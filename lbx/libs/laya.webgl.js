!function(t,e,a){a.un,a.uns;var i=a.static,r=a.class,_=a.getset,n=(a.__newvec,laya.maths.Bezier),s=laya.resource.Bitmap,o=laya.utils.Browser,h=(laya.display.css.CacheStyle,laya.filters.ColorFilter),l=laya.utils.ColorUtils,u=a.Config,c=laya.resource.Context,d=laya.display.cmd.DrawCanvasCmd,f=laya.display.cmd.DrawImageCmd,D=(laya.events.Event,laya.display.cmd.FillTextCmd),m=laya.filters.Filter,C=laya.utils.FontInfo,E=laya.display.Graphics,v=laya.resource.HTMLCanvas,A=(laya.utils.HTMLChar,laya.resource.HTMLImage),R=(laya.utils.Handler,laya.net.Loader,laya.maths.Matrix),T=laya.display.Node,P=(laya.utils.PerfHUD,laya.maths.Point),N=laya.utils.Pool,L=laya.maths.Rectangle,p=laya.renders.Render,b=laya.renders.RenderSprite,S=laya.resource.Resource,x=(laya.resource.ResourceManager,laya.display.cmd.RestoreCmd),M=laya.display.cmd.RotateCmd,y=laya.utils.RunDriver,O=laya.display.cmd.SaveCmd,g=laya.display.cmd.ScaleCmd,B=laya.display.Sprite,w=(laya.display.SpriteConst,laya.display.css.SpriteStyle,laya.display.Stage),I=laya.utils.Stat,F=laya.utils.StringKey,G=laya.system.System,W=laya.display.Text,V=laya.resource.Texture,U=laya.display.cmd.TransformCmd,X=laya.display.cmd.TranslateCmd,k=laya.utils.VectorGraphManager;laya.utils.WordText;a.interface("laya.webgl.submit.ISubmit"),a.interface("laya.webgl.canvas.save.ISaveData");var z=function(){function SaveBase(){}r(SaveBase,"laya.webgl.canvas.save.SaveBase");var t=SaveBase.prototype;return a.imps(t,{"laya.webgl.canvas.save.ISaveData":!0}),t.isSaveMark=function(){return!1},t.restore=function(t){this._dataObj[this._valueName]=this._value,SaveBase.POOL[SaveBase.POOL._length++]=this,this._newSubmit&&(t._curSubmit=Rt.RENDERBASE)},SaveBase._createArray=function(){var t=[];return t._length=0,t},SaveBase._init=function(){var t=SaveBase._namemap={};return t[1]="ALPHA",t[2]="fillStyle",t[8]="font",t[256]="lineWidth",t[512]="strokeStyle",t[8192]="_mergeID",t[1024]=t[2048]=t[4096]=[],t[16384]="textBaseline",t[32768]="textAlign",t[65536]="_nBlendType",t[1048576]="shader",t[2097152]="filters",t[8388608]="_colorFiler",t},SaveBase.save=function(t,e,a,i){if((t._saveMark._saveuse&e)!==e){t._saveMark._saveuse|=e;var r=SaveBase.POOL,_=r._length>0?r[--r._length]:new SaveBase;_._value=a[_._valueName=SaveBase._namemap[e]],_._dataObj=a,_._newSubmit=i;var n=t._save;n[n._length++]=_}},SaveBase.POOL=laya.webgl.canvas.save.SaveBase._createArray(),SaveBase._namemap=SaveBase._init(),SaveBase}(),Y=function(){function Value2D(t,e){this.size=[0,0],this.alpha=1,this.ALPHA=1,this.subID=0,this.ref=1,this._cacheID=0,this.clipMatDir=[99999999,0,0,99999999],this.clipMatPos=[0,0],this.defines=new Gt,this.mainID=t,this.subID=e,this.textureHost=null,this.texture=null,this.color=null,this.colorAdd=null,this.u_mmat2=null,this._cacheID=t|e,this._inClassCache=Value2D._cache[this._cacheID],t>0&&!this._inClassCache&&(this._inClassCache=Value2D._cache[this._cacheID]=[],this._inClassCache._length=0),this.clear()}r(Value2D,"laya.webgl.shader.d2.value.Value2D");var t=Value2D.prototype;return t.setValue=function(t){},t._ShaderWithCompile=function(){return Kt.withCompile2D(0,this.mainID,this.defines.toNameDic(),this.mainID|this.defines._value,te.create,this._attribLocation)},t.upload=function(){var t=bt;bt.worldMatrix4===bt.TEMPMAT4_ARRAY||this.defines.addInt(128),this.mmat=t.worldMatrix4;var e=Kt.sharders[this.mainID|this.defines._value]||this._ShaderWithCompile();e._shaderValueWidth!==t.width||e._shaderValueHeight!==t.height?(this.size[0]=t.width,this.size[1]=t.height,e._shaderValueWidth=t.width,e._shaderValueHeight=t.height,e.upload(this,null)):e.upload(this,e._params2dQuick2||e._make2dQuick2())},t.setFilters=function(t){if(this.filters=t,t)for(var e,a=t.length,i=0;i<a;i++)(e=t[i])&&(this.defines.add(e.type),e.action.setValue(this))},t.clear=function(){this.defines._value=this.subID+(xt.shaderHighPrecision?1024:0)},t.release=function(){--this.ref<1&&(this._inClassCache&&(this._inClassCache[this._inClassCache._length++]=this),this.clear(),this.filters=null,this.ref=1)},Value2D._initone=function(t,e){Value2D._typeClass[t]=e,Value2D._cache[t]=[],Value2D._cache[t]._length=0},Value2D.__init__=function(){Value2D._initone(4,Bt),Value2D._initone(512,gt),Value2D._initone(1,wt),Value2D._initone(9,wt)},Value2D.create=function(t,e){var a=Value2D._cache[t|e];return a._length?a[--a._length]:new Value2D._typeClass[t|e](e)},Value2D._cache=[],Value2D._typeClass=[],Value2D.TEMPMAT4_ARRAY=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],Value2D}(),H=(function(){function AlphaCmdNative(){this._paramData=new ParamData(4,!0)}r(AlphaCmdNative,"laya.layagl.cmdNative.AlphaCmdNative");var t=AlphaCmdNative.prototype;t.recover=function(){N.recover("AlphaCmd",this)},t.run=function(t,e,a){t.alpha(this._alpha)},_(0,t,"cmdID",function(){return"Alpha"}),_(0,t,"alpha",function(){return this._alpha},function(t){t=(t=t>1?1:t)<0?0:t,this._alpha=t;var e=16777215;e|=255*t<<24,this._paramData._int32Data[0]=e,K.syncBufferToRenderThread(this._paramData)}),AlphaCmdNative.create=function(t){var e=N.getItemByClass("AlphaCmd",AlphaCmdNative),a=e._graphicsCmdEncoder=this._commandEncoder;return e.alpha=t,a.setGlobalValueEx(tt.GLOBALVALUE_DRAWTEXTURE_COLOR,15,e._paramData.getPtrID(),0),K.syncBufferToRenderThread(a),e},AlphaCmdNative.ID="Alpha"}(),function(){function ClipRectCmdNative(){this._graphicsCmdEncoder=null,this._paramData=new ParamData(16,!0)}r(ClipRectCmdNative,"laya.layagl.cmdNative.ClipRectCmdNative");var t=ClipRectCmdNative.prototype;t.recover=function(){N.recover("ClipRectCmd",this)},_(0,t,"cmdID",function(){return"ClipRect"}),_(0,t,"width",function(){return 0},function(t){}),_(0,t,"x",function(){return 0},function(t){}),_(0,t,"y",function(){return 0},function(t){}),_(0,t,"height",function(){return 0},function(t){}),ClipRectCmdNative.create=function(t,e,a,i){var r=N.getItemByClass("ClipRectCmd",ClipRectCmdNative);r._graphicsCmdEncoder=this._commandEncoder;var _=r._graphicsCmdEncoder,n=r._paramData._float32Data;n[0]=t,n[1]=e,n[2]=a,n[3]=i;var s=r._paramData.getPtrID();return K.syncBufferToRenderThread(r._paramData),_.setClipValueEx(tt.GLOBALVALUE_CLIP_MAT_DIR,tt.GLOBALVALUE_CLIP_MAT_POS,tt.GLOBALVALUE_MATRIX32,s),K.syncBufferToRenderThread(_),r},ClipRectCmdNative.ID="ClipRect"}(),function(){function DrawCanvasCmdNative(){this._graphicsCmdEncoder=null,this._index=0,this._paramData=null,this._texture=null,this._x=NaN,this._y=NaN,this._width=NaN,this._height=NaN}r(DrawCanvasCmdNative,"laya.layagl.cmdNative.DrawCanvasCmdNative");var t=DrawCanvasCmdNative.prototype;return t.recover=function(){this._graphicsCmdEncoder=null,N.recover("DrawCanvasCmd",this)},_(0,t,"cmdID",function(){return"DrawCanvas"}),_(0,t,"y",function(){return this._y},function(t){this._y=t;var e=this._paramData._float32Data;e[DrawCanvasCmdNative._PARAM_VB_POS_+1]=this._y,e[DrawCanvasCmdNative._PARAM_VB_POS_+7]=this._y,e[DrawCanvasCmdNative._PARAM_VB_POS_+13]=this._y+this._height,e[DrawCanvasCmdNative._PARAM_VB_POS_+19]=this._y+this._height,e[DrawCanvasCmdNative._PARAM_CLIP_SIZE+1]=t+16,K.syncBufferToRenderThread(this._paramData)}),_(0,t,"texture",function(){return this._texture},function(t){this._texture=t,this._paramData._int32Data[DrawCanvasCmdNative._PARAM_TEXTURE_POS_]=this._texture._getSource().id;var e=this._paramData._float32Data,a=$t.flipyuv;e[DrawCanvasCmdNative._PARAM_VB_POS_+2]=a[0],e[DrawCanvasCmdNative._PARAM_VB_POS_+3]=a[1],e[DrawCanvasCmdNative._PARAM_VB_POS_+8]=a[2],e[DrawCanvasCmdNative._PARAM_VB_POS_+9]=a[3],e[DrawCanvasCmdNative._PARAM_VB_POS_+14]=a[4],e[DrawCanvasCmdNative._PARAM_VB_POS_+15]=a[5],e[DrawCanvasCmdNative._PARAM_VB_POS_+20]=a[6],e[DrawCanvasCmdNative._PARAM_VB_POS_+21]=a[7],K.syncBufferToRenderThread(this._paramData)}),_(0,t,"width",function(){return this._width},function(t){this._width=t;var e=this._paramData._float32Data;e[DrawCanvasCmdNative._PARAM_VB_POS_]=this._x,e[DrawCanvasCmdNative._PARAM_VB_POS_+6]=this._x+this._width,e[DrawCanvasCmdNative._PARAM_VB_POS_+12]=this._x+this._width,e[DrawCanvasCmdNative._PARAM_VB_POS_+18]=this._x,e[DrawCanvasCmdNative._PARAM_CLIP_SIZE+2]=t-32,K.syncBufferToRenderThread(this._paramData)}),_(0,t,"x",function(){return this._x},function(t){this._x=t;var e=this._paramData._float32Data;e[DrawCanvasCmdNative._PARAM_VB_POS_]=this._x,e[DrawCanvasCmdNative._PARAM_VB_POS_+6]=this._x+this._width,e[DrawCanvasCmdNative._PARAM_VB_POS_+12]=this._x+this._width,e[DrawCanvasCmdNative._PARAM_VB_POS_+18]=this._x,e[DrawCanvasCmdNative._PARAM_CLIP_SIZE]=t+16,K.syncBufferToRenderThread(this._paramData)}),_(0,t,"height",function(){return this._height},function(t){this._height=t;var e=this._paramData._float32Data;e[DrawCanvasCmdNative._PARAM_VB_POS_+1]=this._y,e[DrawCanvasCmdNative._PARAM_VB_POS_+7]=this._y,e[DrawCanvasCmdNative._PARAM_VB_POS_+13]=this._y+this._height,e[DrawCanvasCmdNative._PARAM_VB_POS_+19]=this._y+this._height,e[DrawCanvasCmdNative._PARAM_CLIP_SIZE+3]=t-32,K.syncBufferToRenderThread(this._paramData)}),DrawCanvasCmdNative.create=function(t,e,a,i,r){var _=N.getItemByClass("DrawCanvasCmd",DrawCanvasCmdNative);_._graphicsCmdEncoder=this._commandEncoder,DrawCanvasCmdNative.createCommandEncoder(),_._paramData||(_._paramData=new ParamData(132,!0)),_._texture=t,_._x=e,_._y=a,_._width=i,_._height=r,DrawCanvasCmdNative.setParamData(_._paramData,t,e,a,i,r);var n=DrawCanvasCmdNative._DRAW_CANVAS_CMD_ENCODER_.getPtrID(),s=_._paramData.getPtrID();return _._graphicsCmdEncoder.useCommandEncoder(n,s,-1),K.syncBufferToRenderThread(_._graphicsCmdEncoder),_},DrawCanvasCmdNative.createCommandEncoder=function(){DrawCanvasCmdNative._DRAW_CANVAS_CMD_ENCODER_||(DrawCanvasCmdNative._DRAW_CANVAS_CMD_ENCODER_=K.instance.createCommandEncoder(124,32,!0),DrawCanvasCmdNative._DRAW_CANVAS_CMD_ENCODER_.blendFuncByGlobalValue(tt.GLOBALVALUE_BLENDFUNC_SRC,tt.GLOBALVALUE_BLENDFUNC_DEST),DrawCanvasCmdNative._DRAW_CANVAS_CMD_ENCODER_.useProgramEx(tt.PROGRAMEX_DRAWTEXTURE),DrawCanvasCmdNative._DRAW_CANVAS_CMD_ENCODER_.useVDO(tt.VDO_MESHQUADTEXTURE),DrawCanvasCmdNative._DRAW_CANVAS_CMD_ENCODER_.uniformEx(tt.GLOBALVALUE_VIEWS,0),DrawCanvasCmdNative._DRAW_CANVAS_CMD_ENCODER_.uniformEx(tt.GLOBALVALUE_CLIP_MAT_DIR,1),DrawCanvasCmdNative._DRAW_CANVAS_CMD_ENCODER_.uniformEx(tt.GLOBALVALUE_CLIP_MAT_POS,2),DrawCanvasCmdNative._DRAW_CANVAS_CMD_ENCODER_.uniformTextureByParamData(0,4,4*DrawCanvasCmdNative._PARAM_TEXTURE_POS_),DrawCanvasCmdNative._DRAW_CANVAS_CMD_ENCODER_.setRectMeshByParamData(12,4*DrawCanvasCmdNative._PARAM_VB_POS_,16),DrawCanvasCmdNative._DRAW_CANVAS_CMD_ENCODER_.modifyMesh(tt.GLOBALVALUE_MATRIX32,0,7),DrawCanvasCmdNative._DRAW_CANVAS_CMD_ENCODER_.modifyMesh(tt.GLOBALVALUE_DRAWTEXTURE_COLOR,1,15),K.syncBufferToRenderThread(DrawCanvasCmdNative._DRAW_CANVAS_CMD_ENCODER_))},DrawCanvasCmdNative.setParamData=function(t,e,a,i,r,_){var n=t._float32Data,s=t._int32Data;s[0]=3,s[1]=33984,s[DrawCanvasCmdNative._PARAM_TEXTURE_POS_]=e._getSource().id,s[3]=1,s[4]=96;var o=0!=r?r:e.width,h=0!=_?_:e.height,l=$t.flipyuv,u=DrawCanvasCmdNative._PARAM_VB_POS_;n[u++]=a,n[u++]=i,n[u++]=l[0],n[u++]=l[1],s[u++]=4294967295,s[u++]=4294967295,n[u++]=a+o,n[u++]=i,n[u++]=l[2],n[u++]=l[3],s[u++]=4294967295,s[u++]=4294967295,n[u++]=a+o,n[u++]=i+h,n[u++]=l[4],n[u++]=l[5],s[u++]=4294967295,s[u++]=4294967295,n[u++]=a,n[u++]=i+h,n[u++]=l[6],n[u++]=l[7],s[u++]=4294967295,s[u++]=4294967295,n[DrawCanvasCmdNative._PARAM_CLIP_SIZE]=a+16,n[DrawCanvasCmdNative._PARAM_CLIP_SIZE+1]=i+16,n[DrawCanvasCmdNative._PARAM_CLIP_SIZE+2]=r-32,n[DrawCanvasCmdNative._PARAM_CLIP_SIZE+3]=_-32,K.syncBufferToRenderThread(t)},DrawCanvasCmdNative.ID="DrawCanvas",DrawCanvasCmdNative._DRAW_CANVAS_CMD_ENCODER_=null,DrawCanvasCmdNative._PARAM_TEXTURE_POS_=2,DrawCanvasCmdNative._PARAM_VB_POS_=5,DrawCanvasCmdNative._PARAM_CLIP_SIZE=29,DrawCanvasCmdNative}()),Z=(function(){function DrawCircleCmdNative(){this._graphicsCmdEncoder=null,this._paramData=null,this._paramID=null,this._x=NaN,this._y=NaN,this._radius=NaN,this._fillColor=null,this._lineColor=null,this._lineWidth=NaN,this._vertNum=0,this._line_vertNum=0,this.ibBuffer=null,this.vbBuffer=null,this.line_ibBuffer=null,this.line_vbBuffer=null,this._ibSize=0,this._vbSize=0,this._line_ibSize=0,this._line_vbSize=0,this._cmdCurrentPos=0,this._points=[],this._linePoints=[],this._line_vbArray=[],this._line_ibArray=[]}r(DrawCircleCmdNative,"laya.layagl.cmdNative.DrawCircleCmdNative");var t=DrawCircleCmdNative.prototype;t._arc=function(t,e,a,i,r){void 0===i&&(i=!1),void 0===r&&(r=!0);var _,n=[],s=0,o=0,h=0,l=0,u=0,c=0,d=0;if(o=2*Math.PI-0,i)if(Math.abs(o)>=2*Math.PI)o=2*-Math.PI;else for(;o>0;)o-=2*Math.PI;else if(Math.abs(o)>=2*Math.PI)o=2*Math.PI;else for(;o<0;)o+=2*Math.PI;_=o/(d=a<101?Math.max(10,o*a/5):a<201?Math.max(10,o*a/20):Math.max(10,o*a/40))/2,h=Math.abs(4/3*(1-Math.cos(_))/Math.sin(_)),i&&(h=-h);for(c=0;c<=d;c++)s=0+o*(c/d),l=t+Math.cos(s)*a,u=e+Math.sin(s)*a,n.push(l),n.push(u);return n},t.recover=function(){this._fillColor=null,this._lineColor=null,this._points.length=0,this._linePoints.length=0,this._line_vbArray.length=0,this._line_ibArray.length=0,N.recover("DrawCircleCmd",this)},_(0,t,"lineColor",function(){return this._lineColor},function(t){!this._lineColor&&this._lineWidth&&(this._graphicsCmdEncoder._idata[this._cmdCurrentPos+1]=DrawCircleCmdNative._DRAW_CIRCLE_LINES_CMD_ENCODER_.getPtrID(),K.syncBufferToRenderThread(this._graphicsCmdEncoder)),this._lineColor=t,this._linePoints.length=0,this._line_ibArray.length=0,this._line_vbArray.length=0;for(var e=0;e<this._points.length;e++)this._linePoints.push(this._points[e]);this._linePoints.push(this._points[0]),this._linePoints.push(this._points[1]),Et.createLine2(this._linePoints,this._line_ibArray,this._lineWidth,0,this._line_vbArray,!1),this._line_vertNum=this._linePoints.length;var a=this._line_vertNum;(!this.line_ibBuffer||this.line_ibBuffer.getByteLength()<3*(this._line_vertNum-2)*2)&&(this.line_ibBuffer=new ParamData(3*(a-2)*2,!0,!0)),this._line_ibSize=3*(this._line_vertNum-2)*2;for(var i=this.line_ibBuffer._int16Data,r=0,_=0;_<3*(this._line_vertNum-2);_++)i[r++]=this._line_ibArray[_];(!this.line_vbBuffer||this.line_vbBuffer.getByteLength()<3*this._line_vertNum*4)&&(this.line_vbBuffer=new ParamData(3*a*4,!0)),this._line_vbSize=3*this._line_vertNum*4;var n=l.create(t).numColor,s=this.line_vbBuffer._float32Data,o=this.line_vbBuffer._int32Data,h=0;for(e=0;e<this._line_vertNum;e++)s[h++]=this._line_vbArray[2*e]+this.x,s[h++]=this._line_vbArray[2*e+1]+this.y,o[h++]=n;var u=this._paramData._int32Data;u[DrawCircleCmdNative._PARAM_LINE_VB_POS_]=this.line_vbBuffer.getPtrID(),u[DrawCircleCmdNative._PARAM_LINE_IB_POS_]=this.line_ibBuffer.getPtrID(),u[DrawCircleCmdNative._PARAM_LINE_VB_SIZE_POS_]=this._line_vbSize,u[DrawCircleCmdNative._PARAM_LINE_IB_SIZE_POS_]=this._line_ibSize,K.syncBufferToRenderThread(this.line_vbBuffer),K.syncBufferToRenderThread(this.line_ibBuffer),K.syncBufferToRenderThread(this._paramData)}),_(0,t,"cmdID",function(){return"DrawCircle"}),_(0,t,"fillColor",function(){return this._fillColor},function(t){this._fillColor=t;for(var e=l.create(this._fillColor).numColor,a=this.vbBuffer._int32Data,i=0,r=0;r<this._vertNum;r++)i++,i++,a[i++]=e;K.syncBufferToRenderThread(this.vbBuffer)}),_(0,t,"x",function(){return this._x},function(t){this._x=t;for(var e=this.vbBuffer._float32Data,a=0,i=0;i<this._vertNum;i++)e[a++]=this._points[2*i]+this._x,a++,a++;if(this._lineColor){var r=this.line_vbBuffer._float32Data;for(a=0,i=0;i<this._line_vertNum;i++)r[a++]=this._line_vbArray[2*i]+this._x,a++,a++;K.syncBufferToRenderThread(this.line_vbBuffer)}K.syncBufferToRenderThread(this.vbBuffer)}),_(0,t,"y",function(){return this._y},function(t){this._y=t;for(var e=this.vbBuffer._float32Data,a=0,i=0;i<this._vertNum;i++)a++,e[a++]=this._points[2*i+1]+this._y,a++;if(this._lineColor){var r=this.line_vbBuffer._float32Data;for(a=0,i=0;i<this._line_vertNum;i++)a++,r[a++]=this._line_vbArray[2*i+1]+this._y,a++;K.syncBufferToRenderThread(this.line_vbBuffer)}K.syncBufferToRenderThread(this.vbBuffer)}),_(0,t,"radius",function(){return this._radius},function(t){this._points=this._arc(0,0,t),this._vertNum=this._points.length/2;var e=this._vertNum,a=0;this._linePoints.length=0,this._line_ibArray.length=0,this._line_vbArray.length=0;var i=this._vertNum-2;(!this.ibBuffer||this.ibBuffer.getByteLength()<3*i*2)&&(this.ibBuffer=new ParamData(3*i*2,!0,!0)),this._ibSize=3*i*2;for(var r=this.ibBuffer._int16Data,_=0,n=0;n<i;n++)r[_++]=0,r[_++]=n+1+0,r[_++]=n+2+0;(!this.vbBuffer||this.vbBuffer.getByteLength()<3*this._vertNum*4)&&(this.vbBuffer=new ParamData(3*e*4,!0)),this._vbSize=3*this._vertNum*4;for(var s=l.create(this._fillColor).numColor,o=this.vbBuffer._float32Data,h=this.vbBuffer._int32Data,u=0,c=0;c<this._vertNum;c++)o[u++]=this._points[2*c]+this._x,o[u++]=this._points[2*c+1]+this._y,h[u++]=s;if(this._lineColor){for(c=0;c<this._points.length;c++)this._linePoints.push(this._points[c]);this._linePoints.push(this._points[0]),this._linePoints.push(this._points[1]),Et.createLine2(this._linePoints,this._line_ibArray,this._lineWidth,0,this._line_vbArray,!1),this._line_vertNum=this._linePoints.length,a=this._line_vertNum,(!this.line_ibBuffer||this.line_ibBuffer.getByteLength()<3*(this._line_vertNum-2)*2)&&(this.line_ibBuffer=new ParamData(3*(a-2)*2,!0,!0)),this._line_ibSize=3*(this._line_vertNum-2)*2;var d=this.line_ibBuffer._int16Data;_=0;for(var f=0;f<3*(this._line_vertNum-2);f++)d[_++]=this._line_ibArray[f];(!this.line_vbBuffer||this.line_vbBuffer.getByteLength()<3*this._line_vertNum*4)&&(this.line_vbBuffer=new ParamData(3*a*4,!0)),this._line_vbSize=3*this._line_vertNum*4;var D=l.create(this._lineColor).numColor,m=this.line_vbBuffer._float32Data,C=this.line_vbBuffer._int32Data;for(u=0,c=0;c<this._line_vertNum;c++)m[u++]=this._line_vbArray[2*c]+this._x,m[u++]=this._line_vbArray[2*c+1]+this._y,C[u++]=D}var E=this._paramData._int32Data;E[DrawCircleCmdNative._PARAM_VB_POS_]=this.vbBuffer.getPtrID(),E[DrawCircleCmdNative._PARAM_IB_POS_]=this.ibBuffer.getPtrID(),E[DrawCircleCmdNative._PARAM_VB_SIZE_POS_]=this._vbSize,E[DrawCircleCmdNative._PARAM_IB_SIZE_POS_]=this._ibSize,K.syncBufferToRenderThread(this.vbBuffer),K.syncBufferToRenderThread(this.ibBuffer),this._lineColor&&(E[DrawCircleCmdNative._PARAM_LINE_VB_POS_]=this.line_vbBuffer.getPtrID(),E[DrawCircleCmdNative._PARAM_LINE_IB_POS_]=this.line_ibBuffer.getPtrID(),E[DrawCircleCmdNative._PARAM_LINE_VB_SIZE_POS_]=this._line_vbSize,E[DrawCircleCmdNative._PARAM_LINE_IB_SIZE_POS_]=this._line_ibSize,K.syncBufferToRenderThread(this.line_vbBuffer),K.syncBufferToRenderThread(this.line_ibBuffer)),K.syncBufferToRenderThread(this._paramData)}),_(0,t,"lineWidth",function(){return this._lineWidth},function(t){!this._lineWidth&&this._lineColor&&(this._graphicsCmdEncoder._idata[this._cmdCurrentPos+1]=DrawCircleCmdNative._DRAW_CIRCLE_LINES_CMD_ENCODER_.getPtrID(),K.syncBufferToRenderThread(this._graphicsCmdEncoder)),this._lineWidth=t,this._linePoints.length=0,this._line_ibArray.length=0,this._line_vbArray.length=0;for(var e=0;e<this._points.length;e++)this._linePoints.push(this._points[e]);this._linePoints.push(this._points[0]),this._linePoints.push(this._points[1]),Et.createLine2(this._linePoints,this._line_ibArray,t,0,this._line_vbArray,!1),this._line_vertNum=this._linePoints.length;var a=this._line_vertNum;(!this.line_ibBuffer||this.line_ibBuffer.getByteLength()<3*(this._line_vertNum-2)*2)&&(this.line_ibBuffer=new ParamData(3*(a-2)*2,!0,!0)),this._line_ibSize=3*(this._line_vertNum-2)*2;for(var i=this.line_ibBuffer._int16Data,r=0,_=0;_<3*(this._line_vertNum-2);_++)i[r++]=this._line_ibArray[_];(!this.line_vbBuffer||this.line_vbBuffer.getByteLength()<3*this._line_vertNum*4)&&(this.line_vbBuffer=new ParamData(3*a*4,!0)),this._line_vbSize=3*this._line_vertNum*4;var n=l.create(this._lineColor).numColor,s=this.line_vbBuffer._float32Data,o=this.line_vbBuffer._int32Data,h=0;for(e=0;e<this._line_vertNum;e++)s[h++]=this._line_vbArray[2*e]+this.x,s[h++]=this._line_vbArray[2*e+1]+this.y,o[h++]=n;var u=this._paramData._int32Data;u[DrawCircleCmdNative._PARAM_LINE_VB_POS_]=this.line_vbBuffer.getPtrID(),u[DrawCircleCmdNative._PARAM_LINE_IB_POS_]=this.line_ibBuffer.getPtrID(),u[DrawCircleCmdNative._PARAM_LINE_VB_SIZE_POS_]=this._line_vbSize,u[DrawCircleCmdNative._PARAM_LINE_IB_SIZE_POS_]=this._line_ibSize,K.syncBufferToRenderThread(this.line_vbBuffer),K.syncBufferToRenderThread(this.line_ibBuffer),K.syncBufferToRenderThread(this._paramData)}),DrawCircleCmdNative.create=function(t,e,a,i,r,_,n){var s=N.getItemByClass("DrawCircleCmd",DrawCircleCmdNative);s._graphicsCmdEncoder=this._commandEncoder,DrawCircleCmdNative._DRAW_CIRCLE_LINES_CMD_ENCODER_||(DrawCircleCmdNative._DRAW_CIRCLE_LINES_CMD_ENCODER_=K.instance.createCommandEncoder(140,32,!0),DrawCircleCmdNative._DRAW_CIRCLE_LINES_CMD_ENCODER_.blendFuncByGlobalValue(tt.GLOBALVALUE_BLENDFUNC_SRC,tt.GLOBALVALUE_BLENDFUNC_DEST),DrawCircleCmdNative._DRAW_CIRCLE_LINES_CMD_ENCODER_.useProgramEx(tt.PROGRAMEX_DRAWVG),DrawCircleCmdNative._DRAW_CIRCLE_LINES_CMD_ENCODER_.useVDO(tt.VDO_MESHVG),DrawCircleCmdNative._DRAW_CIRCLE_LINES_CMD_ENCODER_.uniformEx(tt.GLOBALVALUE_VIEWS,0),DrawCircleCmdNative._DRAW_CIRCLE_LINES_CMD_ENCODER_.uniformEx(tt.GLOBALVALUE_CLIP_MAT_DIR,1),DrawCircleCmdNative._DRAW_CIRCLE_LINES_CMD_ENCODER_.uniformEx(tt.GLOBALVALUE_CLIP_MAT_POS,2),DrawCircleCmdNative._DRAW_CIRCLE_LINES_CMD_ENCODER_.setMeshExByParamData(4*DrawCircleCmdNative._PARAM_VB_POS_,4*DrawCircleCmdNative._PARAM_VB_OFFSET_POS_,4*DrawCircleCmdNative._PARAM_VB_SIZE_POS_,4*DrawCircleCmdNative._PARAM_IB_POS_,4*DrawCircleCmdNative._PARAM_IB_OFFSET_POS_,4*DrawCircleCmdNative._PARAM_IB_SIZE_POS_,4*DrawCircleCmdNative._PARAM_INDEX_ELEMENT_OFFSET_POS_),DrawCircleCmdNative._DRAW_CIRCLE_LINES_CMD_ENCODER_.modifyMesh(tt.GLOBALVALUE_MATRIX32,0,7),DrawCircleCmdNative._DRAW_CIRCLE_LINES_CMD_ENCODER_.modifyMesh(tt.GLOBALVALUE_DRAWTEXTURE_COLOR,1,15),DrawCircleCmdNative._DRAW_CIRCLE_LINES_CMD_ENCODER_.setMeshExByParamData(4*DrawCircleCmdNative._PARAM_LINE_VB_POS_,4*DrawCircleCmdNative._PARAM_LINE_VB_OFFSET_POS_,4*DrawCircleCmdNative._PARAM_LINE_VB_SIZE_POS_,4*DrawCircleCmdNative._PARAM_LINE_IB_POS_,4*DrawCircleCmdNative._PARAM_LINE_IB_OFFSET_POS_,4*DrawCircleCmdNative._PARAM_LINE_IB_SIZE_POS_,4*DrawCircleCmdNative._PARAM_LINE_INDEX_ELEMENT_OFFSET_POS_),DrawCircleCmdNative._DRAW_CIRCLE_LINES_CMD_ENCODER_.modifyMesh(tt.GLOBALVALUE_MATRIX32,0,7),DrawCircleCmdNative._DRAW_CIRCLE_LINES_CMD_ENCODER_.modifyMesh(tt.GLOBALVALUE_DRAWTEXTURE_COLOR,1,15),K.syncBufferToRenderThread(DrawCircleCmdNative._DRAW_CIRCLE_LINES_CMD_ENCODER_)),DrawCircleCmdNative._DRAW_CIRCLE_CMD_ENCODER_||(DrawCircleCmdNative._DRAW_CIRCLE_CMD_ENCODER_=K.instance.createCommandEncoder(88,32,!0),DrawCircleCmdNative._DRAW_CIRCLE_CMD_ENCODER_.blendFuncByGlobalValue(tt.GLOBALVALUE_BLENDFUNC_SRC,tt.GLOBALVALUE_BLENDFUNC_DEST),DrawCircleCmdNative._DRAW_CIRCLE_CMD_ENCODER_.useProgramEx(tt.PROGRAMEX_DRAWVG),DrawCircleCmdNative._DRAW_CIRCLE_CMD_ENCODER_.useVDO(tt.VDO_MESHVG),DrawCircleCmdNative._DRAW_CIRCLE_CMD_ENCODER_.uniformEx(tt.GLOBALVALUE_VIEWS,0),DrawCircleCmdNative._DRAW_CIRCLE_CMD_ENCODER_.uniformEx(tt.GLOBALVALUE_CLIP_MAT_DIR,1),DrawCircleCmdNative._DRAW_CIRCLE_CMD_ENCODER_.uniformEx(tt.GLOBALVALUE_CLIP_MAT_POS,2),DrawCircleCmdNative._DRAW_CIRCLE_CMD_ENCODER_.setMeshExByParamData(4*DrawCircleCmdNative._PARAM_VB_POS_,4*DrawCircleCmdNative._PARAM_VB_OFFSET_POS_,4*DrawCircleCmdNative._PARAM_VB_SIZE_POS_,4*DrawCircleCmdNative._PARAM_IB_POS_,4*DrawCircleCmdNative._PARAM_IB_OFFSET_POS_,4*DrawCircleCmdNative._PARAM_IB_SIZE_POS_,4*DrawCircleCmdNative._PARAM_INDEX_ELEMENT_OFFSET_POS_),DrawCircleCmdNative._DRAW_CIRCLE_CMD_ENCODER_.modifyMesh(tt.GLOBALVALUE_MATRIX32,0,7),DrawCircleCmdNative._DRAW_CIRCLE_CMD_ENCODER_.modifyMesh(tt.GLOBALVALUE_DRAWTEXTURE_COLOR,1,15),K.syncBufferToRenderThread(DrawCircleCmdNative._DRAW_CIRCLE_CMD_ENCODER_)),s._paramData||(s._paramData=new ParamData(72,!0)),s._x=t,s._y=e,s._radius=a,s._fillColor=i,s._lineColor=r,s._lineWidth=_,s._points=s._arc(0,0,a),s._vertNum=s._points.length/2;var o=s._vertNum,h=s._vertNum-2;(!s.ibBuffer||s.ibBuffer.getByteLength()<3*h*2)&&(s.ibBuffer=new ParamData(3*h*2,!0,!0)),s._ibSize=3*h*2;for(var u=s.ibBuffer._int16Data,c=0,d=0;d<h;d++)u[c++]=0,u[c++]=d+1+0,u[c++]=d+2+0;var f=l.create(i).numColor;(!s.vbBuffer||s.vbBuffer.getByteLength()<3*s._vertNum*4)&&(s.vbBuffer=new ParamData(3*o*4,!0)),s._vbSize=3*s._vertNum*4;for(var D=s.vbBuffer._float32Data,m=s.vbBuffer._int32Data,C=0,E=0;E<s._vertNum;E++)D[C++]=s._points[2*E]+t,D[C++]=s._points[2*E+1]+e,m[C++]=f;var v=0;for(E=0;E<s._points.length;E++)s._linePoints.push(s._points[E]);if(s._linePoints.push(s._points[0]),s._linePoints.push(s._points[1]),r){Et.createLine2(s._linePoints,s._line_ibArray,_,0,s._line_vbArray,!1),s._line_vertNum=s._linePoints.length,v=s._line_vertNum,(!s.line_ibBuffer||s.line_ibBuffer.getByteLength()<3*(s._line_vertNum-2)*2)&&(s.line_ibBuffer=new ParamData(3*(v-2)*2,!0,!0)),s._line_ibSize=3*(s._line_vertNum-2)*2;var A=s.line_ibBuffer._int16Data;c=0;for(var R=0;R<3*(s._line_vertNum-2);R++)A[c++]=s._line_ibArray[R];(!s.line_vbBuffer||s.line_vbBuffer.getByteLength()<3*s._line_vertNum*4)&&(s.line_vbBuffer=new ParamData(3*v*4,!0)),s._line_vbSize=3*s._line_vertNum*4;var T=l.create(r),P=T.numColor,L=s.line_vbBuffer._float32Data,p=s.line_vbBuffer._int32Data;for(C=0,E=0;E<s._line_vertNum;E++)L[C++]=s._line_vbArray[2*E]+t,L[C++]=s._line_vbArray[2*E+1]+e,p[C++]=P}else{s._lineWidth=1;for(Et.createLine2(s._linePoints,s._line_ibArray,s._lineWidth,0,s._line_vbArray,!1),s._line_vertNum=s._linePoints.length,v=s._line_vertNum,(!s.line_ibBuffer||s.line_ibBuffer.getByteLength()<3*(s._line_vertNum-2)*2)&&(s.line_ibBuffer=new ParamData(3*(v-2)*2,!0,!0)),s._line_ibSize=3*(s._line_vertNum-2)*2,A=s.line_ibBuffer._int16Data,c=0,R=0;R<3*(s._line_vertNum-2);R++)A[c++]=s._line_ibArray[R];for((!s.line_vbBuffer||s.line_vbBuffer.getByteLength()<3*s._line_vertNum*4)&&(s.line_vbBuffer=new ParamData(3*v*4,!0)),s._line_vbSize=3*s._line_vertNum*4,P=(T=l.create("#FFFFFF")).numColor,L=s.line_vbBuffer._float32Data,p=s.line_vbBuffer._int32Data,C=0,E=0;E<s._line_vertNum;E++)L[C++]=s._line_vbArray[2*E]+t,L[C++]=s._line_vbArray[2*E+1]+e,p[C++]=P}var b=s._paramData._float32Data,S=s._paramData._int32Data;return S[0]=1,S[1]=32,S[DrawCircleCmdNative._PARAM_VB_POS_]=s.vbBuffer.getPtrID(),S[DrawCircleCmdNative._PARAM_IB_POS_]=s.ibBuffer.getPtrID(),S[DrawCircleCmdNative._PARAM_VB_SIZE_POS_]=s._vbSize,S[DrawCircleCmdNative._PARAM_IB_SIZE_POS_]=s._ibSize,S[DrawCircleCmdNative._PARAM_VB_OFFSET_POS_]=0,S[DrawCircleCmdNative._PARAM_IB_OFFSET_POS_]=0,S[DrawCircleCmdNative._PARAM_INDEX_ELEMENT_OFFSET_POS_]=0,K.syncBufferToRenderThread(s.vbBuffer),K.syncBufferToRenderThread(s.ibBuffer),S[DrawCircleCmdNative._PARAM_LINE_VB_POS_]=s.line_vbBuffer.getPtrID(),S[DrawCircleCmdNative._PARAM_LINE_IB_POS_]=s.line_ibBuffer.getPtrID(),b[DrawCircleCmdNative._PARAM_LINECOLOR_POS_]=r,b[DrawCircleCmdNative._PARAM_LINEWIDTH_POS_]=_,S[DrawCircleCmdNative._PARAM_LINE_VB_SIZE_POS_]=s._line_vbSize,S[DrawCircleCmdNative._PARAM_LINE_IB_SIZE_POS_]=s._line_ibSize,S[DrawCircleCmdNative._PARAM_LINE_VB_OFFSET_POS_]=0,S[DrawCircleCmdNative._PARAM_LINE_IB_OFFSET_POS_]=0,S[DrawCircleCmdNative._PARAM_LINE_INDEX_ELEMENT_OFFSET_POS_]=0,K.syncBufferToRenderThread(s.line_vbBuffer),K.syncBufferToRenderThread(s.line_ibBuffer),K.syncBufferToRenderThread(s._paramData),s._cmdCurrentPos=r?s._graphicsCmdEncoder.useCommandEncoder(DrawCircleCmdNative._DRAW_CIRCLE_LINES_CMD_ENCODER_.getPtrID(),s._paramData.getPtrID(),-1):s._graphicsCmdEncoder.useCommandEncoder(DrawCircleCmdNative._DRAW_CIRCLE_CMD_ENCODER_.getPtrID(),s._paramData.getPtrID(),-1),K.syncBufferToRenderThread(s._graphicsCmdEncoder),s},DrawCircleCmdNative.ID="DrawCircle",DrawCircleCmdNative._DRAW_CIRCLE_CMD_ENCODER_=null,DrawCircleCmdNative._DRAW_CIRCLE_LINES_CMD_ENCODER_=null,DrawCircleCmdNative._PARAM_VB_POS_=2,DrawCircleCmdNative._PARAM_IB_POS_=3,DrawCircleCmdNative._PARAM_LINE_VB_POS_=4,DrawCircleCmdNative._PARAM_LINE_IB_POS_=5,DrawCircleCmdNative._PARAM_LINECOLOR_POS_=6,DrawCircleCmdNative._PARAM_LINEWIDTH_POS_=7,DrawCircleCmdNative._PARAM_VB_SIZE_POS_=8,DrawCircleCmdNative._PARAM_IB_SIZE_POS_=9,DrawCircleCmdNative._PARAM_LINE_VB_SIZE_POS_=10,DrawCircleCmdNative._PARAM_LINE_IB_SIZE_POS_=11,DrawCircleCmdNative._PARAM_VB_OFFSET_POS_=12,DrawCircleCmdNative._PARAM_IB_OFFSET_POS_=13,DrawCircleCmdNative._PARAM_LINE_VB_OFFSET_POS_=14,DrawCircleCmdNative._PARAM_LINE_IB_OFFSET_POS_=15,DrawCircleCmdNative._PARAM_INDEX_ELEMENT_OFFSET_POS_=16,DrawCircleCmdNative._PARAM_LINE_INDEX_ELEMENT_OFFSET_POS_=17}(),function(){function DrawCurvesCmdNative(){this._graphicsCmdEncoder=null,this._paramData=null,this._x=0,this._y=0,this._points=[],this._lineColor=null,this._lineWidth=NaN,this.lastOriX=0,this.lastOriY=0,this.tArray=[],this._vertNum=0,this.ibBuffer=null,this.vbBuffer=null,this._ibSize=0,this._vbSize=0,this._ibArray=[],this._vbArray=[]}r(DrawCurvesCmdNative,"laya.layagl.cmdNative.DrawCurvesCmdNative");var t=DrawCurvesCmdNative.prototype;t._getPoints=function(t){var e=[];this._points.push(t[0]),this._points.push(t[1]);for(var a=2,i=t.length;a<i;)this._quadraticCurveTo(e,t[a++],t[a++],t[a++],t[a++]);return e},t._quadraticCurveTo=function(t,e,a,i,r){var _=n.I;0==this.tArray.length?(this.lastOriX=this._points[0],this.lastOriY=this._points[1]):(this.lastOriX=this.tArray[this.tArray.length-2],this.lastOriY=this.tArray[this.tArray.length-1]),this.tArray=_.getBezierPoints([this.lastOriX,this.lastOriY,e,a,i,r],30,2);for(var s=2,o=this.tArray.length;s<o;s++)t.push(this.tArray[s])},t.recover=function(){this._lineColor=null,this._points.length=0,this.tArray.length=0,this._ibArray.length=0,this._vbArray.length=0,N.recover("DrawCurvesCmd",this)},_(0,t,"lineColor",function(){return this._lineColor},function(t){this._lineColor=t;for(var e=l.create(this._lineColor).numColor,a=this.vbBuffer._int32Data,i=0,r=0;r<this._vertNum;r++)i++,i++,a[i++]=e;K.syncBufferToRenderThread(this.vbBuffer)}),_(0,t,"points",function(){return this._points},function(t){this._points.length=0,this.lastOriX=0,this.lastOriY=0,this._points=this._getPoints(t),this._ibArray.length=0,this._vbArray.length=0,Et.createLine2(this._points,this._ibArray,this.lineWidth,0,this._vbArray,!1);var e=l.create(this._lineColor).numColor;this._vertNum=this._points.length;var a=this._vertNum;(!this.vbBuffer||this.vbBuffer.getByteLength()<3*this._vertNum*4)&&(this.vbBuffer=new ParamData(3*a*4,!0)),this._vbSize=3*this._vertNum*4;for(var i=this.vbBuffer._float32Data,r=this.vbBuffer._int32Data,_=0,n=0;n<this._vertNum;n++)i[_++]=this._vbArray[2*n]+this.x,i[_++]=this._vbArray[2*n+1]+this.y,r[_++]=e;(!this.ibBuffer||this.ibBuffer.getByteLength()<3*(this._vertNum-2)*2)&&(this.ibBuffer=new ParamData(3*(a-2)*2,!0,!0)),this._ibSize=3*(this._vertNum-2)*2;for(var s=this.ibBuffer._int16Data,o=0;o<3*(this._vertNum-2);o++)s[o]=this._ibArray[o];(r=this._paramData._int32Data)[DrawCurvesCmdNative._PARAM_VB_SIZE_POS_]=this._vbSize,r[DrawCurvesCmdNative._PARAM_IB_SIZE_POS_]=this._ibSize,K.syncBufferToRenderThread(this.ibBuffer),K.syncBufferToRenderThread(this.vbBuffer),K.syncBufferToRenderThread(this._paramData)}),_(0,t,"cmdID",function(){return"DrawCurves"}),_(0,t,"x",function(){return this._x},function(t){this._x=t;for(var e=this.vbBuffer._float32Data,a=0,i=0;i<this._vertNum;i++)e[a++]=this._vbArray[2*i]+this._x,a++,a++;K.syncBufferToRenderThread(this.vbBuffer)}),_(0,t,"y",function(){return this._y},function(t){this._y=t;for(var e=this.vbBuffer._float32Data,a=0,i=0;i<this._vertNum;i++)a++,e[a++]=this._vbArray[2*i+1]+this._y,a++;K.syncBufferToRenderThread(this.vbBuffer)}),_(0,t,"lineWidth",function(){return this._lineWidth},function(t){this._lineWidth=t,this._ibArray.length=0,this._vbArray.length=0,Et.createLine2(this._points,this._ibArray,this._lineWidth,0,this._vbArray,!1);for(var e=this.vbBuffer._float32Data,a=0,i=0;i<this._vertNum;i++)e[a++]=this._vbArray[2*i]+this.x,e[a++]=this._vbArray[2*i+1]+this.y,a++;K.syncBufferToRenderThread(this.vbBuffer)}),DrawCurvesCmdNative.create=function(t,e,a,i,r){var _=N.getItemByClass("DrawCurvesCmd",DrawCurvesCmdNative);_._graphicsCmdEncoder=this._commandEncoder,DrawCurvesCmdNative._DRAW_CURVES_CMD_ENCODER_||(DrawCurvesCmdNative._DRAW_CURVES_CMD_ENCODER_=K.instance.createCommandEncoder(88,32,!0),DrawCurvesCmdNative._DRAW_CURVES_CMD_ENCODER_.useProgramEx(tt.PROGRAMEX_DRAWVG),DrawCurvesCmdNative._DRAW_CURVES_CMD_ENCODER_.useVDO(tt.VDO_MESHVG),DrawCurvesCmdNative._DRAW_CURVES_CMD_ENCODER_.uniformEx(tt.GLOBALVALUE_VIEWS,0),DrawCurvesCmdNative._DRAW_CURVES_CMD_ENCODER_.uniformEx(tt.GLOBALVALUE_CLIP_MAT_DIR,1),DrawCurvesCmdNative._DRAW_CURVES_CMD_ENCODER_.uniformEx(tt.GLOBALVALUE_CLIP_MAT_POS,2),DrawCurvesCmdNative._DRAW_CURVES_CMD_ENCODER_.setMeshExByParamData(4*DrawCurvesCmdNative._PARAM_VB_POS_,4*DrawCurvesCmdNative._PARAM_VB_OFFSET_POS_,4*DrawCurvesCmdNative._PARAM_VB_SIZE_POS_,4*DrawCurvesCmdNative._PARAM_IB_POS_,4*DrawCurvesCmdNative._PARAM_IB_OFFSET_POS_,4*DrawCurvesCmdNative._PARAM_IB_SIZE_POS_,4*DrawCurvesCmdNative._PARAM_INDEX_ELEMENT_OFFSET_POS_),DrawCurvesCmdNative._DRAW_CURVES_CMD_ENCODER_.modifyMesh(tt.GLOBALVALUE_MATRIX32,0,7),DrawCurvesCmdNative._DRAW_CURVES_CMD_ENCODER_.modifyMesh(tt.GLOBALVALUE_DRAWTEXTURE_COLOR,1,15),K.syncBufferToRenderThread(DrawCurvesCmdNative._DRAW_CURVES_CMD_ENCODER_)),_._paramData||(_._paramData=new ParamData(32,!0)),_._x=t,_._y=e,_._lineColor=i,_._lineWidth=r,_._points=_._getPoints(a),Et.createLine2(_._points,_._ibArray,r,0,_._vbArray,!1);var n=l.create(i).numColor;_._vertNum=_._points.length;var s=_._vertNum;(!_.vbBuffer||_.vbBuffer.getByteLength()<3*_._vertNum*4)&&(_.vbBuffer=new ParamData(3*s*4,!0)),_._vbSize=3*_._vertNum*4;for(var o=_.vbBuffer._float32Data,h=_.vbBuffer._int32Data,u=0,c=0;c<_._vertNum;c++)o[u++]=_._vbArray[2*c]+t,o[u++]=_._vbArray[2*c+1]+e,h[u++]=n;(!_.ibBuffer||_.ibBuffer.getByteLength()<3*(_._vertNum-2)*2)&&(_.ibBuffer=new ParamData(3*(s-2)*2,!0,!0)),_._ibSize=3*(_._vertNum-2)*2;for(var d=_.ibBuffer._int16Data,f=0;f<3*(_._vertNum-2);f++)d[f]=_._ibArray[f];_._paramData._float32Data;return(h=_._paramData._int32Data)[0]=1,h[DrawCurvesCmdNative._PARAM_VB_POS_]=_.vbBuffer.getPtrID(),h[DrawCurvesCmdNative._PARAM_IB_POS_]=_.ibBuffer.getPtrID(),h[DrawCurvesCmdNative._PARAM_VB_SIZE_POS_]=_._vbSize,h[DrawCurvesCmdNative._PARAM_IB_SIZE_POS_]=_._ibSize,h[DrawCurvesCmdNative._PARAM_VB_OFFSET_POS_]=0,h[DrawCurvesCmdNative._PARAM_IB_OFFSET_POS_]=0,h[DrawCurvesCmdNative._PARAM_INDEX_ELEMENT_OFFSET_POS_]=0,K.syncBufferToRenderThread(_.vbBuffer),K.syncBufferToRenderThread(_.ibBuffer),K.syncBufferToRenderThread(_._paramData),_._graphicsCmdEncoder.useCommandEncoder(DrawCurvesCmdNative._DRAW_CURVES_CMD_ENCODER_.getPtrID(),_._paramData.getPtrID(),-1),K.syncBufferToRenderThread(_._graphicsCmdEncoder),_},DrawCurvesCmdNative.ID="DrawCurves",DrawCurvesCmdNative._DRAW_CURVES_CMD_ENCODER_=null,DrawCurvesCmdNative._PARAM_VB_POS_=1,DrawCurvesCmdNative._PARAM_IB_POS_=2,DrawCurvesCmdNative._PARAM_VB_SIZE_POS_=3,DrawCurvesCmdNative._PARAM_IB_SIZE_POS_=4,DrawCurvesCmdNative._PARAM_VB_OFFSET_POS_=5,DrawCurvesCmdNative._PARAM_IB_OFFSET_POS_=6,DrawCurvesCmdNative._PARAM_INDEX_ELEMENT_OFFSET_POS_=7}(),function(){function DrawImageCmdNative(){this._graphicsCmdEncoder=null,this._index=0,this._paramData=null,this._texture=null,this._x=NaN,this._y=NaN,this._width=NaN,this._height=NaN}r(DrawImageCmdNative,"laya.layagl.cmdNative.DrawImageCmdNative");var t=DrawImageCmdNative.prototype;t.recover=function(){this._graphicsCmdEncoder=null,N.recover("DrawImageCmd",this)},_(0,t,"cmdID",function(){return"DrawImage"}),_(0,t,"y",function(){return this._y},function(t){this._y=t;var e=this._paramData._float32Data;e[DrawImageCmdNative._PARAM_VB_POS_+1]=this._y,e[DrawImageCmdNative._PARAM_VB_POS_+7]=this._y,e[DrawImageCmdNative._PARAM_VB_POS_+13]=this._y+this._height,e[DrawImageCmdNative._PARAM_VB_POS_+19]=this._y+this._height,K.syncBufferToRenderThread(this._paramData)}),_(0,t,"texture",function(){return this._texture},function(t){this._texture=t,this._paramData._int32Data[DrawImageCmdNative._PARAM_TEXTURE_POS_]=this._texture.bitmap._glTexture.id;var e=this._paramData._float32Data,a=this._texture.uv;e[DrawImageCmdNative._PARAM_VB_POS_+2]=a[0],e[DrawImageCmdNative._PARAM_VB_POS_+3]=a[1],e[DrawImageCmdNative._PARAM_VB_POS_+8]=a[2],e[DrawImageCmdNative._PARAM_VB_POS_+9]=a[3],e[DrawImageCmdNative._PARAM_VB_POS_+14]=a[4],e[DrawImageCmdNative._PARAM_VB_POS_+15]=a[5],e[DrawImageCmdNative._PARAM_VB_POS_+20]=a[6],e[DrawImageCmdNative._PARAM_VB_POS_+21]=a[7],K.syncBufferToRenderThread(this._paramData)}),_(0,t,"width",function(){return this._width},function(t){this._width=t;var e=this._paramData._float32Data;e[DrawImageCmdNative._PARAM_VB_POS_]=this._x,e[DrawImageCmdNative._PARAM_VB_POS_+6]=this._x+this._width,e[DrawImageCmdNative._PARAM_VB_POS_+12]=this._x+this._width,e[DrawImageCmdNative._PARAM_VB_POS_+18]=this._x,K.syncBufferToRenderThread(this._paramData)}),_(0,t,"x",function(){return this._x},function(t){this._x=t;var e=this._paramData._float32Data;e[DrawImageCmdNative._PARAM_VB_POS_]=this._x,e[DrawImageCmdNative._PARAM_VB_POS_+6]=this._x+this._width,e[DrawImageCmdNative._PARAM_VB_POS_+12]=this._x+this._width,e[DrawImageCmdNative._PARAM_VB_POS_+18]=this._x,K.syncBufferToRenderThread(this._paramData)}),_(0,t,"height",function(){return this._height},function(t){this._height=t;var e=this._paramData._float32Data;e[DrawImageCmdNative._PARAM_VB_POS_+1]=this._y,e[DrawImageCmdNative._PARAM_VB_POS_+7]=this._y,e[DrawImageCmdNative._PARAM_VB_POS_+13]=this._y+this._height,e[DrawImageCmdNative._PARAM_VB_POS_+19]=this._y+this._height,K.syncBufferToRenderThread(this._paramData)}),DrawImageCmdNative.create=function(t,e,a,i,r){var _=N.getItemByClass("DrawImageCmd",DrawImageCmdNative);_._graphicsCmdEncoder=this._commandEncoder,DrawImageCmdNative._DRAW_IMAGE_CMD_ENCODER_||(DrawImageCmdNative._DRAW_IMAGE_CMD_ENCODER_=K.instance.createCommandEncoder(124,32,!0),DrawImageCmdNative._DRAW_IMAGE_CMD_ENCODER_.blendFuncByGlobalValue(tt.GLOBALVALUE_BLENDFUNC_SRC,tt.GLOBALVALUE_BLENDFUNC_DEST),DrawImageCmdNative._DRAW_IMAGE_CMD_ENCODER_.useProgramEx(tt.PROGRAMEX_DRAWTEXTURE),DrawImageCmdNative._DRAW_IMAGE_CMD_ENCODER_.useVDO(tt.VDO_MESHQUADTEXTURE),DrawImageCmdNative._DRAW_IMAGE_CMD_ENCODER_.uniformEx(tt.GLOBALVALUE_VIEWS,0),DrawImageCmdNative._DRAW_IMAGE_CMD_ENCODER_.uniformEx(tt.GLOBALVALUE_CLIP_MAT_DIR,1),DrawImageCmdNative._DRAW_IMAGE_CMD_ENCODER_.uniformEx(tt.GLOBALVALUE_CLIP_MAT_POS,2),DrawImageCmdNative._DRAW_IMAGE_CMD_ENCODER_.uniformTextureByParamData(0,4,4*DrawImageCmdNative._PARAM_TEXTURE_POS_),DrawImageCmdNative._DRAW_IMAGE_CMD_ENCODER_.setRectMeshByParamData(12,4*DrawImageCmdNative._PARAM_VB_POS_,16),DrawImageCmdNative._DRAW_IMAGE_CMD_ENCODER_.modifyMesh(tt.GLOBALVALUE_MATRIX32,0,7),DrawImageCmdNative._DRAW_IMAGE_CMD_ENCODER_.modifyMesh(tt.GLOBALVALUE_DRAWTEXTURE_COLOR,1,15),K.syncBufferToRenderThread(DrawImageCmdNative._DRAW_IMAGE_CMD_ENCODER_)),_._paramData||(_._paramData=new ParamData(116,!0)),_._texture=t,_._x=e,_._y=a,_._width=i,_._height=r;var n=_._paramData._float32Data,s=_._paramData._int32Data;s[0]=3,s[1]=33984,s[DrawImageCmdNative._PARAM_TEXTURE_POS_]=t.getIsReady()?t.bitmap._glTexture.id:0,s[3]=1,s[4]=96;var o=0!=i?i:t.bitmap.width,h=0!=r?r:t.bitmap.height,l=t.uv,u=DrawImageCmdNative._PARAM_VB_POS_;return n[u++]=e,n[u++]=a,n[u++]=l[0],n[u++]=l[1],s[u++]=4294967295,s[u++]=4294967295,n[u++]=e+o,n[u++]=a,n[u++]=l[2],n[u++]=l[3],s[u++]=4294967295,s[u++]=4294967295,n[u++]=e+o,n[u++]=a+h,n[u++]=l[4],n[u++]=l[5],s[u++]=4294967295,s[u++]=4294967295,n[u++]=e,n[u++]=a+h,n[u++]=l[6],n[u++]=l[7],s[u++]=4294967295,s[u++]=4294967295,K.syncBufferToRenderThread(_._paramData),_._graphicsCmdEncoder.useCommandEncoder(DrawImageCmdNative._DRAW_IMAGE_CMD_ENCODER_.getPtrID(),_._paramData.getPtrID(),-1),K.syncBufferToRenderThread(_._graphicsCmdEncoder),_},DrawImageCmdNative.ID="DrawImage",DrawImageCmdNative._DRAW_IMAGE_CMD_ENCODER_=null,DrawImageCmdNative._PARAM_TEXTURE_POS_=2,DrawImageCmdNative._PARAM_VB_POS_=5}(),function(){function DrawLineCmdNative(){this._graphicsCmdEncoder=null,this._paramData=null,this._fromX=NaN,this._fromY=NaN,this._toX=NaN,this._toY=NaN,this._lineColor=null,this._lineWidth=NaN,this._vid=0}r(DrawLineCmdNative,"laya.layagl.cmdNative.DrawLineCmdNative");var t=DrawLineCmdNative.prototype;t.recover=function(){N.recover("DrawLineCmd",this)},_(0,t,"lineColor",function(){return this._lineColor},function(t){this._lineColor=t;var e=l.create(this.lineColor).numColor,a=this._paramData._int32Data,i=DrawLineCmdNative._PARAM_VB_POS_;i++,i++,a[i++]=e,i++,i++,a[i++]=e,i++,i++,a[i++]=e,i++,i++,a[i++]=e,K.syncBufferToRenderThread(this._paramData)}),_(0,t,"cmdID",function(){return"DrawLine"}),_(0,t,"toY",function(){return this._toY},function(t){this._toY=t;var e=[this._fromX,this._fromY,this._toX,this._toY],a=[],i=[];Et.createLine2(e,i,this._lineWidth,0,a,!1);var r=this._paramData._float32Data,_=(this._paramData._int32Data,this._paramData._int16Data),n=DrawLineCmdNative._PARAM_VB_POS_;r[n++]=a[0],r[n++]=a[1],n++,r[n++]=a[2],r[n++]=a[3],n++,r[n++]=a[4],r[n++]=a[5],n++,r[n++]=a[6],r[n++]=a[7],n++;var s=2*DrawLineCmdNative._PARAM_IB_POS_;_[s++]=i[0],_[s++]=i[1],_[s++]=i[2],_[s++]=i[3],_[s++]=i[4],_[s++]=i[5],K.syncBufferToRenderThread(this._paramData)}),_(0,t,"fromX",function(){return this._fromX},function(t){this._fromX=t;var e=[this._fromX,this._fromY,this._toX,this._toY],a=[],i=[];Et.createLine2(e,i,this._lineWidth,0,a,!1);var r=this._paramData._float32Data,_=(this._paramData._int32Data,this._paramData._int16Data),n=DrawLineCmdNative._PARAM_VB_POS_;r[n++]=a[0],r[n++]=a[1],n++,r[n++]=a[2],r[n++]=a[3],n++,r[n++]=a[4],r[n++]=a[5],n++,r[n++]=a[6],r[n++]=a[7],n++;var s=2*DrawLineCmdNative._PARAM_IB_POS_;_[s++]=i[0],_[s++]=i[1],_[s++]=i[2],_[s++]=i[3],_[s++]=i[4],_[s++]=i[5],K.syncBufferToRenderThread(this._paramData)}),_(0,t,"vid",function(){return this._vid},function(t){this._vid=t}),_(0,t,"toX",function(){return this._toX},function(t){this._toX=t;var e=[this._fromX,this._fromY,this._toX,this._toY],a=[],i=[];Et.createLine2(e,i,this._lineWidth,0,a,!1);var r=this._paramData._float32Data,_=(this._paramData._int32Data,this._paramData._int16Data),n=DrawLineCmdNative._PARAM_VB_POS_;r[n++]=a[0],r[n++]=a[1],n++,r[n++]=a[2],r[n++]=a[3],n++,r[n++]=a[4],r[n++]=a[5],n++,r[n++]=a[6],r[n++]=a[7],n++;var s=2*DrawLineCmdNative._PARAM_IB_POS_;_[s++]=i[0],_[s++]=i[1],_[s++]=i[2],_[s++]=i[3],_[s++]=i[4],_[s++]=i[5],K.syncBufferToRenderThread(this._paramData)}),_(0,t,"fromY",function(){return this._fromY},function(t){this._fromY=t;var e=[this._fromX,this._fromY,this._toX,this._toY],a=[],i=[];Et.createLine2(e,i,this._lineWidth,0,a,!1);var r=this._paramData._float32Data,_=(this._paramData._int32Data,this._paramData._int16Data),n=DrawLineCmdNative._PARAM_VB_POS_;r[n++]=a[0],r[n++]=a[1],n++,r[n++]=a[2],r[n++]=a[3],n++,r[n++]=a[4],r[n++]=a[5],n++,r[n++]=a[6],r[n++]=a[7],n++;var s=2*DrawLineCmdNative._PARAM_IB_POS_;_[s++]=i[0],_[s++]=i[1],_[s++]=i[2],_[s++]=i[3],_[s++]=i[4],_[s++]=i[5],K.syncBufferToRenderThread(this._paramData)}),_(0,t,"lineWidth",function(){return this._lineWidth},function(t){this._lineWidth=t;var e=[this._fromX,this._fromY,this._toX,this._toY],a=[],i=[];Et.createLine2(e,i,this.lineWidth,0,a,!1);var r=this._paramData._float32Data,_=(this._paramData._int32Data,this._paramData._int16Data),n=DrawLineCmdNative._PARAM_VB_POS_;r[n++]=a[0],r[n++]=a[1],n++,r[n++]=a[2],r[n++]=a[3],n++,r[n++]=a[4],r[n++]=a[5],n++,r[n++]=a[6],r[n++]=a[7],n++;var s=2*DrawLineCmdNative._PARAM_IB_POS_;_[s++]=i[0],_[s++]=i[1],_[s++]=i[2],_[s++]=i[3],_[s++]=i[4],_[s++]=i[5],K.syncBufferToRenderThread(this._paramData)}),DrawLineCmdNative.create=function(t,e,a,i,r,_,n){var s=N.getItemByClass("DrawLineCmd",DrawLineCmdNative);s._graphicsCmdEncoder=this._commandEncoder,DrawLineCmdNative._DRAW_LINE_CMD_ENCODER_||(DrawLineCmdNative._DRAW_LINE_CMD_ENCODER_=K.instance.createCommandEncoder(84,32,!0),DrawLineCmdNative._DRAW_LINE_CMD_ENCODER_.useProgramEx(tt.PROGRAMEX_DRAWVG),DrawLineCmdNative._DRAW_LINE_CMD_ENCODER_.useVDO(tt.VDO_MESHVG),DrawLineCmdNative._DRAW_LINE_CMD_ENCODER_.uniformEx(tt.GLOBALVALUE_VIEWS,0),DrawLineCmdNative._DRAW_LINE_CMD_ENCODER_.uniformEx(tt.GLOBALVALUE_CLIP_MAT_DIR,1),DrawLineCmdNative._DRAW_LINE_CMD_ENCODER_.uniformEx(tt.GLOBALVALUE_CLIP_MAT_POS,2),DrawLineCmdNative._DRAW_LINE_CMD_ENCODER_.setMeshByParamData(4*DrawLineCmdNative._PARAM_VB_POS_,4*DrawLineCmdNative._PARAM_VB_OFFSET_POS_,4,4*DrawLineCmdNative._PARAM_IB_POS_,4*DrawLineCmdNative._PARAM_IB_OFFSET_POS_,8,4*DrawLineCmdNative._PARAM_INDEX_ELEMENT_OFFSET_POS_),DrawLineCmdNative._DRAW_LINE_CMD_ENCODER_.modifyMesh(tt.GLOBALVALUE_MATRIX32,0,7),DrawLineCmdNative._DRAW_LINE_CMD_ENCODER_.modifyMesh(tt.GLOBALVALUE_DRAWTEXTURE_COLOR,1,15),K.syncBufferToRenderThread(DrawLineCmdNative._DRAW_LINE_CMD_ENCODER_)),s._paramData||(s._paramData=new ParamData(96,!0)),s._fromX=t,s._fromY=e,s._toX=a,s._toY=i,s._lineColor=r,s._lineWidth=_,s._vid=n;var o=l.create(r).numColor,h=[t,e,a,i],u=[],c=[];Et.createLine2(h,c,_,0,u,!1);var d=s._paramData._float32Data,f=s._paramData._int32Data,D=s._paramData._int16Data;f[0]=1,f[1]=48,f[2]=12,f[DrawLineCmdNative._PARAM_VB_OFFSET_POS_]=0,f[DrawLineCmdNative._PARAM_IB_OFFSET_POS_]=0,f[DrawLineCmdNative._PARAM_INDEX_ELEMENT_OFFSET_POS_]=0;var m=DrawLineCmdNative._PARAM_VB_POS_;d[m++]=u[0],d[m++]=u[1],f[m++]=o,d[m++]=u[2],d[m++]=u[3],f[m++]=o,d[m++]=u[4],d[m++]=u[5],f[m++]=o,d[m++]=u[6],d[m++]=u[7],f[m++]=o;var C=2*DrawLineCmdNative._PARAM_IB_POS_;return D[C++]=c[0],D[C++]=c[1],D[C++]=c[2],D[C++]=c[3],D[C++]=c[4],D[C++]=c[5],d[DrawLineCmdNative._PARAM_LINECOLOR_POS_]=r||4278190335,d[DrawLineCmdNative._PARAM_LINEWIDTH_POS_]=_,d[DrawLineCmdNative._PARAM_VID_POS_]=n,K.syncBufferToRenderThread(s._paramData),s._graphicsCmdEncoder.useCommandEncoder(DrawLineCmdNative._DRAW_LINE_CMD_ENCODER_.getPtrID(),s._paramData.getPtrID(),-1),K.syncBufferToRenderThread(s._graphicsCmdEncoder),s},DrawLineCmdNative.ID="DrawLine",DrawLineCmdNative._DRAW_LINE_CMD_ENCODER_=null,DrawLineCmdNative._PARAM_VB_POS_=3,DrawLineCmdNative._PARAM_IB_POS_=15,DrawLineCmdNative._PARAM_LINECOLOR_POS_=18,DrawLineCmdNative._PARAM_LINEWIDTH_POS_=19,DrawLineCmdNative._PARAM_VID_POS_=20,DrawLineCmdNative._PARAM_VB_OFFSET_POS_=21,DrawLineCmdNative._PARAM_IB_OFFSET_POS_=22,DrawLineCmdNative._PARAM_INDEX_ELEMENT_OFFSET_POS_=23}(),function(){function DrawLinesCmdNative(){this._graphicsCmdEncoder=null,this._paramData=null,this._x=NaN,this._y=NaN,this._points=null,this._lineColor=null,this._lineWidth=NaN,this._vid=0,this._vertNum=0,this.ibBuffer=null,this.vbBuffer=null,this._ibSize=0,this._vbSize=0,this._ibArray=[],this._vbArray=[]}r(DrawLinesCmdNative,"laya.layagl.cmdNative.DrawLinesCmdNative");var t=DrawLinesCmdNative.prototype;t.recover=function(){this._points=null,this._lineColor=null,this._ibArray.length=0,this._vbArray.length=0,N.recover("DrawLinesCmd",this)},_(0,t,"lineColor",function(){return this._lineColor},function(t){this._lineColor=t;for(var e=l.create(this._lineColor).numColor,a=this.vbBuffer._int32Data,i=0,r=0;r<this._vertNum;r++)i++,i++,a[i++]=e;K.syncBufferToRenderThread(this.vbBuffer)}),_(0,t,"points",function(){return this._points},function(t){this._points=t,this._ibArray.length=0,this._vbArray.length=0,Et.createLine2(this._points,this._ibArray,this._lineWidth,0,this._vbArray,!1);var e=l.create(this._lineColor).numColor;this._vertNum=this._points.length;var a=this._vertNum;(!this.vbBuffer||this.vbBuffer.getByteLength()<3*this._vertNum*4)&&(this.vbBuffer=new ParamData(3*a*4,!0)),this._vbSize=3*this._vertNum*4;for(var i=this.vbBuffer._float32Data,r=this.vbBuffer._int32Data,_=0,n=0;n<this._vertNum;n++)i[_++]=this._vbArray[2*n]+this.x,i[_++]=this._vbArray[2*n+1]+this.y,r[_++]=e;(!this.ibBuffer||this.ibBuffer.getByteLength()<3*(this._vertNum-2)*2)&&(this.ibBuffer=new ParamData(3*(a-2)*2,!0,!0)),this._ibSize=3*(this._vertNum-2)*2;for(var s=this.ibBuffer._int16Data,o=0;o<3*(this._vertNum-2);o++)s[o]=this._ibArray[o];(r=this._paramData._int32Data)[DrawLinesCmdNative._PARAM_VB_SIZE_POS_]=this._vbSize,r[DrawLinesCmdNative._PARAM_IB_SIZE_POS_]=this._ibSize,K.syncBufferToRenderThread(this.ibBuffer),K.syncBufferToRenderThread(this.vbBuffer),K.syncBufferToRenderThread(this._paramData)}),_(0,t,"cmdID",function(){return"DrawLines"}),_(0,t,"x",function(){return this._x},function(t){this._x=t;for(var e=this.vbBuffer._float32Data,a=0,i=0;i<this._vertNum;i++)e[a++]=this._vbArray[2*i]+this._x,a++,a++;K.syncBufferToRenderThread(this.vbBuffer)}),_(0,t,"vid",function(){return this._vid},function(t){this._vid=t}),_(0,t,"y",function(){return this._y},function(t){this._y=t;for(var e=this.vbBuffer._float32Data,a=0,i=0;i<this._vertNum;i++)a++,e[a++]=this._vbArray[2*i+1]+this._y,a++;K.syncBufferToRenderThread(this.vbBuffer)}),_(0,t,"lineWidth",function(){return this._lineWidth},function(t){this._lineWidth=t,this._ibArray.length=0,this._vbArray.length=0,Et.createLine2(this._points,this._ibArray,this._lineWidth,0,this._vbArray,!1);for(var e=this.vbBuffer._float32Data,a=0,i=0;i<this._vertNum;i++)e[a++]=this._vbArray[2*i]+this.x,e[a++]=this._vbArray[2*i+1]+this.y,a++;K.syncBufferToRenderThread(this.vbBuffer)}),DrawLinesCmdNative.create=function(t,e,a,i,r,_){var n=N.getItemByClass("DrawLinesCmd",DrawLinesCmdNative);n._graphicsCmdEncoder=this._commandEncoder,DrawLinesCmdNative._DRAW_LINES_CMD_ENCODER_||(DrawLinesCmdNative._DRAW_LINES_CMD_ENCODER_=K.instance.createCommandEncoder(88,32,!0),DrawLinesCmdNative._DRAW_LINES_CMD_ENCODER_.useProgramEx(tt.PROGRAMEX_DRAWVG),DrawLinesCmdNative._DRAW_LINES_CMD_ENCODER_.useVDO(tt.VDO_MESHVG),DrawLinesCmdNative._DRAW_LINES_CMD_ENCODER_.uniformEx(tt.GLOBALVALUE_VIEWS,0),DrawLinesCmdNative._DRAW_LINES_CMD_ENCODER_.uniformEx(tt.GLOBALVALUE_CLIP_MAT_DIR,1),DrawLinesCmdNative._DRAW_LINES_CMD_ENCODER_.uniformEx(tt.GLOBALVALUE_CLIP_MAT_POS,2),DrawLinesCmdNative._DRAW_LINES_CMD_ENCODER_.setMeshExByParamData(4*DrawLinesCmdNative._PARAM_VB_POS_,4*DrawLinesCmdNative._PARAM_VB_OFFSET_POS_,4*DrawLinesCmdNative._PARAM_VB_SIZE_POS_,4*DrawLinesCmdNative._PARAM_IB_POS_,4*DrawLinesCmdNative._PARAM_IB_OFFSET_POS_,4*DrawLinesCmdNative._PARAM_IB_SIZE_POS_,4*DrawLinesCmdNative._PARAM_INDEX_ELEMENT_OFFSET_POS_),DrawLinesCmdNative._DRAW_LINES_CMD_ENCODER_.modifyMesh(tt.GLOBALVALUE_MATRIX32,0,7),DrawLinesCmdNative._DRAW_LINES_CMD_ENCODER_.modifyMesh(tt.GLOBALVALUE_DRAWTEXTURE_COLOR,1,15),K.syncBufferToRenderThread(DrawLinesCmdNative._DRAW_LINES_CMD_ENCODER_)),n._paramData||(n._paramData=new ParamData(44,!0)),n._x=t,n._y=e,n._points=a,n._lineColor=i,n._lineWidth=r,n._vid=_,Et.createLine2(a,n._ibArray,r,0,n._vbArray,!1);var s=l.create(i).numColor;n._vertNum=a.length;var o=n._vertNum;(!n.vbBuffer||n.vbBuffer.getByteLength()<3*n._vertNum*4)&&(n.vbBuffer=new ParamData(3*o*4,!0)),n._vbSize=3*n._vertNum*4;for(var h=n.vbBuffer._float32Data,u=n.vbBuffer._int32Data,c=0,d=0;d<n._vertNum;d++)h[c++]=n._vbArray[2*d]+t,h[c++]=n._vbArray[2*d+1]+e,u[c++]=s;(!n.ibBuffer||n.ibBuffer.getByteLength()<3*(n._vertNum-2)*2)&&(n.ibBuffer=new ParamData(3*(o-2)*2,!0,!0)),n._ibSize=3*(n._vertNum-2)*2;for(var f=n.ibBuffer._int16Data,D=0;D<3*(n._vertNum-2);D++)f[D]=n._ibArray[D];var m=n._paramData._float32Data;return(u=n._paramData._int32Data)[0]=1,u[DrawLinesCmdNative._PARAM_VB_POS_]=n.vbBuffer.getPtrID(),u[DrawLinesCmdNative._PARAM_IB_POS_]=n.ibBuffer.getPtrID(),m[DrawLinesCmdNative._PARAM_LINECOLOR_POS_]=i||4278190335,m[DrawLinesCmdNative._PARAM_LINEWIDTH_POS_]=r,m[DrawLinesCmdNative._PARAM_VID_POS_]=_,u[DrawLinesCmdNative._PARAM_VB_SIZE_POS_]=n._vbSize,u[DrawLinesCmdNative._PARAM_IB_SIZE_POS_]=n._ibSize,u[DrawLinesCmdNative._PARAM_VB_OFFSET_POS_]=0,u[DrawLinesCmdNative._PARAM_IB_OFFSET_POS_]=0,u[DrawLinesCmdNative._PARAM_INDEX_ELEMENT_OFFSET_POS_]=0,K.syncBufferToRenderThread(n.vbBuffer),K.syncBufferToRenderThread(n.ibBuffer),K.syncBufferToRenderThread(n._paramData),n._graphicsCmdEncoder.useCommandEncoder(DrawLinesCmdNative._DRAW_LINES_CMD_ENCODER_.getPtrID(),n._paramData.getPtrID(),-1),K.syncBufferToRenderThread(n._graphicsCmdEncoder),n},DrawLinesCmdNative.ID="DrawLines",DrawLinesCmdNative._DRAW_LINES_CMD_ENCODER_=null,DrawLinesCmdNative._PARAM_VB_POS_=1,DrawLinesCmdNative._PARAM_IB_POS_=2,DrawLinesCmdNative._PARAM_LINECOLOR_POS_=3,DrawLinesCmdNative._PARAM_LINEWIDTH_POS_=4,DrawLinesCmdNative._PARAM_VID_POS_=5,DrawLinesCmdNative._PARAM_VB_SIZE_POS_=6,DrawLinesCmdNative._PARAM_IB_SIZE_POS_=7,DrawLinesCmdNative._PARAM_VB_OFFSET_POS_=8,DrawLinesCmdNative._PARAM_IB_OFFSET_POS_=9,DrawLinesCmdNative._PARAM_INDEX_ELEMENT_OFFSET_POS_=10}(),function(){function DrawParticleCmdNative(){this._graphicsCmdEncoder=null,this._paramData=null,this.vbBuffer=null,this._template=null,this._floatCountPerVertex=29,this._firstNewElement=0,this._firstFreeElement=0,this._firstActiveElement=0,this._firstRetiredElement=0,this._maxParticleNum=0}r(DrawParticleCmdNative,"laya.layagl.cmdNative.DrawParticleCmdNative");var t=DrawParticleCmdNative.prototype;t.updateParticle=function(){if(this._template.texture){this._template.updateParticleForNative();var t=this._template.sv,e=this._paramData._int32Data,a=this._paramData._float32Data;a[DrawParticleCmdNative._PARAM_CURRENTTIME_POS_]=t.u_CurrentTime,a[DrawParticleCmdNative._PARAM_DURATION_POS_]=t.u_Duration,a[DrawParticleCmdNative._PARAM_ENDVEL_POS_]=t.u_EndVelocity,a[DrawParticleCmdNative._PARAM_GRAVITY_POS_]=t.u_Gravity[0],a[DrawParticleCmdNative._PARAM_GRAVITY_POS_+1]=t.u_Gravity[1],a[DrawParticleCmdNative._PARAM_GRAVITY_POS_+2]=t.u_Gravity[2],t.size[0]=bt.width,t.size[1]=bt.height,a[DrawParticleCmdNative._PARAM_SIZE_POS_]=t.size[0],a[DrawParticleCmdNative._PARAM_SIZE_POS_+1]=t.size[1],a[DrawParticleCmdNative._PARAM_MAT_POS_]=1,a[DrawParticleCmdNative._PARAM_MAT_POS_+1]=0,a[DrawParticleCmdNative._PARAM_MAT_POS_+2]=0,a[DrawParticleCmdNative._PARAM_MAT_POS_+3]=0,a[DrawParticleCmdNative._PARAM_MAT_POS_+4]=0,a[DrawParticleCmdNative._PARAM_MAT_POS_+5]=1,a[DrawParticleCmdNative._PARAM_MAT_POS_+6]=0,a[DrawParticleCmdNative._PARAM_MAT_POS_+7]=0,a[DrawParticleCmdNative._PARAM_MAT_POS_+8]=0,a[DrawParticleCmdNative._PARAM_MAT_POS_+9]=0,a[DrawParticleCmdNative._PARAM_MAT_POS_+10]=1,a[DrawParticleCmdNative._PARAM_MAT_POS_+11]=0,a[DrawParticleCmdNative._PARAM_MAT_POS_+12]=0,a[DrawParticleCmdNative._PARAM_MAT_POS_+13]=0,a[DrawParticleCmdNative._PARAM_MAT_POS_+14]=0,a[DrawParticleCmdNative._PARAM_MAT_POS_+15]=1,e[DrawParticleCmdNative._PARAM_TEXTURE_LOC_POS_]=33984,e[DrawParticleCmdNative._PARAM_TEXTURE_POS_]=this._template.texture.bitmap._glTexture.id,this.vbBuffer=this._template.getConchMesh(),this._firstNewElement=this._template.getFirstNewElement(),this._firstFreeElement=this._template.getFirstFreeElement(),this._firstActiveElement=this._template.getFirstActiveElement(),this._firstRetiredElement=this._template.getFirstRetiredElement();var i=0,r=0,_=0,n=0,s=0,o=0;this._firstActiveElement!=this._firstFreeElement&&(this._firstActiveElement<this._firstFreeElement?(e[DrawParticleCmdNative._PARAM_REGDATA_POS_]=1,s=this._firstFreeElement-this._firstActiveElement,i=(this._firstFreeElement-this._firstActiveElement)*this._floatCountPerVertex*4*4,_=this._firstActiveElement*this._floatCountPerVertex*4*4):(e[DrawParticleCmdNative._PARAM_REGDATA_POS_]=0,s=this._maxParticleNum-this._firstActiveElement,i=(this._maxParticleNum-this._firstActiveElement)*this._floatCountPerVertex*4*4,_=this._firstActiveElement*this._floatCountPerVertex*4*4,this._firstFreeElement>0?(o=this._firstFreeElement,r=this._firstFreeElement*this._floatCountPerVertex*4*4,n=0):e[DrawParticleCmdNative._PARAM_REGDATA_POS_]=1)),e[DrawParticleCmdNative._PARAM_VB1_POS_]=this.vbBuffer.getPtrID(),e[DrawParticleCmdNative._PARAM_RECT1_NUM_POS_]=s,e[DrawParticleCmdNative._PARAM_VB1_SIZE_POS_]=i,e[DrawParticleCmdNative._PARAM_VB1_OFFSET_POS_]=_,K.syncBufferToRenderThread(this.vbBuffer),r>0&&(e[DrawParticleCmdNative._PARAM_VB2_POS_]=this.vbBuffer.getPtrID(),e[DrawParticleCmdNative._PARAM_RECT2_NUM_POS_]=o,e[DrawParticleCmdNative._PARAM_VB2_SIZE_POS_]=r,e[DrawParticleCmdNative._PARAM_VB2_OFFSET_POS_]=n),K.syncBufferToRenderThread(this._paramData),this._template.addDrawCounter()}},t.recover=function(){this._template=null,N.recover("DrawParticleCmd",this)},_(0,t,"cmdID",function(){return"DrawParticleCmd"}),DrawParticleCmdNative.create=function(t){var e=N.getItemByClass("DrawParticleCmd",DrawParticleCmdNative);e._graphicsCmdEncoder=this._commandEncoder,DrawParticleCmdNative._DRAW_PARTICLE_CMD_ENCODER_||(DrawParticleCmdNative._DRAW_PARTICLE_CMD_ENCODER_=K.instance.createCommandEncoder(84,32,!0),DrawParticleCmdNative._DRAW_PARTICLE_CMD_ENCODER_.blendFuncByGlobalValue(tt.GLOBALVALUE_BLENDFUNC_SRC,tt.GLOBALVALUE_BLENDFUNC_DEST),DrawParticleCmdNative._DRAW_PARTICLE_CMD_ENCODER_.useProgramEx(tt.PROGRAMEX_DRAWPARTICLE),DrawParticleCmdNative._DRAW_PARTICLE_CMD_ENCODER_.useVDO(tt.VDO_MESHPARTICLE),DrawParticleCmdNative._DRAW_PARTICLE_CMD_ENCODER_.uniformByParamData(0,4*DrawParticleCmdNative._PARAM_CURRENTTIME_POS_),DrawParticleCmdNative._DRAW_PARTICLE_CMD_ENCODER_.uniformByParamData(1,4*DrawParticleCmdNative._PARAM_DURATION_POS_),DrawParticleCmdNative._DRAW_PARTICLE_CMD_ENCODER_.uniformByParamData(2,4*DrawParticleCmdNative._PARAM_ENDVEL_POS_),DrawParticleCmdNative._DRAW_PARTICLE_CMD_ENCODER_.uniformByParamData(3,4*DrawParticleCmdNative._PARAM_GRAVITY_POS_),DrawParticleCmdNative._DRAW_PARTICLE_CMD_ENCODER_.uniformByParamData(4,4*DrawParticleCmdNative._PARAM_SIZE_POS_),DrawParticleCmdNative._DRAW_PARTICLE_CMD_ENCODER_.uniformByParamData(5,4*DrawParticleCmdNative._PARAM_MAT_POS_),DrawParticleCmdNative._DRAW_PARTICLE_CMD_ENCODER_.uniformTextureByParamData(4*DrawParticleCmdNative._PARAM_TEXTURE_UNIFORMLOC_POS_,4*DrawParticleCmdNative._PARAM_TEXTURE_LOC_POS_,4*DrawParticleCmdNative._PARAM_TEXTURE_POS_),DrawParticleCmdNative._DRAW_PARTICLE_CMD_ENCODER_.setRectMeshExByParamData(4*DrawParticleCmdNative._PARAM_RECT1_NUM_POS_,4*DrawParticleCmdNative._PARAM_VB1_POS_,4*DrawParticleCmdNative._PARAM_VB1_SIZE_POS_,4*DrawParticleCmdNative._PARAM_VB1_OFFSET_POS_),DrawParticleCmdNative._DRAW_PARTICLE_CMD_ENCODER_.modifyMesh(tt.GLOBALVALUE_MATRIX32,1,7),DrawParticleCmdNative._DRAW_PARTICLE_CMD_ENCODER_.loadDataToRegByParamData(0,4*DrawParticleCmdNative._PARAM_REGDATA_POS_,4),DrawParticleCmdNative._DRAW_PARTICLE_CMD_ENCODER_.ifGreater0(0,2),DrawParticleCmdNative._DRAW_PARTICLE_CMD_ENCODER_.setRectMeshExByParamData(4*DrawParticleCmdNative._PARAM_RECT2_NUM_POS_,4*DrawParticleCmdNative._PARAM_VB2_POS_,4*DrawParticleCmdNative._PARAM_VB2_SIZE_POS_,4*DrawParticleCmdNative._PARAM_VB2_OFFSET_POS_),DrawParticleCmdNative._DRAW_PARTICLE_CMD_ENCODER_.modifyMesh(tt.GLOBALVALUE_MATRIX32,1,7),K.syncBufferToRenderThread(DrawParticleCmdNative._DRAW_PARTICLE_CMD_ENCODER_)),e._paramData||(e._paramData=new ParamData(144,!0)),e._template=t,e._maxParticleNum=t.settings.maxPartices;var a=e._paramData._int32Data,i=(t._sv,e._paramData._float32Data),r=0;for(i[DrawParticleCmdNative._PARAM_CURRENTTIME_POS_]=-1,i[DrawParticleCmdNative._PARAM_DURATION_POS_]=-1,i[DrawParticleCmdNative._PARAM_ENDVEL_POS_]=-1,i[DrawParticleCmdNative._PARAM_GRAVITY_POS_]=-1,i[DrawParticleCmdNative._PARAM_GRAVITY_POS_+1]=-1,i[DrawParticleCmdNative._PARAM_GRAVITY_POS_+2]=-1,i[DrawParticleCmdNative._PARAM_SIZE_POS_]=-1,i[DrawParticleCmdNative._PARAM_SIZE_POS_+1]=-1,r=0;r<16;r++)i[DrawParticleCmdNative._PARAM_MAT_POS_+r]=-1;return a[DrawParticleCmdNative._PARAM_TEXTURE_LOC_POS_]=-1,a[DrawParticleCmdNative._PARAM_TEXTURE_POS_]=-1,a[DrawParticleCmdNative._PARAM_TEXTURE_UNIFORMLOC_POS_]=6,a[DrawParticleCmdNative._PARAM_REGDATA_POS_]=0,a[DrawParticleCmdNative._PARAM_VB1_POS_]=-1,a[DrawParticleCmdNative._PARAM_VB2_POS_]=-1,a[DrawParticleCmdNative._PARAM_VB1_SIZE_POS_]=-1,a[DrawParticleCmdNative._PARAM_VB2_SIZE_POS_]=-1,a[DrawParticleCmdNative._PARAM_RECT1_NUM_POS_]=-1,a[DrawParticleCmdNative._PARAM_RECT2_NUM_POS_]=-1,K.syncBufferToRenderThread(e._paramData),e._graphicsCmdEncoder.useCommandEncoder(DrawParticleCmdNative._DRAW_PARTICLE_CMD_ENCODER_.getPtrID(),e._paramData.getPtrID(),-1),K.syncBufferToRenderThread(e._graphicsCmdEncoder),e},DrawParticleCmdNative.ID="DrawParticleCmd",DrawParticleCmdNative._DRAW_PARTICLE_CMD_ENCODER_=null,DrawParticleCmdNative._PARAM_VB1_POS_=0,DrawParticleCmdNative._PARAM_VB2_POS_=1,DrawParticleCmdNative._PARAM_VB1_SIZE_POS_=2,DrawParticleCmdNative._PARAM_VB2_SIZE_POS_=3,DrawParticleCmdNative._PARAM_CURRENTTIME_POS_=4,DrawParticleCmdNative._PARAM_DURATION_POS_=5,DrawParticleCmdNative._PARAM_ENDVEL_POS_=6,DrawParticleCmdNative._PARAM_GRAVITY_POS_=7,DrawParticleCmdNative._PARAM_SIZE_POS_=10,DrawParticleCmdNative._PARAM_MAT_POS_=12,DrawParticleCmdNative._PARAM_TEXTURE_LOC_POS_=28,DrawParticleCmdNative._PARAM_TEXTURE_POS_=29,DrawParticleCmdNative._PARAM_REGDATA_POS_=30,DrawParticleCmdNative._PARAM_TEXTURE_UNIFORMLOC_POS_=31,DrawParticleCmdNative._PARAM_RECT1_NUM_POS_=32,DrawParticleCmdNative._PARAM_RECT2_NUM_POS_=33,DrawParticleCmdNative._PARAM_VB1_OFFSET_POS_=34,DrawParticleCmdNative._PARAM_VB2_OFFSET_POS_=35}(),function(){function DrawPathCmdNative(){this._graphicsCmdEncoder=null,this._paramData=null,this._graphicsCmdEncoder_fill=null,this._paramData_fill=null,this._x=NaN,this._y=NaN,this._paths=null,this._brush=null,this._pen=null,this._vertNum=0,this._startOriX=0,this._startOriY=0,this._lastOriX=0,this._lastOriY=0,this.SEGNUM=32,this.lines_ibBuffer=null,this.lines_vbBuffer=null,this._lines_ibSize=0,this._lines_vbSize=0,this.fill_ibBuffer=null,this.fill_vbBuffer=null,this._fill_ibSize=0,this._fill_vbSize=0,this._cmdCurrentPos=0,this._points=[],this._lines_ibArray=[],this._lines_vbArray=[],this._fill_ibArray=[],this._fill_vbArray=[]}r(DrawPathCmdNative,"laya.layagl.cmdNative.DrawPathCmdNative");var t=DrawPathCmdNative.prototype;t._arcTo=function(t){var e=t[1],a=t[2],i=t[3],r=t[4],_=t[5],n=0,s=0,o=0,h=this._lastOriX-e,l=this._lastOriY-a,u=Math.sqrt(h*h+l*l);if(!(u<=1e-6)){var c=h/u,d=l/u,f=i-e,D=r-a,m=f*f+D*D,C=Math.sqrt(m);if(!(C<=1e-6)){var E=f/C,v=D/C,A=c+E,R=d+v,T=Math.sqrt(A*A+R*R);if(!(T<=1e-6)){var P=A/T,N=R/T,L=Math.acos(P*c+N*d),p=Math.PI/2-L,b=(u=_/Math.tan(p))*c+e,S=u*d+a,x=Math.sqrt(u*u+_*_),M=e+P*x,y=a+N*x,O=0,g=0;if(c*v-d*E>=0){var B=2*p/this.SEGNUM;O=Math.sin(B),g=Math.cos(B)}else B=2*-p/this.SEGNUM,O=Math.sin(B),g=Math.cos(B);var w=this._lastOriX,I=this._lastOriY,F=b-M,G=S-y;for(n=0;n<this.SEGNUM;n++){var W=F*g+G*O,V=-F*O+G*g;s=W+M,o=V+y,(Math.abs(w-s)>.1||Math.abs(I-o)>.1)&&(this._points.push(s),this._points.push(o)),F=W,G=V}}}}},t.recover=function(){this._paths=null,this._brush=null,this._pen=null,this._points.length=0,this._lines_ibArray.length=0,this._lines_vbArray.length=0,this._fill_ibArray.length=0,this._fill_vbArray.length=0,N.recover("DrawPathCmd",this)},_(0,t,"cmdID",function(){return"DrawPath"}),_(0,t,"paths",function(){return this._paths},function(t){this._paths=t}),_(0,t,"x",function(){return this._x},function(t){this._x=t;for(var e=this.lines_vbBuffer._float32Data,a=0,i=0;i<this._vertNum;i++)e[a++]=this._lines_vbArray[2*i]+t,a++,a++;K.syncBufferToRenderThread(this.lines_vbBuffer)}),_(0,t,"y",function(){return this._y},function(t){this._y=t;for(var e=this.lines_vbBuffer._float32Data,a=0,i=0;i<this._vertNum;i++)a++,e[a++]=this._lines_vbArray[2*i+1]+t,a++;K.syncBufferToRenderThread(this.lines_vbBuffer)}),_(0,t,"brush",function(){return this._brush},function(t){this._brush||(this._graphicsCmdEncoder._idata[this._cmdCurrentPos+1]=DrawPathCmdNative._DRAW_LINES_FILL_CMD_ENCODER_.getPtrID(),K.syncBufferToRenderThread(this._graphicsCmdEncoder)),this._brush=t;var e=this._vertNum,a=vt.earcut(this._points,null,2);if(a.length>0){(!this.fill_ibBuffer||this.fill_ibBuffer.getByteLength()<2*a.length)&&(this.fill_ibBuffer=new ParamData(2*a.length,!0,!0)),this._fill_ibSize=2*a.length;for(var i=this.fill_ibBuffer._int16Data,r=0,_=0;_<a.length;_++)i[r++]=a[_]}var n=l.create(t.fillStyle).numColor;(!this.fill_vbBuffer||this.fill_vbBuffer.getByteLength()<3*this._vertNum*4)&&(this.fill_vbBuffer=new ParamData(3*e*4,!0)),this._fill_vbSize=3*this._vertNum*4;for(var s=this.fill_vbBuffer._float32Data,o=this.fill_vbBuffer._int32Data,h=0,u=0;u<this._vertNum;u++)s[h++]=this._points[2*u]+this.x,s[h++]=this._points[2*u+1]+this.y,o[h++]=n;var c=this._paramData._int32Data;c[DrawPathCmdNative._PARAM_FILL_VB_POS_]=this.fill_vbBuffer.getPtrID(),c[DrawPathCmdNative._PARAM_FILL_IB_POS_]=this.fill_ibBuffer.getPtrID(),c[DrawPathCmdNative._PARAM_FILL_VB_SIZE_POS_]=this._fill_vbSize,c[DrawPathCmdNative._PARAM_FILL_IB_SIZE_POS_]=this._fill_ibSize,K.syncBufferToRenderThread(this.fill_vbBuffer),K.syncBufferToRenderThread(this.fill_ibBuffer),K.syncBufferToRenderThread(this._paramData)}),_(0,t,"pen",function(){return this._pen},function(t){this._pen=t,this._lines_ibArray.length=0,this._lines_vbArray.length=0,Et.createLine2(this._points,this._lines_ibArray,t.lineWidth,0,this._lines_vbArray,!1);var e=l.create(t.strokeStyle).numColor,a=this._vertNum;(!this.lines_vbBuffer||this.lines_vbBuffer.getByteLength()<3*this._vertNum*4)&&(this.lines_vbBuffer=new ParamData(3*a*4,!0)),this._lines_vbSize=3*this._vertNum*4;for(var i=this.lines_vbBuffer._float32Data,r=this.lines_vbBuffer._int32Data,_=0,n=0;n<this._vertNum;n++)i[_++]=this._lines_vbArray[2*n]+this.x,i[_++]=this._lines_vbArray[2*n+1]+this.y,r[_++]=e;(!this.lines_ibBuffer||this.lines_ibBuffer.getByteLength()<3*(this._vertNum-2)*2)&&(this.lines_ibBuffer=new ParamData(3*(a-2)*2,!0,!0)),this._lines_ibSize=3*(this._vertNum-2)*2;for(var s=this.lines_ibBuffer._int16Data,o=0;o<3*(this._vertNum-2);o++)s[o]=this._lines_ibArray[o];(r=this._paramData._int32Data)[DrawPathCmdNative._PARAM_LINES_VB_POS_]=this.lines_vbBuffer.getPtrID(),r[DrawPathCmdNative._PARAM_LINES_IB_POS_]=this.lines_ibBuffer.getPtrID(),r[DrawPathCmdNative._PARAM_LINES_VB_SIZE_POS_]=this._lines_vbSize,r[DrawPathCmdNative._PARAM_LINES_IB_SIZE_POS_]=this._lines_ibSize,K.syncBufferToRenderThread(this.lines_vbBuffer),K.syncBufferToRenderThread(this.lines_ibBuffer),K.syncBufferToRenderThread(this._paramData)}),DrawPathCmdNative.create=function(t,e,a,i,r){var _=N.getItemByClass("DrawPathCmd",DrawPathCmdNative);_._graphicsCmdEncoder=this._commandEncoder,DrawPathCmdNative._DRAW_LINES_CMD_ENCODER_||(DrawPathCmdNative._DRAW_LINES_CMD_ENCODER_=K.instance.createCommandEncoder(88,32,!0),DrawPathCmdNative._DRAW_LINES_CMD_ENCODER_.blendFuncByGlobalValue(tt.GLOBALVALUE_BLENDFUNC_SRC,tt.GLOBALVALUE_BLENDFUNC_DEST),DrawPathCmdNative._DRAW_LINES_CMD_ENCODER_.useProgramEx(tt.PROGRAMEX_DRAWVG),DrawPathCmdNative._DRAW_LINES_CMD_ENCODER_.useVDO(tt.VDO_MESHVG),DrawPathCmdNative._DRAW_LINES_CMD_ENCODER_.uniformEx(tt.GLOBALVALUE_VIEWS,0),DrawPathCmdNative._DRAW_LINES_CMD_ENCODER_.uniformEx(tt.GLOBALVALUE_CLIP_MAT_DIR,1),DrawPathCmdNative._DRAW_LINES_CMD_ENCODER_.uniformEx(tt.GLOBALVALUE_CLIP_MAT_POS,2),DrawPathCmdNative._DRAW_LINES_CMD_ENCODER_.setMeshExByParamData(4*DrawPathCmdNative._PARAM_LINES_VB_POS_,4*DrawPathCmdNative._PARAM_LINE_VB_OFFSET_POS_,4*DrawPathCmdNative._PARAM_LINES_VB_SIZE_POS_,4*DrawPathCmdNative._PARAM_LINES_IB_POS_,4*DrawPathCmdNative._PARAM_LINE_IB_OFFSET_POS_,4*DrawPathCmdNative._PARAM_LINES_IB_SIZE_POS_,4*DrawPathCmdNative._PARAM_FILL_INDEX_ELEMENT_OFFSET_POS_),DrawPathCmdNative._DRAW_LINES_CMD_ENCODER_.modifyMesh(tt.GLOBALVALUE_MATRIX32,0,7),DrawPathCmdNative._DRAW_LINES_CMD_ENCODER_.modifyMesh(tt.GLOBALVALUE_DRAWTEXTURE_COLOR,1,15),K.syncBufferToRenderThread(DrawPathCmdNative._DRAW_LINES_CMD_ENCODER_)),DrawPathCmdNative._DRAW_FILL_CMD_ENCODER_||(DrawPathCmdNative._DRAW_FILL_CMD_ENCODER_=K.instance.createCommandEncoder(88,32,!0),DrawPathCmdNative._DRAW_FILL_CMD_ENCODER_.blendFuncByGlobalValue(tt.GLOBALVALUE_BLENDFUNC_SRC,tt.GLOBALVALUE_BLENDFUNC_DEST),DrawPathCmdNative._DRAW_FILL_CMD_ENCODER_.useProgramEx(tt.PROGRAMEX_DRAWVG),DrawPathCmdNative._DRAW_FILL_CMD_ENCODER_.useVDO(tt.VDO_MESHVG),DrawPathCmdNative._DRAW_FILL_CMD_ENCODER_.uniformEx(tt.GLOBALVALUE_VIEWS,0),DrawPathCmdNative._DRAW_FILL_CMD_ENCODER_.uniformEx(tt.GLOBALVALUE_CLIP_MAT_DIR,1),DrawPathCmdNative._DRAW_FILL_CMD_ENCODER_.uniformEx(tt.GLOBALVALUE_CLIP_MAT_POS,2),DrawPathCmdNative._DRAW_FILL_CMD_ENCODER_.setMeshExByParamData(4*DrawPathCmdNative._PARAM_FILL_VB_POS_,4*DrawPathCmdNative._PARAM_FILL_VB_OFFSET_POS_,4*DrawPathCmdNative._PARAM_FILL_VB_SIZE_POS_,4*DrawPathCmdNative._PARAM_FILL_IB_POS_,4*DrawPathCmdNative._PARAM_FILL_IB_OFFSET_POS_,4*DrawPathCmdNative._PARAM_FILL_IB_SIZE_POS_,4*DrawPathCmdNative._PARAM_FILL_INDEX_ELEMENT_OFFSET_POS_),DrawPathCmdNative._DRAW_FILL_CMD_ENCODER_.modifyMesh(tt.GLOBALVALUE_MATRIX32,0,7),DrawPathCmdNative._DRAW_FILL_CMD_ENCODER_.modifyMesh(tt.GLOBALVALUE_DRAWTEXTURE_COLOR,1,15),K.syncBufferToRenderThread(DrawPathCmdNative._DRAW_FILL_CMD_ENCODER_)),DrawPathCmdNative._DRAW_LINES_FILL_CMD_ENCODER_||(DrawPathCmdNative._DRAW_LINES_FILL_CMD_ENCODER_=K.instance.createCommandEncoder(136,32,!0),DrawPathCmdNative._DRAW_LINES_FILL_CMD_ENCODER_.blendFuncByGlobalValue(tt.GLOBALVALUE_BLENDFUNC_SRC,tt.GLOBALVALUE_BLENDFUNC_DEST),DrawPathCmdNative._DRAW_LINES_FILL_CMD_ENCODER_.useProgramEx(tt.PROGRAMEX_DRAWVG),DrawPathCmdNative._DRAW_LINES_FILL_CMD_ENCODER_.useVDO(tt.VDO_MESHVG),DrawPathCmdNative._DRAW_LINES_FILL_CMD_ENCODER_.uniformEx(tt.GLOBALVALUE_VIEWS,0),DrawPathCmdNative._DRAW_LINES_FILL_CMD_ENCODER_.uniformEx(tt.GLOBALVALUE_CLIP_MAT_DIR,1),DrawPathCmdNative._DRAW_LINES_FILL_CMD_ENCODER_.uniformEx(tt.GLOBALVALUE_CLIP_MAT_POS,2),DrawPathCmdNative._DRAW_LINES_FILL_CMD_ENCODER_.setMeshExByParamData(4*DrawPathCmdNative._PARAM_FILL_VB_POS_,4*DrawPathCmdNative._PARAM_FILL_VB_OFFSET_POS_,4*DrawPathCmdNative._PARAM_FILL_VB_SIZE_POS_,4*DrawPathCmdNative._PARAM_FILL_IB_POS_,4*DrawPathCmdNative._PARAM_FILL_IB_OFFSET_POS_,4*DrawPathCmdNative._PARAM_FILL_IB_SIZE_POS_,4*DrawPathCmdNative._PARAM_FILL_INDEX_ELEMENT_OFFSET_POS_),DrawPathCmdNative._DRAW_LINES_FILL_CMD_ENCODER_.modifyMesh(tt.GLOBALVALUE_MATRIX32,0,7),DrawPathCmdNative._DRAW_LINES_FILL_CMD_ENCODER_.modifyMesh(tt.GLOBALVALUE_DRAWTEXTURE_COLOR,1,15),DrawPathCmdNative._DRAW_LINES_FILL_CMD_ENCODER_.setMeshExByParamData(4*DrawPathCmdNative._PARAM_LINES_VB_POS_,4*DrawPathCmdNative._PARAM_LINE_VB_OFFSET_POS_,4*DrawPathCmdNative._PARAM_LINES_VB_SIZE_POS_,4*DrawPathCmdNative._PARAM_LINES_IB_POS_,4*DrawPathCmdNative._PARAM_LINE_IB_OFFSET_POS_,4*DrawPathCmdNative._PARAM_LINES_IB_SIZE_POS_,4*DrawPathCmdNative._PARAM_LINE_INDEX_ELEMENT_OFFSET_POS_),DrawPathCmdNative._DRAW_LINES_FILL_CMD_ENCODER_.modifyMesh(tt.GLOBALVALUE_MATRIX32,0,7),DrawPathCmdNative._DRAW_LINES_FILL_CMD_ENCODER_.modifyMesh(tt.GLOBALVALUE_DRAWTEXTURE_COLOR,1,15),K.syncBufferToRenderThread(DrawPathCmdNative._DRAW_LINES_FILL_CMD_ENCODER_)),_._paramData||(_._paramData=new ParamData(60,!0)),_._x=t,_._y=e,_._paths=a,_._brush=i,_._pen=r;for(var n=0,s=a.length;n<s;n++){var o=a[n];switch(0==n&&(_._startOriX=o[1],_._startOriY=o[2]),o[0]){case"moveTo":case"lineTo":_._lastOriX=o[1],_._lastOriY=o[2],_._points.push(o[1]),_._points.push(o[2]);break;case"arcTo":_._arcTo(o);break;case"closePath":_._points.push(_._startOriX),_._points.push(_._startOriY)}}if(_._vertNum=_._points.length,r){Et.createLine2(_._points,_._lines_ibArray,r.lineWidth,0,_._lines_vbArray,!1);var h=l.create(r.strokeStyle),u=h.numColor,c=_._vertNum;(!_.lines_vbBuffer||_.lines_vbBuffer.getByteLength()<3*_._vertNum*4)&&(_.lines_vbBuffer=new ParamData(3*c*4,!0)),_._lines_vbSize=3*_._vertNum*4;var d=_.lines_vbBuffer._float32Data,f=_.lines_vbBuffer._int32Data,D=0;for(n=0;n<_._vertNum;n++)d[D++]=_._lines_vbArray[2*n]+t,d[D++]=_._lines_vbArray[2*n+1]+e,f[D++]=u;(!_.lines_ibBuffer||_.lines_ibBuffer.getByteLength()<3*(_._vertNum-2)*2)&&(_.lines_ibBuffer=new ParamData(3*(c-2)*2,!0,!0)),_._lines_ibSize=3*(_._vertNum-2)*2;for(var m=_.lines_ibBuffer._int16Data,C=0;C<3*(_._vertNum-2);C++)m[C]=_._lines_ibArray[C]}if(i){c=_._vertNum;var E=vt.earcut(_._points,null,2);if(E.length>0){(!_.fill_ibBuffer||_.fill_ibBuffer.getByteLength()<2*E.length)&&(_.fill_ibBuffer=new ParamData(2*E.length,!0,!0)),_._fill_ibSize=2*E.length,m=_.fill_ibBuffer._int16Data;var v=0;for(C=0;C<E.length;C++)m[v++]=E[C]}u=(h=l.create(i.fillStyle)).numColor,(!_.fill_vbBuffer||_.fill_vbBuffer.getByteLength()<3*_._vertNum*4)&&(_.fill_vbBuffer=new ParamData(3*c*4,!0)),_._fill_vbSize=3*_._vertNum*4,d=_.fill_vbBuffer._float32Data;var A=_.fill_vbBuffer._int32Data;for(A=_.fill_vbBuffer._int32Data,D=0,n=0;n<_._vertNum;n++)d[D++]=_._points[2*n]+t,d[D++]=_._points[2*n+1]+e,A[D++]=u}_._paramData._float32Data;return(f=_._paramData._int32Data)[0]=1,r&&(f[DrawPathCmdNative._PARAM_LINES_VB_POS_]=_.lines_vbBuffer.getPtrID(),f[DrawPathCmdNative._PARAM_LINES_IB_POS_]=_.lines_ibBuffer.getPtrID(),f[DrawPathCmdNative._PARAM_LINES_VB_SIZE_POS_]=_._lines_vbSize,f[DrawPathCmdNative._PARAM_LINES_IB_SIZE_POS_]=_._lines_ibSize,f[DrawPathCmdNative._PARAM_LINE_VB_OFFSET_POS_]=0,f[DrawPathCmdNative._PARAM_LINE_IB_OFFSET_POS_]=0,f[DrawPathCmdNative._PARAM_LINE_INDEX_ELEMENT_OFFSET_POS_]=0,K.syncBufferToRenderThread(_.lines_vbBuffer),K.syncBufferToRenderThread(_.lines_ibBuffer)),i&&(f[DrawPathCmdNative._PARAM_FILL_VB_POS_]=_.fill_vbBuffer.getPtrID(),f[DrawPathCmdNative._PARAM_FILL_IB_POS_]=_.fill_ibBuffer.getPtrID(),f[DrawPathCmdNative._PARAM_FILL_VB_SIZE_POS_]=_._fill_vbSize,f[DrawPathCmdNative._PARAM_FILL_IB_SIZE_POS_]=_._fill_ibSize,f[DrawPathCmdNative._PARAM_FILL_VB_OFFSET_POS_]=0,f[DrawPathCmdNative._PARAM_FILL_IB_OFFSET_POS_]=0,f[DrawPathCmdNative._PARAM_FILL_INDEX_ELEMENT_OFFSET_POS_]=0,K.syncBufferToRenderThread(_.fill_vbBuffer),K.syncBufferToRenderThread(_.fill_ibBuffer)),K.syncBufferToRenderThread(_._paramData),i&&r?_._cmdCurrentPos=_._graphicsCmdEncoder.useCommandEncoder(DrawPathCmdNative._DRAW_LINES_FILL_CMD_ENCODER_.getPtrID(),_._paramData.getPtrID(),-1):i&&!r?_._cmdCurrentPos=_._graphicsCmdEncoder.useCommandEncoder(DrawPathCmdNative._DRAW_FILL_CMD_ENCODER_.getPtrID(),_._paramData.getPtrID(),-1):!i&&r&&(_._cmdCurrentPos=_._graphicsCmdEncoder.useCommandEncoder(DrawPathCmdNative._DRAW_LINES_CMD_ENCODER_.getPtrID(),_._paramData.getPtrID(),-1)),K.syncBufferToRenderThread(_._graphicsCmdEncoder),_},DrawPathCmdNative.ID="DrawPath",DrawPathCmdNative._DRAW_LINES_CMD_ENCODER_=null,DrawPathCmdNative._DRAW_LINES_FILL_CMD_ENCODER_=null,DrawPathCmdNative._DRAW_FILL_CMD_ENCODER_=null,DrawPathCmdNative._PARAM_LINES_VB_POS_=1,DrawPathCmdNative._PARAM_LINES_IB_POS_=2,DrawPathCmdNative._PARAM_LINES_VB_SIZE_POS_=3,DrawPathCmdNative._PARAM_LINES_IB_SIZE_POS_=4,DrawPathCmdNative._PARAM_FILL_VB_POS_=5,DrawPathCmdNative._PARAM_FILL_IB_POS_=6,DrawPathCmdNative._PARAM_FILL_VB_SIZE_POS_=7,DrawPathCmdNative._PARAM_FILL_IB_SIZE_POS_=8,DrawPathCmdNative._PARAM_FILL_VB_OFFSET_POS_=9,DrawPathCmdNative._PARAM_FILL_IB_OFFSET_POS_=10,DrawPathCmdNative._PARAM_LINE_VB_OFFSET_POS_=11,DrawPathCmdNative._PARAM_LINE_IB_OFFSET_POS_=12,DrawPathCmdNative._PARAM_FILL_INDEX_ELEMENT_OFFSET_POS_=13,DrawPathCmdNative._PARAM_LINE_INDEX_ELEMENT_OFFSET_POS_=14}(),function(){function DrawPieCmdNative(){this._graphicsCmdEncoder=null,this._paramData=null,this._paramID=null,this._x=NaN,this._y=NaN,this._radius=NaN,this._startAngle=NaN,this._endAngle=NaN,this._fillColor=null,this._lineColor=null,this._lineWidth=NaN,this._vertNum=0,this._line_vertNum=0,this.ibBuffer=null,this.vbBuffer=null,this.line_ibBuffer=null,this.line_vbBuffer=null,this._ibSize=0,this._vbSize=0,this._line_ibSize=0,this._line_vbSize=0,this._cmdCurrentPos=0,this._points=[],this._linePoints=[],this._line_vbArray=[],this._line_ibArray=[]}r(DrawPieCmdNative,"laya.layagl.cmdNative.DrawPieCmdNative");var t=DrawPieCmdNative.prototype;t._arc=function(t,e,a,i,r,_,n){void 0===_&&(_=!1),void 0===n&&(n=!0);var s=[];s.push(0),s.push(0);var o,h=0,l=0,u=0,c=0,d=0,f=0,D=0,m=0;if(l=r-i,_)if(Math.abs(l)>=2*Math.PI)l=2*-Math.PI;else for(;l>0;)l-=2*Math.PI;else if(Math.abs(l)>=2*Math.PI)l=2*Math.PI;else for(;l<0;)l+=2*Math.PI;o=l/(m=a<101?Math.max(10,l*a/5):a<201?Math.max(10,l*a/20):Math.max(10,l*a/40))/2,u=Math.abs(4/3*(1-Math.cos(o))/Math.sin(o)),_&&(u=-u);var C=0,E=0;for(D=0;D<=m;D++)h=i+l*(D/m),c=Math.cos(h),f=e+Math.sin(h)*a,(d=t+c*a)==C&&f==E||(s.push(d),s.push(f)),C=d,E=f;return c=Math.cos(r),f=e+Math.sin(r)*a,(d=t+c*a)==C&&f==E||(s.push(d),s.push(f)),s},t._setData=function(t,e,a,i,r,_){this._vertNum=i.length/2;var n=this._vertNum,s=this._vertNum-2;(!this.ibBuffer||this.ibBuffer.getByteLength()<3*s*2)&&(this.ibBuffer=new ParamData(3*s*2,!0,!0)),this._ibSize=3*s*2;for(var o=this.ibBuffer._int16Data,h=0,u=0;u<s;u++)o[h++]=0,o[h++]=u+1+0,o[h++]=u+2+0;(!this.vbBuffer||this.vbBuffer.getByteLength()<3*this._vertNum*4)&&(this.vbBuffer=new ParamData(3*n*4,!0)),this._vbSize=3*this._vertNum*4;for(var c=l.create(a).numColor,d=this.vbBuffer._float32Data,f=this.vbBuffer._int32Data,D=0,m=0;m<this._vertNum;m++)d[D++]=i[2*m]+t,d[D++]=i[2*m+1]+e,f[D++]=c;var C=0;for(this._linePoints.length=0,this._line_ibArray.length=0,this._line_vbArray.length=0,m=0;m<i.length;m++)this._linePoints.push(i[m]);if(this._linePoints.push(i[0]),this._linePoints.push(i[1]),r){Et.createLine2(this._linePoints,this._line_ibArray,_,0,this._line_vbArray,!1),this._line_vertNum=this._linePoints.length,C=this._line_vertNum,(!this.line_ibBuffer||this.line_ibBuffer.getByteLength()<3*(this._line_vertNum-2)*2)&&(this.line_ibBuffer=new ParamData(3*(C-2)*2,!0,!0)),this._line_ibSize=3*(this._line_vertNum-2)*2;var E=this.line_ibBuffer._int16Data;h=0;for(var v=0;v<3*(this._line_vertNum-2);v++)E[h++]=this._line_ibArray[v];(!this.line_vbBuffer||this.line_vbBuffer.getByteLength()<3*this._line_vertNum*4)&&(this.line_vbBuffer=new ParamData(3*C*4,!0)),this._line_vbSize=3*this._line_vertNum*4;var A=l.create(r),R=A.numColor,T=this.line_vbBuffer._float32Data,P=this.line_vbBuffer._int32Data;for(D=0,m=0;m<this._line_vertNum;m++)T[D++]=this._line_vbArray[2*m]+this._x,T[D++]=this._line_vbArray[2*m+1]+this._y,P[D++]=R}else{this._lineWidth=1;for(Et.createLine2(this._linePoints,this._line_ibArray,this._lineWidth,0,this._line_vbArray,!1),this._line_vertNum=this._linePoints.length,C=this._line_vertNum,(!this.line_ibBuffer||this.line_ibBuffer.getByteLength()<3*(this._line_vertNum-2)*2)&&(this.line_ibBuffer=new ParamData(3*(C-2)*2,!0,!0)),this._line_ibSize=3*(this._line_vertNum-2)*2,E=this.line_ibBuffer._int16Data,h=0,v=0;v<3*(this._line_vertNum-2);v++)E[h++]=this._line_ibArray[v];for((!this.line_vbBuffer||this.line_vbBuffer.getByteLength()<3*this._line_vertNum*4)&&(this.line_vbBuffer=new ParamData(3*C*4,!0)),this._line_vbSize=3*this._line_vertNum*4,R=(A=l.create("#FFFFFF")).numColor,T=this.line_vbBuffer._float32Data,P=this.line_vbBuffer._int32Data,D=0,m=0;m<this._line_vertNum;m++)T[D++]=this._line_vbArray[2*m]+this._x,T[D++]=this._line_vbArray[2*m+1]+this._y,P[D++]=R}},t._saveToParamData=function(){this._paramData._float32Data;var t=this._paramData._int32Data;t[0]=1,t[1]=32,t[DrawPieCmdNative._PARAM_VB_POS_]=this.vbBuffer.getPtrID(),t[DrawPieCmdNative._PARAM_IB_POS_]=this.ibBuffer.getPtrID(),t[DrawPieCmdNative._PARAM_VB_SIZE_POS_]=this._vbSize,t[DrawPieCmdNative._PARAM_IB_SIZE_POS_]=this._ibSize,t[DrawPieCmdNative._PARAM_VB_OFFSET_POS_]=0,t[DrawPieCmdNative._PARAM_IB_OFFSET_POS_]=0,t[DrawPieCmdNative._PARAM_INDEX_ELEMENT_OFFSET_POS_]=0,K.syncBufferToRenderThread(this.vbBuffer),K.syncBufferToRenderThread(this.ibBuffer),t[DrawPieCmdNative._PARAM_LINE_VB_POS_]=this.line_vbBuffer.getPtrID(),t[DrawPieCmdNative._PARAM_LINE_IB_POS_]=this.line_ibBuffer.getPtrID(),t[DrawPieCmdNative._PARAM_LINE_VB_SIZE_POS_]=this._line_vbSize,t[DrawPieCmdNative._PARAM_LINE_IB_SIZE_POS_]=this._line_ibSize,t[DrawPieCmdNative._PARAM_LINE_VB_OFFSET_POS_]=0,t[DrawPieCmdNative._PARAM_LINE_IB_OFFSET_POS_]=0,t[DrawPieCmdNative._PARAM_LINE_INDEX_ELEMENT_OFFSET_POS_]=0,K.syncBufferToRenderThread(this.line_vbBuffer),K.syncBufferToRenderThread(this.line_ibBuffer)},t.recover=function(){this._fillColor=null,this._lineColor=null,this._points.length=0,this._linePoints.length=0,this._line_vbArray.length=0,this._line_ibArray.length=0,N.recover("DrawPieCmd",this)},_(0,t,"lineColor",function(){return this._lineColor},function(t){!this._lineColor&&this._lineWidth&&(this._graphicsCmdEncoder._idata[this._cmdCurrentPos+1]=DrawPieCmdNative._DRAW_PIE_LINES_CMD_ENCODER_.getPtrID(),K.syncBufferToRenderThread(this._graphicsCmdEncoder)),this._lineColor=t,this._linePoints.length=0,this._line_ibArray.length=0,this._line_vbArray.length=0;for(var e=0;e<this._points.length;e++)this._linePoints.push(this._points[e]);this._linePoints.push(this._points[0]),this._linePoints.push(this._points[1]),Et.createLine2(this._linePoints,this._line_ibArray,this._lineWidth,0,this._line_vbArray,!1),this._line_vertNum=this._linePoints.length;var a=this._line_vertNum;(!this.line_ibBuffer||this.line_ibBuffer.getByteLength()<3*(this._line_vertNum-2)*2)&&(this.line_ibBuffer=new ParamData(3*(a-2)*2,!0,!0)),this._line_ibSize=3*(this._line_vertNum-2)*2;for(var i=this.line_ibBuffer._int16Data,r=0,_=0;_<3*(this._line_vertNum-2);_++)i[r++]=this._line_ibArray[_];(!this.line_vbBuffer||this.line_vbBuffer.getByteLength()<3*this._line_vertNum*4)&&(this.line_vbBuffer=new ParamData(3*a*4,!0)),this._line_vbSize=3*this._line_vertNum*4;var n=l.create(t).numColor,s=this.line_vbBuffer._float32Data,o=this.line_vbBuffer._int32Data,h=0;for(e=0;e<this._line_vertNum;e++)s[h++]=this._line_vbArray[2*e]+this._x,s[h++]=this._line_vbArray[2*e+1]+this._y,o[h++]=n;K.syncBufferToRenderThread(this.line_ibBuffer),K.syncBufferToRenderThread(this.line_vbBuffer)}),_(0,t,"startAngle",function(){return 180*this._startAngle/Math.PI},function(t){this._startAngle=t*Math.PI/180,this._points=this._arc(0,0,this._radius,t*Math.PI/180,this._endAngle),this._setData(this._x,this._y,this._fillColor,this._points,this._lineColor,this._lineWidth),this._saveToParamData(),K.syncBufferToRenderThread(this._paramData)}),_(0,t,"cmdID",function(){return"DrawPie"}),_(0,t,"fillColor",function(){return this._fillColor},function(t){this._fillColor=t;for(var e=l.create(this._fillColor).numColor,a=this.vbBuffer._int32Data,i=0,r=0;r<this._vertNum;r++)i++,i++,a[i++]=e;K.syncBufferToRenderThread(this.vbBuffer)}),_(0,t,"x",function(){return this._x},function(t){this._x=t;for(var e=this.vbBuffer._float32Data,a=0,i=0;i<this._vertNum;i++)e[a++]=this._points[2*i]+this._x,a++,a++;if(this._lineColor){var r=this.line_vbBuffer._float32Data;for(a=0,i=0;i<this._line_vertNum;i++)r[a++]=this._line_vbArray[2*i]+this._x,a++,a++;K.syncBufferToRenderThread(this.line_vbBuffer)}K.syncBufferToRenderThread(this.vbBuffer)}),_(0,t,"y",function(){return this._y},function(t){this._y=t;for(var e=this.vbBuffer._float32Data,a=0,i=0;i<this._vertNum;i++)a++,e[a++]=this._points[2*i+1]+this._y,a++;if(this._lineColor){var r=this.line_vbBuffer._float32Data;for(a=0,i=0;i<this._line_vertNum;i++)a++,r[a++]=this._line_vbArray[2*i+1]+this._y,a++;K.syncBufferToRenderThread(this.line_vbBuffer)}K.syncBufferToRenderThread(this.vbBuffer)}),_(0,t,"radius",function(){return this._radius},function(t){this._points=this._arc(0,0,t,this._startAngle,this._endAngle),this._setData(this._x,this._y,this._fillColor,this._points,this._lineColor,this._lineWidth),this._saveToParamData(),K.syncBufferToRenderThread(this._paramData)}),_(0,t,"endAngle",function(){return 180*this._endAngle/Math.PI},function(t){this._endAngle=t*Math.PI/180,this._points=this._arc(0,0,this._radius,this._startAngle,t*Math.PI/180),this._setData(this._x,this._y,this._fillColor,this._points,this._lineColor,this._lineWidth),this._saveToParamData(),K.syncBufferToRenderThread(this._paramData)}),_(0,t,"lineWidth",function(){return this._lineWidth},function(t){this.lineColor&&(this._graphicsCmdEncoder._idata[this._cmdCurrentPos+1]=DrawPieCmdNative._DRAW_PIE_LINES_CMD_ENCODER_.getPtrID(),K.syncBufferToRenderThread(this._graphicsCmdEncoder)),this._lineWidth=t,this._linePoints.length=0,this._line_ibArray.length=0,this._line_vbArray.length=0;for(var e=0;e<this._points.length;e++)this._linePoints.push(this._points[e]);this._linePoints.push(this._points[0]),this._linePoints.push(this._points[1]),Et.createLine2(this._linePoints,this._line_ibArray,t,0,this._line_vbArray,!1),this._line_vertNum=this._linePoints.length;var a=this._line_vertNum;(!this.line_ibBuffer||this.line_ibBuffer.getByteLength()<3*(this._line_vertNum-2)*2)&&(this.line_ibBuffer=new ParamData(3*(a-2)*2,!0,!0)),this._line_ibSize=3*(this._line_vertNum-2)*2;for(var i=this.line_ibBuffer._int16Data,r=0,_=0;_<3*(this._line_vertNum-2);_++)i[r++]=this._line_ibArray[_];(!this.line_vbBuffer||this.line_vbBuffer.getByteLength()<3*this._line_vertNum*4)&&(this.line_vbBuffer=new ParamData(3*a*4,!0)),this._line_vbSize=3*this._line_vertNum*4;var n=l.create(this.lineColor).numColor,s=this.line_vbBuffer._float32Data,o=this.line_vbBuffer._int32Data,h=0;for(e=0;e<this._line_vertNum;e++)s[h++]=this._line_vbArray[2*e]+this._x,s[h++]=this._line_vbArray[2*e+1]+this._y,o[h++]=n;K.syncBufferToRenderThread(this.line_ibBuffer),K.syncBufferToRenderThread(this.line_vbBuffer)}),DrawPieCmdNative.create=function(t,e,a,i,r,_,n,s,o){var h=N.getItemByClass("DrawPieCmd",DrawPieCmdNative);return h._graphicsCmdEncoder=this._commandEncoder,DrawPieCmdNative._DRAW_PIE_LINES_CMD_ENCODER_||(DrawPieCmdNative._DRAW_PIE_LINES_CMD_ENCODER_=K.instance.createCommandEncoder(140,32,!0),DrawPieCmdNative._DRAW_PIE_LINES_CMD_ENCODER_.blendFuncByGlobalValue(tt.GLOBALVALUE_BLENDFUNC_SRC,tt.GLOBALVALUE_BLENDFUNC_DEST),DrawPieCmdNative._DRAW_PIE_LINES_CMD_ENCODER_.useProgramEx(tt.PROGRAMEX_DRAWVG),DrawPieCmdNative._DRAW_PIE_LINES_CMD_ENCODER_.useVDO(tt.VDO_MESHVG),DrawPieCmdNative._DRAW_PIE_LINES_CMD_ENCODER_.uniformEx(tt.GLOBALVALUE_VIEWS,0),DrawPieCmdNative._DRAW_PIE_LINES_CMD_ENCODER_.uniformEx(tt.GLOBALVALUE_CLIP_MAT_DIR,1),DrawPieCmdNative._DRAW_PIE_LINES_CMD_ENCODER_.uniformEx(tt.GLOBALVALUE_CLIP_MAT_POS,2),DrawPieCmdNative._DRAW_PIE_LINES_CMD_ENCODER_.setMeshExByParamData(4*DrawPieCmdNative._PARAM_VB_POS_,4*DrawPieCmdNative._PARAM_VB_OFFSET_POS_,4*DrawPieCmdNative._PARAM_VB_SIZE_POS_,4*DrawPieCmdNative._PARAM_IB_POS_,4*DrawPieCmdNative._PARAM_IB_OFFSET_POS_,4*DrawPieCmdNative._PARAM_IB_SIZE_POS_,4*DrawPieCmdNative._PARAM_INDEX_ELEMENT_OFFSET_POS_),DrawPieCmdNative._DRAW_PIE_LINES_CMD_ENCODER_.modifyMesh(tt.GLOBALVALUE_MATRIX32,0,7),DrawPieCmdNative._DRAW_PIE_LINES_CMD_ENCODER_.modifyMesh(tt.GLOBALVALUE_DRAWTEXTURE_COLOR,1,15),DrawPieCmdNative._DRAW_PIE_LINES_CMD_ENCODER_.setMeshExByParamData(4*DrawPieCmdNative._PARAM_LINE_VB_POS_,4*DrawPieCmdNative._PARAM_LINE_VB_OFFSET_POS_,4*DrawPieCmdNative._PARAM_LINE_VB_SIZE_POS_,4*DrawPieCmdNative._PARAM_LINE_IB_POS_,4*DrawPieCmdNative._PARAM_LINE_IB_OFFSET_POS_,4*DrawPieCmdNative._PARAM_LINE_IB_SIZE_POS_,4*DrawPieCmdNative._PARAM_LINE_INDEX_ELEMENT_OFFSET_POS_),DrawPieCmdNative._DRAW_PIE_LINES_CMD_ENCODER_.modifyMesh(tt.GLOBALVALUE_MATRIX32,0,7),DrawPieCmdNative._DRAW_PIE_LINES_CMD_ENCODER_.modifyMesh(tt.GLOBALVALUE_DRAWTEXTURE_COLOR,1,15),K.syncBufferToRenderThread(DrawPieCmdNative._DRAW_PIE_LINES_CMD_ENCODER_)),DrawPieCmdNative._DRAW_PIE_CMD_ENCODER_||(DrawPieCmdNative._DRAW_PIE_CMD_ENCODER_=K.instance.createCommandEncoder(88,32,!0),DrawPieCmdNative._DRAW_PIE_CMD_ENCODER_.blendFuncByGlobalValue(tt.GLOBALVALUE_BLENDFUNC_SRC,tt.GLOBALVALUE_BLENDFUNC_DEST),DrawPieCmdNative._DRAW_PIE_CMD_ENCODER_.useProgramEx(tt.PROGRAMEX_DRAWVG),DrawPieCmdNative._DRAW_PIE_CMD_ENCODER_.useVDO(tt.VDO_MESHVG),DrawPieCmdNative._DRAW_PIE_CMD_ENCODER_.uniformEx(tt.GLOBALVALUE_VIEWS,0),DrawPieCmdNative._DRAW_PIE_CMD_ENCODER_.uniformEx(tt.GLOBALVALUE_CLIP_MAT_DIR,1),DrawPieCmdNative._DRAW_PIE_CMD_ENCODER_.uniformEx(tt.GLOBALVALUE_CLIP_MAT_POS,2),DrawPieCmdNative._DRAW_PIE_CMD_ENCODER_.setMeshExByParamData(4*DrawPieCmdNative._PARAM_VB_POS_,4*DrawPieCmdNative._PARAM_VB_OFFSET_POS_,4*DrawPieCmdNative._PARAM_VB_SIZE_POS_,4*DrawPieCmdNative._PARAM_IB_POS_,4*DrawPieCmdNative._PARAM_IB_OFFSET_POS_,4*DrawPieCmdNative._PARAM_IB_SIZE_POS_,4*DrawPieCmdNative._PARAM_INDEX_ELEMENT_OFFSET_POS_),DrawPieCmdNative._DRAW_PIE_CMD_ENCODER_.modifyMesh(tt.GLOBALVALUE_MATRIX32,0,7),DrawPieCmdNative._DRAW_PIE_CMD_ENCODER_.modifyMesh(tt.GLOBALVALUE_DRAWTEXTURE_COLOR,1,15),K.syncBufferToRenderThread(DrawPieCmdNative._DRAW_PIE_CMD_ENCODER_)),h._paramData||(h._paramData=new ParamData(64,!0)),h._x=t,h._y=e,h._radius=a,h._startAngle=i,h._endAngle=r,h._fillColor=_,h._lineColor=n,h._lineWidth=s,h._points=h._arc(0,0,a,i,r),h._setData(t,e,_,h._points,n,s),h._saveToParamData(),K.syncBufferToRenderThread(h._paramData),h._cmdCurrentPos=n?h._graphicsCmdEncoder.useCommandEncoder(DrawPieCmdNative._DRAW_PIE_LINES_CMD_ENCODER_.getPtrID(),h._paramData.getPtrID(),-1):h._graphicsCmdEncoder.useCommandEncoder(DrawPieCmdNative._DRAW_PIE_CMD_ENCODER_.getPtrID(),h._paramData.getPtrID(),-1),K.syncBufferToRenderThread(h._graphicsCmdEncoder),h},DrawPieCmdNative.ID="DrawPie",DrawPieCmdNative._DRAW_PIE_CMD_ENCODER_=null,DrawPieCmdNative._DRAW_PIE_LINES_CMD_ENCODER_=null,DrawPieCmdNative._PARAM_VB_POS_=2,DrawPieCmdNative._PARAM_IB_POS_=3,DrawPieCmdNative._PARAM_LINE_VB_POS_=4,DrawPieCmdNative._PARAM_LINE_IB_POS_=5,DrawPieCmdNative._PARAM_VB_SIZE_POS_=6,DrawPieCmdNative._PARAM_IB_SIZE_POS_=7,DrawPieCmdNative._PARAM_LINE_VB_SIZE_POS_=8,DrawPieCmdNative._PARAM_LINE_IB_SIZE_POS_=9,DrawPieCmdNative._PARAM_VB_OFFSET_POS_=10,DrawPieCmdNative._PARAM_IB_OFFSET_POS_=11,DrawPieCmdNative._PARAM_LINE_VB_OFFSET_POS_=12,DrawPieCmdNative._PARAM_LINE_IB_OFFSET_POS_=13,DrawPieCmdNative._PARAM_INDEX_ELEMENT_OFFSET_POS_=14,DrawPieCmdNative._PARAM_LINE_INDEX_ELEMENT_OFFSET_POS_=15}(),function(){function DrawPolyCmdNative(){this._graphicsCmdEncoder=null,this._graphicsCmdEncoder_lines=null,this._paramData=null,this._x=NaN,this._y=NaN,this._points=null,this._fillColor=null,this._lineColor=null,this._lineWidth=NaN,this._isConvexPolygon=!1,this._vid=0,this._vertNum=0,this._line_vertNum=0,this.ibBuffer=null,this.vbBuffer=null,this.line_ibBuffer=null,this.line_vbBuffer=null,this._ibSize=0,this._vbSize=0,this._line_ibSize=0,this._line_vbSize=0,this._cmdCurrentPos=0,this._linePoints=[],this._line_vbArray=[],this._line_ibArray=[]}r(DrawPolyCmdNative,"laya.layagl.cmdNative.DrawPolyCmdNative");var t=DrawPolyCmdNative.prototype;t.recover=function(){this._points=null,this._fillColor=null,this._lineColor=null,this._linePoints.length=0,this._line_vbArray.length=0,this._line_ibArray.length=0,N.recover("DrawPolyCmd",this)},_(0,t,"lineColor",function(){return this._lineColor},function(t){if(this._graphicsCmdEncoder._idata[this._cmdCurrentPos+1]=DrawPolyCmdNative._DRAW_POLY_LINES_CMD_ENCODER_.getPtrID(),K.syncBufferToRenderThread(this._graphicsCmdEncoder),this._lineColor=t,this._lineColor&&this.line_vbBuffer){for(var e=l.create(this._lineColor).numColor,a=this.line_vbBuffer._int32Data,i=0,r=0;r<this._line_vertNum;r++)i++,i++,a[i++]=e;K.syncBufferToRenderThread(this.line_vbBuffer)}}),_(0,t,"points",function(){return this._points},function(t){this._points=t,this._vertNum=t.length/2;var e=this._vertNum,a=vt.earcut(t,null,2);if(a.length>0){(!this.ibBuffer||this.ibBuffer.getByteLength()<2*a.length)&&(this.ibBuffer=new ParamData(2*a.length,!0,!0)),this._ibSize=2*a.length;for(var i=this.ibBuffer._int16Data,r=0,_=0;_<a.length;_++)i[r++]=a[_]}(!this.vbBuffer||this.vbBuffer.getByteLength()<3*this._vertNum*4)&&(this.vbBuffer=new ParamData(3*e*4,!0)),this._vbSize=3*this._vertNum*4;for(var n=l.create(this._fillColor).numColor,s=this.vbBuffer._float32Data,o=this.vbBuffer._int32Data,h=0,u=0;u<this._vertNum;u++)s[h++]=this._points[2*u]+this._x,s[h++]=this._points[2*u+1]+this._y,o[h++]=n;var c=this._paramData._int32Data;if(c[DrawPolyCmdNative._PARAM_VB_POS_]=this.vbBuffer.getPtrID(),c[DrawPolyCmdNative._PARAM_IB_POS_]=this.ibBuffer.getPtrID(),c[DrawPolyCmdNative._PARAM_VB_SIZE_POS_]=this._vbSize,c[DrawPolyCmdNative._PARAM_IB_SIZE_POS_]=this._ibSize,K.syncBufferToRenderThread(this.vbBuffer),K.syncBufferToRenderThread(this.ibBuffer),K.syncBufferToRenderThread(this._paramData),this.lineColor){var d;for(this._linePoints.length=0,this._line_ibArray.length=0,this._line_vbArray.length=0,u=0;u<t.length;u++)this._linePoints.push(t[u]);this._linePoints.push(t[0]),this._linePoints.push(t[1]),Et.createLine2(this._linePoints,this._line_ibArray,this._lineWidth,0,this._line_vbArray,!1),this._line_vertNum=this._linePoints.length,d=this._line_vertNum,(!this.line_ibBuffer||this.line_ibBuffer.getByteLength()<3*(this._line_vertNum-2)*2)&&(this.line_ibBuffer=new ParamData(3*(d-2)*2,!0,!0)),this._line_ibSize=3*(this._line_vertNum-2)*2;var f=this.line_ibBuffer._int16Data;for(r=0,_=0;_<3*(this._line_vertNum-2);_++)f[r++]=this._line_ibArray[_];(!this.line_vbBuffer||this.line_vbBuffer.getByteLength()<3*this._line_vertNum*4)&&(this.line_vbBuffer=new ParamData(3*d*4,!0)),this._line_vbSize=3*this._line_vertNum*4;var D=l.create(this._lineColor).numColor,m=this.line_vbBuffer._float32Data,C=this.line_vbBuffer._int32Data;for(h=0,u=0;u<this._line_vertNum;u++)m[h++]=this._line_vbArray[2*u]+this._x,m[h++]=this._line_vbArray[2*u+1]+this._y,C[h++]=D;(c=this._paramData._int32Data)[DrawPolyCmdNative._PARAM_LINE_VB_POS_]=this.line_vbBuffer.getPtrID(),c[DrawPolyCmdNative._PARAM_LINE_IB_POS_]=this.line_ibBuffer.getPtrID(),c[DrawPolyCmdNative._PARAM_LINE_VB_SIZE_POS_]=this._line_vbSize,c[DrawPolyCmdNative._PARAM_LINE_IB_SIZE_POS_]=this._line_ibSize,K.syncBufferToRenderThread(this.line_vbBuffer),K.syncBufferToRenderThread(this.line_ibBuffer)}}),_(0,t,"cmdID",function(){return"DrawPoly"}),_(0,t,"fillColor",function(){return this._fillColor},function(t){this._fillColor=t;for(var e=l.create(this._fillColor).numColor,a=this.vbBuffer._int32Data,i=0,r=0;r<this._vertNum;r++)i++,i++,a[i++]=e;K.syncBufferToRenderThread(this.vbBuffer)}),_(0,t,"x",function(){return this._x},function(t){this._x=t;for(var e=this.vbBuffer._float32Data,a=0,i=0;i<this._vertNum;i++)e[a++]=this._points[2*i]+this._x,a++,a++;if(this._lineColor){var r=this.line_vbBuffer._float32Data;for(a=0,i=0;i<this._line_vertNum;i++)r[a++]=this._line_vbArray[2*i]+this._x,a++,a++;K.syncBufferToRenderThread(this.line_vbBuffer)}K.syncBufferToRenderThread(this.vbBuffer)}),_(0,t,"isConvexPolygon",function(){return this._isConvexPolygon},function(t){this._isConvexPolygon=t}),_(0,t,"vid",function(){return this._vid},function(t){this._vid=t}),_(0,t,"y",function(){return this._y},function(t){this._y=t;for(var e=this.vbBuffer._float32Data,a=0,i=0;i<this._vertNum;i++)a++,e[a++]=this._points[2*i+1]+this._y,a++;if(this._lineColor){var r=this.line_vbBuffer._float32Data;for(a=0,i=0;i<this._line_vertNum;i++)a++,r[a++]=this._line_vbArray[2*i+1]+this._y,a++;K.syncBufferToRenderThread(this.line_vbBuffer)}K.syncBufferToRenderThread(this.vbBuffer)}),_(0,t,"lineWidth",function(){return this._lineWidth},function(t){this.lineColor&&(this._graphicsCmdEncoder._idata[this._cmdCurrentPos+1]=DrawPolyCmdNative._DRAW_POLY_LINES_CMD_ENCODER_.getPtrID(),K.syncBufferToRenderThread(this._graphicsCmdEncoder)),this._lineWidth=t,this._linePoints.length=0,this._line_ibArray.length=0,this._line_vbArray.length=0;for(var e=0;e<this._points.length;e++)this._linePoints.push(this._points[e]);this._linePoints.push(this._points[0]),this._linePoints.push(this._points[1]),Et.createLine2(this._linePoints,this._line_ibArray,this._lineWidth,0,this._line_vbArray,!1);var a=this.line_vbBuffer._float32Data,i=0;for(e=0;e<this._line_vertNum;e++)a[i++]=this._line_vbArray[2*e]+this._x,a[i++]=this._line_vbArray[2*e+1]+this._y,i++;K.syncBufferToRenderThread(this.line_vbBuffer)}),DrawPolyCmdNative.create=function(t,e,a,i,r,_,n,s){var o=N.getItemByClass("DrawPolyCmd",DrawPolyCmdNative);o._graphicsCmdEncoder=this._commandEncoder,DrawPolyCmdNative._DRAW_POLY_CMD_ENCODER_||(DrawPolyCmdNative._DRAW_POLY_CMD_ENCODER_=K.instance.createCommandEncoder(88,32,!0),DrawPolyCmdNative._DRAW_POLY_CMD_ENCODER_.blendFuncByGlobalValue(tt.GLOBALVALUE_BLENDFUNC_SRC,tt.GLOBALVALUE_BLENDFUNC_DEST),DrawPolyCmdNative._DRAW_POLY_CMD_ENCODER_.useProgramEx(tt.PROGRAMEX_DRAWVG),DrawPolyCmdNative._DRAW_POLY_CMD_ENCODER_.useVDO(tt.VDO_MESHVG),DrawPolyCmdNative._DRAW_POLY_CMD_ENCODER_.uniformEx(tt.GLOBALVALUE_VIEWS,0),DrawPolyCmdNative._DRAW_POLY_CMD_ENCODER_.uniformEx(tt.GLOBALVALUE_CLIP_MAT_DIR,1),DrawPolyCmdNative._DRAW_POLY_CMD_ENCODER_.uniformEx(tt.GLOBALVALUE_CLIP_MAT_POS,2),DrawPolyCmdNative._DRAW_POLY_CMD_ENCODER_.setMeshExByParamData(4*DrawPolyCmdNative._PARAM_VB_POS_,4*DrawPolyCmdNative._PARAM_VB_OFFSET_POS_,4*DrawPolyCmdNative._PARAM_VB_SIZE_POS_,4*DrawPolyCmdNative._PARAM_IB_POS_,4*DrawPolyCmdNative._PARAM_IB_OFFSET_POS_,4*DrawPolyCmdNative._PARAM_IB_SIZE_POS_,4*DrawPolyCmdNative._PARAM_INDEX_ELEMENT_OFFSET_POS_),DrawPolyCmdNative._DRAW_POLY_CMD_ENCODER_.modifyMesh(tt.GLOBALVALUE_MATRIX32,0,7),DrawPolyCmdNative._DRAW_POLY_CMD_ENCODER_.modifyMesh(tt.GLOBALVALUE_DRAWTEXTURE_COLOR,1,15),K.syncBufferToRenderThread(DrawPolyCmdNative._DRAW_POLY_CMD_ENCODER_)),DrawPolyCmdNative._DRAW_POLY_LINES_CMD_ENCODER_||(DrawPolyCmdNative._DRAW_POLY_LINES_CMD_ENCODER_=K.instance.createCommandEncoder(140,32,!0),DrawPolyCmdNative._DRAW_POLY_LINES_CMD_ENCODER_.blendFuncByGlobalValue(tt.GLOBALVALUE_BLENDFUNC_SRC,tt.GLOBALVALUE_BLENDFUNC_DEST),DrawPolyCmdNative._DRAW_POLY_LINES_CMD_ENCODER_.useProgramEx(tt.PROGRAMEX_DRAWVG),DrawPolyCmdNative._DRAW_POLY_LINES_CMD_ENCODER_.useVDO(tt.VDO_MESHVG),DrawPolyCmdNative._DRAW_POLY_LINES_CMD_ENCODER_.uniformEx(tt.GLOBALVALUE_VIEWS,0),DrawPolyCmdNative._DRAW_POLY_LINES_CMD_ENCODER_.uniformEx(tt.GLOBALVALUE_CLIP_MAT_DIR,1),DrawPolyCmdNative._DRAW_POLY_LINES_CMD_ENCODER_.uniformEx(tt.GLOBALVALUE_CLIP_MAT_POS,2),DrawPolyCmdNative._DRAW_POLY_LINES_CMD_ENCODER_.setMeshExByParamData(4*DrawPolyCmdNative._PARAM_VB_POS_,4*DrawPolyCmdNative._PARAM_VB_OFFSET_POS_,4*DrawPolyCmdNative._PARAM_VB_SIZE_POS_,4*DrawPolyCmdNative._PARAM_IB_POS_,4*DrawPolyCmdNative._PARAM_IB_OFFSET_POS_,4*DrawPolyCmdNative._PARAM_IB_SIZE_POS_,4*DrawPolyCmdNative._PARAM_INDEX_ELEMENT_OFFSET_POS_),DrawPolyCmdNative._DRAW_POLY_LINES_CMD_ENCODER_.modifyMesh(tt.GLOBALVALUE_MATRIX32,0,7),DrawPolyCmdNative._DRAW_POLY_LINES_CMD_ENCODER_.modifyMesh(tt.GLOBALVALUE_DRAWTEXTURE_COLOR,1,15),DrawPolyCmdNative._DRAW_POLY_LINES_CMD_ENCODER_.setMeshExByParamData(4*DrawPolyCmdNative._PARAM_LINE_VB_POS_,4*DrawPolyCmdNative._PARAM_LINE_VB_OFFSET_POS_,4*DrawPolyCmdNative._PARAM_LINE_VB_SIZE_POS_,4*DrawPolyCmdNative._PARAM_LINE_IB_POS_,4*DrawPolyCmdNative._PARAM_LINE_VB_OFFSET_POS_,4*DrawPolyCmdNative._PARAM_LINE_IB_SIZE_POS_,4*DrawPolyCmdNative._PARAM_LINE_INDEX_ELEMENT_OFFSET_POS_),DrawPolyCmdNative._DRAW_POLY_LINES_CMD_ENCODER_.modifyMesh(tt.GLOBALVALUE_MATRIX32,0,7),DrawPolyCmdNative._DRAW_POLY_LINES_CMD_ENCODER_.modifyMesh(tt.GLOBALVALUE_DRAWTEXTURE_COLOR,1,15),K.syncBufferToRenderThread(DrawPolyCmdNative._DRAW_POLY_LINES_CMD_ENCODER_)),o._paramData||(o._paramData=new ParamData(68,!0)),o._x=t,o._y=e,o._points=a,o._fillColor=i,o._lineColor=r,o._lineWidth=_,o._isConvexPolygon=n,o._vertNum=a.length/2;var h=o._vertNum,u=vt.earcut(a,null,2);if(u.length>0){(!o.ibBuffer||o.ibBuffer.getByteLength()<2*u.length)&&(o.ibBuffer=new ParamData(2*u.length,!0,!0)),o._ibSize=2*u.length;for(var c=o.ibBuffer._int16Data,d=0,f=0;f<u.length;f++)c[d++]=u[f]}var D=l.create(i).numColor;(!o.vbBuffer||o.vbBuffer.getByteLength()<3*o._vertNum*4)&&(o.vbBuffer=new ParamData(3*h*4,!0)),o._vbSize=3*o._vertNum*4;for(var m=o.vbBuffer._float32Data,C=o.vbBuffer._int32Data,E=0,v=0;v<o._vertNum;v++)m[E++]=a[2*v]+t,m[E++]=a[2*v+1]+e,C[E++]=D;for(v=0;v<a.length;v++)o._linePoints.push(a[v]);if(o._linePoints.push(a[0]),o._linePoints.push(a[1]),r){Et.createLine2(o._linePoints,o._line_ibArray,_,0,o._line_vbArray,!1),o._line_vertNum=o._linePoints.length;var A=o._line_vertNum;(!o.line_ibBuffer||o.line_ibBuffer.getByteLength()<3*(o._line_vertNum-2)*2)&&(o.line_ibBuffer=new ParamData(3*(A-2)*2,!0,!0)),o._line_ibSize=3*(o._line_vertNum-2)*2;var R=o.line_ibBuffer._int16Data;for(d=0,f=0;f<3*(o._line_vertNum-2);f++)R[d++]=o._line_ibArray[f];(!o.line_vbBuffer||o.line_vbBuffer.getByteLength()<3*o._line_vertNum*4)&&(o.line_vbBuffer=new ParamData(3*A*4,!0)),o._line_vbSize=3*o._line_vertNum*4;var T=l.create(r),P=T.numColor,L=o.line_vbBuffer._float32Data,p=o.line_vbBuffer._int32Data;for(E=0,v=0;v<o._line_vertNum;v++)L[E++]=o._line_vbArray[2*v]+t,L[E++]=o._line_vbArray[2*v+1]+e,p[E++]=P}else{o._lineWidth=1;for(Et.createLine2(o._linePoints,o._line_ibArray,o._lineWidth,0,o._line_vbArray,!1),o._line_vertNum=o._linePoints.length,A=o._line_vertNum,(!o.line_ibBuffer||o.line_ibBuffer.getByteLength()<3*(o._line_vertNum-2)*2)&&(o.line_ibBuffer=new ParamData(3*(A-2)*2,!0,!0)),o._line_ibSize=3*(o._line_vertNum-2)*2,R=o.line_ibBuffer._int16Data,d=0,f=0;f<3*(o._line_vertNum-2);f++)R[d++]=o._line_ibArray[f];for((!o.line_vbBuffer||o.line_vbBuffer.getByteLength()<3*o._line_vertNum*4)&&(o.line_vbBuffer=new ParamData(3*A*4,!0)),o._line_vbSize=3*o._line_vertNum*4,P=(T=l.create("#ffffff")).numColor,L=o.line_vbBuffer._float32Data,p=o.line_vbBuffer._int32Data,E=0,v=0;v<o._line_vertNum;v++)L[E++]=o._line_vbArray[2*v]+t,L[E++]=o._line_vbArray[2*v+1]+e,p[E++]=P}var b=o._paramData._float32Data,S=o._paramData._int32Data;return S[0]=1,S[1]=32,null==o.ibBuffer?null:(S[DrawPolyCmdNative._PARAM_VB_POS_]=o.vbBuffer.getPtrID(),S[DrawPolyCmdNative._PARAM_IB_POS_]=o.ibBuffer.getPtrID(),S[DrawPolyCmdNative._PARAM_VB_SIZE_POS_]=o._vbSize,S[DrawPolyCmdNative._PARAM_IB_SIZE_POS_]=o._ibSize,S[DrawPolyCmdNative._PARAM_VB_OFFSET_POS_]=0,S[DrawPolyCmdNative._PARAM_IB_OFFSET_POS_]=0,S[DrawPolyCmdNative._PARAM_INDEX_ELEMENT_OFFSET_POS_]=0,b[DrawPolyCmdNative._PARAM_ISCONVEXT_POS_]=n,K.syncBufferToRenderThread(o.vbBuffer),K.syncBufferToRenderThread(o.ibBuffer),S[DrawPolyCmdNative._PARAM_LINE_VB_POS_]=o.line_vbBuffer.getPtrID(),S[DrawPolyCmdNative._PARAM_LINE_IB_POS_]=o.line_ibBuffer.getPtrID(),S[DrawPolyCmdNative._PARAM_LINE_VB_SIZE_POS_]=o._line_vbSize,S[DrawPolyCmdNative._PARAM_LINE_IB_SIZE_POS_]=o._line_ibSize,S[DrawPolyCmdNative._PARAM_LINE_VB_OFFSET_POS_]=0,S[DrawPolyCmdNative._PARAM_LINE_IB_OFFSET_POS_]=0,S[DrawPolyCmdNative._PARAM_LINE_INDEX_ELEMENT_OFFSET_POS_]=0,K.syncBufferToRenderThread(o.line_vbBuffer),K.syncBufferToRenderThread(o.line_ibBuffer),K.syncBufferToRenderThread(o._paramData),o._cmdCurrentPos=r?o._graphicsCmdEncoder.useCommandEncoder(DrawPolyCmdNative._DRAW_POLY_LINES_CMD_ENCODER_.getPtrID(),o._paramData.getPtrID(),-1):o._graphicsCmdEncoder.useCommandEncoder(DrawPolyCmdNative._DRAW_POLY_CMD_ENCODER_.getPtrID(),o._paramData.getPtrID(),-1),K.syncBufferToRenderThread(o._graphicsCmdEncoder),o)},DrawPolyCmdNative.ID="DrawPoly",DrawPolyCmdNative._DRAW_POLY_CMD_ENCODER_=null,DrawPolyCmdNative._DRAW_POLY_LINES_CMD_ENCODER_=null,DrawPolyCmdNative._PARAM_VB_POS_=2,DrawPolyCmdNative._PARAM_IB_POS_=3,DrawPolyCmdNative._PARAM_VB_SIZE_POS_=4,DrawPolyCmdNative._PARAM_IB_SIZE_POS_=5,DrawPolyCmdNative._PARAM_LINE_VB_POS_=6,DrawPolyCmdNative._PARAM_LINE_IB_POS_=7,DrawPolyCmdNative._PARAM_LINE_VB_SIZE_POS_=8,DrawPolyCmdNative._PARAM_LINE_IB_SIZE_POS_=9,DrawPolyCmdNative._PARAM_ISCONVEXT_POS_=10,DrawPolyCmdNative._PARAM_VB_OFFSET_POS_=11,DrawPolyCmdNative._PARAM_IB_OFFSET_POS_=12,DrawPolyCmdNative._PARAM_LINE_VB_OFFSET_POS_=13,DrawPolyCmdNative._PARAM_LINE_IB_OFFSET_POS_=14,DrawPolyCmdNative._PARAM_INDEX_ELEMENT_OFFSET_POS_=15,DrawPolyCmdNative._PARAM_LINE_INDEX_ELEMENT_OFFSET_POS_=16}(),function(){function DrawRectCmdNative(){this._graphicsCmdEncoder=null,this._index=0,this._paramData=null,this._x=NaN,this._y=NaN,this._width=NaN,this._height=NaN,this._fillColor=null,this._lineColor=null,this._lineWidth=NaN,this._line_vertNum=0,this._cmdCurrentPos=0,this._linePoints=[],this._line_ibArray=[],this._line_vbArray=[]}r(DrawRectCmdNative,"laya.layagl.cmdNative.DrawRectCmdNative");var t=DrawRectCmdNative.prototype;t.recover=function(){this._linePoints.length=0,this._line_ibArray.length=0,this._line_vbArray.length=0,this._graphicsCmdEncoder=null,N.recover("DrawRectCmd",this)},_(0,t,"lineColor",function(){return this._lineColor},function(t){this._graphicsCmdEncoder._idata[this._cmdCurrentPos+1]=DrawRectCmdNative._DRAW_RECT_LINE_CMD_ENCODER_.getPtrID(),K.syncBufferToRenderThread(this._graphicsCmdEncoder),this._lineColor=t;for(var e=this._paramData._int32Data,a=l.create(t).numColor,i=DrawRectCmdNative._PARAM_LINE_VB_POS_,r=0;r<this._line_vertNum;r++)i++,i++,e[i++]=a;K.syncBufferToRenderThread(this._paramData)}),_(0,t,"cmdID",function(){return"DrawRect"}),_(0,t,"fillColor",function(){return this._fillColor},function(t){if(this._fillColor=t,"string"==typeof t){var e=l.create(this._fillColor).numColor,a=this._paramData._int32Data;a[DrawRectCmdNative._PARAM_VB_POS_+4]=e,a[DrawRectCmdNative._PARAM_VB_POS_+10]=e,a[DrawRectCmdNative._PARAM_VB_POS_+16]=e,a[DrawRectCmdNative._PARAM_VB_POS_+22]=e}else(a=this._paramData._int32Data)[DrawRectCmdNative._PARAM_VB_POS_+4]=t,a[DrawRectCmdNative._PARAM_VB_POS_+10]=t,a[DrawRectCmdNative._PARAM_VB_POS_+16]=t,a[DrawRectCmdNative._PARAM_VB_POS_+22]=t;K.syncBufferToRenderThread(this._paramData)}),_(0,t,"width",function(){return this._width},function(t){this._width=t;var e=this._paramData._float32Data;if(e[DrawRectCmdNative._PARAM_VB_POS_+6]=this._x+this._width,e[DrawRectCmdNative._PARAM_VB_POS_+12]=this._x+this._width,this.lineColor){this._line_ibArray.length=0,this._line_vbArray.length=0,this._linePoints[2]=this._x+this._width,this._linePoints[4]=this._x+this._width,Et.createLine2(this._linePoints,this._line_ibArray,this._lineWidth,0,this._line_vbArray,!1),this._line_vertNum=this._linePoints.length;for(var a=DrawRectCmdNative._PARAM_LINE_VB_POS_,i=0;i<this._line_vertNum;i++)e[a++]=this._line_vbArray[2*i],e[a++]=this._line_vbArray[2*i+1],a++}K.syncBufferToRenderThread(this._paramData)}),_(0,t,"x",function(){return this._x},function(t){this._x=t;var e=this._paramData._float32Data;if(e[DrawRectCmdNative._PARAM_VB_POS_]=this._x,e[DrawRectCmdNative._PARAM_VB_POS_+6]=this._x+this._width,e[DrawRectCmdNative._PARAM_VB_POS_+12]=this._x+this._width,e[DrawRectCmdNative._PARAM_VB_POS_+18]=this._x,this.lineColor){this._line_ibArray.length=0,this._line_vbArray.length=0,this._linePoints[0]=this._x,this._linePoints[2]=this._x+this._width,this._linePoints[4]=this._x+this._width,this._linePoints[6]=this._x,this._linePoints[8]=this._x,Et.createLine2(this._linePoints,this._line_ibArray,this._lineWidth,0,this._line_vbArray,!1);for(var a=DrawRectCmdNative._PARAM_LINE_VB_POS_,i=0;i<this._line_vertNum;i++)e[a++]=this._line_vbArray[2*i],e[a++]=this._line_vbArray[2*i+1],a++}K.syncBufferToRenderThread(this._paramData)}),_(0,t,"y",function(){return this._y},function(t){this._y=t;var e=this._paramData._float32Data;if(e[DrawRectCmdNative._PARAM_VB_POS_+1]=this._y,e[DrawRectCmdNative._PARAM_VB_POS_+7]=this._y,e[DrawRectCmdNative._PARAM_VB_POS_+13]=this._y+this._height,e[DrawRectCmdNative._PARAM_VB_POS_+19]=this._y+this._height,this.lineColor){this._line_ibArray.length=0,this._line_vbArray.length=0,this._linePoints[1]=this._y,this._linePoints[3]=this._y,this._linePoints[5]=this._y+this._height,this._linePoints[7]=this._y+this._height,this._linePoints[9]=this._y-this._lineWidth/2,Et.createLine2(this._linePoints,this._line_ibArray,this._lineWidth,0,this._line_vbArray,!1);for(var a=DrawRectCmdNative._PARAM_LINE_VB_POS_,i=0;i<this._line_vertNum;i++)e[a++]=this._line_vbArray[2*i],e[a++]=this._line_vbArray[2*i+1],a++}K.syncBufferToRenderThread(this._paramData)}),_(0,t,"height",function(){return this._height},function(t){this._height=t;var e=this._paramData._float32Data;if(e[DrawRectCmdNative._PARAM_VB_POS_+13]=this._y+this._height,e[DrawRectCmdNative._PARAM_VB_POS_+19]=this._y+this._height,this.lineColor){this._line_ibArray.length=0,this._line_vbArray.length=0,this._linePoints[5]=this._y+this._height,this._linePoints[7]=this._y+this._height,Et.createLine2(this._linePoints,this._line_ibArray,this._lineWidth,0,this._line_vbArray,!1);for(var a=DrawRectCmdNative._PARAM_LINE_VB_POS_,i=0;i<this._line_vertNum;i++)e[a++]=this._line_vbArray[2*i],e[a++]=this._line_vbArray[2*i+1],a++}K.syncBufferToRenderThread(this._paramData)}),_(0,t,"lineWidth",function(){return this._lineWidth},function(t){this.lineColor&&(this._graphicsCmdEncoder._idata[this._cmdCurrentPos+1]=DrawRectCmdNative._DRAW_RECT_LINE_CMD_ENCODER_.getPtrID(),K.syncBufferToRenderThread(this._graphicsCmdEncoder)),this._lineWidth=t,this._line_ibArray.length=0,this._line_vbArray.length=0,this._linePoints[9]=this._y-this._lineWidth/2,Et.createLine2(this._linePoints,this._line_ibArray,this._lineWidth,0,this._line_vbArray,!1),this._line_vertNum=this._linePoints.length;for(var e=this._paramData._float32Data,a=DrawRectCmdNative._PARAM_LINE_VB_POS_,i=0;i<this._line_vertNum;i++)e[a++]=this._line_vbArray[2*i],e[a++]=this._line_vbArray[2*i+1],a++;K.syncBufferToRenderThread(this._paramData)}),DrawRectCmdNative.create=function(t,e,a,i,r,_,n){var s=N.getItemByClass("DrawRectCmd",DrawRectCmdNative);s._graphicsCmdEncoder=this._commandEncoder,DrawRectCmdNative._DRAW_RECT_LINE_CMD_ENCODER_||(DrawRectCmdNative._DRAW_RECT_LINE_CMD_ENCODER_=K.instance.createCommandEncoder(164,32,!0),DrawRectCmdNative._DRAW_RECT_LINE_CMD_ENCODER_.blendFuncByGlobalValue(tt.GLOBALVALUE_BLENDFUNC_SRC,tt.GLOBALVALUE_BLENDFUNC_DEST),DrawRectCmdNative._DRAW_RECT_LINE_CMD_ENCODER_.useProgramEx(tt.PROGRAMEX_DRAWTEXTURE),DrawRectCmdNative._DRAW_RECT_LINE_CMD_ENCODER_.useVDO(tt.VDO_MESHQUADTEXTURE),DrawRectCmdNative._DRAW_RECT_LINE_CMD_ENCODER_.uniformEx(tt.GLOBALVALUE_VIEWS,0),DrawRectCmdNative._DRAW_RECT_LINE_CMD_ENCODER_.uniformEx(tt.GLOBALVALUE_CLIP_MAT_DIR,1),DrawRectCmdNative._DRAW_RECT_LINE_CMD_ENCODER_.uniformEx(tt.GLOBALVALUE_CLIP_MAT_POS,2),DrawRectCmdNative._DRAW_RECT_LINE_CMD_ENCODER_.setRectMeshByParamData(4*DrawRectCmdNative._PARAM_RECT_NUM_POS_,4*DrawRectCmdNative._PARAM_VB_POS_,4*DrawRectCmdNative._PARAM_VB_SIZE_POS_),DrawRectCmdNative._DRAW_RECT_LINE_CMD_ENCODER_.modifyMesh(tt.GLOBALVALUE_MATRIX32,0,7),DrawRectCmdNative._DRAW_RECT_LINE_CMD_ENCODER_.modifyMesh(tt.GLOBALVALUE_DRAWTEXTURE_COLOR,1,15),DrawRectCmdNative._DRAW_RECT_LINE_CMD_ENCODER_.useProgramEx(tt.PROGRAMEX_DRAWVG),DrawRectCmdNative._DRAW_RECT_LINE_CMD_ENCODER_.useVDO(tt.VDO_MESHVG),DrawRectCmdNative._DRAW_RECT_LINE_CMD_ENCODER_.uniformEx(tt.GLOBALVALUE_VIEWS,0),DrawRectCmdNative._DRAW_RECT_LINE_CMD_ENCODER_.uniformEx(tt.GLOBALVALUE_CLIP_MAT_DIR,1),DrawRectCmdNative._DRAW_RECT_LINE_CMD_ENCODER_.uniformEx(tt.GLOBALVALUE_CLIP_MAT_POS,2),DrawRectCmdNative._DRAW_RECT_LINE_CMD_ENCODER_.setMeshByParamData(4*DrawRectCmdNative._PARAM_LINE_VB_POS_,4*DrawRectCmdNative._PARAM_LINE_VB_OFFSET_POS_,4*DrawRectCmdNative._PARAM_LINE_VB_SIZE_POS_,4*DrawRectCmdNative._PARAM_LINE_IB_POS_,4*DrawRectCmdNative._PARAM_LINE_IB_OFFSET_POS_,4*DrawRectCmdNative._PARAM_LINE_IB_SIZE_POS_,4*DrawRectCmdNative._PARAM_LINE_IBELEMENT_OFFSET_POS_),DrawRectCmdNative._DRAW_RECT_LINE_CMD_ENCODER_.modifyMesh(tt.GLOBALVALUE_MATRIX32,0,7),DrawRectCmdNative._DRAW_RECT_LINE_CMD_ENCODER_.modifyMesh(tt.GLOBALVALUE_DRAWTEXTURE_COLOR,1,15),K.syncBufferToRenderThread(DrawRectCmdNative._DRAW_RECT_LINE_CMD_ENCODER_)),DrawRectCmdNative._DRAW_RECT_CMD_ENCODER_||(DrawRectCmdNative._DRAW_RECT_CMD_ENCODER_=K.instance.createCommandEncoder(84,32,!0),DrawRectCmdNative._DRAW_RECT_CMD_ENCODER_.blendFuncByGlobalValue(tt.GLOBALVALUE_BLENDFUNC_SRC,tt.GLOBALVALUE_BLENDFUNC_DEST),DrawRectCmdNative._DRAW_RECT_CMD_ENCODER_.useProgramEx(tt.PROGRAMEX_DRAWTEXTURE),DrawRectCmdNative._DRAW_RECT_CMD_ENCODER_.useVDO(tt.VDO_MESHQUADTEXTURE),DrawRectCmdNative._DRAW_RECT_CMD_ENCODER_.uniformEx(tt.GLOBALVALUE_VIEWS,0),DrawRectCmdNative._DRAW_RECT_CMD_ENCODER_.uniformEx(tt.GLOBALVALUE_CLIP_MAT_DIR,1),DrawRectCmdNative._DRAW_RECT_CMD_ENCODER_.uniformEx(tt.GLOBALVALUE_CLIP_MAT_POS,2),DrawRectCmdNative._DRAW_RECT_CMD_ENCODER_.setRectMeshByParamData(4*DrawRectCmdNative._PARAM_RECT_NUM_POS_,4*DrawRectCmdNative._PARAM_VB_POS_,4*DrawRectCmdNative._PARAM_VB_SIZE_POS_),DrawRectCmdNative._DRAW_RECT_CMD_ENCODER_.modifyMesh(tt.GLOBALVALUE_MATRIX32,0,7),DrawRectCmdNative._DRAW_RECT_CMD_ENCODER_.modifyMesh(tt.GLOBALVALUE_DRAWTEXTURE_COLOR,1,15),K.syncBufferToRenderThread(DrawRectCmdNative._DRAW_RECT_CMD_ENCODER_)),s._paramData||(s._paramData=new ParamData(292,!0)),s._x=t,s._y=e,s._width=a,s._height=i,s._fillColor=r,s._lineColor=_,s._lineWidth=n;var o=l.create(r).numColor,h=s._paramData._float32Data,u=s._paramData._int32Data;u[DrawRectCmdNative._PARAM_RECT_NUM_POS_]=1,u[DrawRectCmdNative._PARAM_VB_SIZE_POS_]=96;var c=DrawRectCmdNative._PARAM_VB_POS_;if(h[c++]=t,h[c++]=e,h[c++]=0,h[c++]=0,u[c++]=o,h[c++]=4294967295,h[c++]=t+a,h[c++]=e,h[c++]=0,h[c++]=0,u[c++]=o,h[c++]=4294967295,h[c++]=t+a,h[c++]=e+i,h[c++]=0,h[c++]=0,u[c++]=o,h[c++]=4294967295,h[c++]=t,h[c++]=e+i,h[c++]=0,h[c++]=0,u[c++]=o,h[c++]=4294967295,s._linePoints.push(t),s._linePoints.push(e),s._linePoints.push(t+a),s._linePoints.push(e),s._linePoints.push(t+a),s._linePoints.push(e+i),s._linePoints.push(t),s._linePoints.push(e+i),s._linePoints.push(t),s._linePoints.push(e-n/2),_){Et.createLine2(s._linePoints,s._line_ibArray,n,0,s._line_vbArray,!1),s._line_vertNum=s._linePoints.length,u[DrawRectCmdNative._PARAM_LINE_VB_SIZE_POS_]=120;var d=l.create(_),f=d.numColor;c=DrawRectCmdNative._PARAM_LINE_VB_POS_;for(var D=0;D<s._line_vertNum;D++)h[c++]=s._line_vbArray[2*D],h[c++]=s._line_vbArray[2*D+1],u[c++]=f;u[DrawRectCmdNative._PARAM_LINE_IB_SIZE_POS_]=2*s._line_ibArray.length;var m=s._paramData._int16Data;c=2*DrawRectCmdNative._PARAM_LINE_IB_POS_;for(var C=0;C<s._line_ibArray.length;C++)m[c++]=s._line_ibArray[C]}else{s._lineWidth=1;for(Et.createLine2(s._linePoints,s._line_ibArray,s._lineWidth,0,s._line_vbArray,!1),s._line_vertNum=s._linePoints.length,u[DrawRectCmdNative._PARAM_LINE_VB_SIZE_POS_]=120,f=(d=l.create("#ffffff")).numColor,c=DrawRectCmdNative._PARAM_LINE_VB_POS_,D=0;D<s._line_vertNum;D++)h[c++]=s._line_vbArray[2*D],h[c++]=s._line_vbArray[2*D+1],u[c++]=f;for(u[DrawRectCmdNative._PARAM_LINE_IB_SIZE_POS_]=2*s._line_ibArray.length,m=s._paramData._int16Data,c=2*DrawRectCmdNative._PARAM_LINE_IB_POS_,C=0;C<s._line_ibArray.length;C++)m[c++]=s._line_ibArray[C]}return u[DrawRectCmdNative._PARAM_LINE_VB_OFFSET_POS_]=0,u[DrawRectCmdNative._PARAM_LINE_IB_OFFSET_POS_]=0,u[DrawRectCmdNative._PARAM_LINE_IBELEMENT_OFFSET_POS_]=0,K.syncBufferToRenderThread(s._paramData),s._cmdCurrentPos=_?s._graphicsCmdEncoder.useCommandEncoder(DrawRectCmdNative._DRAW_RECT_LINE_CMD_ENCODER_.getPtrID(),s._paramData.getPtrID(),-1):s._graphicsCmdEncoder.useCommandEncoder(DrawRectCmdNative._DRAW_RECT_CMD_ENCODER_.getPtrID(),s._paramData.getPtrID(),-1),K.syncBufferToRenderThread(s._graphicsCmdEncoder),s},DrawRectCmdNative.ID="DrawRect",DrawRectCmdNative._DRAW_RECT_CMD_ENCODER_=null,DrawRectCmdNative._DRAW_RECT_LINE_CMD_ENCODER_=null,DrawRectCmdNative._PARAM_RECT_NUM_POS_=0,DrawRectCmdNative._PARAM_VB_SIZE_POS_=1,DrawRectCmdNative._PARAM_VB_POS_=2,DrawRectCmdNative._PARAM_LINE_VB_SIZE_POS_=26,DrawRectCmdNative._PARAM_LINE_VB_POS_=27,DrawRectCmdNative._PARAM_LINE_IB_SIZE_POS_=57,DrawRectCmdNative._PARAM_LINE_IB_POS_=58,DrawRectCmdNative._PARAM_LINE_VB_OFFSET_POS_=70,DrawRectCmdNative._PARAM_LINE_IB_OFFSET_POS_=71,DrawRectCmdNative._PARAM_LINE_IBELEMENT_OFFSET_POS_=72}(),function(){function DrawTextureCmdNative(){this._graphicsCmdEncoder=null,this._index=0,this._paramData=null,this._texture=null,this._x=NaN,this._y=NaN,this._width=NaN,this._height=NaN,this._matrix=null,this._alpha=NaN,this._color=null,this._blendMode=null,this._cmdCurrentPos=0,this._blend_src=0,this._blend_dest=0}r(DrawTextureCmdNative,"laya.layagl.cmdNative.DrawTextureCmdNative");var t=DrawTextureCmdNative.prototype;t.recover=function(){this._texture=null,N.recover("DrawTextureCmd",this)},t._setBlendMode=function(t){switch(t){case"normal":this._blend_src=1,this._blend_dest=771;break;case"add":this._blend_src=1,this._blend_dest=772;break;case"multiply":this._blend_src=774,this._blend_dest=771;break;case"screen":case"light":this._blend_src=1,this._blend_dest=1;break;case"overlay":this._blend_src=1,this._blend_dest=769;break;case"destination-out":this._blend_src=0,this._blend_dest=0;break;case"mask":this._blend_src=0,this._blend_dest=770;break;default:alert("_setBlendMode Unknown type")}},t._mixRGBandAlpha=function(t,e){var a=(4278190080&t)>>>24;return 0!=a?a*=e:a=255*e,16777215&t|a<<24},_(0,t,"cmdID",function(){return"DrawTexture"}),_(0,t,"matrix",function(){return this._matrix},function(t){this._matrix||(this._graphicsCmdEncoder._idata[this._cmdCurrentPos+1]=DrawTextureCmdNative._DRAW_TEXTURE_CMD_ENCODER_MATRIX_.getPtrID(),K.syncBufferToRenderThread(this._graphicsCmdEncoder)),this._matrix=t;var e=this._paramData._float32Data;e[DrawTextureCmdNative._PARAM_MATRIX_POS_]=t.a,e[DrawTextureCmdNative._PARAM_MATRIX_POS_+1]=t.b,e[DrawTextureCmdNative._PARAM_MATRIX_POS_+2]=t.c,e[DrawTextureCmdNative._PARAM_MATRIX_POS_+3]=t.d,e[DrawTextureCmdNative._PARAM_MATRIX_POS_+4]=t.tx,e[DrawTextureCmdNative._PARAM_MATRIX_POS_+5]=t.ty,K.syncBufferToRenderThread(this._paramData)}),_(0,t,"y",function(){return this._y},function(t){this._y=t;var e=this._paramData._float32Data;e[DrawTextureCmdNative._PARAM_VB_POS_+1]=this._y,e[DrawTextureCmdNative._PARAM_VB_POS_+7]=this._y,e[DrawTextureCmdNative._PARAM_VB_POS_+13]=this._y+this._height,e[DrawTextureCmdNative._PARAM_VB_POS_+19]=this._y+this._height,K.syncBufferToRenderThread(this._paramData)}),_(0,t,"texture",function(){return this._texture},function(t){if(t&&t.url){this._texture=t,this._paramData._int32Data[DrawTextureCmdNative._PARAM_TEXTURE_POS_]=this._texture.bitmap._glTexture.id;var e=this._paramData._float32Data,a=this.texture.uv;e[DrawTextureCmdNative._PARAM_VB_POS_+2]=a[0],e[DrawTextureCmdNative._PARAM_VB_POS_+3]=a[1],e[DrawTextureCmdNative._PARAM_VB_POS_+8]=a[2],e[DrawTextureCmdNative._PARAM_VB_POS_+9]=a[3],e[DrawTextureCmdNative._PARAM_VB_POS_+14]=a[4],e[DrawTextureCmdNative._PARAM_VB_POS_+15]=a[5],e[DrawTextureCmdNative._PARAM_VB_POS_+20]=a[6],e[DrawTextureCmdNative._PARAM_VB_POS_+21]=a[7],K.syncBufferToRenderThread(this._paramData)}}),_(0,t,"width",function(){return this._width},function(t){this._width=t;var e=this._paramData._float32Data;e[DrawTextureCmdNative._PARAM_VB_POS_]=this._x,e[DrawTextureCmdNative._PARAM_VB_POS_+6]=this._x+this._width,e[DrawTextureCmdNative._PARAM_VB_POS_+12]=this._x+this._width,e[DrawTextureCmdNative._PARAM_VB_POS_+18]=this._x,K.syncBufferToRenderThread(this._paramData)}),_(0,t,"x",function(){return this._x},function(t){this._x=t;var e=this._paramData._float32Data;e[DrawTextureCmdNative._PARAM_VB_POS_]=this._x,e[DrawTextureCmdNative._PARAM_VB_POS_+6]=this._x+this._width,e[DrawTextureCmdNative._PARAM_VB_POS_+12]=this._x+this._width,e[DrawTextureCmdNative._PARAM_VB_POS_+18]=this._x,K.syncBufferToRenderThread(this._paramData)}),_(0,t,"height",function(){return this._height},function(t){this._height=t;var e=this._paramData._float32Data;e[DrawTextureCmdNative._PARAM_VB_POS_+1]=this._y,e[DrawTextureCmdNative._PARAM_VB_POS_+7]=this._y,e[DrawTextureCmdNative._PARAM_VB_POS_+13]=this._y+this._height,e[DrawTextureCmdNative._PARAM_VB_POS_+19]=this._y+this._height,K.syncBufferToRenderThread(this._paramData)}),_(0,t,"alpha",function(){return this._alpha},function(t){this._alpha=t}),DrawTextureCmdNative.create=function(t,e,a,i,r,_,n,s,o){var h=N.getItemByClass("DrawTextureCmd",DrawTextureCmdNative);h._graphicsCmdEncoder=this._commandEncoder,DrawTextureCmdNative._DRAW_TEXTURE_CMD_ENCODER_||(DrawTextureCmdNative._DRAW_TEXTURE_CMD_ENCODER_=K.instance.createCommandEncoder(124,32,!0),DrawTextureCmdNative._DRAW_TEXTURE_CMD_ENCODER_.blendFuncByGlobalValue(tt.GLOBALVALUE_BLENDFUNC_SRC,tt.GLOBALVALUE_BLENDFUNC_DEST),DrawTextureCmdNative._DRAW_TEXTURE_CMD_ENCODER_.blendFuncByParamData(4*DrawTextureCmdNative._PARAM_BLEND_SRC_POS_,4*DrawTextureCmdNative._PARAM_BLEND_DEST_POS_),DrawTextureCmdNative._DRAW_TEXTURE_CMD_ENCODER_.useProgramEx(tt.PROGRAMEX_DRAWTEXTURE),DrawTextureCmdNative._DRAW_TEXTURE_CMD_ENCODER_.useVDO(tt.VDO_MESHQUADTEXTURE),DrawTextureCmdNative._DRAW_TEXTURE_CMD_ENCODER_.uniformEx(tt.GLOBALVALUE_VIEWS,0),DrawTextureCmdNative._DRAW_TEXTURE_CMD_ENCODER_.uniformEx(tt.GLOBALVALUE_CLIP_MAT_DIR,1),DrawTextureCmdNative._DRAW_TEXTURE_CMD_ENCODER_.uniformEx(tt.GLOBALVALUE_CLIP_MAT_POS,2),DrawTextureCmdNative._DRAW_TEXTURE_CMD_ENCODER_.uniformTextureByParamData(4*DrawTextureCmdNative._PARAM_UNIFORM_LOCATION_POS_,4*DrawTextureCmdNative._PARAM_TEX_LOCATION_POS_,4*DrawTextureCmdNative._PARAM_TEXTURE_POS_),DrawTextureCmdNative._DRAW_TEXTURE_CMD_ENCODER_.setRectMeshByParamData(4*DrawTextureCmdNative._PARAM_RECT_NUM_POS_,4*DrawTextureCmdNative._PARAM_VB_POS_,4*DrawTextureCmdNative._PARAM_VB_SIZE_POS_),DrawTextureCmdNative._DRAW_TEXTURE_CMD_ENCODER_.modifyMesh(tt.GLOBALVALUE_MATRIX32,0,7),DrawTextureCmdNative._DRAW_TEXTURE_CMD_ENCODER_.modifyMesh(tt.GLOBALVALUE_DRAWTEXTURE_COLOR,1,15),K.syncBufferToRenderThread(DrawTextureCmdNative._DRAW_TEXTURE_CMD_ENCODER_)),DrawTextureCmdNative._DRAW_TEXTURE_CMD_ENCODER_MATRIX_||(DrawTextureCmdNative._DRAW_TEXTURE_CMD_ENCODER_MATRIX_=K.instance.createCommandEncoder(132,32,!0),DrawTextureCmdNative._DRAW_TEXTURE_CMD_ENCODER_MATRIX_.blendFuncByGlobalValue(tt.GLOBALVALUE_BLENDFUNC_SRC,tt.GLOBALVALUE_BLENDFUNC_DEST),DrawTextureCmdNative._DRAW_TEXTURE_CMD_ENCODER_MATRIX_.blendFuncByParamData(4*DrawTextureCmdNative._PARAM_BLEND_SRC_POS_,4*DrawTextureCmdNative._PARAM_BLEND_DEST_POS_),DrawTextureCmdNative._DRAW_TEXTURE_CMD_ENCODER_MATRIX_.useProgramEx(tt.PROGRAMEX_DRAWTEXTURE),DrawTextureCmdNative._DRAW_TEXTURE_CMD_ENCODER_MATRIX_.useVDO(tt.VDO_MESHQUADTEXTURE),DrawTextureCmdNative._DRAW_TEXTURE_CMD_ENCODER_MATRIX_.save(),DrawTextureCmdNative._DRAW_TEXTURE_CMD_ENCODER_MATRIX_.setGlobalValueByParamData(tt.GLOBALVALUE_MATRIX32,7,4*DrawTextureCmdNative._PARAM_MATRIX_POS_),DrawTextureCmdNative._DRAW_TEXTURE_CMD_ENCODER_MATRIX_.uniformEx(tt.GLOBALVALUE_VIEWS,0),DrawTextureCmdNative._DRAW_TEXTURE_CMD_ENCODER_MATRIX_.uniformEx(tt.GLOBALVALUE_CLIP_MAT_DIR,1),DrawTextureCmdNative._DRAW_TEXTURE_CMD_ENCODER_MATRIX_.uniformEx(tt.GLOBALVALUE_CLIP_MAT_POS,2),DrawTextureCmdNative._DRAW_TEXTURE_CMD_ENCODER_MATRIX_.uniformTextureByParamData(4*DrawTextureCmdNative._PARAM_UNIFORM_LOCATION_POS_,4*DrawTextureCmdNative._PARAM_TEX_LOCATION_POS_,4*DrawTextureCmdNative._PARAM_TEXTURE_POS_),DrawTextureCmdNative._DRAW_TEXTURE_CMD_ENCODER_MATRIX_.setRectMeshByParamData(4*DrawTextureCmdNative._PARAM_RECT_NUM_POS_,4*DrawTextureCmdNative._PARAM_VB_POS_,4*DrawTextureCmdNative._PARAM_VB_SIZE_POS_),DrawTextureCmdNative._DRAW_TEXTURE_CMD_ENCODER_MATRIX_.modifyMesh(tt.GLOBALVALUE_MATRIX32,0,7),DrawTextureCmdNative._DRAW_TEXTURE_CMD_ENCODER_MATRIX_.modifyMesh(tt.GLOBALVALUE_DRAWTEXTURE_COLOR,1,15),DrawTextureCmdNative._DRAW_TEXTURE_CMD_ENCODER_MATRIX_.restore(),K.syncBufferToRenderThread(DrawTextureCmdNative._DRAW_TEXTURE_CMD_ENCODER_MATRIX_)),h._paramData||(h._paramData=new ParamData(148,!0)),h._texture=t,h._x=e,h._y=a,h._width=i,h._height=r,h._matrix=_,h._alpha=n,h._color=s,h._blendMode=o;var l=0!=i?i:t.bitmap.width,u=0!=r?r:t.bitmap.height,c=t.uv,d=h._paramData._float32Data,f=h._paramData._int32Data;f[DrawTextureCmdNative._PARAM_UNIFORM_LOCATION_POS_]=3,f[DrawTextureCmdNative._PARAM_TEX_LOCATION_POS_]=33984,f[DrawTextureCmdNative._PARAM_TEXTURE_POS_]=t.bitmap._glTexture.id,f[DrawTextureCmdNative._PARAM_RECT_NUM_POS_]=1,f[DrawTextureCmdNative._PARAM_VB_SIZE_POS_]=96,o?(h._setBlendMode(o),f[DrawTextureCmdNative._PARAM_BLEND_SRC_POS_]=h._blend_src,f[DrawTextureCmdNative._PARAM_BLEND_DEST_POS_]=h._blend_dest):(f[DrawTextureCmdNative._PARAM_BLEND_SRC_POS_]=-1,f[DrawTextureCmdNative._PARAM_BLEND_DEST_POS_]=-1);var D=4294967295;n&&(D=h._mixRGBandAlpha(D,n));var m=DrawTextureCmdNative._PARAM_VB_POS_;return d[m++]=e,d[m++]=a,d[m++]=c[0],d[m++]=c[1],f[m++]=D,f[m++]=4294967295,d[m++]=e+l,d[m++]=a,d[m++]=c[2],d[m++]=c[3],f[m++]=D,f[m++]=4294967295,d[m++]=e+l,d[m++]=a+u,d[m++]=c[4],d[m++]=c[5],f[m++]=D,f[m++]=4294967295,d[m++]=e,d[m++]=a+u,d[m++]=c[6],d[m++]=c[7],f[m++]=D,f[m++]=4294967295,_&&(d[DrawTextureCmdNative._PARAM_MATRIX_POS_]=_.a,d[DrawTextureCmdNative._PARAM_MATRIX_POS_+1]=_.b,d[DrawTextureCmdNative._PARAM_MATRIX_POS_+2]=_.c,d[DrawTextureCmdNative._PARAM_MATRIX_POS_+3]=_.d,d[DrawTextureCmdNative._PARAM_MATRIX_POS_+4]=_.tx,d[DrawTextureCmdNative._PARAM_MATRIX_POS_+5]=_.ty),K.syncBufferToRenderThread(h._paramData),h._cmdCurrentPos=_?h._graphicsCmdEncoder.useCommandEncoder(DrawTextureCmdNative._DRAW_TEXTURE_CMD_ENCODER_MATRIX_.getPtrID(),h._paramData.getPtrID(),-1):h._graphicsCmdEncoder.useCommandEncoder(DrawTextureCmdNative._DRAW_TEXTURE_CMD_ENCODER_.getPtrID(),h._paramData.getPtrID(),-1),K.syncBufferToRenderThread(h._graphicsCmdEncoder),h},DrawTextureCmdNative.ID="DrawTexture",DrawTextureCmdNative._DRAW_TEXTURE_CMD_ENCODER_=null,DrawTextureCmdNative._DRAW_TEXTURE_CMD_ENCODER_MATRIX_=null,DrawTextureCmdNative._PARAM_UNIFORM_LOCATION_POS_=0,DrawTextureCmdNative._PARAM_TEX_LOCATION_POS_=1,DrawTextureCmdNative._PARAM_TEXTURE_POS_=2,DrawTextureCmdNative._PARAM_RECT_NUM_POS_=3,DrawTextureCmdNative._PARAM_VB_SIZE_POS_=4,DrawTextureCmdNative._PARAM_VB_POS_=5,DrawTextureCmdNative._PARAM_MATRIX_POS_=29,DrawTextureCmdNative._PARAM_BLEND_SRC_POS_=35,DrawTextureCmdNative._PARAM_BLEND_DEST_POS_=36}(),function(){function DrawTexturesCmdNative(){this._graphicsCmdEncoder=null,this._index=0,this._paramData=null,this._texture=null,this._pos=null,this._rectNum=0,this._vbSize=0,this.vbBuffer=null}r(DrawTexturesCmdNative,"laya.layagl.cmdNative.DrawTexturesCmdNative");var t=DrawTexturesCmdNative.prototype;t.recover=function(){this._texture=null,this._pos=null,N.recover("DrawTexturesCmd",this)},_(0,t,"cmdID",function(){return"DrawTextures"}),_(0,t,"texture",function(){return this._texture},function(t){this._texture=t;for(var e=this._texture.bitmap.width,a=this._texture.bitmap.height,i=this._texture.uv,r=this.vbBuffer._float32Data,_=this.vbBuffer._int32Data,n=0,s=0;s<this._rectNum;s++){var o=this.pos[2*s],h=this.pos[2*s+1];r[n++]=o,r[n++]=h,r[n++]=i[0],r[n++]=i[1],_[n++]=4294967295,_[n++]=4294967295,r[n++]=o+e,r[n++]=h,r[n++]=i[2],r[n++]=i[3],_[n++]=4294967295,_[n++]=4294967295,r[n++]=o+e,r[n++]=h+a,r[n++]=i[4],r[n++]=i[5],_[n++]=4294967295,_[n++]=4294967295,r[n++]=o,r[n++]=h+a,r[n++]=i[6],r[n++]=i[7],_[n++]=4294967295,_[n++]=4294967295}var l=this._paramData._int32Data;l[DrawTexturesCmdNative._PARAM_TEXLOCATION_POS_]=33984,l[DrawTexturesCmdNative._PARAM_TEXTURE_POS_]=this._texture.bitmap._glTexture.id,K.syncBufferToRenderThread(this.vbBuffer),K.syncBufferToRenderThread(this._paramData)}),_(0,t,"pos",function(){return this._pos},function(t){this._pos=t;var e=this._pos.length/2,a=this._texture.bitmap.width,i=this._texture.bitmap.height,r=this._texture.uv;(!this.vbBuffer||this.vbBuffer.getByteLength()<24*e*4)&&(this.vbBuffer=new ParamData(24*e*4,!0)),this._vbSize=24*e*4,this._rectNum=e;for(var _=this.vbBuffer._float32Data,n=this.vbBuffer._int32Data,s=0,o=0;o<e;o++){var h=this.pos[2*o],l=this.pos[2*o+1];_[s++]=h,_[s++]=l,_[s++]=r[0],_[s++]=r[1],n[s++]=4294967295,n[s++]=4294967295,_[s++]=h+a,_[s++]=l,_[s++]=r[2],_[s++]=r[3],n[s++]=4294967295,n[s++]=4294967295,_[s++]=h+a,_[s++]=l+i,_[s++]=r[4],_[s++]=r[5],n[s++]=4294967295,n[s++]=4294967295,_[s++]=h,_[s++]=l+i,_[s++]=r[6],_[s++]=r[7],n[s++]=4294967295,n[s++]=4294967295}this._paramData._float32Data;var u=this._paramData._int32Data;u[DrawTexturesCmdNative._PARAM_RECT_NUM_POS_]=this._rectNum,u[DrawTexturesCmdNative._PARAM_VB_POS_]=this.vbBuffer.getPtrID(),u[DrawTexturesCmdNative._PARAM_VB_SIZE_POS_]=this._vbSize,K.syncBufferToRenderThread(this.vbBuffer),K.syncBufferToRenderThread(this._paramData)}),DrawTexturesCmdNative.create=function(t,e){var a=N.getItemByClass("DrawTexturesCmd",DrawTexturesCmdNative);a._graphicsCmdEncoder=this._commandEncoder,DrawTexturesCmdNative._DRAW_TEXTURES_CMD_ENCODER_||(DrawTexturesCmdNative._DRAW_TEXTURES_CMD_ENCODER_=K.instance.createCommandEncoder(124,32,!0),DrawTexturesCmdNative._DRAW_TEXTURES_CMD_ENCODER_.blendFuncByGlobalValue(tt.GLOBALVALUE_BLENDFUNC_SRC,tt.GLOBALVALUE_BLENDFUNC_DEST),DrawTexturesCmdNative._DRAW_TEXTURES_CMD_ENCODER_.useProgramEx(tt.PROGRAMEX_DRAWTEXTURE),DrawTexturesCmdNative._DRAW_TEXTURES_CMD_ENCODER_.useVDO(tt.VDO_MESHQUADTEXTURE),DrawTexturesCmdNative._DRAW_TEXTURES_CMD_ENCODER_.uniformEx(tt.GLOBALVALUE_VIEWS,0),DrawTexturesCmdNative._DRAW_TEXTURES_CMD_ENCODER_.uniformEx(tt.GLOBALVALUE_CLIP_MAT_DIR,1),DrawTexturesCmdNative._DRAW_TEXTURES_CMD_ENCODER_.uniformEx(tt.GLOBALVALUE_CLIP_MAT_POS,2),DrawTexturesCmdNative._DRAW_TEXTURES_CMD_ENCODER_.uniformTextureByParamData(DrawTexturesCmdNative._PARAM_UNIFORMLOCATION_POS_,4*DrawTexturesCmdNative._PARAM_TEXLOCATION_POS_,4*DrawTexturesCmdNative._PARAM_TEXTURE_POS_),DrawTexturesCmdNative._DRAW_TEXTURES_CMD_ENCODER_.setRectMeshExByParamData(4*DrawTexturesCmdNative._PARAM_RECT_NUM_POS_,4*DrawTexturesCmdNative._PARAM_VB_POS_,4*DrawTexturesCmdNative._PARAM_VB_SIZE_POS_,4*DrawTexturesCmdNative._PARAM_VB_OFFSET_POS_),DrawTexturesCmdNative._DRAW_TEXTURES_CMD_ENCODER_.modifyMesh(tt.GLOBALVALUE_MATRIX32,0,7),DrawTexturesCmdNative._DRAW_TEXTURES_CMD_ENCODER_.modifyMesh(tt.GLOBALVALUE_DRAWTEXTURE_COLOR,1,15),K.syncBufferToRenderThread(DrawTexturesCmdNative._DRAW_TEXTURES_CMD_ENCODER_)),a._paramData||(a._paramData=new ParamData(28,!0)),a._texture=t,a._pos=e;var i=t.bitmap.width,r=t.bitmap.height,_=t.uv,n=e.length/2;(!a.vbBuffer||a.vbBuffer.getByteLength()<24*n*4)&&(a.vbBuffer=new ParamData(24*n*4,!0)),a._vbSize=24*n*4,a._rectNum=n;for(var s=a.vbBuffer._float32Data,o=a.vbBuffer._int32Data,h=0,l=0;l<n;l++){var u=e[2*l],c=e[2*l+1];s[h++]=u,s[h++]=c,s[h++]=_[0],s[h++]=_[1],o[h++]=4294967295,o[h++]=4294967295,s[h++]=u+i,s[h++]=c,s[h++]=_[2],s[h++]=_[3],o[h++]=4294967295,o[h++]=4294967295,s[h++]=u+i,s[h++]=c+r,s[h++]=_[4],s[h++]=_[5],o[h++]=4294967295,o[h++]=4294967295,s[h++]=u,s[h++]=c+r,s[h++]=_[6],s[h++]=_[7],o[h++]=4294967295,o[h++]=4294967295}a._paramData._float32Data;var d=a._paramData._int32Data;return d[DrawTexturesCmdNative._PARAM_UNIFORMLOCATION_POS_]=3,d[DrawTexturesCmdNative._PARAM_TEXLOCATION_POS_]=33984,d[DrawTexturesCmdNative._PARAM_TEXTURE_POS_]=t.bitmap._glTexture.id,d[DrawTexturesCmdNative._PARAM_RECT_NUM_POS_]=a._rectNum,d[DrawTexturesCmdNative._PARAM_VB_POS_]=a.vbBuffer.getPtrID(),d[DrawTexturesCmdNative._PARAM_VB_SIZE_POS_]=a._vbSize,d[DrawTexturesCmdNative._PARAM_VB_OFFSET_POS_]=0,K.syncBufferToRenderThread(a.vbBuffer),K.syncBufferToRenderThread(a._paramData),a._graphicsCmdEncoder.useCommandEncoder(DrawTexturesCmdNative._DRAW_TEXTURES_CMD_ENCODER_.getPtrID(),a._paramData.getPtrID(),-1),K.syncBufferToRenderThread(a._graphicsCmdEncoder),a},DrawTexturesCmdNative.ID="DrawTextures",DrawTexturesCmdNative._DRAW_TEXTURES_CMD_ENCODER_=null,DrawTexturesCmdNative._PARAM_UNIFORMLOCATION_POS_=0,DrawTexturesCmdNative._PARAM_TEXLOCATION_POS_=1,DrawTexturesCmdNative._PARAM_TEXTURE_POS_=2,DrawTexturesCmdNative._PARAM_RECT_NUM_POS_=3,DrawTexturesCmdNative._PARAM_VB_POS_=4,DrawTexturesCmdNative._PARAM_VB_SIZE_POS_=5,DrawTexturesCmdNative._PARAM_VB_OFFSET_POS_=6}(),function(){function DrawTrianglesCmdNative(){this._graphicsCmdEncoder=null,this._paramData=null,this._texture=null,this._x=NaN,this._y=NaN,this._vertices=null,this._uvs=null,this._indices=null,this._matrix=null,this._alpha=NaN,this._color=null,this._blendMode=null,this.vbBuffer=null,this._vbSize=NaN,this.ibBuffer=null,this._ibSize=NaN,this._verticesNum=NaN,this._ibNum=NaN,this._blend_src=0,this._blend_dest=0}r(DrawTrianglesCmdNative,"laya.layagl.cmdNative.DrawTrianglesCmdNative");var t=DrawTrianglesCmdNative.prototype;t.recover=function(){this._texture=null,this._vertices=null,this._uvs=null,this._indices=null,this._matrix=null,N.recover("DrawTrianglesCmd",this)},t._setBlendMode=function(t){switch(t){case"normal":this._blend_src=1,this._blend_dest=771;break;case"add":this._blend_src=1,this._blend_dest=772;break;case"multiply":this._blend_src=774,this._blend_dest=771;break;case"screen":case"light":this._blend_src=1,this._blend_dest=1;break;case"overlay":this._blend_src=1,this._blend_dest=769;break;case"destination-out":this._blend_src=0,this._blend_dest=0;break;case"mask":this._blend_src=0,this._blend_dest=770;break;default:alert("_setBlendMode Unknown type")}},t._mixRGBandAlpha=function(t,e){var a=(4278190080&t)>>>24;return 0!=a?a*=e:a=255*e,16777215&t|a<<24},_(0,t,"vertices",function(){return this._vertices},function(t){this._vertices=t;for(var e=this.vbBuffer._float32Data,a=0,i=0;i<this._verticesNum;i++)e[a++]=this._x+t[2*i],e[a++]=this._y+t[2*i+1],a++,a++,a++,a++;K.syncBufferToRenderThread(this.vbBuffer)}),_(0,t,"cmdID",function(){return"DrawTriangles"}),_(0,t,"matrix",function(){return this._matrix},function(t){this._matrix=t;var e=this._paramData._float32Data;e[DrawTrianglesCmdNative._PARAM_MATRIX_POS_]=t.a,e[DrawTrianglesCmdNative._PARAM_MATRIX_POS_+1]=t.b,e[DrawTrianglesCmdNative._PARAM_MATRIX_POS_+2]=t.c,e[DrawTrianglesCmdNative._PARAM_MATRIX_POS_+3]=t.d,e[DrawTrianglesCmdNative._PARAM_MATRIX_POS_+4]=t.tx,e[DrawTrianglesCmdNative._PARAM_MATRIX_POS_+5]=t.ty,K.syncBufferToRenderThread(this._paramData)}),_(0,t,"texture",function(){return this._texture},function(t){t&&t.url&&(this._texture=t,this._paramData._int32Data[DrawTrianglesCmdNative._PARAM_TEXTURE_POS_]=this._texture.bitmap._glTexture.id,K.syncBufferToRenderThread(this._paramData))}),_(0,t,"y",function(){return this._y},function(t){this._y=t;for(var e=this.vbBuffer._float32Data,a=0,i=0;i<this._verticesNum;i++)a++,e[a++]=t+this.vertices[2*i+1],a++,a++,a++,a++;K.syncBufferToRenderThread(this.vbBuffer)}),_(0,t,"x",function(){return this._x},function(t){this._x=t;for(var e=this.vbBuffer._float32Data,a=0,i=0;i<this._verticesNum;i++)e[a++]=t+this.vertices[2*i],a++,a++,a++,a++,a++;K.syncBufferToRenderThread(this.vbBuffer)}),_(0,t,"alpha",function(){return this._alpha},function(t){this._alpha=t}),_(0,t,"uvs",function(){return this._uvs},function(t){this._uvs=t;for(var e=this.vbBuffer._float32Data,a=0,i=0;i<this._verticesNum;i++)a++,a++,e[a++]=t[2*i],e[a++]=t[2*i+1],a++,a++;K.syncBufferToRenderThread(this.vbBuffer)}),_(0,t,"indices",function(){return this._indices},function(t){this._indices=t;for(var e=this.ibBuffer._int16Data,a=0,i=0;i<this._ibNum;i++)e[a++]=t[i];K.syncBufferToRenderThread(this.ibBuffer)}),_(0,t,"color",function(){return this._color},function(t){this._color=t}),_(0,t,"blendMode",function(){return this._blendMode},function(t){this._blendMode=t}),DrawTrianglesCmdNative.create=function(t,e,a,i,r,_,n,s,o,u){var c=N.getItemByClass("DrawTrianglesCmd",DrawTrianglesCmdNative);c._graphicsCmdEncoder=this._commandEncoder,DrawTrianglesCmdNative._DRAW_TRIANGLES_CMD_ENCODER_||(DrawTrianglesCmdNative._DRAW_TRIANGLES_CMD_ENCODER_=K.instance.createCommandEncoder(152,32,!0),DrawTrianglesCmdNative._DRAW_TRIANGLES_CMD_ENCODER_.save(),DrawTrianglesCmdNative._DRAW_TRIANGLES_CMD_ENCODER_.blendFuncByGlobalValue(tt.GLOBALVALUE_BLENDFUNC_SRC,tt.GLOBALVALUE_BLENDFUNC_DEST),DrawTrianglesCmdNative._DRAW_TRIANGLES_CMD_ENCODER_.blendFuncByParamData(4*DrawTrianglesCmdNative._PARAM_BLEND_SRC_POS_,4*DrawTrianglesCmdNative._PARAM_BLEND_DEST_POS_),DrawTrianglesCmdNative._DRAW_TRIANGLES_CMD_ENCODER_.useProgramEx(tt.PROGRAMEX_DRAWTEXTURE),DrawTrianglesCmdNative._DRAW_TRIANGLES_CMD_ENCODER_.useVDO(tt.VDO_MESHQUADTEXTURE),DrawTrianglesCmdNative._DRAW_TRIANGLES_CMD_ENCODER_.setGlobalValueByParamData(tt.GLOBALVALUE_MATRIX32,7,4*DrawTrianglesCmdNative._PARAM_MATRIX_POS_),DrawTrianglesCmdNative._DRAW_TRIANGLES_CMD_ENCODER_.uniformEx(tt.GLOBALVALUE_VIEWS,0),DrawTrianglesCmdNative._DRAW_TRIANGLES_CMD_ENCODER_.uniformEx(tt.GLOBALVALUE_CLIP_MAT_DIR,1),DrawTrianglesCmdNative._DRAW_TRIANGLES_CMD_ENCODER_.uniformEx(tt.GLOBALVALUE_CLIP_MAT_POS,2),DrawTrianglesCmdNative._DRAW_TRIANGLES_CMD_ENCODER_.uniformTextureByParamData(4*DrawTrianglesCmdNative._PARAM_UNIFORMLOCATION_POS_,4*DrawTrianglesCmdNative._PARAM_TEXLOCATION_POS_,4*DrawTrianglesCmdNative._PARAM_TEXTURE_POS_),DrawTrianglesCmdNative._DRAW_TRIANGLES_CMD_ENCODER_.setMeshExByParamData(4*DrawTrianglesCmdNative._PARAM_VB_POS_,4*DrawTrianglesCmdNative._PARAM_VB_OFFSET_POS_,4*DrawTrianglesCmdNative._PARAM_VB_SIZE_POS_,4*DrawTrianglesCmdNative._PARAM_IB_POS_,4*DrawTrianglesCmdNative._PARAM_IB_OFFSET_POS_,4*DrawTrianglesCmdNative._PARAM_IB_SIZE_POS_,4*DrawTrianglesCmdNative._PARAM_INDEX_ELEMENT_OFFSET_POS_),DrawTrianglesCmdNative._DRAW_TRIANGLES_CMD_ENCODER_.modifyMesh(tt.GLOBALVALUE_MATRIX32,0,7),DrawTrianglesCmdNative._DRAW_TRIANGLES_CMD_ENCODER_.modifyMesh(tt.GLOBALVALUE_DRAWTEXTURE_COLOR,1,15),DrawTrianglesCmdNative._DRAW_TRIANGLES_CMD_ENCODER_.restore(),K.syncBufferToRenderThread(DrawTrianglesCmdNative._DRAW_TRIANGLES_CMD_ENCODER_)),DrawTrianglesCmdNative._DRAW_TRIANGLES_COLORFILTER_CMD_ENCODER_||(DrawTrianglesCmdNative._DRAW_TRIANGLES_COLORFILTER_CMD_ENCODER_=K.instance.createCommandEncoder(152,32,!0),DrawTrianglesCmdNative._DRAW_TRIANGLES_COLORFILTER_CMD_ENCODER_.save(),DrawTrianglesCmdNative._DRAW_TRIANGLES_COLORFILTER_CMD_ENCODER_.blendFuncByGlobalValue(tt.GLOBALVALUE_BLENDFUNC_SRC,tt.GLOBALVALUE_BLENDFUNC_DEST),DrawTrianglesCmdNative._DRAW_TRIANGLES_COLORFILTER_CMD_ENCODER_.blendFuncByParamData(4*DrawTrianglesCmdNative._PARAM_BLEND_SRC_POS_,4*DrawTrianglesCmdNative._PARAM_BLEND_DEST_POS_),DrawTrianglesCmdNative._DRAW_TRIANGLES_COLORFILTER_CMD_ENCODER_.addShaderMacro(tt.SHADER_MACRO_COLOR_FILTER),DrawTrianglesCmdNative._DRAW_TRIANGLES_COLORFILTER_CMD_ENCODER_.setGlobalValueByParamData(tt.GLOBALVALUE_COLORFILTER_COLOR,8,4*DrawTrianglesCmdNative._PARAM_FILTER_COLOR_POS_),DrawTrianglesCmdNative._DRAW_TRIANGLES_COLORFILTER_CMD_ENCODER_.setGlobalValueByParamData(tt.GLOBALVALUE_COLORFILTER_ALPHA,8,4*DrawTrianglesCmdNative._PARAM_FILTER_ALPHA_POS_),DrawTrianglesCmdNative._DRAW_TRIANGLES_COLORFILTER_CMD_ENCODER_.useProgramEx(tt.PROGRAMEX_DRAWTEXTURE),DrawTrianglesCmdNative._DRAW_TRIANGLES_COLORFILTER_CMD_ENCODER_.useVDO(tt.VDO_MESHQUADTEXTURE),DrawTrianglesCmdNative._DRAW_TRIANGLES_COLORFILTER_CMD_ENCODER_.setGlobalValueByParamData(tt.GLOBALVALUE_MATRIX32,7,4*DrawTrianglesCmdNative._PARAM_MATRIX_POS_),DrawTrianglesCmdNative._DRAW_TRIANGLES_COLORFILTER_CMD_ENCODER_.uniformEx(tt.GLOBALVALUE_VIEWS,0),DrawTrianglesCmdNative._DRAW_TRIANGLES_COLORFILTER_CMD_ENCODER_.uniformEx(tt.GLOBALVALUE_CLIP_MAT_DIR,1),DrawTrianglesCmdNative._DRAW_TRIANGLES_COLORFILTER_CMD_ENCODER_.uniformEx(tt.GLOBALVALUE_CLIP_MAT_POS,2),DrawTrianglesCmdNative._DRAW_TRIANGLES_COLORFILTER_CMD_ENCODER_.uniformTextureByParamData(4*DrawTrianglesCmdNative._PARAM_UNIFORMLOCATION_POS_,4*DrawTrianglesCmdNative._PARAM_TEXLOCATION_POS_,4*DrawTrianglesCmdNative._PARAM_TEXTURE_POS_),DrawTrianglesCmdNative._DRAW_TRIANGLES_COLORFILTER_CMD_ENCODER_.setMeshExByParamData(4*DrawTrianglesCmdNative._PARAM_VB_POS_,4*DrawTrianglesCmdNative._PARAM_VB_OFFSET_POS_,4*DrawTrianglesCmdNative._PARAM_VB_SIZE_POS_,4*DrawTrianglesCmdNative._PARAM_IB_POS_,4*DrawTrianglesCmdNative._PARAM_IB_OFFSET_POS_,4*DrawTrianglesCmdNative._PARAM_IB_SIZE_POS_,4*DrawTrianglesCmdNative._PARAM_INDEX_ELEMENT_OFFSET_POS_),DrawTrianglesCmdNative._DRAW_TRIANGLES_COLORFILTER_CMD_ENCODER_.modifyMesh(tt.GLOBALVALUE_MATRIX32,0,7),DrawTrianglesCmdNative._DRAW_TRIANGLES_COLORFILTER_CMD_ENCODER_.modifyMesh(tt.GLOBALVALUE_DRAWTEXTURE_COLOR,1,15),DrawTrianglesCmdNative._DRAW_TRIANGLES_COLORFILTER_CMD_ENCODER_.restore(),K.syncBufferToRenderThread(DrawTrianglesCmdNative._DRAW_TRIANGLES_COLORFILTER_CMD_ENCODER_)),c._paramData||(c._paramData=new ParamData(152,!0)),c._texture=t,c._x=e,c._y=a,c._vertices=i,c._uvs=r,c._indices=_,c._matrix=n||new R,c._alpha=s,c._color=o,c._blendMode=u;var d=new h,f=l.create(o);d.color(f.arrColor[0],f.arrColor[1],f.arrColor[2],f.arrColor[3]),c._verticesNum=c._vertices.length/2;var D=c._verticesNum;(!c.vbBuffer||c.vbBuffer.getByteLength()<24*D*3)&&(c.vbBuffer=new ParamData(24*D*3,!0)),c._vbSize=24*D*3;var m=c.vbBuffer._float32Data,C=c.vbBuffer._int32Data,E=4294967295;s&&(E=c._mixRGBandAlpha(E,s));for(var v=0,A=0;A<c._verticesNum;A++)m[v++]=e/c._matrix.a+i[2*A],m[v++]=a/c._matrix.d+i[2*A+1],m[v++]=r[2*A],m[v++]=r[2*A+1],C[v++]=E,C[v++]=4294967295;c._ibNum=_.length;var T=c._ibNum;(!c.ibBuffer||c.ibBuffer.getByteLength()<2*T)&&(c.ibBuffer=new ParamData(2*T,!0,!0)),c._ibSize=2*T;for(var P=c.ibBuffer._int16Data,L=0,p=0;p<c._ibNum;p++)P[L++]=_[p];var b=c._paramData._float32Data,S=c._paramData._int32Data;if(S[DrawTrianglesCmdNative._PARAM_UNIFORMLOCATION_POS_]=3,S[DrawTrianglesCmdNative._PARAM_TEXLOCATION_POS_]=33984,S[DrawTrianglesCmdNative._PARAM_TEXTURE_POS_]=t.bitmap._glTexture.id,S[DrawTrianglesCmdNative._PARAM_VB_POS_]=c.vbBuffer.getPtrID(),S[DrawTrianglesCmdNative._PARAM_VB_SIZE_POS_]=c._vbSize,S[DrawTrianglesCmdNative._PARAM_IB_POS_]=c.ibBuffer.getPtrID(),S[DrawTrianglesCmdNative._PARAM_IB_SIZE_POS_]=c._ibSize,S[DrawTrianglesCmdNative._PARAM_VB_OFFSET_POS_]=0,S[DrawTrianglesCmdNative._PARAM_IB_OFFSET_POS_]=0,S[DrawTrianglesCmdNative._PARAM_INDEX_ELEMENT_OFFSET_POS_]=0,b[DrawTrianglesCmdNative._PARAM_MATRIX_POS_]=c._matrix.a,b[DrawTrianglesCmdNative._PARAM_MATRIX_POS_+1]=c._matrix.b,b[DrawTrianglesCmdNative._PARAM_MATRIX_POS_+2]=c._matrix.c,b[DrawTrianglesCmdNative._PARAM_MATRIX_POS_+3]=c._matrix.d,b[DrawTrianglesCmdNative._PARAM_MATRIX_POS_+4]=c._matrix.tx,b[DrawTrianglesCmdNative._PARAM_MATRIX_POS_+5]=c._matrix.ty,u?(c._setBlendMode(u),S[DrawTrianglesCmdNative._PARAM_BLEND_SRC_POS_]=c._blend_src,S[DrawTrianglesCmdNative._PARAM_BLEND_DEST_POS_]=c._blend_dest):(S[DrawTrianglesCmdNative._PARAM_BLEND_SRC_POS_]=-1,S[DrawTrianglesCmdNative._PARAM_BLEND_DEST_POS_]=-1),o){v=DrawTrianglesCmdNative._PARAM_FILTER_COLOR_POS_;var x=d._mat;b[v++]=x[0],b[v++]=x[1],b[v++]=x[2],b[v++]=x[3],b[v++]=x[4],b[v++]=x[5],b[v++]=x[6],b[v++]=x[7],b[v++]=x[8],b[v++]=x[9],b[v++]=x[10],b[v++]=x[11],b[v++]=x[12],b[v++]=x[13],b[v++]=x[14],b[v++]=x[15],v=DrawTrianglesCmdNative._PARAM_FILTER_ALPHA_POS_;var M=d._alpha;b[v++]=255*M[0],b[v++]=255*M[1],b[v++]=255*M[2],b[v++]=255*M[3]}return K.syncBufferToRenderThread(c.vbBuffer),K.syncBufferToRenderThread(c.ibBuffer),K.syncBufferToRenderThread(c._paramData),o?c._graphicsCmdEncoder.useCommandEncoder(DrawTrianglesCmdNative._DRAW_TRIANGLES_COLORFILTER_CMD_ENCODER_.getPtrID(),c._paramData.getPtrID(),-1):c._graphicsCmdEncoder.useCommandEncoder(DrawTrianglesCmdNative._DRAW_TRIANGLES_CMD_ENCODER_.getPtrID(),c._paramData.getPtrID(),-1),K.syncBufferToRenderThread(c._graphicsCmdEncoder),c},DrawTrianglesCmdNative.ID="DrawTriangles",DrawTrianglesCmdNative._DRAW_TRIANGLES_CMD_ENCODER_=null,DrawTrianglesCmdNative._DRAW_TRIANGLES_COLORFILTER_CMD_ENCODER_=null,DrawTrianglesCmdNative._PARAM_UNIFORMLOCATION_POS_=0,DrawTrianglesCmdNative._PARAM_TEXLOCATION_POS_=1,DrawTrianglesCmdNative._PARAM_TEXTURE_POS_=2,DrawTrianglesCmdNative._PARAM_VB_POS_=3,DrawTrianglesCmdNative._PARAM_VB_SIZE_POS_=4,DrawTrianglesCmdNative._PARAM_IB_POS_=5,DrawTrianglesCmdNative._PARAM_IB_SIZE_POS_=6,DrawTrianglesCmdNative._PARAM_VB_OFFSET_POS_=7,DrawTrianglesCmdNative._PARAM_IB_OFFSET_POS_=8,DrawTrianglesCmdNative._PARAM_INDEX_ELEMENT_OFFSET_POS_=9,DrawTrianglesCmdNative._PARAM_BLEND_SRC_POS_=10,DrawTrianglesCmdNative._PARAM_BLEND_DEST_POS_=11,DrawTrianglesCmdNative._PARAM_MATRIX_POS_=12,DrawTrianglesCmdNative._PARAM_FILTER_COLOR_POS_=18,DrawTrianglesCmdNative._PARAM_FILTER_ALPHA_POS_=34}(),function(){function FillBorderTextCmdNative(){this._graphicsCmdEncoder=null,this._index=0,this._text=null,this._x=NaN,this._y=NaN,this._font=null,this._color=null,this._strokeColor=null,this._strokeWidth=0,this._textAlign=null,this._draw_texture_cmd_encoder_=K.instance.createCommandEncoder(64,32,!0)}r(FillBorderTextCmdNative,"laya.layagl.cmdNative.FillBorderTextCmdNative");var t=FillBorderTextCmdNative.prototype;t.createFillBorderText=function(t,e,a,i,r,_,n,s,o){l.create(_).numColor;var h={};h._curMat=new R,h._italicDeg=0,h._drawTextureUseColor=4294967295,h.fillStyle=_,h._fillColor=4294967295,h.setFillColor=function(t){h._fillColor=t},h.getFillColor=function(){return h._fillColor},h.mixRGBandAlpha=function(t){return t},h._drawTextureM=function(e,a,i,r,_,n,s,o){t.blendFuncByGlobalValue(tt.GLOBALVALUE_BLENDFUNC_SRC,tt.GLOBALVALUE_BLENDFUNC_DEST),t.useProgramEx(tt.PROGRAMEX_DRAWTEXTURE),t.useVDO(tt.VDO_MESHQUADTEXTURE),t.uniformEx(tt.GLOBALVALUE_VIEWS,0),t.uniformEx(tt.GLOBALVALUE_CLIP_MAT_DIR,1),t.uniformEx(tt.GLOBALVALUE_CLIP_MAT_POS,2),t.uniformTexture(3,33984,e.bitmap._glTexture);var h=new Float32Array([a,i,o[0],o[1],0,0,a+r,i,o[2],o[3],0,0,a+r,i+_,o[4],o[5],0,0,a,i+_,o[6],o[7],0,0]),l=new Int32Array(h.buffer);l[4]=l[10]=l[16]=l[22]=4294967295,l[5]=l[11]=l[17]=l[23]=4294967295,t.setRectMesh(1,h,h.length),t.modifyMesh(tt.GLOBALVALUE_MATRIX32,0,7),t.modifyMesh(tt.GLOBALVALUE_DRAWTEXTURE_COLOR,1,15),K.syncBufferToRenderThread(t)},FillBorderTextCmdNative.cbook.filltext_native(h,e,null,a,i,r,_,n,s,o)},t.recover=function(){this._graphicsCmdEncoder=null,N.recover("FillBorderTextCmd",this)},_(0,t,"text",function(){return this._text},function(t){var e=this._draw_texture_cmd_encoder_;e.clearEncoding(),this._text=t,this.createFillBorderText(e,this._text,this._x,this._y,this._font,this._color,this._strokeColor,this._strokeWidth,this._textAlign),K.syncBufferToRenderThread(e)}),_(0,t,"cmdID",function(){return"FillBorderText"}),_(0,t,"font",function(){return this._font},function(t){var e=this._draw_texture_cmd_encoder_;e.clearEncoding(),this._font=t,this.createFillBorderText(e,this._text,this._x,this._y,this._font,this._color,this._strokeColor,this._strokeWidth,this._textAlign),K.syncBufferToRenderThread(e)}),_(0,t,"color",function(){return this._color},function(t){var e=this._draw_texture_cmd_encoder_;e.clearEncoding(),this._color=t,this.createFillBorderText(e,this._text,this._x,this._y,this._font,this._color,this._strokeColor,this._strokeWidth,this._textAlign),K.syncBufferToRenderThread(e)}),_(0,t,"textAlign",function(){return this._textAlign},function(t){var e=this._draw_texture_cmd_encoder_;e.clearEncoding(),this._textAlign=t,this.createFillBorderText(e,this._text,this._x,this._y,this._font,this._color,this._strokeColor,this._strokeWidth,this._textAlign),K.syncBufferToRenderThread(e)}),_(0,t,"x",function(){return this._x},function(t){var e=this._draw_texture_cmd_encoder_;e.clearEncoding(),this._x=t,this.createFillBorderText(e,this._text,this._x,this._y,this._font,this._color,this._strokeColor,this._strokeWidth,this._textAlign),K.syncBufferToRenderThread(e)}),_(0,t,"y",function(){return this._y},function(t){var e=this._draw_texture_cmd_encoder_;e.clearEncoding(),this._y=t,this.createFillBorderText(e,this._text,this._x,this._y,this._font,this._color,this._strokeColor,this._strokeWidth,this._textAlign),K.syncBufferToRenderThread(e)}),FillBorderTextCmdNative.create=function(t,e,a,i,r,_,n,s){FillBorderTextCmdNative.cbook||new Error("Error:charbook not create!");var o=N.getItemByClass("FillBorderTextCmd",FillBorderTextCmdNative),h=o._graphicsCmdEncoder=this._commandEncoder;return o._text=t,o._x=e,o._y=a,o._font=i,o._color=r,o._strokeColor=_,o._strokeWidth=n,o._textAlign=s,o._draw_texture_cmd_encoder_.clearEncoding(),o.createFillBorderText(o._draw_texture_cmd_encoder_,t,e,a,i,r,_,n,s),K.syncBufferToRenderThread(o._draw_texture_cmd_encoder_),h.useCommandEncoder(o._draw_texture_cmd_encoder_.getPtrID(),-1,-1),K.syncBufferToRenderThread(h),o},FillBorderTextCmdNative.ID="FillBorderText",i(FillBorderTextCmdNative,["cbook",function(){return this.cbook=ht.charbookInst}])}(),function(){function FillBorderWordsCmdNative(){this._draw_texture_cmd_encoder_=K.instance.createCommandEncoder(64,32,!0)}r(FillBorderWordsCmdNative,"laya.layagl.cmdNative.FillBorderWordsCmdNative");var t=FillBorderWordsCmdNative.prototype;t.createFillBorderText=function(t,e,a,i,r,_,n,s){l.create(_).numColor;var o={};o._curMat=new R,o._italicDeg=0,o._drawTextureUseColor=4294967295,o.fillStyle=_,o._fillColor=4294967295,o.setFillColor=function(t){o._fillColor=t},o.getFillColor=function(){return o._fillColor},o.mixRGBandAlpha=function(t){return t},o._drawTextureM=function(e,a,i,r,_,n,s,o){t.blendFuncByGlobalValue(tt.GLOBALVALUE_BLENDFUNC_SRC,tt.GLOBALVALUE_BLENDFUNC_DEST),t.useProgramEx(tt.PROGRAMEX_DRAWTEXTURE),t.useVDO(tt.VDO_MESHQUADTEXTURE),t.uniformEx(tt.GLOBALVALUE_VIEWS,0),t.uniformEx(tt.GLOBALVALUE_CLIP_MAT_DIR,1),t.uniformEx(tt.GLOBALVALUE_CLIP_MAT_POS,2),t.uniformTexture(3,33984,e.bitmap._glTexture);var h=new Float32Array([a,i,o[0],o[1],0,0,a+r,i,o[2],o[3],0,0,a+r,i+_,o[4],o[5],0,0,a,i+_,o[6],o[7],0,0]),l=new Int32Array(h.buffer);l[4]=l[10]=l[16]=l[22]=4294967295,l[5]=l[11]=l[17]=l[23]=4294967295,t.setRectMesh(1,h,h.length),t.modifyMesh(tt.GLOBALVALUE_MATRIX32,0,7),t.modifyMesh(tt.GLOBALVALUE_DRAWTEXTURE_COLOR,1,15),K.syncBufferToRenderThread(t)},FillBorderWordsCmdNative.cbook.filltext_native(o,null,e,a,i,r,_,n,s,null,0)},t.recover=function(){this._graphicsCmdEncoder=null,this.words=null,N.recover("FillBorderWordsCmd",this)},_(0,t,"cmdID",function(){return"FillBorderWords"}),FillBorderWordsCmdNative.create=function(t,e,a,i,r,_,n){FillBorderWordsCmdNative.cbook||new Error("Error:charbook not create!");var s=N.getItemByClass("FillBorderWordsCmd",FillBorderWordsCmdNative),o=s._graphicsCmdEncoder=this._commandEncoder;return s.words=t,s.x=e,s.y=a,s.font=i,s.color=r,s.strokeColor=_,s.strokeWidth=n,s._draw_texture_cmd_encoder_.clearEncoding(),s.createFillBorderText(s._draw_texture_cmd_encoder_,t,e,a,i,r,_,n),K.syncBufferToRenderThread(s._draw_texture_cmd_encoder_),o.useCommandEncoder(s._draw_texture_cmd_encoder_.getPtrID(),-1,-1),K.syncBufferToRenderThread(o),s},FillBorderWordsCmdNative.ID="FillBorderWords",i(FillBorderWordsCmdNative,["cbook",function(){return this.cbook=ht.charbookInst}])}(),function(){function FillTextCmdNative(){this._graphicsCmdEncoder=null,this._index=0,this._text=null,this._x=NaN,this._y=NaN,this._font=null,this._color=null,this._textAlign=null,this._draw_texture_cmd_encoder_=K.instance.createCommandEncoder(64,32,!0)}r(FillTextCmdNative,"laya.layagl.cmdNative.FillTextCmdNative");var t=FillTextCmdNative.prototype;t.createFillText=function(t,e,a,i,r,_,n){l.create(_).numColor;var s={};s._curMat=new R,s._italicDeg=0,s._drawTextureUseColor=4294967295,s.fillStyle=_,s._fillColor=4294967295,s.setFillColor=function(t){s._fillColor=t},s.getFillColor=function(){return s._fillColor},s.mixRGBandAlpha=function(t){return t},s._drawTextureM=function(e,a,i,r,_,n,s,o){t.blendFuncByGlobalValue(tt.GLOBALVALUE_BLENDFUNC_SRC,tt.GLOBALVALUE_BLENDFUNC_DEST),t.useProgramEx(tt.PROGRAMEX_DRAWTEXTURE),t.useVDO(tt.VDO_MESHQUADTEXTURE),t.uniformEx(tt.GLOBALVALUE_VIEWS,0),t.uniformEx(tt.GLOBALVALUE_CLIP_MAT_DIR,1),t.uniformEx(tt.GLOBALVALUE_CLIP_MAT_POS,2),t.uniformTexture(3,33984,e.bitmap._glTexture);var h=new Float32Array([a,i,o[0],o[1],0,0,a+r,i,o[2],o[3],0,0,a+r,i+_,o[4],o[5],0,0,a,i+_,o[6],o[7],0,0]),l=new Int32Array(h.buffer);l[4]=l[10]=l[16]=l[22]=4294967295,l[5]=l[11]=l[17]=l[23]=4294967295,t.setRectMesh(1,h,h.length),t.modifyMesh(tt.GLOBALVALUE_MATRIX32,0,7),t.modifyMesh(tt.GLOBALVALUE_DRAWTEXTURE_COLOR,1,15),K.syncBufferToRenderThread(t)},FillTextCmdNative.cbook.filltext_native(s,e,null,a,i,r,_,null,0,n)},t.recover=function(){this._graphicsCmdEncoder=null,N.recover("FillTextCmd",this)},_(0,t,"text",function(){return this._text},function(t){var e=this._draw_texture_cmd_encoder_;e.clearEncoding(),this._text=t,this.createFillText(e,this._text,this._x,this._y,this._font,this._color,this._textAlign),K.syncBufferToRenderThread(e)}),_(0,t,"cmdID",function(){return"FillText"}),_(0,t,"font",function(){return this._font},function(t){var e=this._draw_texture_cmd_encoder_;e.clearEncoding(),this._font=t,this.createFillText(e,this._text,this._x,this._y,this._font,this._color,this._textAlign),K.syncBufferToRenderThread(e)}),_(0,t,"color",function(){return this._color},function(t){var e=this._draw_texture_cmd_encoder_;e.clearEncoding(),this._color=t,this.createFillText(e,this._text,this._x,this._y,this._font,this._color,this._textAlign),K.syncBufferToRenderThread(e)}),_(0,t,"textAlign",function(){return this._textAlign},function(t){var e=this._draw_texture_cmd_encoder_;e.clearEncoding(),this._textAlign=t,this.createFillText(e,this._text,this._x,this._y,this._font,this._color,this._textAlign),K.syncBufferToRenderThread(e)}),_(0,t,"x",function(){return this._x},function(t){var e=this._draw_texture_cmd_encoder_;e.clearEncoding(),this._x=t,this.createFillText(e,this._text,this._x,this._y,this._font,this._color,this._textAlign),K.syncBufferToRenderThread(e)}),_(0,t,"y",function(){return this._y},function(t){var e=this._draw_texture_cmd_encoder_;e.clearEncoding(),this._y=t,this.createFillText(e,this._text,this._x,this._y,this._font,this._color,this._textAlign),K.syncBufferToRenderThread(e)}),FillTextCmdNative.create=function(t,e,a,i,r,_){FillTextCmdNative.cbook||new Error("Error:charbook not create!");var n=N.getItemByClass("FillTextCmd",FillTextCmdNative),s=n._graphicsCmdEncoder=this._commandEncoder;return n._text=t,n._x=e,n._y=a,n._font=i,n._color=r,n._textAlign=_,n._draw_texture_cmd_encoder_.clearEncoding(),n.createFillText(n._draw_texture_cmd_encoder_,t,e,a,i,r,_),K.syncBufferToRenderThread(n._draw_texture_cmd_encoder_),s.useCommandEncoder(n._draw_texture_cmd_encoder_.getPtrID(),-1,-1),K.syncBufferToRenderThread(s),n},FillTextCmdNative.ID="FillText",i(FillTextCmdNative,["cbook",function(){return this.cbook=ht.charbookInst}])}(),function(){function FillWordsCmdNative(){this._draw_texture_cmd_encoder_=K.instance.createCommandEncoder(64,32,!0)}r(FillWordsCmdNative,"laya.layagl.cmdNative.FillWordsCmdNative");var t=FillWordsCmdNative.prototype;t.createFillText=function(t,e,a,i,r,_){l.create(_).numColor;var n={};n._curMat=new R,n._italicDeg=0,n._drawTextureUseColor=4294967295,n.fillStyle=_,n._fillColor=4294967295,n.setFillColor=function(t){n._fillColor=t},n.getFillColor=function(){return n._fillColor},n.mixRGBandAlpha=function(t){return t},n._drawTextureM=function(e,a,i,r,_,n,s,o){t.blendFuncByGlobalValue(tt.GLOBALVALUE_BLENDFUNC_SRC,tt.GLOBALVALUE_BLENDFUNC_DEST),t.useProgramEx(tt.PROGRAMEX_DRAWTEXTURE),t.useVDO(tt.VDO_MESHQUADTEXTURE),t.uniformEx(tt.GLOBALVALUE_VIEWS,0),t.uniformEx(tt.GLOBALVALUE_CLIP_MAT_DIR,1),t.uniformEx(tt.GLOBALVALUE_CLIP_MAT_POS,2),t.uniformTexture(3,33984,e.bitmap._glTexture);var h=new Float32Array([a,i,o[0],o[1],0,0,a+r,i,o[2],o[3],0,0,a+r,i+_,o[4],o[5],0,0,a,i+_,o[6],o[7],0,0]),l=new Int32Array(h.buffer);l[4]=l[10]=l[16]=l[22]=4294967295,l[5]=l[11]=l[17]=l[23]=4294967295,t.setRectMesh(1,h,h.length),t.modifyMesh(tt.GLOBALVALUE_MATRIX32,0,7),t.modifyMesh(tt.GLOBALVALUE_DRAWTEXTURE_COLOR,1,15),K.syncBufferToRenderThread(t)},FillWordsCmdNative.cbook.filltext_native(n,null,e,a,i,r,_,null,0,null)},t.recover=function(){this._graphicsCmdEncoder=null,this.words=null,N.recover("FillWordsCmd",this)},_(0,t,"cmdID",function(){return"FillWords"}),FillWordsCmdNative.create=function(t,e,a,i,r){FillWordsCmdNative.cbook||new Error("Error:charbook not create!");var _=N.getItemByClass("FillWordsCmd",FillWordsCmdNative),n=_._graphicsCmdEncoder=this._commandEncoder;return _.words=t,_.x=e,_.y=a,_.font=i,_.color=r,_._draw_texture_cmd_encoder_.clearEncoding(),_.createFillText(_._draw_texture_cmd_encoder_,t,e,a,i,r),K.syncBufferToRenderThread(_._draw_texture_cmd_encoder_),n.useCommandEncoder(_._draw_texture_cmd_encoder_.getPtrID(),-1,-1),K.syncBufferToRenderThread(n),_},FillWordsCmdNative.ID="FillWords",i(FillWordsCmdNative,["cbook",function(){return this.cbook=ht.charbookInst}])}(),function(){function RestoreCmdNative(){this._graphicsCmdEncoder=null}r(RestoreCmdNative,"laya.layagl.cmdNative.RestoreCmdNative");var t=RestoreCmdNative.prototype;t.recover=function(){N.recover("RestoreCmd",this)},_(0,t,"cmdID",function(){return"Restore"}),RestoreCmdNative.create=function(){var t=N.getItemByClass("RestoreCmd",RestoreCmdNative),e=t._graphicsCmdEncoder=this._commandEncoder;return e.restore(),K.syncBufferToRenderThread(e),t},RestoreCmdNative.ID="Restore"}(),function(){function RotateCmdNative(){this._graphicsCmdEncoder=null,this._paramData=new ParamData(12,!0)}r(RotateCmdNative,"laya.layagl.cmdNative.RotateCmdNative");var t=RotateCmdNative.prototype;t.recover=function(){N.recover("RotateCmd",this)},_(0,t,"cmdID",function(){return"Rotate"}),_(0,t,"angle",function(){return this._paramData._float32Data[0]},function(t){this._paramData._float32Data[0]=t,K.syncBufferToRenderThread(this._paramData)}),_(0,t,"pivotX",function(){return this._paramData._float32Data[1]},function(t){this._paramData._float32Data[1]=t,K.syncBufferToRenderThread(this._paramData)}),_(0,t,"pivotY",function(){return this._paramData._float32Data[2]},function(t){this._paramData._float32Data[2]=t,K.syncBufferToRenderThread(this._paramData)}),RotateCmdNative.create=function(t,e,a){var i=N.getItemByClass("RotateCmd",RotateCmdNative),r=i._graphicsCmdEncoder=this._commandEncoder,_=i._paramData._float32Data;_[0]=t,_[1]=e,_[2]=a;var n=i._paramData.getPtrID();return K.syncBufferToRenderThread(i._paramData),r.setGlobalValueEx(tt.GLOBALVALUE_MATRIX32,13,n,0),K.syncBufferToRenderThread(r),i},RotateCmdNative.ID="Rotate"}(),function(){function SaveCmdNative(){this._graphicsCmdEncoder=null}r(SaveCmdNative,"laya.layagl.cmdNative.SaveCmdNative");var t=SaveCmdNative.prototype;t.recover=function(){N.recover("SaveCmd",this)},_(0,t,"cmdID",function(){return"Save"}),SaveCmdNative.create=function(){var t=N.getItemByClass("SaveCmd",SaveCmdNative),e=t._graphicsCmdEncoder=this._commandEncoder;return e.save(),K.syncBufferToRenderThread(e),t},SaveCmdNative.ID="Save"}(),function(){function ScaleCmdNative(){this._graphicsCmdEncoder=null,this._paramData=new ParamData(16,!0)}r(ScaleCmdNative,"laya.layagl.cmdNative.ScaleCmdNative");var t=ScaleCmdNative.prototype;t.recover=function(){N.recover("ScaleCmd",this)},_(0,t,"cmdID",function(){return"Scale"}),_(0,t,"scaleX",function(){return this._paramData._float32Data[0]},function(t){this._paramData._float32Data[0]=t,K.syncBufferToRenderThread(this._paramData)}),_(0,t,"scaleY",function(){return this._paramData._float32Data[1]},function(t){this._paramData._float32Data[1]=t,K.syncBufferToRenderThread(this._paramData)}),_(0,t,"pivotX",function(){return this._paramData._float32Data[2]},function(t){this._paramData._float32Data[2]=t,K.syncBufferToRenderThread(this._paramData)}),_(0,t,"pivotY",function(){return this._paramData._float32Data[3]},function(t){this._paramData._float32Data[3]=t,K.syncBufferToRenderThread(this._paramData)}),ScaleCmdNative.create=function(t,e,a,i){var r=N.getItemByClass("ScaleCmd",ScaleCmdNative),_=r._graphicsCmdEncoder=this._commandEncoder,n=r._paramData._float32Data;n[0]=t,n[1]=e,n[2]=a,n[3]=i;var s=r._paramData.getPtrID();return K.syncBufferToRenderThread(r._paramData),_.setGlobalValueEx(tt.GLOBALVALUE_MATRIX32,12,s,0),K.syncBufferToRenderThread(_),r},ScaleCmdNative.ID="Scale"}(),function(){function TransformCmdNative(){this._graphicsCmdEncoder=null,this._matrix=null,this._paramData=new ParamData(32,!0)}r(TransformCmdNative,"laya.layagl.cmdNative.TransformCmdNative");var t=TransformCmdNative.prototype;t.recover=function(){this._matrix=null,N.recover("TransformCmd",this)},_(0,t,"cmdID",function(){return"Transform"}),_(0,t,"matrix",function(){return this._matrix},function(t){this._matrix=t;var e=this._paramData._float32Data;e[0]=this._matrix.a,e[1]=this._matrix.b,e[2]=this._matrix.c,e[3]=this._matrix.d,e[4]=this._matrix.tx,e[5]=this._matrix.ty,K.syncBufferToRenderThread(this._paramData)}),_(0,t,"pivotX",function(){return this._paramData._float32Data[6]},function(t){this._paramData._float32Data[6]=t,K.syncBufferToRenderThread(this._paramData)}),_(0,t,"pivotY",function(){return this._paramData._float32Data[7]},function(t){this._paramData._float32Data[7]=t,K.syncBufferToRenderThread(this._paramData)}),TransformCmdNative.create=function(t,e,a){var i=N.getItemByClass("TransformCmd",TransformCmdNative),r=i._graphicsCmdEncoder=this._commandEncoder,_=i._paramData._float32Data;_[0]=t.a,_[1]=t.b,_[2]=t.c,_[3]=t.d,_[4]=t.tx,_[5]=t.ty,_[6]=e,_[7]=a,i._matrix=t;var n=i._paramData.getPtrID();return K.syncBufferToRenderThread(i._paramData),r.setGlobalValueEx(tt.GLOBALVALUE_MATRIX32,14,n,0),K.syncBufferToRenderThread(r),i},TransformCmdNative.ID="Transform"}(),function(){function TranslateCmdNative(){this._graphicsCmdEncoder=null,this._paramData=new ParamData(8,!0)}r(TranslateCmdNative,"laya.layagl.cmdNative.TranslateCmdNative");var t=TranslateCmdNative.prototype;t.recover=function(){N.recover("TranslateCmd",this)},_(0,t,"ty",function(){return this._paramData._float32Data[1]},function(t){this._paramData._float32Data[1]=t,K.syncBufferToRenderThread(this._paramData)}),_(0,t,"cmdID",function(){return"Translate"}),_(0,t,"tx",function(){return this._paramData._float32Data[0]},function(t){this._paramData._float32Data[0]=t,K.syncBufferToRenderThread(this._paramData)}),TranslateCmdNative.create=function(t,e){var a=N.getItemByClass("TranslateCmd",TranslateCmdNative),i=a._graphicsCmdEncoder=this._commandEncoder,r=a._paramData._float32Data;r[0]=t,r[1]=e;var _=a._paramData.getPtrID();return K.syncBufferToRenderThread(a._paramData),i.setGlobalValueEx(tt.GLOBALVALUE_MATRIX32,9,_,0),K.syncBufferToRenderThread(i),a},TranslateCmdNative.ID="Translate"}(),function(){function CommandEncoder(t,e,a,i){this._idata=[]}r(CommandEncoder,"laya.layagl.CommandEncoder");var t=CommandEncoder.prototype;return t.getArrayData=function(){return this._idata},t.getPtrID=function(){return 0},t.beginEncoding=function(){},t.endEncoding=function(){},t.clearEncoding=function(){this._idata.length=0},t.getCount=function(){return this._idata.length},t.add_ShaderValue=function(t){this._idata.push(t)},t.addShaderUniform=function(t){this.add_ShaderValue(t)},CommandEncoder}()),Q=function(){function ConchCmdReplace(){}return r(ConchCmdReplace,"laya.layagl.ConchCmdReplace"),ConchCmdReplace.__init__=function(){var t,e=laya.display.cmd,a=laya.layagl.cmdNative;for(t in e)a[t+"Native"]&&(e[t].create=a[t+"Native"].create)},ConchCmdReplace}(),j=function(){function ConchGraphicsAdpt(){this._commandEncoder=null}r(ConchGraphicsAdpt,"laya.layagl.ConchGraphicsAdpt");var t=ConchGraphicsAdpt.prototype;return t._createData=function(){this._commandEncoder=K.instance.createCommandEncoder(128,64,!0)},t._clearData=function(){this._commandEncoder&&this._commandEncoder.clearEncoding()},t._destroyData=function(){this._commandEncoder&&(this._commandEncoder.clearEncoding(),this._commandEncoder=null)},ConchGraphicsAdpt.__init__=function(){var t,e,a=E.prototype,i=ConchGraphicsAdpt.prototype,r=["_createData","_clearData","_destroyData"],_=0;for(t=r.length,_=0;_<t;_++)a[e=r[_]]=i[e]},ConchGraphicsAdpt}(),K=function(){function LayaGL(){}r(LayaGL,"laya.layagl.LayaGL");var t=LayaGL.prototype;return t.createCommandEncoder=function(t,e,a){return void 0===t&&(t=128),void 0===e&&(e=64),void 0===a&&(a=!1),new Z(this,t,e,a)},t.beginCommandEncoding=function(t){},t.endCommandEncoding=function(){},t.calcMatrixFromScaleSkewRotation=function(t,e,a,i,r,_,n,s,o,h,l,u){},t.setGLTemplate=function(t,e){},t.setEndGLTemplate=function(t,e){},t.matrix4x4Multiply=function(t,e,a){},t.evaluateClipDatasRealTime=function(t,e,a,i){},LayaGL.getFrameCount=function(){return 0},LayaGL.syncBufferToRenderThread=function(t,e){void 0===e&&(e=0)},LayaGL.createArrayBufferRef=function(t,e,a){},LayaGL.createArrayBufferRefs=function(t,e,a,i){},LayaGL.EXECUTE_JS_THREAD_BUFFER=0,LayaGL.EXECUTE_RENDER_THREAD_BUFFER=1,LayaGL.EXECUTE_COPY_TO_RENDER=2,LayaGL.EXECUTE_COPY_TO_RENDER3D=3,LayaGL.VALUE_OPERATE_ADD=0,LayaGL.VALUE_OPERATE_SUB=1,LayaGL.VALUE_OPERATE_MUL=2,LayaGL.VALUE_OPERATE_DIV=3,LayaGL.VALUE_OPERATE_M2_MUL=4,LayaGL.VALUE_OPERATE_M3_MUL=5,LayaGL.VALUE_OPERATE_M4_MUL=6,LayaGL.VALUE_OPERATE_M32_MUL=7,LayaGL.VALUE_OPERATE_SET=8,LayaGL.VALUE_OPERATE_M32_TRANSLATE=9,LayaGL.VALUE_OPERATE_M32_SCALE=10,LayaGL.VALUE_OPERATE_M32_ROTATE=11,LayaGL.VALUE_OPERATE_M32_SCALE_PIVOT=12,LayaGL.VALUE_OPERATE_M32_ROTATE_PIVOT=13,LayaGL.VALUE_OPERATE_M32_TRANSFORM_PIVOT=14,LayaGL.VALUE_OPERATE_BYTE4_COLOR_MUL=15,LayaGL.ARRAY_BUFFER_TYPE_DATA=0,LayaGL.ARRAY_BUFFER_TYPE_CMD=1,LayaGL.ARRAY_BUFFER_REF_REFERENCE=0,LayaGL.ARRAY_BUFFER_REF_COPY=1,LayaGL.UPLOAD_SHADER_UNIFORM_TYPE_ID=0,LayaGL.UPLOAD_SHADER_UNIFORM_TYPE_DATA=1,LayaGL.instance=null,LayaGL}(),q=function(){function LayaGLRenderingContext(){this._customCmds=null,this._targets=null,this._width=0,this._height=0}r(LayaGLRenderingContext,"laya.layagl.LayaGLRenderingContext");var t=LayaGLRenderingContext.prototype;return t.drawTexture=function(t,e,a,i,r){void 0===e&&(e=0),void 0===a&&(a=0),void 0===i&&(i=0),void 0===r&&(r=0),this.drawImage(t,e,a,i,r)},t.drawImage=function(t,e,a,i,r){void 0===e&&(e=0),void 0===a&&(a=0),void 0===i&&(i=0),void 0===r&&(r=0),this._customCmds.push(f.create.call(this,t,e,a,i,r))},t.fillText=function(t,e,a,i,r,_){this._customCmds.push(D.create.call(this,t,e,a,i||W.defaultFontStr(),r,_))},t.save=function(){this._customCmds.push(O.create.call(this))},t.restore=function(){this._customCmds.push(x.create.call(this))},t.translate=function(t,e){this._customCmds.push(X.create.call(this,t,e))},t.rotate=function(t,e,a){void 0===e&&(e=0),void 0===a&&(a=0),this._customCmds.push(M.create.call(this,t,e,a))},t.scale=function(t,e,a,i){void 0===a&&(a=0),void 0===i&&(i=0),this._customCmds.push(g.create.call(this,t,e,a,i))},t.transform=function(t,e,a){void 0===e&&(e=0),void 0===a&&(a=0),this._customCmds.push(U.create.call(this,t,e,a))},t.beginRT=function(){$t.pushRT(),this._targets.start(),this.clear()},t.clear=function(){},t.endRT=function(){$t.popRT()},t.drawCanvas=function(t,e,a){var i=t.context._targets;this._customCmds.push(d.create.call(this,i,e,a,i.width,i.height))},t.drawTarget=function(t,e,a,i,r,_){var n=new ArrayBuffer(96),s=new Int32Array(n),o=new Float32Array(n),h=0!=r?r:e.width,l=0!=_?_:e.height,u=$t.flipyuv,c=0;o[c++]=a,o[c++]=i,o[c++]=u[0],o[c++]=u[1],s[c++]=4294967295,s[c++]=4294967295,o[c++]=a+h,o[c++]=i,o[c++]=u[2],o[c++]=u[3],s[c++]=4294967295,s[c++]=4294967295,o[c++]=a+h,o[c++]=i+l,o[c++]=u[4],o[c++]=u[5],s[c++]=4294967295,s[c++]=4294967295,o[c++]=a,o[c++]=i+l,o[c++]=u[6],o[c++]=u[7],s[c++]=4294967295,s[c++]=4294967295,t.useProgramEx(tt.PROGRAMEX_DRAWTEXTURE),t.useVDO(tt.VDO_MESHQUADTEXTURE),t.uniformEx(tt.GLOBALVALUE_VIEWS,0),t.uniformEx(tt.GLOBALVALUE_CLIP_MAT_DIR,1),t.uniformEx(tt.GLOBALVALUE_CLIP_MAT_POS,2),t.uniformTexture(0,33984,e._getSource()),t.setRectMesh(1,n),t.modifyMesh(tt.GLOBALVALUE_MATRIX32,0,7),t.modifyMesh(tt.GLOBALVALUE_DRAWTEXTURE_COLOR,1,15)},_(0,t,"asBitmap",function(){return!this._targets},function(t){if(t){if(this._targets||(this._targets=new $t(this._width,this._height,1,-1)),!this._width||!this._height)throw Error("asBitmap no size!")}else this._targets=null}),LayaGLRenderingContext}(),$=function(){function LayaGLRunner(){}return r(LayaGLRunner,"laya.layagl.LayaGLRunner"),LayaGLRunner.uploadShaderUniforms=function(t,e,a,i){for(var r=a._data,_=e.getArrayData(),n=0,s=0,o=_.length;s<o;s++){var h=_[s];if(i||-1!==h.textureID){var l=r[h.dataOffset];null!=l&&(n+=h.fun.call(h.caller,h,l))}}return n},LayaGLRunner.uploadCustomUniform=function(t,e,a,i){var r=0,_=e[a];return _&&null!=i&&(r+=_.fun.call(_.caller,_,i)),r},LayaGLRunner.uploadShaderUniformsForNative=function(t,e,a){var i=0;a._runtimeCopyValues.length>=0&&(i=1);var r=a._data;return t.uploadShaderUniforms(e,r,i)},LayaGLRunner}(),J=function(){function LayaGLTemplate(){this._commStr="",this._commandEncoder=null,this._id=0,this._commandEncoder=K.instance.createCommandEncoder(64,16,!1)}return r(LayaGLTemplate,"laya.layagl.LayaGLTemplate"),LayaGLTemplate.prototype.addComd=function(t,e){this._commStr+=t+"("+e+");",this._commandEncoder[t].apply(this._commandEncoder,e)},LayaGLTemplate.createByRenderType=function(t){var e=LayaGLTemplate.GLS[t]=new LayaGLTemplate;p.isConchApp&&K.instance.setGLTemplate(t,e._commandEncoder.getPtrID());for(var a=1;a<=8192;){if(t&a&&LayaGLTemplate.__FUN_PARAM__[a])for(var i=LayaGLTemplate.__FUN_PARAM__[a],r=0,_=i.length;r<_;r++){var n=i[r];e.addComd(n.func,n.args)}a<<=1}return e._id=t,console.log("template="+e._commStr),e},LayaGLTemplate.createByRenderTypeEnd=function(t){var e=LayaGLTemplate.GLSE[t]=new LayaGLTemplate;p.isConchApp&&K.instance.setEndGLTemplate(t,e._commandEncoder.getPtrID());for(var a=8192;a>1;){if(t&a&&LayaGLTemplate.__FUN_PARAM_END_[a])for(var i=LayaGLTemplate.__FUN_PARAM_END_[a],r=0,_=i.length;r<_;r++){var n=i[r];e.addComd(n.func,n.args)}a>>=1}return e._id=t,console.log("templateEnd="+e._commStr),e},LayaGLTemplate.__init__=function(){LayaGLTemplate.__FUN_PARAM__[1]=[{func:"setGlobalValueByParamData",args:[tt.GLOBALVALUE_DRAWTEXTURE_COLOR,15,88]}],LayaGLTemplate.__FUN_PARAM__[2]=[{func:"calcLocalMatrix32",args:[60,64,24,28,32,36,40,44,48,52,56]},{func:"setGlobalValueByParamData",args:[tt.GLOBALVALUE_MATRIX32,7,64]}],LayaGLTemplate.__FUN_PARAM__[4]=[{func:"setGlobalValueByParamData",args:[tt.GLOBALVALUE_BLENDFUNC_SRC,8,284]},{func:"setGlobalValueByParamData",args:[tt.GLOBALVALUE_BLENDFUNC_DEST,8,288]}],LayaGLTemplate.__FUN_PARAM__[256]=[{func:"useCommandEncoderByParamData",args:[96,100,1]}],LayaGLTemplate.__FUN_PARAM__[512]=[{func:"callbackJSByParamData",args:[216,272]},{func:"useCommandEncoderByParamData",args:[92,-1,1]}],LayaGLTemplate.__FUN_PARAM__[1024]=[{func:"callbackJSByParamData",args:[216,248]},{func:"useCommandEncoderByParamData",args:[104,-1,3]}],LayaGLTemplate.__FUN_PARAM__[2048]=[{func:"callbackJSByParamData",args:[216,220]},{func:"useCommandEncoderByParamData",args:[108,-1,1]}],LayaGLTemplate.__FUN_PARAM__[64]=[{func:"setClipByParamData",args:[tt.GLOBALVALUE_CLIP_MAT_DIR,tt.GLOBALVALUE_CLIP_MAT_POS,tt.GLOBALVALUE_MATRIX32,112]},{func:"setGlobalValueByParamData",args:[tt.GLOBALVALUE_MATRIX32,9,128]}],LayaGLTemplate.__FUN_PARAM__[16]=[{func:"callbackJSByParamData",args:[216,260]},{func:"useCommandEncoderByParamData",args:[256,-1,0]}],LayaGLTemplate.__FUN_PARAM__[32]=[{func:"callbackJSByParamData",args:[216,276]},{func:"useCommandEncoderByParamData",args:[280,-1,0]}],LayaGLTemplate.__FUN_PARAM__[8]=[{func:"callbackJSByParamData",args:[216,224]},{func:"loadDataToRegByParamData",args:[0,252,4]},{func:"ifGreater0",args:[0,2147483647]},{func:"useCommandEncoderByParamData",args:[232,-1,0]}],LayaGLTemplate.__FUN_PARAM__[128]=[{func:"useCommandEncoderByParamData",args:[292,296,1]},{func:"useCommandEncoderByParamData",args:[300,304,1]}]},LayaGLTemplate.__init_END_=function(){LayaGLTemplate.__FUN_PARAM_END_[16]=[{func:"loadDataToRegByParamData",args:[0,252,4]},{func:"ifGreater0",args:[0,2]},{func:"callbackJSByParamData",args:[216,268]},{func:"useCommandEncoderByParamData",args:[264,-1,1]}],LayaGLTemplate.__FUN_PARAM_END_[8]=[{func:"callbackJSByParamData",args:[216,228]},{func:"useCommandEncoderByParamData",args:[236,-1,0]},{func:"useCommandEncoderByParamData",args:[240,244,1]}]},LayaGLTemplate.GLS=[],LayaGLTemplate.GLSE=[],LayaGLTemplate.__FUN_PARAM__=[],LayaGLTemplate.__FUN_PARAM_END_=[],LayaGLTemplate}(),tt=function(){function LayaNative2D(){}return r(LayaNative2D,"laya.layagl.LayaNative2D"),LayaNative2D._init_simple_texture_cmdEncoder_=function(){LayaNative2D._SIMPLE_TEXTURE_CMDENCODER_=K.instance.createCommandEncoder(124,32,!0),LayaNative2D._SIMPLE_TEXTURE_CMDENCODER_.useProgramEx(laya.layagl.LayaNative2D.PROGRAMEX_DRAWTEXTURE),LayaNative2D._SIMPLE_TEXTURE_CMDENCODER_.useVDO(laya.layagl.LayaNative2D.VDO_MESHQUADTEXTURE),LayaNative2D._SIMPLE_TEXTURE_CMDENCODER_.uniformEx(laya.layagl.LayaNative2D.GLOBALVALUE_VIEWS,0),LayaNative2D._SIMPLE_TEXTURE_CMDENCODER_.uniformEx(laya.layagl.LayaNative2D.GLOBALVALUE_CLIP_MAT_DIR,1),LayaNative2D._SIMPLE_TEXTURE_CMDENCODER_.uniformEx(laya.layagl.LayaNative2D.GLOBALVALUE_CLIP_MAT_POS,2),LayaNative2D._SIMPLE_TEXTURE_CMDENCODER_.uniformTextureByParamData(0,4,8),LayaNative2D._SIMPLE_TEXTURE_CMDENCODER_.blendFuncByGlobalValue(laya.layagl.LayaNative2D.GLOBALVALUE_BLENDFUNC_SRC,laya.layagl.LayaNative2D.GLOBALVALUE_BLENDFUNC_DEST),LayaNative2D._SIMPLE_TEXTURE_CMDENCODER_.setRectMeshByParamData(12,20,16),LayaNative2D._SIMPLE_TEXTURE_CMDENCODER_.modifyMesh(laya.layagl.LayaNative2D.GLOBALVALUE_MATRIX32,0,7),LayaNative2D._SIMPLE_TEXTURE_CMDENCODER_.modifyMesh(laya.layagl.LayaNative2D.GLOBALVALUE_DRAWTEXTURE_COLOR,1,15),K.syncBufferToRenderThread(LayaNative2D._SIMPLE_TEXTURE_CMDENCODER_)},LayaNative2D._init_simple_rect_cmdEncoder_=function(){LayaNative2D._SIMPLE_RECT_CMDENCODER_=K.instance.createCommandEncoder(84,32,!0),LayaNative2D._SIMPLE_RECT_CMDENCODER_.useProgramEx(laya.layagl.LayaNative2D.PROGRAMEX_DRAWTEXTURE),LayaNative2D._SIMPLE_RECT_CMDENCODER_.useVDO(laya.layagl.LayaNative2D.VDO_MESHQUADTEXTURE),LayaNative2D._SIMPLE_RECT_CMDENCODER_.uniformEx(laya.layagl.LayaNative2D.GLOBALVALUE_VIEWS,0),LayaNative2D._SIMPLE_RECT_CMDENCODER_.uniformEx(laya.layagl.LayaNative2D.GLOBALVALUE_CLIP_MAT_DIR,1),LayaNative2D._SIMPLE_RECT_CMDENCODER_.uniformEx(laya.layagl.LayaNative2D.GLOBALVALUE_CLIP_MAT_POS,2),LayaNative2D._SIMPLE_RECT_CMDENCODER_.setRectMeshByParamData(0,8,4),LayaNative2D._SIMPLE_RECT_CMDENCODER_.modifyMesh(laya.layagl.LayaNative2D.GLOBALVALUE_MATRIX32,0,7),LayaNative2D._SIMPLE_RECT_CMDENCODER_.modifyMesh(laya.layagl.LayaNative2D.GLOBALVALUE_DRAWTEXTURE_COLOR,1,15),K.syncBufferToRenderThread(LayaNative2D._SIMPLE_RECT_CMDENCODER_)},LayaNative2D._init_rect_border_cmdEncoder_=function(){LayaNative2D._RECT_BORDER_CMD_ENCODER_=K.instance.createCommandEncoder(84,32,!0),LayaNative2D._RECT_BORDER_CMD_ENCODER_.useProgramEx(laya.layagl.LayaNative2D.PROGRAMEX_DRAWVG),LayaNative2D._RECT_BORDER_CMD_ENCODER_.useVDO(laya.layagl.LayaNative2D.VDO_MESHVG),LayaNative2D._RECT_BORDER_CMD_ENCODER_.uniformEx(laya.layagl.LayaNative2D.GLOBALVALUE_VIEWS,0),LayaNative2D._RECT_BORDER_CMD_ENCODER_.uniformEx(laya.layagl.LayaNative2D.GLOBALVALUE_CLIP_MAT_DIR,1),LayaNative2D._RECT_BORDER_CMD_ENCODER_.uniformEx(laya.layagl.LayaNative2D.GLOBALVALUE_CLIP_MAT_POS,2),LayaNative2D._RECT_BORDER_CMD_ENCODER_.setMeshByParamData(20,0,4,140,8,12,16),LayaNative2D._RECT_BORDER_CMD_ENCODER_.modifyMesh(laya.layagl.LayaNative2D.GLOBALVALUE_MATRIX32,0,7),LayaNative2D._RECT_BORDER_CMD_ENCODER_.modifyMesh(laya.layagl.LayaNative2D.GLOBALVALUE_DRAWTEXTURE_COLOR,1,15),K.syncBufferToRenderThread(LayaNative2D._RECT_BORDER_CMD_ENCODER_)},LayaNative2D.__init__=function(){if(p.isConchApp){var t=K.instance;LayaNative2D.GLOBALVALUE_MATRIX32=t.addGlobalValueDefine(0,5126,6,new Float32Array([1,0,0,1,0,0])),LayaNative2D.GLOBALVALUE_DRAWTEXTURE_COLOR=t.addGlobalValueDefine(0,5124,1,new Uint32Array([4294967295])),LayaNative2D.GLOBALVALUE_ITALICDEG=t.addGlobalValueDefine(0,5126,1,new Float32Array([0])),LayaNative2D.GLOBALVALUE_CLIP_MAT_DIR=t.addGlobalValueDefine(0,5126,4,new Float32Array([1e6,0,0,1e6])),LayaNative2D.GLOBALVALUE_CLIP_MAT_POS=t.addGlobalValueDefine(0,5126,2,new Float32Array([0,0])),LayaNative2D.GLOBALVALUE_BLENDFUNC_SRC=t.addGlobalValueDefine(0,5124,1,new Int32Array([1])),LayaNative2D.GLOBALVALUE_BLENDFUNC_DEST=t.addGlobalValueDefine(0,5124,1,new Int32Array([771])),LayaNative2D.GLOBALVALUE_COLORFILTER_COLOR=t.addGlobalValueDefine(0,5126,16,new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])),LayaNative2D.GLOBALVALUE_COLORFILTER_ALPHA=t.addGlobalValueDefine(0,5126,4,new Float32Array([0,0,0,1])),LayaNative2D.GLOBALVALUE_BLURFILTER_STRENGTH=t.addGlobalValueDefine(0,5126,4,new Float32Array([0,0,0,0])),LayaNative2D.GLOBALVALUE_BLURFILTER_BLURINFO=t.addGlobalValueDefine(0,5126,2,new Float32Array([0,0])),LayaNative2D.GLOBALVALUE_GLOWFILTER_COLOR=t.addGlobalValueDefine(0,5126,4,new Float32Array([0,0,0,0])),LayaNative2D.GLOBALVALUE_GLOWFILTER_BLURINFO1=t.addGlobalValueDefine(0,5126,4,new Float32Array([0,0,0,0])),LayaNative2D.GLOBALVALUE_GLOWFILTER_BLURINFO2=t.addGlobalValueDefine(0,5126,4,new Float32Array([0,0,0,0])),t.endGlobalValueDefine(),LayaNative2D.PROGRAMEX_DRAWTEXTURE=K.instance.createProgramEx("/*\n\ttexturefillrect\n*/\nattribute vec4 posuv;\nattribute vec4 attribColor;\nattribute vec4 attribFlags;\n//attribute vec4 clipDir;\n//attribute vec2 clipRect;\nuniform vec4 clipMatDir;\nuniform vec2 clipMatPos;\nvarying vec2 cliped;\nuniform vec2 size;\n\n#ifdef WORLDMAT\n\tuniform mat4 mmat;\n#endif\n\nvarying vec4 v_texcoordAlpha;\nvarying vec4 v_color;\nvarying float v_useTex;\n\nvoid main() {\n\n#ifdef WORLDMAT\n\tvec4 pos=mmat*vec4(posuv.xy,0.,1.);\n\tgl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,0.,1.0);\n#else\n\tgl_Position =vec4((posuv.x/size.x-0.5)*2.0,(0.5-posuv.y/size.y)*2.0,0.,1.0);\n#endif\n  \n\tv_texcoordAlpha.xy = posuv.zw;\n\t//v_texcoordAlpha.z = attribColor.a/255.0;\n\tv_color = attribColor/255.0;\n\tv_color.xyz*=v_color.w;//\n\t\n\tv_useTex = attribFlags.r/255.0;\n\tfloat clipw = length(clipMatDir.xy);\n\tfloat cliph = length(clipMatDir.zw);\n\tvec2 clippos = posuv.xy - clipMatPos.xy;\t//posclip\n\tif(clipw>20000. && cliph>20000.)\n\t\tcliped = vec2(0.5,0.5);\n\telse {\n\t\t//01/clipw/clipw clipposnormalizeclipclipw\n\t\tcliped=vec2( dot(clippos,clipMatDir.xy)/clipw/clipw, dot(clippos,clipMatDir.zw)/cliph/cliph);\n\t}\n\n}","/*\n\ttexturefillrect\n*/\n\nprecision mediump float;\n//precision highp float;\nvarying vec4 v_texcoordAlpha;\nvarying vec4 v_color;\nvarying float v_useTex;\nuniform sampler2D texture;\nvarying vec2 cliped;\n\n#ifdef BLUR_FILTER\nuniform vec4 strength_sig2_2sig2_gauss1;\nuniform vec2 blurInfo;\n\n#define PI 3.141593\n\nfloat getGaussian(float x, float y){\n    return strength_sig2_2sig2_gauss1.w*exp(-(x*x+y*y)/strength_sig2_2sig2_gauss1.z);\n}\n\nvec4 blur(){\n    const float blurw = 9.0;\n    vec4 vec4Color = vec4(0.0,0.0,0.0,0.0);\n    vec2 halfsz=vec2(blurw,blurw)/2.0/blurInfo;    \n    vec2 startpos=v_texcoordAlpha.xy-halfsz;\n    vec2 ctexcoord = startpos;\n    vec2 step = 1.0/blurInfo;  //      \n    \n    for(float y = 0.0;y<=blurw; ++y){\n        ctexcoord.x=startpos.x;\n        for(float x = 0.0;x<=blurw; ++x){\n            //TODO vs\n            vec4Color += texture2D(texture, ctexcoord)*getGaussian(x-blurw/2.0,y-blurw/2.0);\n            ctexcoord.x+=step.x;\n        }\n        ctexcoord.y+=step.y;\n    }\n    return vec4Color;\n}\n#endif\n\n#ifdef COLOR_FILTER\nuniform vec4 colorAlpha;\nuniform mat4 colorMat;\n#endif\n\n#ifdef GLOW_FILTER\nuniform vec4 u_color;\nuniform vec4 u_blurInfo1;\nuniform vec4 u_blurInfo2;\n#endif\n\n#ifdef COLOR_ADD\nuniform vec4 colorAdd;\n#endif\n\n//FILLTEXTURE\nuniform vec4 u_TexRange;//startu,startv,urange, vrange\n\nvoid main() {\n\tif(cliped.x<0.) discard;\n\tif(cliped.x>1.) discard;\n\tif(cliped.y<0.) discard;\n\tif(cliped.y>1.) discard;\n\t\n#ifdef FILLTEXTURE\t\n   vec4 color= texture2D(texture, fract(v_texcoordAlpha.xy)*u_TexRange.zw + u_TexRange.xy);\n#else\n   vec4 color= texture2D(texture, v_texcoordAlpha.xy);\n#endif\n\n   if(v_useTex<=0.)color = vec4(1.,1.,1.,1.);\n   color.a*=v_color.w;\n   //color.rgb*=v_color.w;\n   color.rgb*=v_color.rgb;\n   gl_FragColor=color;\n   \n   #ifdef COLOR_ADD\n\tgl_FragColor = vec4(colorAdd.rgb,colorAdd.a*gl_FragColor.a);\n\tgl_FragColor.xyz *= colorAdd.a;\n   #endif\n   \n   #ifdef BLUR_FILTER\n\tgl_FragColor =   blur();\n\tgl_FragColor.w*=v_color.w;   \n   #endif\n   \n   #ifdef COLOR_FILTER\n\tmat4 alphaMat =colorMat;\n\n\talphaMat[0][3] *= gl_FragColor.a;\n\talphaMat[1][3] *= gl_FragColor.a;\n\talphaMat[2][3] *= gl_FragColor.a;\n\n\tgl_FragColor = gl_FragColor * alphaMat;\n\tgl_FragColor += colorAlpha/255.0*gl_FragColor.a;\n   #endif\n   \n   #ifdef GLOW_FILTER\n\tconst float c_IterationTime = 10.0;\n\tfloat floatIterationTotalTime = c_IterationTime * c_IterationTime;\n\tvec4 vec4Color = vec4(0.0,0.0,0.0,0.0);\n\tvec2 vec2FilterDir = vec2(-(u_blurInfo1.z)/u_blurInfo2.x,-(u_blurInfo1.w)/u_blurInfo2.y);\n\tvec2 vec2FilterOff = vec2(u_blurInfo1.x/u_blurInfo2.x/c_IterationTime * 2.0,u_blurInfo1.y/u_blurInfo2.y/c_IterationTime * 2.0);\n\tfloat maxNum = u_blurInfo1.x * u_blurInfo1.y;\n\tvec2 vec2Off = vec2(0.0,0.0);\n\tfloat floatOff = c_IterationTime/2.0;\n\tfor(float i = 0.0;i<=c_IterationTime; ++i){\n\t\tfor(float j = 0.0;j<=c_IterationTime; ++j){\n\t\t\tvec2Off = vec2(vec2FilterOff.x * (i - floatOff),vec2FilterOff.y * (j - floatOff));\n\t\t\tvec4Color += texture2D(texture, v_texcoordAlpha.xy + vec2FilterDir + vec2Off)/floatIterationTotalTime;\n\t\t}\n\t}\n\tgl_FragColor = vec4(u_color.rgb,vec4Color.a * u_blurInfo2.z);\n\tgl_FragColor.rgb *= gl_FragColor.a;   \n   #endif\n   \n}","posuv,attribColor,attribFlags","size,clipMatDir,clipMatPos,texture,colorMat,colorAlpha,strength_sig2_2sig2_gauss1,blurInfo,u_color,u_blurInfo1,u_blurInfo2"),LayaNative2D.PROGRAMEX_DRAWVG=K.instance.createProgramEx("attribute vec4 position;\nattribute vec4 attribColor;\n//attribute vec4 clipDir;\n//attribute vec2 clipRect;\nuniform vec4 clipMatDir;\nuniform vec2 clipMatPos;\n#ifdef WORLDMAT\n\tuniform mat4 mmat;\n#endif\nuniform mat4 u_mmat2;\n//uniform vec2 u_pos;\nuniform vec2 size;\nvarying vec4 color;\n//vec4 dirxy=vec4(0.9,0.1, -0.1,0.9);\n//vec4 clip=vec4(100.,30.,300.,600.);\nvarying vec2 cliped;\nvoid main(){\n\t\n#ifdef WORLDMAT\n\tvec4 pos=mmat*vec4(position.xy,0.,1.);\n\tgl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n#else\n\tgl_Position =vec4((position.x/size.x-0.5)*2.0,(0.5-position.y/size.y)*2.0,position.z,1.0);\n#endif\t\n\tfloat clipw = length(clipMatDir.xy);\n\tfloat cliph = length(clipMatDir.zw);\n\tvec2 clippos = position.xy - clipMatPos.xy;\t//posclip\n\tif(clipw>20000. && cliph>20000.)\n\t\tcliped = vec2(0.5,0.5);\n\telse {\n\t\t//clipdirclipposnormalize\n\t\tcliped=vec2( dot(clippos,clipMatDir.xy)/clipw/clipw, dot(clippos,clipMatDir.zw)/cliph/cliph);\n\t}\n  //pos2d.x = dot(clippos,dirx);\n  color=attribColor/255.;\n}","precision mediump float;\n//precision mediump float;\nvarying vec4 color;\n//uniform float alpha;\nvarying vec2 cliped;\nvoid main(){\n\t//vec4 a=vec4(color.r, color.g, color.b, 1);\n\t//a.a*=alpha;\n    gl_FragColor= color;// vec4(color.r, color.g, color.b, alpha);\n\tgl_FragColor.rgb*=color.a;\n\tif(cliped.x<0.) discard;\n\tif(cliped.x>1.) discard;\n\tif(cliped.y<0.) discard;\n\tif(cliped.y>1.) discard;\n}","position,attribColor","size,clipMatDir,clipMatPos"),LayaNative2D.PROGRAMEX_DRAWPARTICLE=K.instance.createProgramEx("attribute vec4 a_CornerTextureCoordinate;\nattribute vec3 a_Position;\nattribute vec3 a_Velocity;\nattribute vec4 a_StartColor;\nattribute vec4 a_EndColor;\nattribute vec3 a_SizeRotation;\nattribute vec2 a_Radius;\nattribute vec4 a_Radian;\nattribute float a_AgeAddScale;\nattribute float a_Time;\n\nvarying vec4 v_Color;\nvarying vec2 v_TextureCoordinate;\n\nuniform float u_CurrentTime;\nuniform float u_Duration;\nuniform float u_EndVelocity;\nuniform vec3 u_Gravity;\n\nuniform vec2 size;\nuniform mat4 u_mmat;\n\nvec4 ComputeParticlePosition(in vec3 position, in vec3 velocity,in float age,in float normalizedAge)\n{\n\n   float startVelocity = length(velocity);//\n   float endVelocity = startVelocity * u_EndVelocity;//\n\n   float velocityIntegral = startVelocity * normalizedAge +(endVelocity - startVelocity) * normalizedAge *normalizedAge/2.0;//vt=v0*t+(1/2)*a*(t^2)\n   \n   vec3 addPosition = normalize(velocity) * velocityIntegral * u_Duration;//    \n   addPosition += u_Gravity * age * normalizedAge;//\n   \n   float radius=mix(a_Radius.x, a_Radius.y, normalizedAge); //\n   float radianHorizontal =mix(a_Radian.x,a_Radian.z,normalizedAge);\n   float radianVertical =mix(a_Radian.y,a_Radian.w,normalizedAge);\n   \n   float r =cos(radianVertical)* radius;\n   addPosition.y += sin(radianVertical) * radius;\n\t\n   addPosition.x += cos(radianHorizontal) *r;\n   addPosition.z += sin(radianHorizontal) *r;\n  \n   addPosition.y=-addPosition.y;//2D2DY\n   position+=addPosition;\n   return  vec4(position,1.0);\n}\n\nfloat ComputeParticleSize(in float startSize,in float endSize, in float normalizedAge)\n{    \n    float size = mix(startSize, endSize, normalizedAge);\n    return size;\n}\n\nmat2 ComputeParticleRotation(in float rot,in float age)\n{    \n    float rotation =rot * age;\n    //2x2.\n    float c = cos(rotation);\n    float s = sin(rotation);\n    return mat2(c, -s, s, c);\n}\n\nvec4 ComputeParticleColor(in vec4 startColor,in vec4 endColor,in float normalizedAge)\n{\n\tvec4 color=mix(startColor,endColor,normalizedAge);\n    //,6.701x*(1-x)*(1-x)*6.7\n    color.a *= normalizedAge * (1.0-normalizedAge) * (1.0-normalizedAge) * 6.7;\n   \n    return color;\n}\n\nvoid main()\n{\n   float age = u_CurrentTime - a_Time;\n   age *= 1.0 + a_AgeAddScale;\n   float normalizedAge = clamp(age / u_Duration,0.0,1.0);\n   gl_Position = ComputeParticlePosition(a_Position, a_Velocity, age, normalizedAge);//\n   float pSize = ComputeParticleSize(a_SizeRotation.x,a_SizeRotation.y, normalizedAge);\n   mat2 rotation = ComputeParticleRotation(a_SizeRotation.z, age);\n\t\n    mat4 mat=u_mmat;\n    gl_Position=vec4((mat*gl_Position).xy,0.0,1.0);\n    gl_Position.xy += (rotation*a_CornerTextureCoordinate.xy) * pSize*vec2(mat[0][0],mat[1][1]);\n    gl_Position=vec4((gl_Position.x/size.x-0.5)*2.0,(0.5-gl_Position.y/size.y)*2.0,0.0,1.0);\n   \n   v_Color = ComputeParticleColor(a_StartColor,a_EndColor, normalizedAge);\n   v_TextureCoordinate =a_CornerTextureCoordinate.zw;\n}\n\n","#ifdef FSHIGHPRECISION\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\nvarying vec4 v_Color;\nvarying vec2 v_TextureCoordinate;\nuniform sampler2D u_texture;\n\nvoid main()\n{\t\n\tgl_FragColor=texture2D(u_texture,v_TextureCoordinate)*v_Color;\n\tgl_FragColor.xyz *= v_Color.w;\n}","a_CornerTextureCoordinate,a_Position,a_Velocity,a_StartColor,a_EndColor,a_SizeRotation,a_Radius,a_Radian,a_AgeAddScale,a_Time","u_CurrentTime,u_Duration,u_EndVelocity,u_Gravity,size,u_mmat,u_texture"),LayaNative2D.VDO_MESHQUADTEXTURE=t.createVDO(new Int32Array([5126,0,4,24,5121,16,4,24,5121,20,4,24])),LayaNative2D.VDO_MESHVG=t.createVDO(new Int32Array([5126,0,2,12,5121,8,4,12])),LayaNative2D.VDO_MESHPARTICLE=t.createVDO(new Int32Array([5126,0,4,116,5126,16,3,116,5126,28,3,116,5126,40,4,116,5126,56,4,116,5126,72,3,116,5126,84,2,116,5126,92,4,116,5126,108,1,116,5126,112,1,116])),LayaNative2D._init_simple_texture_cmdEncoder_(),LayaNative2D._init_simple_rect_cmdEncoder_(),LayaNative2D._init_rect_border_cmdEncoder_(),LayaNative2D.SHADER_MACRO_COLOR_FILTER=K.instance.defineShaderMacro("#define COLOR_FILTER",[{uname:4,id:LayaNative2D.GLOBALVALUE_COLORFILTER_COLOR},{uname:5,id:LayaNative2D.GLOBALVALUE_COLORFILTER_ALPHA}]),LayaNative2D.SHADER_MACRO_BLUR_FILTER=K.instance.defineShaderMacro("#define BLUR_FILTER",[{uname:6,id:LayaNative2D.GLOBALVALUE_BLURFILTER_STRENGTH},{uname:7,id:LayaNative2D.GLOBALVALUE_BLURFILTER_BLURINFO}]),LayaNative2D.SHADER_MACRO_GLOW_FILTER=K.instance.defineShaderMacro("#define GLOW_FILTER",[{uname:8,id:LayaNative2D.GLOBALVALUE_GLOWFILTER_COLOR},{uname:9,id:LayaNative2D.GLOBALVALUE_GLOWFILTER_BLURINFO1},{uname:10,id:LayaNative2D.GLOBALVALUE_GLOWFILTER_BLURINFO2}]),J.__init__(),J.__init_END_(),new ht,ut.charRender=new Ft}},LayaNative2D._SIMPLE_TEXTURE_CMDENCODER_=null,LayaNative2D._SIMPLE_RECT_CMDENCODER_=null,LayaNative2D._RECT_BORDER_CMD_ENCODER_=null,LayaNative2D.PROGRAMEX_DRAWTEXTURE=0,LayaNative2D.PROGRAMEX_DRAWVG=0,LayaNative2D.PROGRAMEX_DRAWRECT=0,LayaNative2D.PROGRAMEX_DRAWPARTICLE=0,LayaNative2D.VDO_MESHQUADTEXTURE=0,LayaNative2D.VDO_MESHVG=0,LayaNative2D.VDO_MESHPARTICLE=0,LayaNative2D.GLOBALVALUE_VIEWS=0,LayaNative2D.GLOBALVALUE_MATRIX32=0,LayaNative2D.GLOBALVALUE_DRAWTEXTURE_COLOR=0,LayaNative2D.GLOBALVALUE_ITALICDEG=0,LayaNative2D.GLOBALVALUE_CLIP_MAT_DIR=0,LayaNative2D.GLOBALVALUE_CLIP_MAT_POS=0,LayaNative2D.GLOBALVALUE_BLENDFUNC_SRC=0,LayaNative2D.GLOBALVALUE_BLENDFUNC_DEST=0,LayaNative2D.GLOBALVALUE_COLORFILTER_COLOR=0,LayaNative2D.GLOBALVALUE_COLORFILTER_ALPHA=0,LayaNative2D.GLOBALVALUE_BLURFILTER_STRENGTH=0,LayaNative2D.GLOBALVALUE_BLURFILTER_BLURINFO=0,LayaNative2D.SHADER_MACRO_COLOR_FILTER=0,LayaNative2D.SHADER_MACRO_BLUR_FILTER=0,LayaNative2D.SHADER_MACRO_GLOW_FILTER=0,LayaNative2D.GLOBALVALUE_GLOWFILTER_COLOR=0,LayaNative2D.GLOBALVALUE_GLOWFILTER_BLURINFO1=0,LayaNative2D.GLOBALVALUE_GLOWFILTER_BLURINFO2=0,LayaNative2D}(),et=function(){function MatrixConch(t,e,a,i,r,_,n){void 0===t&&(t=1),void 0===e&&(e=0),void 0===a&&(a=0),void 0===i&&(i=1),void 0===r&&(r=0),void 0===_&&(_=0),this._nums=n=n||new Float32Array(6),n[0]=t,n[1]=e,n[2]=a,n[3]=i,n[4]=r,n[5]=_,this._checkTransform()}r(MatrixConch,"laya.layagl.MatrixConch");var t=MatrixConch.prototype;return t.identity=function(){var t=this._nums;return t[0]=t[3]=1,t[1]=t[4]=t[5]=t[2]=0,this._bTransform=!1,this},t._checkTransform=function(){var t=this._nums;return this._bTransform=1!==t[0]||0!==t[1]||0!==t[2]||1!==t[3]},t.setTranslate=function(t,e){return this._nums[4]=t,this._nums[5]=e,this},t.translate=function(t,e){return this._nums[4]+=t,this._nums[5]+=e,this},t.scale=function(t,e){var a=this._nums;return a[0]*=t,a[3]*=e,a[2]*=t,a[1]*=e,a[4]*=t,a[5]*=e,this._bTransform=!0,this},t.rotate=function(t){var e=this._nums,a=Math.cos(t),i=Math.sin(t),r=e[0],_=e[2],n=e[4];return e[0]=r*a-e[1]*i,e[1]=r*i+e[1]*a,e[2]=_*a-e[3]*i,e[3]=_*i+e[3]*a,e[4]=n*a-e[5]*i,e[5]=n*i+e[5]*a,this._bTransform=!0,this},t.skew=function(t,e){var a=this._nums,i=Math.tan(t),r=Math.tan(e),_=a[0],n=a[1];return a[0]+=r*a[2],a[1]+=r*a[3],a[2]+=i*_,a[3]+=i*n,this},t.invertTransformPoint=function(t){var e=this._nums,a=e[0],i=e[1],r=e[2],_=e[3],n=e[4],s=a*_-i*r,o=_/s,h=-i/s,l=-r/s,u=a/s,c=(r*e[5]-_*n)/s,d=-(a*e[5]-i*n)/s;return t.setTo(o*t.x+l*t.y+c,h*t.x+u*t.y+d)},t.transformPoint=function(t){var e=this._nums;return t.setTo(e[0]*t.x+e[2]*t.y+e[4],e[1]*t.x+e[3]*t.y+e[5])},t.transformPointN=function(t){var e=this._nums;return t.setTo(e[0]*t.x+e[2]*t.y,e[1]*t.x+e[3]*t.y)},t.getScaleX=function(){var t=this._nums;return 0===t[1]?this.a:Math.sqrt(t[0]*t[0]+t[1]*t[1])},t.getScaleY=function(){var t=this._nums;return 0===t[2]?t[3]:Math.sqrt(t[2]*t[2]+t[3]*t[3])},t.invert=function(){var t=this._nums,e=t[0],a=t[1],i=t[2],r=t[3],_=t[4],n=e*r-a*i;return t[0]=r/n,t[1]=-a/n,t[2]=-i/n,t[3]=e/n,t[4]=(i*this.ty-r*_)/n,t[5]=-(e*this.ty-a*_)/n,this},t.setTo=function(t,e,a,i,r,_){var n=this._nums;return n[0]=t,n[1]=e,n[2]=a,n[3]=i,n[4]=r,n[5]=_,this},t.concat=function(t){var e=this._nums,a=t._nums,i=e[0],r=e[2],_=e[4];return e[0]=i*a[0]+e[1]*a[2],e[1]=i*a[1]+e[1]*a[3],e[2]=r*a[0]+e[3]*a[2],e[3]=r*a[1]+e[3]*a[3],e[4]=_*a[0]+e[5]*a[2]+a[4],e[5]=_*a[1]+e[5]*a[3]+a[5],this},t.scaleEx=function(t,e){var a=this._nums,i=a[0],r=a[1],_=a[2],n=a[3];0!==r||0!==_?(a[0]=t*i,a[1]=t*r,a[2]=e*_,a[3]=e*n):(a[0]=t*i,a[1]=0*n,a[2]=0*i,a[3]=e*n),this._bTransform=!0},t.rotateEx=function(t){var e=this._nums,a=Math.cos(t),i=Math.sin(t),r=e[0],_=e[1],n=e[2],s=e[3];0!==_||0!==n?(e[0]=a*r+i*n,e[1]=a*_+i*s,e[2]=-i*r+a*n,e[3]=-i*_+a*s):(e[0]=a*r,e[1]=i*s,e[2]=-i*r,e[3]=a*s),this._bTransform=!0},t.clone=function(){var t=this._nums,e=MatrixConch.create(),a=e._nums;return a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3],a[4]=t[4],a[5]=t[5],e._bTransform=this._bTransform,e},t.copyTo=function(t){var e=this._nums,a=t._nums;return a[0]=e[0],a[1]=e[1],a[2]=e[2],a[3]=e[3],a[4]=e[4],a[5]=e[5],t._bTransform=this._bTransform,t},t.toString=function(){return this.a+","+this.b+","+this.c+","+this.d+","+this.tx+","+this.ty},t.destroy=function(){this.recover()},t.recover=function(){MatrixConch._pool.push(this)},_(0,t,"a",function(){return this._nums[0]},function(t){this._nums[0]=t}),_(0,t,"b",function(){return this._nums[1]},function(t){this._nums[1]=t}),_(0,t,"c",function(){return this._nums[2]},function(t){this._nums[2]=t}),_(0,t,"d",function(){return this._nums[3]},function(t){this._nums[3]=t}),_(0,t,"tx",function(){return this._nums[4]},function(t){this._nums[4]=t}),_(0,t,"ty",function(){return this._nums[5]},function(t){this._nums[5]=t}),MatrixConch.mul=function(t,e,a){var i=t._nums,r=e._nums,_=a._nums,n=i[0],s=i[1],o=i[2],h=i[3],l=i[4],u=i[5],c=r[0],d=r[1],f=r[2],D=r[3],m=r[4],C=r[5];return 0!==d||0!==f?(_[0]=n*c+s*f,_[1]=n*d+s*D,_[2]=o*c+h*f,_[3]=o*d+h*D,_[4]=c*l+f*u+m,_[5]=d*l+D*u+C):(_[0]=n*c,_[1]=s*D,_[2]=o*c,_[3]=h*D,_[4]=c*l+m,_[5]=D*u+C),a},MatrixConch.mul16=function(t,e,a){var i=t._nums,r=e._nums,_=i[0],n=i[1],s=i[2],o=i[3],h=i[4],l=i[5],u=r[0],c=r[1],d=r[2],f=r[3],D=r[4],m=r[5];return 0!==c||0!==d?(a[0]=_*u+n*d,a[1]=_*c+n*f,a[4]=s*u+o*d,a[5]=s*c+o*f,a[12]=u*h+d*l+D,a[13]=c*h+f*l+m):(a[0]=_*u,a[1]=n*f,a[4]=s*u,a[5]=o*f,a[12]=u*h+D,a[13]=f*l+m),a},MatrixConch.create=function(t){var e;return MatrixConch._pool.length?(e=MatrixConch._pool.pop(),t&&(e._nums=t),e.identity(),e):new MatrixConch(1,0,0,1,0,0,t)},MatrixConch.A=0,MatrixConch.B=1,MatrixConch.C=2,MatrixConch.D=3,MatrixConch.TX=4,MatrixConch.TY=5,MatrixConch.EMPTY=new MatrixConch,MatrixConch.TEMP=new MatrixConch,MatrixConch._pool=[],MatrixConch}(),at=(function(){function QuickTestTool(){this._renderType=0,this._repaint=0,this._x=NaN,this._y=NaN}r(QuickTestTool,"laya.layagl.QuickTestTool");var t=QuickTestTool.prototype;t.render=function(t,e,a){I.spriteCount++,QuickTestTool._addType(this._renderType),QuickTestTool.showRenderTypeInfo(this._renderType),b.renders[this._renderType]._fun(this,t,e+this._x,a+this._y),this._repaint=0},t._stageRender=function(t,e,i){QuickTestTool._countStart(),QuickTestTool._PreStageRender.call(a.stage,t,e,i),QuickTestTool._countEnd()},QuickTestTool.getMCDName=function(t){return QuickTestTool._typeToNameDic[t]},QuickTestTool.showRenderTypeInfo=function(t,e){if(void 0===e&&(e=!1),e||!QuickTestTool.showedDic[t]){if(QuickTestTool.showedDic[t]=!0,!QuickTestTool._rendertypeToStrDic[t]){var a=[],i=0;for(i=1;i<=t;)i&t&&a.push(QuickTestTool.getMCDName(i&t)),i<<=1;QuickTestTool._rendertypeToStrDic[t]=a.join(",")}console.log("cmd:",QuickTestTool._rendertypeToStrDic[t])}},QuickTestTool.__init__=function(){QuickTestTool._typeToNameDic[1]="ALPHA",QuickTestTool._typeToNameDic[2]="TRANSFORM",QuickTestTool._typeToNameDic[256]="TEXTURE",QuickTestTool._typeToNameDic[512]="GRAPHICS",QuickTestTool._typeToNameDic[4096]="ONECHILD",QuickTestTool._typeToNameDic[8192]="CHILDS",QuickTestTool._typeToNameDic[3]="TRANSFORM|ALPHA",QuickTestTool._typeToNameDic[8]="CANVAS",QuickTestTool._typeToNameDic[4]="BLEND",QuickTestTool._typeToNameDic[16]="FILTERS",QuickTestTool._typeToNameDic[32]="MASK",QuickTestTool._typeToNameDic[64]="CLIP",QuickTestTool._typeToNameDic[1024]="LAYAGL3D"},QuickTestTool._countStart=function(){var t;for(t in QuickTestTool._countDic)QuickTestTool._countDic[t]=0},QuickTestTool._countEnd=function(){QuickTestTool._i++,QuickTestTool._i>60&&(QuickTestTool.showCountInfo(),QuickTestTool._i=0)},QuickTestTool._addType=function(t){QuickTestTool._countDic[t]?QuickTestTool._countDic[t]+=1:QuickTestTool._countDic[t]=1},QuickTestTool.showCountInfo=function(){var t;for(t in console.log("==================="),QuickTestTool._countDic)console.log("count:"+QuickTestTool._countDic[t]),QuickTestTool.showRenderTypeInfo(t,!0)},QuickTestTool.enableQuickTest=function(){QuickTestTool.__init__(),B.prototype.render=QuickTestTool.prototype.render,QuickTestTool._PreStageRender=w.prototype.render,w.prototype.render=QuickTestTool.prototype._stageRender},QuickTestTool.showedDic={},QuickTestTool._rendertypeToStrDic={},QuickTestTool._typeToNameDic={},QuickTestTool._PreStageRender=null,QuickTestTool._countDic={},QuickTestTool._i=0}(),function(){function BlendMode(){}return r(BlendMode,"laya.webgl.canvas.BlendMode"),BlendMode._init_=function(t){BlendMode.fns=[BlendMode.BlendNormal,BlendMode.BlendAdd,BlendMode.BlendMultiply,BlendMode.BlendScreen,BlendMode.BlendOverlay,BlendMode.BlendLight,BlendMode.BlendMask,BlendMode.BlendDestinationOut],BlendMode.targetFns=[BlendMode.BlendNormalTarget,BlendMode.BlendAddTarget,BlendMode.BlendMultiplyTarget,BlendMode.BlendScreenTarget,BlendMode.BlendOverlayTarget,BlendMode.BlendLightTarget,BlendMode.BlendMask,BlendMode.BlendDestinationOut]},BlendMode.BlendNormal=function(t){Mt.setBlendFunc(t,1,771)},BlendMode.BlendAdd=function(t){Mt.setBlendFunc(t,1,772)},BlendMode.BlendMultiply=function(t){Mt.setBlendFunc(t,774,771)},BlendMode.BlendScreen=function(t){Mt.setBlendFunc(t,1,1)},BlendMode.BlendOverlay=function(t){Mt.setBlendFunc(t,1,769)},BlendMode.BlendLight=function(t){Mt.setBlendFunc(t,1,1)},BlendMode.BlendNormalTarget=function(t){Mt.setBlendFunc(t,1,771)},BlendMode.BlendAddTarget=function(t){Mt.setBlendFunc(t,1,772)},BlendMode.BlendMultiplyTarget=function(t){Mt.setBlendFunc(t,774,771)},BlendMode.BlendScreenTarget=function(t){Mt.setBlendFunc(t,1,1)},BlendMode.BlendOverlayTarget=function(t){Mt.setBlendFunc(t,1,769)},BlendMode.BlendLightTarget=function(t){Mt.setBlendFunc(t,1,1)},BlendMode.BlendMask=function(t){Mt.setBlendFunc(t,0,770)},BlendMode.BlendDestinationOut=function(t){Mt.setBlendFunc(t,0,0)},BlendMode.activeBlendFunction=null,BlendMode.NAMES=["normal","add","multiply","screen","overlay","light","mask","destination-out"],BlendMode.TOINT={normal:0,add:1,multiply:2,screen:3,overlay:4,light:5,mask:6,"destination-out":7,lighter:1},BlendMode.NORMAL="normal",BlendMode.ADD="add",BlendMode.MULTIPLY="multiply",BlendMode.SCREEN="screen",BlendMode.OVERLAY="overlay",BlendMode.LIGHT="light",BlendMode.MASK="mask",BlendMode.DESTINATIONOUT="destination-out",BlendMode.LIGHTER="lighter",BlendMode.fns=[],BlendMode.targetFns=[],BlendMode}()),it=function(){function DrawStyle(t){this._color=null,this.setValue(t)}r(DrawStyle,"laya.webgl.canvas.DrawStyle");var t=DrawStyle.prototype;return t.setValue=function(t){this._color=t?t instanceof laya.utils.ColorUtils?t:l.create(t):l.create("#000000")},t.reset=function(){this._color=l.create("#000000")},t.toInt=function(){return this._color.numColor},t.equal=function(t){return"string"==typeof t?this._color.strColor===t:t instanceof laya.utils.ColorUtils&&this._color.numColor===t.numColor},t.toColorStr=function(){return this._color.strColor},DrawStyle.create=function(t){if(t){var e=t instanceof laya.utils.ColorUtils?t:l.create(t);return e._drawStyle||(e._drawStyle=new DrawStyle(t))}return DrawStyle.DEFAULT},DrawStyle.DEFAULT=new DrawStyle("#000000"),DrawStyle}(),rt=function(){var t;function Path(){this._lastOriX=0,this._lastOriY=0,this.paths=[],this._curPath=null}r(Path,"laya.webgl.canvas.Path");var e=Path.prototype;return e.beginPath=function(e){this.paths.length=1,this._curPath=this.paths[0]=new t,this._curPath.convex=e},e.closePath=function(){this._curPath.loop=!0},e.newPath=function(){this._curPath=new t,this.paths.push(this._curPath)},e.addPoint=function(t,e){this._curPath.path.push(t,e)},e.push=function(e,a){this._curPath?this._curPath.path.length>0&&(this._curPath=new t,this.paths.push(this._curPath)):(this._curPath=new t,this.paths.push(this._curPath));var i=this._curPath;i.path=e.slice(),i.convex=a},e.reset=function(){this.paths.length=0},Path.__init$=function(){t=function(){function renderPath(){this.path=[],this.loop=!1,this.convex=!1}return r(renderPath,""),renderPath}()},Path}(),_t=function(){function SaveClipRect(){this._clipInfoID=-1,this._globalClipMatrix=new R,this._clipRect=new L}r(SaveClipRect,"laya.webgl.canvas.save.SaveClipRect");var t=SaveClipRect.prototype;return a.imps(t,{"laya.webgl.canvas.save.ISaveData":!0}),t.isSaveMark=function(){return!1},t.restore=function(t){this._globalClipMatrix.copyTo(t._globalClipMatrix),this._clipRect.clone(t._clipRect),t._clipInfoID=this._clipInfoID,SaveClipRect.POOL[SaveClipRect.POOL._length++]=this},SaveClipRect.save=function(t){if(131072!=(131072&t._saveMark._saveuse)){t._saveMark._saveuse|=131072;var e=SaveClipRect.POOL,a=e._length>0?e[--e._length]:new SaveClipRect;t._globalClipMatrix.copyTo(a._globalClipMatrix),t._clipRect.clone(a._clipRect),a._clipInfoID=t._clipInfoID;var i=t._save;i[i._length++]=a}},SaveClipRect.POOL=z._createArray(),SaveClipRect}(),nt=function(){function SaveMark(){this._saveuse=0}r(SaveMark,"laya.webgl.canvas.save.SaveMark");var t=SaveMark.prototype;return a.imps(t,{"laya.webgl.canvas.save.ISaveData":!0}),t.isSaveMark=function(){return!0},t.restore=function(t){t._saveMark=this._preSaveMark,SaveMark.POOL[SaveMark.POOL._length++]=this},SaveMark.Create=function(t){var e=SaveMark.POOL,a=e._length>0?e[--e._length]:new SaveMark;return a._saveuse=0,a._preSaveMark=t._saveMark,t._saveMark=a,a},SaveMark.POOL=z._createArray(),SaveMark}(),st=function(){function SaveTransform(){this._matrix=new R}r(SaveTransform,"laya.webgl.canvas.save.SaveTransform");var t=SaveTransform.prototype;return a.imps(t,{"laya.webgl.canvas.save.ISaveData":!0}),t.isSaveMark=function(){return!1},t.restore=function(t){t._curMat=this._savematrix,SaveTransform.POOL[SaveTransform.POOL._length++]=this},SaveTransform.save=function(t){var e=t._saveMark;if(2048!=(2048&e._saveuse)){e._saveuse|=2048;var a=SaveTransform.POOL,i=a._length>0?a[--a._length]:new SaveTransform;i._savematrix=t._curMat,t._curMat=t._curMat.copyTo(i._matrix);var r=t._save;r[r._length++]=i}},SaveTransform.POOL=z._createArray(),SaveTransform}(),ot=function(){function SaveTranslate(){this._mat=new R}r(SaveTranslate,"laya.webgl.canvas.save.SaveTranslate");var t=SaveTranslate.prototype;return a.imps(t,{"laya.webgl.canvas.save.ISaveData":!0}),t.isSaveMark=function(){return!1},t.restore=function(t){this._mat.copyTo(t._curMat),SaveTranslate.POOL[SaveTranslate.POOL._length++]=this},SaveTranslate.save=function(t){var e=SaveTranslate.POOL,a=e._length>0?e[--e._length]:new SaveTranslate;t._curMat.copyTo(a._mat);var i=t._save;i[i._length++]=a},SaveTranslate.POOL=z._createArray(),SaveTranslate}(),ht=function(){var t;function CharBook(){this.fontPages=[],this.fontPagesName=[],this._curPage=null,this.tempUV=[0,0,1,0,1,1,0,1],this.fontScaleX=1,this.fontScaleY=1,this._curStrPos=0,this.tempMat=new R,CharBook.charbookInst=this,ut.charRender=p.isConchApp?new Ft:new It}r(CharBook,"laya.webgl.resource.CharBook");var e=CharBook.prototype;return e.selectFont=function(t,e){var a,i=Math.max(this.fontScaleX,this.fontScaleY),r=e*i;if(t===CharBook._lastFont&&r===CharBook._lastFontSz)a=CharBook._lastCharPage;else{var _=ut.getBmpSize(e)*i,n=t+Math.floor(_/CharBook.gridSize),s=this.fontPagesName.indexOf(n);if(s<0){var o=new ut(t,_,p.isConchApp?0:Math.ceil(e/4));this.fontPages.push(o),this.fontPagesName.push(n),a=o}else a=this.fontPages[s];a.selectSize(e,_),CharBook._lastFont=t,CharBook._lastFontSz=r,CharBook._lastCharPage=a}return a},e.isEmoji=function(t){return CharBook._emojiReg.test(t)},e.getNextChar=function(t){var e=t.length,a=this._curStrPos;if(a>=e)return null;for(var i=a,r=0;i<e;i++){var _=t.charCodeAt(i);if(55296!=(55296&_))if(65038!==_&&65039!==_){if(8205!=_){if(1==r)break;i++;break}r=1}else r=1;else r=1}return this._curStrPos=i,t.substring(a,i)},e.hasFreedText=function(t,e){if(t&&t.length>0)for(var a=e,i=t.length;a<i;a++){var r=t[a];if(r)for(var _=0,n=r.length;_<n;_++){if(r[_].ri.tex.__destroyed)return!0}}return!1},e._fast_filltext=function(t,e,a,i,r,_,n,s,o,h,l){if(void 0===l&&(l=0),!(e&&e.length<1||a&&a.length<1)){if(CharBook._curFont=_._font,this.fontScaleX=this.fontScaleY=1,CharBook.scaleFontWithCtx){var u=t.getMatScaleX(),d=t.getMatScaleY();if(u<1e-4||d<.1)return;u>1&&(this.fontScaleX=u),d>1&&(this.fontScaleY=d)}_._italic&&(t._italicDeg=12),this._curPage=this.selectFont(_._family,_._size);var f=i,D=e,m=e,C=0,E=!a&&e instanceof laya.utils.WordText,v=!!a,A=CharBook.cacheRenderInfoInWordText&&E?D.pageChars:[];switch(E?(m=D._text,(C=D.width)<0&&(C=D.width=this._curPage.getWidth(m))):C=this._curPage.getWidth(m),h){case c.ENUM_TEXTALIGN_CENTER:f=i-C/2;break;case c.ENUM_TEXTALIGN_RIGHT:f=i-C;break;default:f=i}D&&D.lastGCCnt!=this._curPage.gcCnt&&(D.lastGCCnt=this._curPage.gcCnt,E&&this.hasFreedText(A,D.startID)&&(A=D.pageChars=[]));var R=E?D.startID:0,T=E?D.startIDStroke:0;if(!A||A.length<1){var P=null;CharBook.scaleFontWithCtx&&(ut.charRender.scale(Math.max(this.fontScaleX,1),Math.max(this.fontScaleY,1)),(this.fontScaleX>1||this.fontScaleY>1)&&(P=""+(10*this.fontScaleX|0)+(10*this.fontScaleY|0))),R=-1,T=-1;var N,L=0,p=0;if(this._curStrPos=0,v){var b=a[this._curStrPos++];N=b.char,L=b.x,p=b.y}else N=this.getNextChar(m);for(var S=_._bold;N;){var x,M=this.isEmoji(N);if((x=this._curPage.getChar(N,o,_._size,n,s,S,!1,P)).isSpace);else{var y=A[x.tex.id];y||(A[x.tex.id]=y=[],(R<0||R>x.tex.id)&&(R=x.tex.id)),y.push({ri:x,isEmoji:M,x:L,y:p,color:"#"+(16777215&n).toString(16),nColor:n,w:x.bmpWidth/this.fontScaleX,h:x.bmpHeight/this.fontScaleY})}v?(b=a[this._curStrPos++])?(N=b.char,L=b.x,p=b.y):N=null:(N=this.getNextChar(m),L+=x.width)}E&&(D.startID=R,D.startIDStroke=T)}this._drawResortedWords(t,f,A,R,r),t._italicDeg=0}},e.fillWords=function(t,e,a,i,r,_,n,s){if(e&&!(e.length<=0)){var o=l.create(_).numColor,h=n?l.create(n).numColor:0;CharBook._curFont=r;var u=C.Parse(r);this._fast_filltext(t,null,e,a,i,u,o,h,s,0,0)}},e.filltext=function(t,e,a,i,r,_,n,s,o,h){if(void 0===h&&(h=0),!(e.length<=0)){var u=l.create(_).numColor,d=n?l.create(n).numColor:0;CharBook._curFont=r;var f=C.Parse(r),D=0;switch(o){case"center":D=c.ENUM_TEXTALIGN_CENTER;break;case"right":D=c.ENUM_TEXTALIGN_RIGHT}this._fast_filltext(t,e,null,a,i,f,u,d,s,D,h)}},e.filltext_native=function(t,e,a,i,r,_,n,s,o,h,u){if(void 0===u&&(u=0),!(e&&e.length<=0)){var c=l.create(n).numColor,d=s?l.create(s).numColor:0;if(CharBook._curFont=_,this.fontScaleX=this.fontScaleY=1,CharBook.scaleFontWithCtx){var f=t._curMat.getScaleX(),D=t._curMat.getScaleY();if(f<1e-4||D<.1)return;this.fontScaleX=f,this.fontScaleY=D,ut.charRender.scale(this.fontScaleX,this.fontScaleY)}var m=C.Parse(_),E=m._family,v=m._bold;m._italic&&(t._italicDeg=12),this._curPage=this.selectFont(E,m._size*this.fontScaleX);var A=i,R=e,T=e,P=0,N=!a&&T instanceof laya.utils.WordText,L=!!a,p=CharBook.cacheRenderInfoInWordText&&N?R.pageChars:[];switch(N?(T=R.toString(),(P=R.width)<0&&(P=R.width=this._curPage.getWidth(T))):P=this._curPage.getWidth(T),h){case"center":A=i-P/2;break;case"right":A=i-P;break;default:A=i}if(p){for(var b=!1,S=0,x=p.length;S<x;S++){var M=p[S];if(M){for(var y=0,O=M.length;y<O;y++){if(M[y].ri.tex.__destroyed){b=!0;break}}if(b)break}}b&&(p=R.pageChars=[])}if(!p||p.length<=0){var g=null;CharBook.scaleFontWithCtx&&(ut.charRender.scale(Math.max(this.fontScaleX,1),Math.max(this.fontScaleY,1)),(this.fontScaleX>1||this.fontScaleY>1)&&(g=""+(10*this.fontScaleX|0)+(10*this.fontScaleY|0)));var B,w=0,I=0;if(this._curStrPos=0,L){var F=a[this._curStrPos++];B=F.char,w=F.x,I=F.y}else B=this.getNextChar(T);for(v=m._bold;B;){var G,W=this.isEmoji(B);if((G=this._curPage.getChar(B,o,m._size,c,d,v,!1,g)).isSpace);else{var V=p[G.tex.id];V||(p[G.tex.id]=V=[]),V.push({ri:G,isEmoji:W,x:w,y:I,color:n,nColor:c})}L?(F=a[this._curStrPos++])?(B=F.char,w=F.x,I=F.y):B=null:(w+=G.width,B=this.getNextChar(T))}}var U=t._drawTextureUseColor;this._drawResortedWords_native(t,A,p,r),t._drawTextureUseColor=U,t._italicDeg=0}},e._drawResortedWords=function(t,e,a,i,r){var _=t.getFillColor();t.setFillColor(t.mixRGBandAlpha(16777215)),e-=this._curPage.margin_left,r-=this._curPage.margin_top;for(var n=i,s=a.length;n<s;n++){var o=a[n];if(o){var h=o.length;if(!(h<=0)){t._useNewTex2DSubmit(o[0].ri.tex.texture,4*h);for(var l=0;l<h;l++){var u=o[l],c=u.ri;c.isSpace||(c.touch(),t._drawTexRect(e+u.x,r+u.y,u.w,u.h,c.uv),t.touches&&t.touches.push(c))}}}}t.setFillColor(_),t._curSubmit._key.other=-1},e._drawResortedWords_native=function(t,e,a,i){for(var r=0,_=0,n=a.length;_<n;_++){var s=a[_];if(s)for(var o=0,h=s.length;o<h;o++){var l=s[o],u=l.ri;u.isSpace||(t._drawTextureUseColor=!CharBook.getFontBmpWithColor&&!l.isEmoji,r!=l.nColor&&(t.fillStyle=l.color,r=l.nColor),u.touch(),this._drawCharRenderInfo(t,l.ri,e+l.x,l.y+i))}}},e._drawCharRenderInfo=function(t,e,a,i){t._drawTextureM(e.tex.texture,a-this._curPage.margin_left,i-this._curPage.margin_top,e.bmpWidth,e.bmpHeight,null,1,e.uv),t.touches&&t.touches.push(e)},e.GC=function(){var t=this.fontPages.length;if(t){var e=I.loopCount%t;this.fontPages[e].removeLRU()}},CharBook.textureWidth=512,CharBook.cacheRenderInfoInWordText=!0,CharBook.scaleFontWithCtx=!0,CharBook.getFontBmpWithColor=!0,CharBook.gridSize=16,CharBook.debug=!1,CharBook._curFont=null,CharBook.charbookInst=null,CharBook._fontMem=0,CharBook._lastFont=null,CharBook._lastFontSz=0,CharBook._lastCharPage=null,CharBook.isWan1Wan=!1,i(CharBook,["_emojiReg",function(){return this._emojiReg=/(?:0\u20E3|1\u20E3|2\u20E3|3\u20E3|4\u20E3|5\u20E3|6\u20E3|7\u20E3|8\u20E3|9\u20E3|#\u20E3|\*\u20E3|\uD83C(?:\uDDE6\uD83C(?:\uDDE8|\uDDE9|\uDDEA|\uDDEB|\uDDEC|\uDDEE|\uDDF1|\uDDF2|\uDDF4|\uDDF6|\uDDF7|\uDDF8|\uDDF9|\uDDFA|\uDDFC|\uDDFD|\uDDFF)|\uDDE7\uD83C(?:\uDDE6|\uDDE7|\uDDE9|\uDDEA|\uDDEB|\uDDEC|\uDDED|\uDDEE|\uDDEF|\uDDF1|\uDDF2|\uDDF3|\uDDF4|\uDDF6|\uDDF7|\uDDF8|\uDDF9|\uDDFB|\uDDFC|\uDDFE|\uDDFF)|\uDDE8\uD83C(?:\uDDE6|\uDDE8|\uDDE9|\uDDEB|\uDDEC|\uDDED|\uDDEE|\uDDF0|\uDDF1|\uDDF2|\uDDF3|\uDDF4|\uDDF5|\uDDF7|\uDDFA|\uDDFB|\uDDFC|\uDDFD|\uDDFE|\uDDFF)|\uDDE9\uD83C(?:\uDDEA|\uDDEC|\uDDEF|\uDDF0|\uDDF2|\uDDF4|\uDDFF)|\uDDEA\uD83C(?:\uDDE6|\uDDE8|\uDDEA|\uDDEC|\uDDED|\uDDF7|\uDDF8|\uDDF9|\uDDFA)|\uDDEB\uD83C(?:\uDDEE|\uDDEF|\uDDF0|\uDDF2|\uDDF4|\uDDF7)|\uDDEC\uD83C(?:\uDDE6|\uDDE7|\uDDE9|\uDDEA|\uDDEB|\uDDEC|\uDDED|\uDDEE|\uDDF1|\uDDF2|\uDDF3|\uDDF5|\uDDF6|\uDDF7|\uDDF8|\uDDF9|\uDDFA|\uDDFC|\uDDFE)|\uDDED\uD83C(?:\uDDF0|\uDDF2|\uDDF3|\uDDF7|\uDDF9|\uDDFA)|\uDDEE\uD83C(?:\uDDE8|\uDDE9|\uDDEA|\uDDF1|\uDDF2|\uDDF3|\uDDF4|\uDDF6|\uDDF7|\uDDF8|\uDDF9)|\uDDEF\uD83C(?:\uDDEA|\uDDF2|\uDDF4|\uDDF5)|\uDDF0\uD83C(?:\uDDEA|\uDDEC|\uDDED|\uDDEE|\uDDF2|\uDDF3|\uDDF5|\uDDF7|\uDDFC|\uDDFE|\uDDFF)|\uDDF1\uD83C(?:\uDDE6|\uDDE7|\uDDE8|\uDDEE|\uDDF0|\uDDF7|\uDDF8|\uDDF9|\uDDFA|\uDDFB|\uDDFE)|\uDDF2\uD83C(?:\uDDE6|\uDDE8|\uDDE9|\uDDEA|\uDDEB|\uDDEC|\uDDED|\uDDF0|\uDDF1|\uDDF2|\uDDF3|\uDDF4|\uDDF5|\uDDF6|\uDDF7|\uDDF8|\uDDF9|\uDDFA|\uDDFB|\uDDFC|\uDDFD|\uDDFE|\uDDFF)|\uDDF3\uD83C(?:\uDDE6|\uDDE8|\uDDEA|\uDDEB|\uDDEC|\uDDEE|\uDDF1|\uDDF4|\uDDF5|\uDDF7|\uDDFA|\uDDFF)|\uDDF4\uD83C\uDDF2|\uDDF5\uD83C(?:\uDDE6|\uDDEA|\uDDEB|\uDDEC|\uDDED|\uDDF0|\uDDF1|\uDDF2|\uDDF3|\uDDF7|\uDDF8|\uDDF9|\uDDFC|\uDDFE)|\uDDF6\uD83C\uDDE6|\uDDF7\uD83C(?:\uDDEA|\uDDF4|\uDDF8|\uDDFA|\uDDFC)|\uDDF8\uD83C(?:\uDDE6|\uDDE7|\uDDE8|\uDDE9|\uDDEA|\uDDEC|\uDDED|\uDDEE|\uDDEF|\uDDF0|\uDDF1|\uDDF2|\uDDF3|\uDDF4|\uDDF7|\uDDF8|\uDDF9|\uDDFB|\uDDFD|\uDDFE|\uDDFF)|\uDDF9\uD83C(?:\uDDE6|\uDDE8|\uDDE9|\uDDEB|\uDDEC|\uDDED|\uDDEF|\uDDF0|\uDDF1|\uDDF2|\uDDF3|\uDDF4|\uDDF7|\uDDF9|\uDDFB|\uDDFC|\uDDFF)|\uDDFA\uD83C(?:\uDDE6|\uDDEC|\uDDF2|\uDDF8|\uDDFE|\uDDFF)|\uDDFB\uD83C(?:\uDDE6|\uDDE8|\uDDEA|\uDDEC|\uDDEE|\uDDF3|\uDDFA)|\uDDFC\uD83C(?:\uDDEB|\uDDF8)|\uDDFD\uD83C\uDDF0|\uDDFE\uD83C(?:\uDDEA|\uDDF9)|\uDDFF\uD83C(?:\uDDE6|\uDDF2|\uDDFC)))|[\xA9\xAE\u203C\u2049\u2122\u2139\u2194-\u2199\u21A9\u21AA\u231A\u231B\u2328\u23CF\u23E9-\u23F3\u23F8-\u23FA\u24C2\u25AA\u25AB\u25B6\u25C0\u25FB-\u25FE\u2600-\u2604\u260E\u2611\u2614\u2615\u2618\u261D\u2620\u2622\u2623\u2626\u262A\u262E\u262F\u2638-\u263A\u2648-\u2653\u2660\u2663\u2665\u2666\u2668\u267B\u267F\u2692-\u2694\u2696\u2697\u2699\u269B\u269C\u26A0\u26A1\u26AA\u26AB\u26B0\u26B1\u26BD\u26BE\u26C4\u26C5\u26C8\u26CE\u26CF\u26D1\u26D3\u26D4\u26E9\u26EA\u26F0-\u26F5\u26F7-\u26FA\u26FD\u2702\u2705\u2708-\u270D\u270F\u2712\u2714\u2716\u271D\u2721\u2728\u2733\u2734\u2744\u2747\u274C\u274E\u2753-\u2755\u2757\u2763\u2764\u2795-\u2797\u27A1\u27B0\u27BF\u2934\u2935\u2B05-\u2B07\u2B1B\u2B1C\u2B50\u2B55\u3030\u303D\u3297\u3299]|\uD83C[\uDC04\uDCCF\uDD70\uDD71\uDD7E\uDD7F\uDD8E\uDD91-\uDD9A\uDE01\uDE02\uDE1A\uDE2F\uDE32-\uDE3A\uDE50\uDE51\uDF00-\uDF21\uDF24-\uDF93\uDF96\uDF97\uDF99-\uDF9B\uDF9E-\uDFF0\uDFF3-\uDFF5\uDFF7-\uDFFF]|\uD83D[\uDC00-\uDCFD\uDCFF-\uDD3D\uDD49-\uDD4E\uDD50-\uDD67\uDD6F\uDD70\uDD73-\uDD79\uDD87\uDD8A-\uDD8D\uDD90\uDD95\uDD96\uDDA5\uDDA8\uDDB1\uDDB2\uDDBC\uDDC2-\uDDC4\uDDD1-\uDDD3\uDDDC-\uDDDE\uDDE1\uDDE3\uDDEF\uDDF3\uDDFA-\uDE4F\uDE80-\uDEC5\uDECB-\uDED0\uDEE0-\uDEE5\uDEE9\uDEEB\uDEEC\uDEF0\uDEF3]|\uD83E[\uDD10-\uDD18\uDD80-\uDD84\uDDC0]/g},"_uint32",function(){return this._uint32=new Uint32Array(1)},"trash",function(){return this.trash=new t(CharBook.textureWidth)}]),CharBook.__init$=function(){t=function(){function charPageTrash(t){this.poolLen=0,this.cleanTm=0,this.texW=0,this.pool=new Array(10),this.texW=t}r(charPageTrash,"");var t=charPageTrash.prototype;return t.getAPage=function(t){if(this.poolLen>0){var e=this.pool[--this.poolLen];return e.setGridNum(t),this.poolLen>0&&this.clean(),e}return new Ht(this.texW,this.texW,t)},t.discardPage=function(t){this.clean(),t&&(this.poolLen>=this.pool.length&&(this.pool=this.pool.concat(new Array(10))),t.reset(),this.pool[this.poolLen++]=t)},t.clean=function(){var t=a.stage.getFrameTm();if(0===this.cleanTm&&(this.cleanTm=t),t-this.cleanTm>3e4){for(var e=0;e<this.poolLen;e++){var i=this.pool[e];t-i._discardTm>2e4&&(i.destroy(),this.pool[e]=this.pool[this.poolLen-1],this.poolLen--,e--)}this.cleanTm=t}},charPageTrash}()},CharBook}(),lt=function(){function CharInternalTexture(t){this._par=null,this._loaded=!0,this.bitmap={},this.bitmap.id=t.id,this._par=t}return r(CharInternalTexture,"laya.webgl.resource.CharInternalTexture"),CharInternalTexture.prototype._getSource=function(){return this._par._source},CharInternalTexture}(),ut=function(){function CharPages(t,e,a){this.pages=[],this.fontFamily=null,this._slotW=0,this._gridW=0,this._gridNum=0,this._baseSize=0,this._lastSz=0,this._spaceWidthMap=[],this._minScoreID=-1,this._selectedSizeIdx=0,this.margin_left=0,this.margin_top=0,this.margin_bottom=0,this.margin_right=0,this.gcCnt=0,this._textureWidth=ht.textureWidth,this.fontFamily=t,this.margin_top=this.margin_left=this.margin_right=this.margin_bottom=a,this._baseSize=Math.floor(e/ht.gridSize)*ht.gridSize,this._selectedSizeIdx=e-this._baseSize|0,this._slotW=Math.ceil(e/ht.gridSize)*ht.gridSize,this._gridW=Math.floor(this._textureWidth/this._slotW),this._gridW<=0&&console.error(",texture"),this._gridNum=this._gridW*this._gridW,console.log("gridInfo:slotW="+this._slotW+",gridw="+this._gridW+",gridNum="+this._gridNum+",textureW="+this._textureWidth)}r(CharPages,"laya.webgl.resource.CharPages");var t=CharPages.prototype;return t.getWidth=function(t){return CharPages.charRender.getWidth(t)},t.selectSize=function(t,e){this._selectedSizeIdx=e-this._baseSize|0},t.getSpaceChar=function(t){if(this._spaceWidthMap[this._selectedSizeIdx])return this._spaceWidthMap[this._selectedSizeIdx];var e=new ct;return this._spaceWidthMap[this._selectedSizeIdx]=e,e.width=this.getWidth(" "),e.isSpace=!0,e},t.getChar=function(t,e,a,i,r,_,n,s){if(" "===t)return this.getSpaceChar(n);var o,h=e>0?t+"_"+e+r:t;i&=16777215,r&=16777215,ht.getFontBmpWithColor&&(h+=16777215===i?"#w":16711680===i?"#b":1048320===i?"#g":255===i?"#r":"#"+i.toString(16)),_&&(h+="B"),s&&(h+=s);for(var l=0,u=this.pages.length;l<u;l++){var c=this.pages[l].charMaps[this._selectedSizeIdx];if(c&&(o=c.get(h)))return n&&o.touch(),o}o=new ct,this._getASlot(o);var d=o.tex.charMaps[this._selectedSizeIdx];!d&&(d=o.tex.charMaps[this._selectedSizeIdx]=new Map),d.set(h,o),n&&o.touch();var f="",D="";ht.getFontBmpWithColor&&(f=((65280&i)+((255&i)<<16)+((16711680&i)>>16)).toString(16),f="#000000".substr(0,7-f.length)+f,e&&(D=((65280&r)+((255&r)<<16)+((16711680&r)>>16)).toString(16),D="#000000".substr(0,7-D.length)+D)),o.height=a;var m=this.getCharBmp(t,ht._curFont,e,f,D,o);o.bmpWidth=m.width,o.bmpHeight=m.height;var C=Math.floor(o.pos/this._gridW),E=o.pos%this._gridW*this._slotW,v=C*this._slotW,A=this._textureWidth,R=E/A,T=v/A,P=(E+m.width)/A,N=(v+m.height)/A,L=o.uv;return L[0]=R,L[1]=T,L[2]=P,L[3]=T,L[4]=P,L[5]=N,L[6]=R,L[7]=N,o.tex.addChar(m,E,v),o},t._getASlot=function(t){for(var e,a=this.pages.length,i=0,r=0;r<a;r++)if((i=(e=this.pages[r]).findAGrid())>=0)return t.tex=e,void(t.pos=i);if(e=ht.trash.getAPage(this._gridNum),this.pages.push(e),-1==(i=e.findAGrid()))throw"_getASlot error!";t.tex=e,t.pos=i},t.getAllPageScore=function(){for(var t=0,e=this.pages.length,a=I.loopCount,i=0,r=1e4;t<e;t++){var _=this.pages[t];_._scoreTick==a?i+=_._score:_._score=0,_._score<r&&(r=_._score,this._minScoreID=t)}return i},t.removeLRU=function(){var t;if(this._gridNum*this.pages.length-this.getAllPageScore()>=this._gridNum){if(this._minScoreID>=0){console.log("remove font page "+this._minScoreID);var e=(t=this.pages[this._minScoreID])._score;ht.trash.discardPage(t),this.pages[this._minScoreID]=this.pages[this.pages.length-1],this.pages.pop();for(var a=I.loopCount,i=0,r=this.pages.length;i<r&&e>0;i++){e-=(t=this.pages[i]).removeOld(a)}}return this.gcCnt++,!0}return!1},t.getCharBmp=function(t,e,a,i,r,_){return CharPages.charRender.getCharBmp(t,e,a,i,r,_,this.margin_left,this.margin_top,this.margin_right,this.margin_bottom)},CharPages.getBmpSize=function(t){return 1.5*t},CharPages.charRender=null,CharPages}(),ct=function(){function CharRenderInfo(){this.tex=null,this.uv=[0,0,1,1],this.pos=0,this.width=0,this.height=0,this.bmpWidth=0,this.bmpHeight=0,this.touchTick=0,this.isSpace=!1}return r(CharRenderInfo,"laya.webgl.resource.CharRenderInfo"),CharRenderInfo.prototype.touch=function(){var t=I.loopCount;this.tex._scoreTick!=t&&(this.tex._score=0,this.tex._scoreTick=t),this.touchTick!=t&&this.tex._score++,this.touchTick=t},CharRenderInfo}(),dt=function(){function ICharRender(){}r(ICharRender,"laya.webgl.resource.ICharRender");var t=ICharRender.prototype;return t.getWidth=function(t){return 0},t.scale=function(t,e){},t.getCharBmp=function(t,e,a,i,r,_,n,s,o,h){return null},ICharRender}(),ft=function(){function WebGLRTMgr(){}return r(WebGLRTMgr,"laya.webgl.resource.WebGLRTMgr"),WebGLRTMgr.getRT=function(t,e){e|=0,(t|=0)>=1e4&&console.error("getRT error! w too big");var a,i=1e4*e+t,r=WebGLRTMgr.dict[i];return r&&r.length>0?((a=r.pop())._mgrKey=i,a):((a=new $t(t,e,1,-1))._mgrKey=i,a)},WebGLRTMgr.releaseRT=function(t){if(!(t._mgrKey<=0)){var e=WebGLRTMgr.dict[t._mgrKey];!e&&(e=[],WebGLRTMgr.dict[t._mgrKey]=e),t._mgrKey=0,e.push(t)}},WebGLRTMgr.dict={},WebGLRTMgr}(),Dt=function(){function Shader2D(){this.ALPHA=1,this.shaderType=0,this.defines=new Gt,this.fillStyle=it.DEFAULT,this.strokeStyle=it.DEFAULT}return r(Shader2D,"laya.webgl.shader.d2.Shader2D"),Shader2D.prototype.destroy=function(){this.defines=null,this.filters=null},Shader2D.__init__=function(){var t,e;t="/*\n\ttexturefillrect\n*/\nattribute vec4 posuv;\nattribute vec4 attribColor;\nattribute vec4 attribFlags;\n//attribute vec4 clipDir;\n//attribute vec2 clipRect;\nuniform vec4 clipMatDir;\nuniform vec2 clipMatPos;\nvarying vec2 cliped;\nuniform vec2 size;\n\n#ifdef WORLDMAT\n\tuniform mat4 mmat;\n#endif\n\nvarying vec4 v_texcoordAlpha;\nvarying vec4 v_color;\nvarying float v_useTex;\n\nvoid main() {\n\n#ifdef WORLDMAT\n\tvec4 pos=mmat*vec4(posuv.xy,0.,1.);\n\tgl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,0.,1.0);\n#else\n\tgl_Position =vec4((posuv.x/size.x-0.5)*2.0,(0.5-posuv.y/size.y)*2.0,0.,1.0);\n#endif\n  \n\tv_texcoordAlpha.xy = posuv.zw;\n\t//v_texcoordAlpha.z = attribColor.a/255.0;\n\tv_color = attribColor/255.0;\n\tv_color.xyz*=v_color.w;//\n\t\n\tv_useTex = attribFlags.r/255.0;\n\tfloat clipw = length(clipMatDir.xy);\n\tfloat cliph = length(clipMatDir.zw);\n\tvec2 clippos = posuv.xy - clipMatPos.xy;\t//posclip\n\tif(clipw>20000. && cliph>20000.)\n\t\tcliped = vec2(0.5,0.5);\n\telse {\n\t\t//01/clipw/clipw clipposnormalizeclipclipw\n\t\tcliped=vec2( dot(clippos,clipMatDir.xy)/clipw/clipw, dot(clippos,clipMatDir.zw)/cliph/cliph);\n\t}\n\n}",e="/*\n\ttexturefillrect\n*/\n\nprecision mediump float;\n//precision highp float;\nvarying vec4 v_texcoordAlpha;\nvarying vec4 v_color;\nvarying float v_useTex;\nuniform sampler2D texture;\nvarying vec2 cliped;\n\n#ifdef BLUR_FILTER\nuniform vec4 strength_sig2_2sig2_gauss1;\nuniform vec2 blurInfo;\n\n#define PI 3.141593\n\nfloat getGaussian(float x, float y){\n    return strength_sig2_2sig2_gauss1.w*exp(-(x*x+y*y)/strength_sig2_2sig2_gauss1.z);\n}\n\nvec4 blur(){\n    const float blurw = 9.0;\n    vec4 vec4Color = vec4(0.0,0.0,0.0,0.0);\n    vec2 halfsz=vec2(blurw,blurw)/2.0/blurInfo;    \n    vec2 startpos=v_texcoordAlpha.xy-halfsz;\n    vec2 ctexcoord = startpos;\n    vec2 step = 1.0/blurInfo;  //      \n    \n    for(float y = 0.0;y<=blurw; ++y){\n        ctexcoord.x=startpos.x;\n        for(float x = 0.0;x<=blurw; ++x){\n            //TODO vs\n            vec4Color += texture2D(texture, ctexcoord)*getGaussian(x-blurw/2.0,y-blurw/2.0);\n            ctexcoord.x+=step.x;\n        }\n        ctexcoord.y+=step.y;\n    }\n    return vec4Color;\n}\n#endif\n\n#ifdef COLOR_FILTER\nuniform vec4 colorAlpha;\nuniform mat4 colorMat;\n#endif\n\n#ifdef GLOW_FILTER\nuniform vec4 u_color;\nuniform vec4 u_blurInfo1;\nuniform vec4 u_blurInfo2;\n#endif\n\n#ifdef COLOR_ADD\nuniform vec4 colorAdd;\n#endif\n\n//FILLTEXTURE\nuniform vec4 u_TexRange;//startu,startv,urange, vrange\n\nvoid main() {\n\tif(cliped.x<0.) discard;\n\tif(cliped.x>1.) discard;\n\tif(cliped.y<0.) discard;\n\tif(cliped.y>1.) discard;\n\t\n#ifdef FILLTEXTURE\t\n   vec4 color= texture2D(texture, fract(v_texcoordAlpha.xy)*u_TexRange.zw + u_TexRange.xy);\n#else\n   vec4 color= texture2D(texture, v_texcoordAlpha.xy);\n#endif\n\n   if(v_useTex<=0.)color = vec4(1.,1.,1.,1.);\n   color.a*=v_color.w;\n   //color.rgb*=v_color.w;\n   color.rgb*=v_color.rgb;\n   gl_FragColor=color;\n   \n   #ifdef COLOR_ADD\n\tgl_FragColor = vec4(colorAdd.rgb,colorAdd.a*gl_FragColor.a);\n\tgl_FragColor.xyz *= colorAdd.a;\n   #endif\n   \n   #ifdef BLUR_FILTER\n\tgl_FragColor =   blur();\n\tgl_FragColor.w*=v_color.w;   \n   #endif\n   \n   #ifdef COLOR_FILTER\n\tmat4 alphaMat =colorMat;\n\n\talphaMat[0][3] *= gl_FragColor.a;\n\talphaMat[1][3] *= gl_FragColor.a;\n\talphaMat[2][3] *= gl_FragColor.a;\n\n\tgl_FragColor = gl_FragColor * alphaMat;\n\tgl_FragColor += colorAlpha/255.0*gl_FragColor.a;\n   #endif\n   \n   #ifdef GLOW_FILTER\n\tconst float c_IterationTime = 10.0;\n\tfloat floatIterationTotalTime = c_IterationTime * c_IterationTime;\n\tvec4 vec4Color = vec4(0.0,0.0,0.0,0.0);\n\tvec2 vec2FilterDir = vec2(-(u_blurInfo1.z)/u_blurInfo2.x,-(u_blurInfo1.w)/u_blurInfo2.y);\n\tvec2 vec2FilterOff = vec2(u_blurInfo1.x/u_blurInfo2.x/c_IterationTime * 2.0,u_blurInfo1.y/u_blurInfo2.y/c_IterationTime * 2.0);\n\tfloat maxNum = u_blurInfo1.x * u_blurInfo1.y;\n\tvec2 vec2Off = vec2(0.0,0.0);\n\tfloat floatOff = c_IterationTime/2.0;\n\tfor(float i = 0.0;i<=c_IterationTime; ++i){\n\t\tfor(float j = 0.0;j<=c_IterationTime; ++j){\n\t\t\tvec2Off = vec2(vec2FilterOff.x * (i - floatOff),vec2FilterOff.y * (j - floatOff));\n\t\t\tvec4Color += texture2D(texture, v_texcoordAlpha.xy + vec2FilterDir + vec2Off)/floatIterationTotalTime;\n\t\t}\n\t}\n\tgl_FragColor = vec4(u_color.rgb,vec4Color.a * u_blurInfo2.z);\n\tgl_FragColor.rgb *= gl_FragColor.a;   \n   #endif\n   \n}",Kt.preCompile2D(0,1,t,e,null),t="attribute vec4 position;\nattribute vec4 attribColor;\n//attribute vec4 clipDir;\n//attribute vec2 clipRect;\nuniform vec4 clipMatDir;\nuniform vec2 clipMatPos;\n#ifdef WORLDMAT\n\tuniform mat4 mmat;\n#endif\nuniform mat4 u_mmat2;\n//uniform vec2 u_pos;\nuniform vec2 size;\nvarying vec4 color;\n//vec4 dirxy=vec4(0.9,0.1, -0.1,0.9);\n//vec4 clip=vec4(100.,30.,300.,600.);\nvarying vec2 cliped;\nvoid main(){\n\t\n#ifdef WORLDMAT\n\tvec4 pos=mmat*vec4(position.xy,0.,1.);\n\tgl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n#else\n\tgl_Position =vec4((position.x/size.x-0.5)*2.0,(0.5-position.y/size.y)*2.0,position.z,1.0);\n#endif\t\n\tfloat clipw = length(clipMatDir.xy);\n\tfloat cliph = length(clipMatDir.zw);\n\tvec2 clippos = position.xy - clipMatPos.xy;\t//posclip\n\tif(clipw>20000. && cliph>20000.)\n\t\tcliped = vec2(0.5,0.5);\n\telse {\n\t\t//clipdirclipposnormalize\n\t\tcliped=vec2( dot(clippos,clipMatDir.xy)/clipw/clipw, dot(clippos,clipMatDir.zw)/cliph/cliph);\n\t}\n  //pos2d.x = dot(clippos,dirx);\n  color=attribColor/255.;\n}",e="precision mediump float;\n//precision mediump float;\nvarying vec4 color;\n//uniform float alpha;\nvarying vec2 cliped;\nvoid main(){\n\t//vec4 a=vec4(color.r, color.g, color.b, 1);\n\t//a.a*=alpha;\n    gl_FragColor= color;// vec4(color.r, color.g, color.b, alpha);\n\tgl_FragColor.rgb*=color.a;\n\tif(cliped.x<0.) discard;\n\tif(cliped.x>1.) discard;\n\tif(cliped.y<0.) discard;\n\tif(cliped.y>1.) discard;\n}",Kt.preCompile2D(0,4,t,e,null),t="/*\n\ttexturefillrect\n*/\nattribute vec4 posuv;\nattribute vec4 attribColor;\nattribute vec4 attribFlags;\n//attribute vec4 clipDir;\n//attribute vec2 clipRect;\nuniform vec4 clipMatDir;\nuniform vec2 clipMatPos;\nvarying vec2 cliped;\nuniform vec2 size;\n\n#ifdef WORLDMAT\n\tuniform mat4 mmat;\n#endif\n\nvarying vec4 v_texcoordAlpha;\nvarying vec4 v_color;\nvarying float v_useTex;\n\nvoid main() {\n\n#ifdef WORLDMAT\n\tvec4 pos=mmat*vec4(posuv.xy,0.,1.);\n\tgl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,0.,1.0);\n#else\n\tgl_Position =vec4((posuv.x/size.x-0.5)*2.0,(0.5-posuv.y/size.y)*2.0,0.,1.0);\n#endif\n  \n\tv_texcoordAlpha.xy = posuv.zw;\n\t//v_texcoordAlpha.z = attribColor.a/255.0;\n\tv_color = attribColor/255.0;\n\tv_color.xyz*=v_color.w;//\n\t\n\tv_useTex = attribFlags.r/255.0;\n\tfloat clipw = length(clipMatDir.xy);\n\tfloat cliph = length(clipMatDir.zw);\n\tvec2 clippos = posuv.xy - clipMatPos.xy;\t//posclip\n\tif(clipw>20000. && cliph>20000.)\n\t\tcliped = vec2(0.5,0.5);\n\telse {\n\t\t//01/clipw/clipw clipposnormalizeclipclipw\n\t\tcliped=vec2( dot(clippos,clipMatDir.xy)/clipw/clipw, dot(clippos,clipMatDir.zw)/cliph/cliph);\n\t}\n\n}",e='#ifdef FSHIGHPRECISION\n\tprecision highp float;\n#else\n\tprecision mediump float;\n#endif\n\n//precision highp float;\nvarying vec2 v_texcoord;\nuniform sampler2D texture;\nuniform float alpha;\nuniform vec4 u_TexRange;\nuniform vec2 u_offset;\n\n#import?BLUR_FILTER  "parts/BlurFilter_ps_uniform.glsl";\n\n#import?COLOR_FILTER "parts/ColorFilter.glsl" with ColorFilter_ps_uniform;\n\n#import?GLOW_FILTER "parts/GlowFilter_ps_uniform.glsl";\n\n#import?COLOR_ADD "parts/ColorAdd.glsl" with ColorAdd_ps_uniform;\n\nvoid main() {\n   vec2 newTexCoord;\n   newTexCoord.x = mod(u_offset.x + v_texcoord.x,u_TexRange.y) + u_TexRange.x;\n   newTexCoord.y = mod(u_offset.y + v_texcoord.y,u_TexRange.w) + u_TexRange.z;\n   vec4 color= texture2D(texture, newTexCoord);\n   color.a*=alpha;\n   gl_FragColor=color;\n   \n   #import?COLOR_ADD "parts/ColorAdd.glsl" with ColorAdd_ps_logic;\n   \n   #import?BLUR_FILTER  "parts/BlurFilter_ps_logic.glsl";\n   \n   #import?COLOR_FILTER "parts/ColorFilter.glsl" with ColorFilter_ps_logic;\n   \n   #import?GLOW_FILTER "parts/GlowFilter_ps_logic.glsl";\n}',Kt.preCompile2D(0,256,t,e,null),t="attribute vec2 position;\nattribute vec2 texcoord;\nattribute vec4 color;\nuniform vec2 size;\nuniform float offsetX;\nuniform float offsetY;\nuniform mat4 mmat;\nuniform mat4 u_mmat2;\nvarying vec2 v_texcoord;\nvarying vec4 v_color;\nvoid main() {\n  vec4 pos=mmat*u_mmat2*vec4(offsetX+position.x,offsetY+position.y,0,1 );\n  gl_Position = vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n  v_color = color;\n  v_color.rgb *= v_color.a;\n  v_texcoord = texcoord;  \n}",e="precision mediump float;\nvarying vec2 v_texcoord;\nvarying vec4 v_color;\nuniform sampler2D texture;\nuniform float alpha;\nvoid main() {\n\tvec4 t_color = texture2D(texture, v_texcoord);\n\tgl_FragColor = t_color.rgba * v_color;\n\tgl_FragColor *= alpha;\n}",Kt.preCompile2D(0,512,t,e,null)},Shader2D}(),mt=function(){function ShaderDefinesBase(t,e,a){this._value=0,this._name2int=t,this._int2name=e,this._int2nameMap=a}r(ShaderDefinesBase,"laya.webgl.shader.ShaderDefinesBase");var t=ShaderDefinesBase.prototype;return t.add=function(t){return"string"==typeof t&&(t=this._name2int[t]),this._value|=t,this._value},t.addInt=function(t){return this._value|=t,this._value},t.remove=function(t){return"string"==typeof t&&(t=this._name2int[t]),this._value&=~t,this._value},t.isDefine=function(t){return(this._value&t)===t},t.getValue=function(){return this._value},t.setValue=function(t){this._value=t},t.toNameDic=function(){var t=this._int2nameMap[this._value];return t||ShaderDefinesBase._toText(this._value,this._int2name,this._int2nameMap)},ShaderDefinesBase._reg=function(t,e,a,i){a[t]=e,i[e]=t},ShaderDefinesBase._toText=function(t,e,a){var i=a[t];if(i)return i;for(var r={},_=1,n=0;n<32&&!((_=1<<n)>t);n++)if(t&_){var s=e[_];s&&(r[s]="")}return a[t]=r,r},ShaderDefinesBase._toInt=function(t,e){for(var a=t.split("."),i=0,r=0,_=a.length;r<_;r++){var n=e[a[r]];if(!n)throw new Error("Defines to int err:"+t+"/"+a[r]);i|=n}return i},ShaderDefinesBase}(),Ct=function(){function SkinMeshBuffer(){this.ib=null,this.vb=null;xt.mainContext;this.ib=ee.create(35048),this.vb=ae.create(8)}r(SkinMeshBuffer,"laya.webgl.shader.d2.skinAnishader.SkinMeshBuffer");var t=SkinMeshBuffer.prototype;return t.addSkinMesh=function(t){t.getData2(this.vb,this.ib,this.vb._byteLength/32)},t.reset=function(){this.vb.clear(),this.ib.clear()},SkinMeshBuffer.getInstance=function(){return SkinMeshBuffer.instance=SkinMeshBuffer.instance||new SkinMeshBuffer},SkinMeshBuffer.instance=null,SkinMeshBuffer}(),Et=(function(){function ShaderValue(){}r(ShaderValue,"laya.webgl.shader.ShaderValue")}(),function(){function BasePoly(){}return r(BasePoly,"laya.webgl.shapes.BasePoly"),BasePoly.createLine2=function(t,e,a,i,r,_){if(t.length<4)return null;var n=BasePoly.tempData.length>t.length+2?BasePoly.tempData:new Array(t.length+2);n[0]=t[0],n[1]=t[1];var s=2,o=0,h=t.length;for(o=2;o<h;o+=2)Math.abs(t[o]-t[o-2])+Math.abs(t[o+1]-t[o-1])>.01&&(n[s++]=t[o],n[s++]=t[o+1]);_&&Math.abs(t[0]-n[s-2])+Math.abs(t[1]-n[s-1])>.01&&(n[s++]=t[0],n[s++]=t[1]);var l=r;h=s/2;var u,c,d,f,D,m,C,E,v,A,R,T,P,N,L,p,b,S,x,M,y=a/2;for(d=n[0],f=n[1],A=d-(D=n[2]),v=(v=-(f-(m=n[3])))/(M=Math.sqrt(v*v+A*A))*y,A=A/M*y,l.push(d-v,f-A,d+v,f+A),o=1;o<h-1;o++)d=n[2*(o-1)],f=n[2*(o-1)+1],D=n[2*o],m=n[2*o+1],C=n[2*(o+1)],E=n[2*(o+1)+1],A=d-D,T=D-C,L=(-(v=(v=-(f-m))/(M=Math.sqrt(v*v+A*A))*y)+d)*(-(A=A/M*y)+m)-(-v+D)*(-A+f),S=(-(R=(R=-(m-E))/(M=Math.sqrt(R*R+T*T))*y)+C)*(-(T=T/M*y)+m)-(-R+D)*(-T+E),x=(P=-A+f-(-A+m))*(b=-R+D-(-R+C))-(p=-T+E-(-T+m))*(N=-v+D-(-v+d)),Math.abs(x)<.1?(x+=10.1,l.push(D-v,m-A,D+v,m+A)):(((u=(N*S-b*L)/x)-D)*(u-D)+((c=(p*L-P*S)/x)-m)+(c-m),l.push(u,c,D-(u-D),m-(c-m)));for(d=n[s-4],f=n[s-3],A=d-(D=n[s-2]),v=(v=-(f-(m=n[s-1])))/(M=Math.sqrt(v*v+A*A))*y,A=A/M*y,l.push(D-v,m-A,D+v,m+A),o=1;o<h;o++)e.push(i+2*(o-1),i+2*(o-1)+1,i+2*o+1,i+2*o+1,i+2*o,i+2*(o-1));return l},BasePoly.createLineTriangle=function(t,e,a,i,r,_,n){var s=t.slice(),o=s.length,h=s[0],l=s[1],u=s[2],c=(s[2],0),d=0,f=0,D=0,m=o/2;if(!(m<=1)&&2!=m){for(var C=new Array(4*m),E=0,v=0,A=0;A<m-1;A++)h=s[v++],l=s[v++],u=s[v++],D=s[v++]-l,0!=(f=u-h)&&0!=D&&(c=Math.sqrt(f*f+D*D))>.001&&(C[d=4*E]=h,C[d+1]=l,C[d+2]=f/c,C[d+3]=D/c,E++);for(i?(h=s[o-2],l=s[o-1],u=s[0],D=s[1]-l,0!=(f=u-h)&&0!=D&&(c=Math.sqrt(f*f+D*D))>.001&&(C[d=4*E]=h,C[d+1]=l,C[d+2]=f/c,C[d+3]=D/c,E++)):(C[d=4*E]=h,C[d+1]=l,C[d+2]=f/c,C[d+3]=D/c,E++),v=0,A=0;A<m;A++){h=s[v],l=s[v+1],u=s[v+2],s[v+3];s[v+4],s[v+5]}}},i(BasePoly,["tempData",function(){return this.tempData=new Array(256)}]),BasePoly}()),vt=function(){function Earcut(){}return r(Earcut,"laya.webgl.shapes.Earcut"),Earcut.earcut=function(t,e,a){a=a||2;var i,r,_,n,s,o,h,l=e&&e.length,u=l?e[0]*a:t.length,c=Earcut.linkedList(t,0,u,a,!0),d=[];if(!c)return d;if(l&&(c=Earcut.eliminateHoles(t,e,c,a)),t.length>80*a){i=_=t[0],r=n=t[1];for(var f=a;f<u;f+=a)(s=t[f])<i&&(i=s),(o=t[f+1])<r&&(r=o),s>_&&(_=s),o>n&&(n=o);h=0!==(h=Math.max(_-i,n-r))?1/h:0}return Earcut.earcutLinked(c,d,a,i,r,h),d},Earcut.linkedList=function(t,e,a,i,r){var _,n;if(r===Earcut.signedArea(t,e,a,i)>0)for(_=e;_<a;_+=i)n=Earcut.insertNode(_,t[_],t[_+1],n);else for(_=a-i;_>=e;_-=i)n=Earcut.insertNode(_,t[_],t[_+1],n);return n&&Earcut.equals(n,n.next)&&(Earcut.removeNode(n),n=n.next),n},Earcut.filterPoints=function(t,e){if(!t)return t;e||(e=t);var a,i=t;do{if(a=!1,i.steiner||!Earcut.equals(i,i.next)&&0!==Earcut.area(i.prev,i,i.next))i=i.next;else{if(Earcut.removeNode(i),(i=e=i.prev)===i.next)break;a=!0}}while(a||i!==e);return e},Earcut.earcutLinked=function(t,e,a,i,r,_,n){if(t){!n&&_&&Earcut.indexCurve(t,i,r,_);for(var s,o,h=t;t.prev!==t.next;)if(s=t.prev,o=t.next,_?Earcut.isEarHashed(t,i,r,_):Earcut.isEar(t))e.push(s.i/a),e.push(t.i/a),e.push(o.i/a),Earcut.removeNode(t),t=o.next,h=o.next;else if((t=o)===h){n?1===n?(t=Earcut.cureLocalIntersections(t,e,a),Earcut.earcutLinked(t,e,a,i,r,_,2)):2===n&&Earcut.splitEarcut(t,e,a,i,r,_):Earcut.earcutLinked(Earcut.filterPoints(t,null),e,a,i,r,_,1);break}}},Earcut.isEar=function(t){var e=t.prev,a=t,i=t.next;if(Earcut.area(e,a,i)>=0)return!1;for(var r=t.next.next;r!==t.prev;){if(Earcut.pointInTriangle(e.x,e.y,a.x,a.y,i.x,i.y,r.x,r.y)&&Earcut.area(r.prev,r,r.next)>=0)return!1;r=r.next}return!0},Earcut.isEarHashed=function(t,e,a,i){var r=t.prev,_=t,n=t.next;if(Earcut.area(r,_,n)>=0)return!1;for(var s=r.x<_.x?r.x<n.x?r.x:n.x:_.x<n.x?_.x:n.x,o=r.y<_.y?r.y<n.y?r.y:n.y:_.y<n.y?_.y:n.y,h=r.x>_.x?r.x>n.x?r.x:n.x:_.x>n.x?_.x:n.x,l=r.y>_.y?r.y>n.y?r.y:n.y:_.y>n.y?_.y:n.y,u=Earcut.zOrder(s,o,e,a,i),c=Earcut.zOrder(h,l,e,a,i),d=t.nextZ;d&&d.z<=c;){if(d!==t.prev&&d!==t.next&&Earcut.pointInTriangle(r.x,r.y,_.x,_.y,n.x,n.y,d.x,d.y)&&Earcut.area(d.prev,d,d.next)>=0)return!1;d=d.nextZ}for(d=t.prevZ;d&&d.z>=u;){if(d!==t.prev&&d!==t.next&&Earcut.pointInTriangle(r.x,r.y,_.x,_.y,n.x,n.y,d.x,d.y)&&Earcut.area(d.prev,d,d.next)>=0)return!1;d=d.prevZ}return!0},Earcut.cureLocalIntersections=function(t,e,a){var i=t;do{var r=i.prev,_=i.next.next;!Earcut.equals(r,_)&&Earcut.intersects(r,i,i.next,_)&&Earcut.locallyInside(r,_)&&Earcut.locallyInside(_,r)&&(e.push(r.i/a),e.push(i.i/a),e.push(_.i/a),Earcut.removeNode(i),Earcut.removeNode(i.next),i=t=_),i=i.next}while(i!==t);return i},Earcut.splitEarcut=function(t,e,a,i,r,_){var n=t;do{for(var s=n.next.next;s!==n.prev;){if(n.i!==s.i&&Earcut.isValidDiagonal(n,s)){var o=Earcut.splitPolygon(n,s);return n=Earcut.filterPoints(n,n.next),o=Earcut.filterPoints(o,o.next),Earcut.earcutLinked(n,e,a,i,r,_),void Earcut.earcutLinked(o,e,a,i,r,_)}s=s.next}n=n.next}while(n!==t)},Earcut.eliminateHoles=function(t,e,a,i){var r,_,n,s,o,h=[];for(r=0,_=e.length;r<_;r++)n=e[r]*i,s=r<_-1?e[r+1]*i:t.length,(o=Earcut.linkedList(t,n,s,i,!1))===o.next&&(o.steiner=!0),h.push(Earcut.getLeftmost(o));for(h.sort(Earcut.compareX),r=0;r<h.length;r++)Earcut.eliminateHole(h[r],a),a=Earcut.filterPoints(a,a.next);return a},Earcut.compareX=function(t,e){return t.x-e.x},Earcut.eliminateHole=function(t,e){if(e=Earcut.findHoleBridge(t,e)){var a=Earcut.splitPolygon(e,t);Earcut.filterPoints(a,a.next)}},Earcut.findHoleBridge=function(t,e){var a,i=e,r=t.x,_=t.y,n=-1/0;do{if(_<=i.y&&_>=i.next.y&&i.next.y!==i.y){var s=i.x+(_-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(s<=r&&s>n){if(n=s,s===r){if(_===i.y)return i;if(_===i.next.y)return i.next}a=i.x<i.next.x?i:i.next}}i=i.next}while(i!==e);if(!a)return null;if(r===n)return a.prev;var o,h=a,l=a.x,u=a.y,c=1/0;for(i=a.next;i!==h;)r>=i.x&&i.x>=l&&r!==i.x&&Earcut.pointInTriangle(_<u?r:n,_,l,u,_<u?n:r,_,i.x,i.y)&&((o=Math.abs(_-i.y)/(r-i.x))<c||o===c&&i.x>a.x)&&Earcut.locallyInside(i,t)&&(a=i,c=o),i=i.next;return a},Earcut.indexCurve=function(t,e,a,i){var r=t;do{null===r.z&&(r.z=Earcut.zOrder(r.x,r.y,e,a,i)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==t);r.prevZ.nextZ=null,r.prevZ=null,Earcut.sortLinked(r)},Earcut.sortLinked=function(t){var e,a,i,r,_,n,s,o,h=1;do{for(a=t,t=null,_=null,n=0;a;){for(n++,i=a,s=0,e=0;e<h&&(s++,i=i.nextZ);e++);for(o=h;s>0||o>0&&i;)0!==s&&(0===o||!i||a.z<=i.z)?(r=a,a=a.nextZ,s--):(r=i,i=i.nextZ,o--),_?_.nextZ=r:t=r,r.prevZ=_,_=r;a=i}_.nextZ=null,h*=2}while(n>1);return t},Earcut.zOrder=function(t,e,a,i,r){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-a)*r)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-i)*r)|e<<8))|e<<4))|e<<2))|e<<1))<<1},Earcut.getLeftmost=function(t){var e=t,a=t;do{e.x<a.x&&(a=e),e=e.next}while(e!==t);return a},Earcut.pointInTriangle=function(t,e,a,i,r,_,n,s){return(r-n)*(e-s)-(t-n)*(_-s)>=0&&(t-n)*(i-s)-(a-n)*(e-s)>=0&&(a-n)*(_-s)-(r-n)*(i-s)>=0},Earcut.isValidDiagonal=function(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!Earcut.intersectsPolygon(t,e)&&Earcut.locallyInside(t,e)&&Earcut.locallyInside(e,t)&&Earcut.middleInside(t,e)},Earcut.area=function(t,e,a){return(e.y-t.y)*(a.x-e.x)-(e.x-t.x)*(a.y-e.y)},Earcut.equals=function(t,e){return t.x===e.x&&t.y===e.y},Earcut.intersects=function(t,e,a,i){return!!(Earcut.equals(t,e)&&Earcut.equals(a,i)||Earcut.equals(t,i)&&Earcut.equals(a,e))||Earcut.area(t,e,a)>0!=Earcut.area(t,e,i)>0&&Earcut.area(a,i,t)>0!=Earcut.area(a,i,e)>0},Earcut.intersectsPolygon=function(t,e){var a=t;do{if(a.i!==t.i&&a.next.i!==t.i&&a.i!==e.i&&a.next.i!==e.i&&Earcut.intersects(a,a.next,t,e))return!0;a=a.next}while(a!==t);return!1},Earcut.locallyInside=function(t,e){return Earcut.area(t.prev,t,t.next)<0?Earcut.area(t,e,t.next)>=0&&Earcut.area(t,t.prev,e)>=0:Earcut.area(t,e,t.prev)<0||Earcut.area(t,t.next,e)<0},Earcut.middleInside=function(t,e){var a=t,i=!1,r=(t.x+e.x)/2,_=(t.y+e.y)/2;do{a.y>_!=a.next.y>_&&a.next.y!==a.y&&r<(a.next.x-a.x)*(_-a.y)/(a.next.y-a.y)+a.x&&(i=!i),a=a.next}while(a!==t);return i},Earcut.splitPolygon=function(t,e){var a=new At(t.i,t.x,t.y),i=new At(e.i,e.x,e.y),r=t.next,_=e.prev;return t.next=e,e.prev=t,a.next=r,r.prev=a,i.next=a,a.prev=i,_.next=i,i.prev=_,i},Earcut.insertNode=function(t,e,a,i){var r=new At(t,e,a);return i?(r.next=i.next,r.prev=i,i.next.prev=r,i.next=r):(r.prev=r,r.next=r),r},Earcut.removeNode=function(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)},Earcut.signedArea=function(t,e,a,i){for(var r=0,_=e,n=a-i;_<a;_+=i)r+=(t[n]-t[_])*(t[_+1]+t[n+1]),n=_;return r},Earcut}(),At=function(){function EarcutNode(t,e,a){this.i=null,this.x=null,this.y=null,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=null,this.i=t,this.x=e,this.y=a,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}return r(EarcutNode,"laya.webgl.shapes.EarcutNode"),EarcutNode}(),Rt=function(){function Submit(t){this.clipInfoID=-1,this._numEle=0,this._ref=1,this._key=new Pt,void 0===t&&(t=1e4),this._renderType=t,this._id=++Submit.ID}r(Submit,"laya.webgl.submit.Submit");var t=Submit.prototype;return a.imps(t,{"laya.webgl.submit.ISubmit":!0}),t.getID=function(){return this._id},t.releaseRender=function(){Submit.RENDERBASE!=this&&--this._ref<1&&(Submit.POOL[Submit._poolSize++]=this,this.shaderValue.release(),this.shaderValue=null,this._mesh=null,this._parent&&(this._parent.releaseRender(),this._parent=null))},t.getRenderType=function(){return this._renderType},t.renderSubmit=function(){if(0===this._numEle||!this._mesh||0==this._numEle)return 1;var t=this.shaderValue.textureHost;if(t){var e=t._getSource();if(!e)return 1;this.shaderValue.texture=e}var a=xt.mainContext;return this._mesh.useMesh(a),this.shaderValue.upload(),at.activeBlendFunction!==this._blendFn&&(Mt.setBlend(a,!0),this._blendFn(a),at.activeBlendFunction=this._blendFn),a.drawElements(4,this._numEle,5123,this._startIdx),I.drawCall++,I.trianglesFaces+=this._numEle/3,1},t._cloneInit=function(t,e,a,i){t._ref=1,t._mesh=a,t._id=this._id,t._key.copyFrom(this._key),t._parent=this,t._blendFn=this._blendFn,t._renderType=this._renderType,t._startIdx=i*Lt.BYTES_PIDX,t._numEle=this._numEle,t.shaderValue=this.shaderValue,this.shaderValue.ref++,this._ref++},t.clone=function(t,e,a){return null},t.reUse=function(t,e){return 0},t.toString=function(){return"ibindex:"+this._startIdx+" num:"+this._numEle+" key="+this._key},Submit.__init__=function(){var t=Submit.RENDERBASE=new Submit(-1);t.shaderValue=new Y(0,0),t.shaderValue.ALPHA=1,t._ref=4294967295},Submit.create=function(t,e,a){var i=Submit._poolSize?Submit.POOL[--Submit._poolSize]:new Submit;i._ref=1,i._mesh=e,i._key.clear(),i._startIdx=e.indexNum*Lt.BYTES_PIDX,i._numEle=0;var r=t._nBlendType;i._blendFn=t._targets?at.targetFns[r]:at.fns[r],i.shaderValue=a,i.shaderValue.setValue(t._shader2D);var _=t._shader2D.filters;return _&&i.shaderValue.setFilters(_),i},Submit.createShape=function(t,e,a,i){var r=Submit._poolSize?Submit.POOL[--Submit._poolSize]:new Submit;r._mesh=e,r._numEle=a,r._startIdx=2*e.indexNum,r._ref=1,r.shaderValue=i,r.shaderValue.setValue(t._shader2D);var _=t._nBlendType;return r._blendFn=t._targets?at.targetFns[_]:at.fns[_],r},Submit.TYPE_2D=1e4,Submit.TYPE_CANVAS=10003,Submit.TYPE_CMDSETRT=10004,Submit.TYPE_CUSTOM=10005,Submit.TYPE_BLURRT=10006,Submit.TYPE_CMDDESTORYPRERT=10007,Submit.TYPE_DISABLESTENCIL=10008,Submit.TYPE_OTHERIBVB=10009,Submit.TYPE_PRIMITIVE=10010,Submit.TYPE_RT=10011,Submit.TYPE_BLUR_RT=10012,Submit.TYPE_TARGET=10013,Submit.TYPE_CHANGE_VALUE=10014,Submit.TYPE_SHAPE=10015,Submit.TYPE_TEXTURE=10016,Submit.TYPE_FILLTEXTURE=10017,Submit.KEY_ONCE=-1,Submit.KEY_FILLRECT=1,Submit.KEY_DRAWTEXTURE=2,Submit.KEY_VG=3,Submit.KEY_TRIANGLES=4,Submit.RENDERBASE=null,Submit.ID=1,Submit.preRender=null,Submit._poolSize=0,Submit.POOL=[],Submit}(),Tt=function(){function SubmitCMD(){this.fun=null,this._this=null,this.args=null,this._ref=1,this._key=new Pt}r(SubmitCMD,"laya.webgl.submit.SubmitCMD");var t=SubmitCMD.prototype;return a.imps(t,{"laya.webgl.submit.ISubmit":!0}),t.renderSubmit=function(){return this.fun.apply(this._this,this.args),1},t.getRenderType=function(){return 0},t.reUse=function(t,e){return this._ref++,e},t.releaseRender=function(){if(--this._ref<1){var t=SubmitCMD.POOL;t[t._length++]=this}},t.clone=function(t,e,a){return null},SubmitCMD.create=function(t,e,a){var i=SubmitCMD.POOL._length?SubmitCMD.POOL[--SubmitCMD.POOL._length]:new SubmitCMD;return i.fun=e,i.args=t,i._this=a,i._ref=1,i._key.clear(),i},SubmitCMD.POOL=(SubmitCMD.POOL=[],SubmitCMD.POOL._length=0,SubmitCMD.POOL),SubmitCMD}(),Pt=function(){function SubmitKey(){this.blendShader=0,this.submitType=0,this.other=0,this.clear()}r(SubmitKey,"laya.webgl.submit.SubmitKey");var t=SubmitKey.prototype;return t.clear=function(){this.submitType=-1,this.blendShader=this.other=0},t.copyFrom=function(t){this.other=t.other,this.blendShader=t.blendShader,this.submitType=t.submitType},t.copyFrom2=function(t,e,a){this.blendShader=t.blendShader,this.other=a,this.submitType=e},t.equal3_2=function(t,e,a){return this.submitType===e&&this.other===a&&this.blendShader===t.blendShader},t.equal4_2=function(t,e,a){return this.submitType===e&&this.other===a&&this.blendShader===t.blendShader},t.equal_3=function(t){return this.submitType===t.submitType&&this.blendShader===t.blendShader},t.equal=function(t){return this.other===t.other&&this.submitType===t.submitType&&this.blendShader===t.blendShader},SubmitKey}(),Nt=function(){function SubmitTarget(){this._mesh=null,this._startIdx=0,this._numEle=0,this.shaderValue=null,this.blendType=0,this._ref=1,this.srcRT=null,this._key=new Pt}r(SubmitTarget,"laya.webgl.submit.SubmitTarget");var t=SubmitTarget.prototype;return a.imps(t,{"laya.webgl.submit.ISubmit":!0}),t.renderSubmit=function(){var t=xt.mainContext;this._mesh.useMesh(t);var e=this.srcRT;return e&&(this.shaderValue.texture=e._getSource(),this.shaderValue.upload(),this.blend(),I.drawCall++,I.trianglesFaces+=this._numEle/3,xt.mainContext.drawElements(4,this._numEle,5123,this._startIdx)),1},t.blend=function(){if(at.activeBlendFunction!==at.fns[this.blendType]){var t=xt.mainContext;t.enable(3042),at.fns[this.blendType](t),at.activeBlendFunction=at.fns[this.blendType]}},t.getRenderType=function(){return 0},t.releaseRender=function(){if(--this._ref<1){var t=SubmitTarget.POOL;t[t._length++]=this}},t.reUse=function(t,e){return this._startIdx=e,this._ref++,e},SubmitTarget.create=function(t,e,a,i){var r=SubmitTarget.POOL._length?SubmitTarget.POOL[--SubmitTarget.POOL._length]:new SubmitTarget;if(r._mesh=e,r.srcRT=i,r._startIdx=e.indexNum*Lt.BYTES_PIDX,r._ref=1,r._key.clear(),r._numEle=0,r.blendType=t._nBlendType,r._key.blendShader=r.blendType,r.shaderValue=a,r.shaderValue.setValue(t._shader2D),t._colorFiler){var _=t._colorFiler;a.defines.add(_.type),a.colorMat=_._mat,a.colorAlpha=_._alpha}return r},SubmitTarget.POOL=(SubmitTarget.POOL=[],SubmitTarget.POOL._length=0,SubmitTarget.POOL),SubmitTarget}(),Lt=(function(){function ArabicReshaper(){}r(ArabicReshaper,"laya.webgl.text.ArabicReshaper");var t=ArabicReshaper.prototype;t.characterMapContains=function(t){for(var e=0;e<ArabicReshaper.charsMap.length;++e)if(ArabicReshaper.charsMap[e][0]===t)return!0;return!1},t.getCharRep=function(t){for(var e=0;e<ArabicReshaper.charsMap.length;++e)if(ArabicReshaper.charsMap[e][0]===t)return ArabicReshaper.charsMap[e];return!1},t.getCombCharRep=function(t,e){for(var a=0;a<ArabicReshaper.combCharsMap.length;++a)if(ArabicReshaper.combCharsMap[a][0][0]===t&&ArabicReshaper.combCharsMap[a][0][1]===e)return ArabicReshaper.combCharsMap[a];return!1},t.isTransparent=function(t){for(var e=0;e<ArabicReshaper.transChars.length;++e)if(ArabicReshaper.transChars[e]===t)return!0;return!1},t.getOriginalCharsFromCode=function(t){var e=0;for(e=0;e<ArabicReshaper.charsMap.length;++e)if(ArabicReshaper.charsMap[e].indexOf(t)>-1)return String.fromCharCode(ArabicReshaper.charsMap[e][0]);for(e=0;e<ArabicReshaper.combCharsMap.length;++e)if(ArabicReshaper.combCharsMap[e].indexOf(t)>-1)return String.fromCharCode(ArabicReshaper.combCharsMap[e][0][0])+String.fromCharCode(ArabicReshaper.combCharsMap[e][0][1]);return String.fromCharCode(t)},t.convertArabic=function(t){for(var e,a,i="",r=0;r<t.length;++r){var _=t.charCodeAt(r);if(this.characterMapContains(_)){for(var n=null,s=null,o=r-1,h=r+1;o>=0&&this.isTransparent(t.charCodeAt(o));--o);for((!(e=!!(n=o>=0?t.charCodeAt(o):null)&&this.getCharRep(n))||null==e[2]&&null==e[3])&&(n=null);h<t.length&&this.isTransparent(t.charCodeAt(h));++h);if((!(e=!!(s=h<t.length?t.charCodeAt(h):null)&&this.getCharRep(s))||null==e[3]&&null==e[4])&&(s=null),1604===_&&null!=s&&(1570===s||1571===s||1573===s||1575===s)){a=this.getCombCharRep(_,s),i+=null!=n?String.fromCharCode(a[4]):String.fromCharCode(a[1]),++r;continue}if(e=this.getCharRep(_),null!=n&&null!=s&&null!=e[3]){i+=String.fromCharCode(e[3]);continue}if(null!=n&&null!=e[4]){i+=String.fromCharCode(e[4]);continue}if(null!=s&&null!=e[2]){i+=String.fromCharCode(e[2]);continue}i+=String.fromCharCode(e[1])}else i+=String.fromCharCode(_)}return i},t.convertArabicBack=function(t){var e="",a=0,i=0;for(i=0;i<t.length;++i)a=t.charCodeAt(i),e+=this.getOriginalCharsFromCode(a);return e},i(ArabicReshaper,["charsMap",function(){return this.charsMap=[[1569,65152,null,null,null],[1570,65153,null,null,65154],[1571,65155,null,null,65156],[1572,65157,null,null,65158],[1573,65159,null,null,65160],[1574,65161,65163,65164,65162],[1575,65165,null,null,65166],[1576,65167,65169,65170,65168],[1577,65171,null,null,65172],[1578,65173,65175,65176,65174],[1579,65177,65179,65180,65178],[1580,65181,65183,65184,65182],[1581,65185,65187,65188,65186],[1582,65189,65191,65192,65190],[1583,65193,null,null,65194],[1584,65195,null,null,65196],[1585,65197,null,null,65198],[1586,65199,null,null,65200],[1587,65201,65203,65204,65202],[1588,65205,65207,65208,65206],[1589,65209,65211,65212,65210],[1590,65213,65215,65216,65214],[1591,65217,65219,65220,65218],[1592,65221,65223,65224,65222],[1593,65225,65227,65228,65226],[1594,65229,65231,65232,65230],[1600,1600,1600,1600,1600],[1601,65233,65235,65236,65234],[1602,65237,65239,65240,65238],[1603,65241,65243,65244,65242],[1604,65245,65247,65248,65246],[1605,65249,65251,65252,65250],[1606,65253,65255,65256,65254],[1607,65257,65259,65260,65258],[1608,65261,null,null,65262],[1609,65263,null,null,65264],[1610,65265,65267,65268,65266],[1662,64342,64344,64345,64343],[1740,64508,64510,64511,64509],[1670,64378,64380,64381,64379],[1705,64398,64400,64401,64399],[1711,64402,64404,64405,64403],[1688,64394,null,null,64395]]},"combCharsMap",function(){return this.combCharsMap=[[[1604,1570],65269,null,null,65270],[[1604,1571],65271,null,null,65272],[[1604,1573],65273,null,null,65274],[[1604,1575],65275,null,null,65276]]},"transChars",function(){return this.transChars=[1552,1554,1555,1556,1557,1611,1612,1613,1614,1615,1616,1617,1618,1619,1620,1621,1622,1623,1624,1648,1750,1751,1752,1753,1754,1755,1756,1759,1760,1761,1762,1763,1764,1767,1768,1770,1771,1772,1773]}])}(),function(){function CONST3D2D(){}return r(CONST3D2D,"laya.webgl.utils.CONST3D2D"),CONST3D2D.BYTES_PE=4,CONST3D2D.BYTES_PIDX=2,CONST3D2D.defaultMatrix4=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],CONST3D2D.defaultMinusYMatrix4=[1,0,0,0,0,-1,0,0,0,0,1,0,0,0,0,1],CONST3D2D.uniformMatrix3=[1,0,0,0,0,1,0,0,0,0,1,0],CONST3D2D._TMPARRAY=[],CONST3D2D._OFFSETX=0,CONST3D2D._OFFSETY=0,CONST3D2D}()),pt=(function(){function MatirxArray(){}r(MatirxArray,"laya.webgl.utils.MatirxArray"),MatirxArray.ArrayMul=function(t,e,a){if(t)if(e)for(var i=NaN,r=NaN,_=NaN,n=NaN,s=0;s<4;s++)i=t[s],r=t[s+4],_=t[s+8],n=t[s+12],a[s]=i*e[0]+r*e[1]+_*e[2]+n*e[3],a[s+4]=i*e[4]+r*e[5]+_*e[6]+n*e[7],a[s+8]=i*e[8]+r*e[9]+_*e[10]+n*e[11],a[s+12]=i*e[12]+r*e[13]+_*e[14]+n*e[15];else MatirxArray.copyArray(t,a);else MatirxArray.copyArray(e,a)},MatirxArray.copyArray=function(t,e){if(t&&e)for(var a=0;a<t.length;a++)e[a]=t[a]}}(),function(){function Mesh2D(t,e,a){this._stride=0,this.vertNum=0,this.indexNum=0,this._applied=!1,this._vb=null,this._ib=null,this._vao=null,this._attribInfo=null,this._quadNum=0,this.canReuse=!1,this._stride=t,this._vb=new ae(t,35048),e?this._vb._resizeBuffer(e,!1):u.webGL2D_MeshAllocMaxMem&&this._vb._resizeBuffer(65536*t,!1),this._ib=new ee,a&&this._ib._resizeBuffer(a,!1)}r(Mesh2D,"laya.webgl.utils.Mesh2D");var t=Mesh2D.prototype;return t.cloneWithNewVB=function(){var t=new Mesh2D(this._stride,0,0);return t._ib=this._ib,t._quadNum=this._quadNum,t._attribInfo=this._attribInfo,t},t.cloneWithNewVBIB=function(){var t=new Mesh2D(this._stride,0,0);return t._attribInfo=this._attribInfo,t},t.getVBW=function(){return this._vb.setNeedUpload(),this._vb},t.getVBR=function(){return this._vb},t.getIBR=function(){return this._ib},t.getIBW=function(){return this._ib.setNeedUpload(),this._ib},t.createQuadIB=function(t){this._quadNum=t,this._ib._resizeBuffer(6*t*2,!1),this._ib.byteLength=this._ib.bufferLength;for(var e=this._ib.getUint16Array(),a=0,i=0,r=0;r<t;r++)e[a++]=i,e[a++]=i+2,e[a++]=i+1,e[a++]=i,e[a++]=i+3,e[a++]=i+2,i+=4;this._ib.setNeedUpload()},t.setAttributes=function(t){if(this._attribInfo=t,this._attribInfo.length%3!=0)throw"Mesh2D setAttributes error!"},t.configVAO=function(t){if(!this._applied){this._applied=!0,this._vao||(this._vao=t.createVertexArray()),Mt.bindVertexArray(t,this._vao),this._vb._bindForVAO(),this._ib.setNeedUpload(),this._ib._bind_uploadForVAO();for(var e=this._attribInfo.length/3,a=0,i=0;i<e;i++){var r=this._attribInfo[a+1],_=this._attribInfo[a],n=this._attribInfo[a+2];t.enableVertexAttribArray(i),t.vertexAttribPointer(i,r,_,!1,this._stride,n),a+=3}Mt.bindVertexArray(t,null)}},t.useMesh=function(t){this._applied||this.configVAO(t),Mt.bindVertexArray(t,this._vao),this._vb.bind(),this._ib._bind_upload()||this._ib.bind(),this._vb._bind_upload()||this._vb.bind()},t.getEleNum=function(){return this._ib.getBuffer().byteLength/2},t.releaseMesh=function(){},t.destroy=function(){},t.clearVB=function(){this._vb.clear()},Mesh2D._gvaoid=0,Mesh2D}()),bt=function(){function RenderState2D(){}return r(RenderState2D,"laya.webgl.utils.RenderState2D"),RenderState2D.mat2MatArray=function(t,e){var a=t,i=e;return i[0]=a.a,i[1]=a.b,i[2]=RenderState2D.EMPTYMAT4_ARRAY[2],i[3]=RenderState2D.EMPTYMAT4_ARRAY[3],i[4]=a.c,i[5]=a.d,i[6]=RenderState2D.EMPTYMAT4_ARRAY[6],i[7]=RenderState2D.EMPTYMAT4_ARRAY[7],i[8]=RenderState2D.EMPTYMAT4_ARRAY[8],i[9]=RenderState2D.EMPTYMAT4_ARRAY[9],i[10]=RenderState2D.EMPTYMAT4_ARRAY[10],i[11]=RenderState2D.EMPTYMAT4_ARRAY[11],i[12]=a.tx,i[13]=a.ty,i[14]=RenderState2D.EMPTYMAT4_ARRAY[14],i[15]=RenderState2D.EMPTYMAT4_ARRAY[15],e},RenderState2D.restoreTempArray=function(){RenderState2D.TEMPMAT4_ARRAY[0]=1,RenderState2D.TEMPMAT4_ARRAY[1]=0,RenderState2D.TEMPMAT4_ARRAY[4]=0,RenderState2D.TEMPMAT4_ARRAY[5]=1,RenderState2D.TEMPMAT4_ARRAY[12]=0,RenderState2D.TEMPMAT4_ARRAY[13]=0},RenderState2D.clear=function(){RenderState2D.worldScissorTest=!1,RenderState2D.worldAlpha=1},RenderState2D._MAXSIZE=99999999,RenderState2D.EMPTYMAT4_ARRAY=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],RenderState2D.TEMPMAT4_ARRAY=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],RenderState2D.worldMatrix4=RenderState2D.TEMPMAT4_ARRAY,RenderState2D.worldAlpha=1,RenderState2D.worldScissorTest=!1,RenderState2D.worldShaderDefines=null,RenderState2D.worldFilters=null,RenderState2D.width=0,RenderState2D.height=0,i(RenderState2D,["worldMatrix",function(){return this.worldMatrix=new R}]),RenderState2D}(),St=function(){var t,e;function ShaderCompile(e,a,i,r){var _=this;function _compile(e){var a=[],i=new t(a);return _._compileToTree(i,e.split("\n"),0,a,r),i}var n=o.now();this._VS=_compile(e),this._PS=_compile(a),this._nameMap=i,o.now()-n>2&&console.log("ShaderCompile use time:"+(o.now()-n)+"  size:"+e.length+"/"+a.length)}r(ShaderCompile,"laya.webgl.utils.ShaderCompile");var a=ShaderCompile.prototype;return a._compileToTree=function(e,a,i,r,_){var n,s,o,h,l,u,c,d=0,f=0,D=0,m=0;for(f=i;f<a.length;f++)if(!((o=a[f]).length<1)&&0!==(d=o.indexOf("//"))){if(d>=0&&(o=o.substr(0,d)),n=c||new t(r),c=null,n.text=o,n.noCompile=!0,(d=o.indexOf("#"))>=0){for(h="#",m=d+1,D=o.length;m<D;m++){var C=o.charAt(m);if(" "===C||"\t"===C||"?"===C)break;h+=C}switch(n.name=h,h){case"#ifdef":case"#ifndef":if(n.src=o,n.noCompile=null!=o.match(/[!&|()=<>]/),n.noCompile?console.log("function():Boolean{return "+o.substr(d+n.name.length)+"}"):(u=o.replace(/^\s*/,"").split(/\s+/),n.setCondition(u[1],"#ifdef"===h?1:2),n.text="//"+n.text),n.setParent(e),e=n,_)for(u=o.substr(m).split(ShaderCompile._splitToWordExps3),m=0;m<u.length;m++)(o=u[m]).length&&(_[o]=!0);continue;case"#if":if(n.src=o,n.noCompile=!0,n.setParent(e),e=n,_)for(u=o.substr(m).split(ShaderCompile._splitToWordExps3),m=0;m<u.length;m++)(o=u[m]).length&&"defined"!=o&&(_[o]=!0);continue;case"#else":n.src=o,s=(e=e.parent).childs[e.childs.length-1],n.noCompile=s.noCompile,n.noCompile||(n.condition=s.condition,n.conditionType=1==s.conditionType?2:1,n.text="//"+n.text+" "+s.text+" "+n.conditionType),n.setParent(e),e=n;continue;case"#endif":s=(e=e.parent).childs[e.childs.length-1],n.noCompile=s.noCompile,n.noCompile||(n.text="//"+n.text),n.setParent(e);continue;case"#include":u=ShaderCompile.splitToWords(o,null);var E=ShaderCompile.includes[u[1]];if(!E)throw"ShaderCompile error no this include file:"+u[1];if((d=u[0].indexOf("?"))<0){n.setParent(e),o=E.getWith("with"==u[2]?u[3]:null),this._compileToTree(n,o.split("\n"),0,r,_),n.text="";continue}n.setCondition(u[0].substr(d+1),1),n.text=E.getWith("with"==u[2]?u[3]:null);break;case"#import":l=(u=ShaderCompile.splitToWords(o,null))[1],r.push({node:n,file:ShaderCompile.includes[l],ofs:n.text.length});continue}}else{if((s=e.childs[e.childs.length-1])&&!s.name){r.length>0&&ShaderCompile.splitToWords(o,s),c=n,s.text+="\n"+o;continue}r.length>0&&ShaderCompile.splitToWords(o,n)}n.setParent(e)}},a.createShader=function(t,e,a,i){var r={},_="";if(t)for(var n in t)_+="#define "+n+"\n",r[n]=!0;var s=this._VS.toscript(r,[]),o=this._PS.toscript(r,[]);return(a||Kt.create)(_+s.join("\n"),_+o.join("\n"),e,this._nameMap,i)},ShaderCompile._parseOne=function(t,e,a,i,r,_){var n={type:ShaderCompile.shaderParamsMap[a[i+1]],name:a[i+2],size:isNaN(parseInt(a[i+3]))?1:parseInt(a[i+3])};return _&&("attribute"==r?t.push(n):e.push(n)),":"==a[i+3]&&(n.type=a[i+4],i+=2),i+=2},ShaderCompile.addInclude=function(t,a){if(!a||0===a.length)throw new Error("add shader include file err:"+t);if(ShaderCompile.includes[t])throw new Error("add shader include file err, has add:"+t);ShaderCompile.includes[t]=new e(a)},ShaderCompile.preGetParams=function(t,e){var a=[t,e],i={},r=[],_=[],n={},s=[];i.attributes=r,i.uniforms=_,i.defines=n;for(var o=0,h=0,l=0;l<2;l++){a[l]=a[l].replace(ShaderCompile._removeAnnotation,"");var u,c=a[l].match(ShaderCompile._reg);for(o=0,h=c.length;o<h;o++){var d=c[o];if("attribute"==d||"uniform"==d)o=ShaderCompile._parseOne(r,_,c,o,d,!0);else{if("#define"==d){s[d=c[++o]]=1;continue}if("#ifdef"==d){n[u=c[++o]]=n[u]||[];for(o++;o<h;o++)if("attribute"==(d=c[o])||"uniform"==d)o=ShaderCompile._parseOne(r,_,c,o,d,s[u]);else if("#else"==d)for(o++;o<h;o++)if("attribute"==(d=c[o])||"uniform"==d)o=ShaderCompile._parseOne(r,_,c,o,d,!s[u]);else if("#endif"==d)break}}}}return i},ShaderCompile.splitToWords=function(t,e){for(var a,i,r=[],_=-1,n=0,s=t.length;n<s;n++)if(a=t.charAt(n)," \t=+-*/&%!<>()'\",;".indexOf(a)>=0){if(_>=0&&n-_>1&&(i=t.substr(_,n-_),r.push(i)),'"'==a||"'"==a){var o=t.indexOf(a,n+1);if(o<0)throw"Sharder err:"+t;r.push(t.substr(n+1,o-n-1)),n=o,_=-1;continue}"("==a&&e&&r.length>0&&(i=r[r.length-1]+";","vec4;main;".indexOf(i)<0&&(e.useFuns+=i)),_=-1}else _<0&&(_=n);return _<s&&s-_>1&&(i=t.substr(_,s-_),r.push(i)),r},ShaderCompile.IFDEF_NO=0,ShaderCompile.IFDEF_YES=1,ShaderCompile.IFDEF_ELSE=2,ShaderCompile.IFDEF_PARENT=3,ShaderCompile._removeAnnotation=new RegExp("(/\\*([^*]|[\\r\\\n]|(\\*+([^*/]|[\\r\\n])))*\\*+/)|(//.*)","g"),ShaderCompile._reg=new RegExp("(\".*\")|('.*')|([#\\w\\*-\\.+/()=<>{}\\\\]+)|([,;:\\\\])","g"),ShaderCompile._splitToWordExps=new RegExp("[(\".*\")]+|[('.*')]+|([ \\t=\\+\\-*/&%!<>!%(),;])","g"),ShaderCompile.includes={},i(ShaderCompile,["shaderParamsMap",function(){return this.shaderParamsMap={float:5126,int:5124,bool:35670,vec2:35664,vec3:35665,vec4:35666,ivec2:35667,ivec3:35668,ivec4:35669,bvec2:35671,bvec3:35672,bvec4:35673,mat2:35674,mat3:35675,mat4:35676,sampler2D:35678,samplerCube:35680}},"_splitToWordExps3",function(){return this._splitToWordExps3=new RegExp("[ \\t=\\+\\-*/&%!<>!%(),;\\|]","g")}]),ShaderCompile.__init$=function(){t=function(){function ShaderNode(t){this.childs=[],this.text="",this.parent=null,this.name=null,this.noCompile=!1,this.includefiles=null,this.condition=null,this.conditionType=0,this.useFuns="",this.z=0,this.src=null,this.includefiles=t}r(ShaderNode,"");var t=ShaderNode.prototype;return t.setParent=function(t){t.childs.push(this),this.z=t.z+1,this.parent=t},t.setCondition=function(t,e){t&&(this.conditionType=e,t=t.replace(/(\s*$)/g,""),this.condition=function(){return this[t]},this.condition.__condition=t)},t.toscript=function(t,e){return this._toscript(t,e,++ShaderNode.__id)},t._toscript=function(t,e,a){if(this.childs.length<1&&!this.text)return e;e.length;if(this.condition){var i=!!this.condition.call(t);if(2===this.conditionType&&(i=!i),!i)return e}if(this.text&&e.push(this.text),this.childs.length>0&&this.childs.forEach(function(i,r,_){i._toscript(t,e,a)}),this.includefiles.length>0&&this.useFuns.length>0)for(var r,_=0,n=this.includefiles.length;_<n;_++)this.includefiles[_].curUseID!=a&&(r=this.includefiles[_].file.getFunsScript(this.useFuns)).length>0&&(this.includefiles[_].curUseID=a,e[0]=r+e[0]);return e},ShaderNode.__id=1,ShaderNode}(),e=function(){function InlcudeFile(t){this.script=null,this.codes={},this.funs={},this.curUseID=-1,this.funnames="",this.script=t;for(var e=0,a=0,i=0;!((e=t.indexOf("#begin",e))<0);){for(i=e+5;!((i=t.indexOf("#end",i))<0)&&"i"===t.charAt(i+4);)i+=5;if(i<0)throw"add include err,no #end:"+t;a=t.indexOf("\n",e);var r=ShaderCompile.splitToWords(t.substr(e,a-e),null);"code"==r[1]?this.codes[r[2]]=t.substr(a+1,i-a-1):"function"==r[1]&&(a=t.indexOf("function",e),a+="function".length,this.funs[r[3]]=t.substr(a+1,i-a-1),this.funnames+=r[3]+";"),e=i+1}}r(InlcudeFile,"");var t=InlcudeFile.prototype;return t.getWith=function(t){var e=t?this.codes[t]:this.script;if(!e)throw"get with error:"+t;return e},t.getFunsScript=function(t){var e="";for(var a in this.funs)t.indexOf(a+";")>=0&&(e+=this.funs[a]);return e},InlcudeFile}()},ShaderCompile}(),xt=(function(){function VertexArrayObject(){}return r(VertexArrayObject,"laya.webgl.VertexArrayObject"),VertexArrayObject}()(function(){var e={};function synthesizeGLError(a,i){var r;e[a]=!0,void 0!==i&&(r=i,t.console&&t.console.error&&t.console.error(r))}var a=function WebGLVertexArrayObjectOES(t){var e=t.gl;this.ext=t,this.isAlive=!0,this.hasBeenBound=!1,this.elementArrayBuffer=null,this.attribs=new Array(t.maxVertexAttribs);for(var a=0;a<this.attribs.length;a++){var i=new WebGLVertexArrayObjectOES.VertexAttrib(e);this.attribs[a]=i}this.maxAttrib=0};(a.VertexAttrib=function(t){this.enabled=!1,this.buffer=null,this.size=4,this.type=t.FLOAT,this.normalized=!1,this.stride=16,this.offset=0,this.cached="",this.recache()}).prototype.recache=function(){this.cached=[this.size,this.type,this.normalized,this.stride,this.offset].join(":")};var i=function(a){var i=this;this.gl=a,function(t){var a=t.getError;t.getError=function(){do{(i=a.apply(t))!=t.NO_ERROR&&(e[i]=!0)}while(i!=t.NO_ERROR);for(var i in e)if(e[i])return delete e[i],parseInt(i);return t.NO_ERROR}}(a);var r=this.original={getParameter:a.getParameter,enableVertexAttribArray:a.enableVertexAttribArray,disableVertexAttribArray:a.disableVertexAttribArray,bindBuffer:a.bindBuffer,getVertexAttrib:a.getVertexAttrib,vertexAttribPointer:a.vertexAttribPointer};a.getParameter=function(t){return t==i.VERTEX_ARRAY_BINDING_OES?i.currentVertexArrayObject==i.defaultVertexArrayObject?null:i.currentVertexArrayObject:r.getParameter.apply(this,arguments)},a.enableVertexAttribArray=function(t){var e=i.currentVertexArrayObject;return e.maxAttrib=Math.max(e.maxAttrib,t),e.attribs[t].enabled=!0,r.enableVertexAttribArray.apply(this,arguments)},a.disableVertexAttribArray=function(t){var e=i.currentVertexArrayObject;return e.maxAttrib=Math.max(e.maxAttrib,t),e.attribs[t].enabled=!1,r.disableVertexAttribArray.apply(this,arguments)},a.bindBuffer=function(t,e){switch(t){case a.ARRAY_BUFFER:i.currentArrayBuffer=e;break;case a.ELEMENT_ARRAY_BUFFER:i.currentVertexArrayObject.elementArrayBuffer=e}return r.bindBuffer.apply(this,arguments)},a.getVertexAttrib=function(t,e){var _=i.currentVertexArrayObject.attribs[t];switch(e){case a.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING:return _.buffer;case a.VERTEX_ATTRIB_ARRAY_ENABLED:return _.enabled;case a.VERTEX_ATTRIB_ARRAY_SIZE:return _.size;case a.VERTEX_ATTRIB_ARRAY_STRIDE:return _.stride;case a.VERTEX_ATTRIB_ARRAY_TYPE:return _.type;case a.VERTEX_ATTRIB_ARRAY_NORMALIZED:return _.normalized;default:return r.getVertexAttrib.apply(this,arguments)}},a.vertexAttribPointer=function(t,e,a,_,n,s){var o=i.currentVertexArrayObject;o.maxAttrib=Math.max(o.maxAttrib,t);var h=o.attribs[t];return h.buffer=i.currentArrayBuffer,h.size=e,h.type=a,h.normalized=_,h.stride=n,h.offset=s,h.recache(),r.vertexAttribPointer.apply(this,arguments)},a.instrumentExtension&&a.instrumentExtension(this,"OES_vertex_array_object"),a.canvas.addEventListener("webglcontextrestored",function(){var e;e="OESVertexArrayObject emulation library context restored",t.console&&t.console.log&&t.console.log(e),i.reset_()},!0),this.reset_()};i.prototype.VERTEX_ARRAY_BINDING_OES=34229,i.prototype.reset_=function(){if(void 0!==this.vertexArrayObjects)for(var t=0;t<this.vertexArrayObjects.length;++t)this.vertexArrayObjects.isAlive=!1;var e=this.gl;this.maxVertexAttribs=e.getParameter(e.MAX_VERTEX_ATTRIBS),this.defaultVertexArrayObject=new a(this),this.currentVertexArrayObject=null,this.currentArrayBuffer=null,this.vertexArrayObjects=[this.defaultVertexArrayObject],this.bindVertexArrayOES(null)},i.prototype.createVertexArrayOES=function(){var t=new a(this);return this.vertexArrayObjects.push(t),t},i.prototype.deleteVertexArrayOES=function(t){t.isAlive=!1,this.vertexArrayObjects.splice(this.vertexArrayObjects.indexOf(t),1),this.currentVertexArrayObject==t&&this.bindVertexArrayOES(null)},i.prototype.isVertexArrayOES=function(t){return!!(t&&t instanceof a&&t.hasBeenBound&&t.ext==this)},i.prototype.bindVertexArrayOES=function(t){var e=this.gl;if(!t||t.isAlive){var a=this.original,i=this.currentVertexArrayObject;this.currentVertexArrayObject=t||this.defaultVertexArrayObject,this.currentVertexArrayObject.hasBeenBound=!0;var r=this.currentVertexArrayObject;if(i!=r){i&&r.elementArrayBuffer==i.elementArrayBuffer||a.bindBuffer.call(e,e.ELEMENT_ARRAY_BUFFER,r.elementArrayBuffer);for(var _=this.currentArrayBuffer,n=Math.max(i?i.maxAttrib:0,r.maxAttrib),s=0;s<=n;s++){var o=r.attribs[s],h=i?i.attribs[s]:null;if(i&&o.enabled==h.enabled||(o.enabled?a.enableVertexAttribArray.call(e,s):a.disableVertexAttribArray.call(e,s)),o.enabled){var l=!1;i&&o.buffer==h.buffer||(_!=o.buffer&&(a.bindBuffer.call(e,e.ARRAY_BUFFER,o.buffer),_=o.buffer),l=!0),(l||o.cached!=h.cached)&&a.vertexAttribPointer.call(e,s,o.size,o.type,o.normalized,o.stride,o.offset)}}this.currentArrayBuffer!=_&&a.bindBuffer.call(e,e.ARRAY_BUFFER,this.currentArrayBuffer)}}else synthesizeGLError(e.INVALID_OPERATION,"bindVertexArrayOES: attempt to bind deleted arrayObject")},t._setupVertexArrayObject=function(t){var e=t.getSupportedExtensions;t.getSupportedExtensions=function(){var t=e.call(this)||[];return t.indexOf("OES_vertex_array_object")<0&&t.push("OES_vertex_array_object"),t};var a=t.getExtension;t.getExtension=function(t){var e=a.call(this,t);return e||("OES_vertex_array_object"!==t?null:(this.__OESVertexArrayObject||(console.log("Setup OES_vertex_array_object polyfill"),this.__OESVertexArrayObject=new i(this)),this.__OESVertexArrayObject))}},t._forceSetupVertexArrayObject=function(t){var e=t.getSupportedExtensions;t.getSupportedExtensions=function(){var t=e.call(this)||[];return t.indexOf("OES_vertex_array_object")<0&&t.push("OES_vertex_array_object"),t};var a=t.getExtension;t.getExtension=function(t){if("OES_vertex_array_object"===t)return this.__OESVertexArrayObject||(console.log("Setup OES_vertex_array_object polyfill"),this.__OESVertexArrayObject=new i(this)),this.__OESVertexArrayObject;var e=a.call(this,t);return e||null}}}()),function(){function WebGL(){}return r(WebGL,"laya.webgl.WebGL"),WebGL._uint8ArraySlice=function(){for(var t=this.length,e=new Uint8Array(this.length),a=0;a<t;a++)e[a]=this[a];return e},WebGL._float32ArraySlice=function(){for(var t=this.length,e=new Float32Array(this.length),a=0;a<t;a++)e[a]=this[a];return e},WebGL._uint16ArraySlice=function(t){var e,a=arguments,i=0,r=0;if(0===a.length)for(i=this.length,e=new Uint16Array(i),r=0;r<i;r++)e[r]=this[r];else if(2===a.length){var _=a[0],n=a[1];if(n>_)for(i=n-_,e=new Uint16Array(i),r=_;r<n;r++)e[r-_]=this[r];else e=new Uint16Array(0)}return e},WebGL._nativeRender_enable=function(){WebGL.isNativeRender_enable||(WebGL.isNativeRender_enable=!0,A.create=function(t,e){return new Jt(t,e,1,!1,!1)},Mt.__init_native(),bt.width=o.window.innerWidth,bt.height=o.window.innerHeight,y.measureText=function(e,a){return t.conchTextCanvas.font=a,t.conchTextCanvas.measureText(e)},y.enableNative=function(){$.uploadShaderUniforms=$.uploadShaderUniformsForNative;var e=w;if(e.prototype.repaint=e.prototype.repaintForNative,e.prototype.render=e.prototype.renderToNative,p.isConchApp){Z=t.GLCommandEncoder,K=t.LayaGLContext;var a=t.CanvasRenderingContext.prototype,i=q.prototype;q=t.CanvasRenderingContext,a.drawImage=i.drawImage,a.drawTexture=i.drawTexture,a.fillText=i.fillText,a.save=i.save,a.restore=i.restore,a.translate=i.translate,a.scale=i.scale,a.rotate=i.rotate,a.transform=i.transform,a.beginRT=i.beginRT,a.endRT=i.endRT,a.drawCanvas=i.drawCanvas,a.drawTarget=i.drawTarget,a._$get_asBitmap=i._$get_asBitmap,a._$set_asBitmap=i._$set_asBitmap,_(0,a,"asBitmap",a._$get_asBitmap,a._$set_asBitmap)}zt.init(),tt.__init__()})},WebGL._webglRender_enable=function(){p.isWebGL||(p.isWebGL=!0,y.initRender=function(t,e,a){var i=K.instance=laya.webgl.WebGL.mainContext=function(t){var e,a=["webgl2","webgl","experimental-webgl","webkit-3d","moz-webgl"];u.useWebGL2||a.shift();for(var i=0;i<a.length;i++){try{e=t.getContext(a[i],{stencil:u.isStencil,alpha:u.isAlpha,antialias:u.isAntialias,premultipliedAlpha:u.premultipliedAlpha,preserveDrawingBuffer:u.preserveDrawingBuffer})}catch(t){}if(e)return"webgl2"===a[i]&&(laya.webgl.WebGL._isWebGL2=!0),new K,e}return null}(p._mainCanvas.source);if(!i)return!1;t.size(e,a),Mt.__init__(i),yt.__init__(),Rt.__init__();var r=new yt;p._context=r,t._setContext(r),laya.webgl.WebGL.shaderHighPrecision=!1;try{i.getShaderPrecisionFormat(35632,36338).precision?WebGL.shaderHighPrecision=!0:WebGL.shaderHighPrecision=!1}catch(t){}return K.instance=i,G.__init__(),Gt.__init__(),Y.__init__(),Dt.__init__(),qt.__int__(i),at._init_(i),!0},A.create=function(t,e){return new Jt(t,e,1,!1,!1)},y.createRenderSprite=function(t,e){return new Ot(t,e)},y.changeWebGLSize=function(t,e){laya.webgl.WebGL.onStageResize(t,e)},y.clear=function(t){bt.worldScissorTest&&laya.webgl.WebGL.mainContext.disable(3089);var e=p.context,i=0==e._submits._length||u.preserveDrawingBuffer?l.create(t).arrColor:a.stage._wgColor;i&&e.clearBG(i[0],i[1],i[2],i[3]),bt.clear()},y.drawToCanvas=function(t,e,a,i,r,_){r-=t.x,_-=t.y,r|=0,_|=0,a|=0,i|=0;var n=new yt;n.size(a,i),n.asBitmap=!0,n._targets.start(),b.renders[e]._fun(t,n,r,_),n.flush(),n._targets.end(),n._targets.restore();var s=n._targets.getData(0,0,a,i);n.destroy();for(var o=new ImageData(a,i),h=4*a,l=(new Uint8Array(h),o.data),u=i-1,c=u*h,d=0;u>=0;u--)l.set(s.subarray(d,d+h),c),c-=h,d+=h;var f=new v(!0);return f.size(a,i),f.getContext("2d").putImageData(o,0,0),f},y.getTexturePixels=function(t,e,a,i,r){return alert(""),null},m._filter=function(t,e,a,i){var r=e,_=this._next;if(_){var n=t.filters,s=n.length;if(1==s&&32==n[0].type)return e.save(),e.setColorFilter(n[0]),_._fun.call(_,t,e,a,i),void e.restore();var o,h=Y.create(1,0),l=P.TEMP,u=r._curMat,c=R.create();u.copyTo(c);var d=0,f=0,D=t._cacheStyle.filterCache||null;if(D&&0==t.getRepaint()){if((t._cacheStyle.hasGlowFilter||!1)&&(d=50,f=25),(o=t.getBounds()).width<=0||o.height<=0)return;o.width+=d,o.height+=d,l.x=o.x*c.a+o.y*c.c,l.y=o.y*c.d+o.x*c.b,o.x=l.x,o.y=l.y,l.x=o.width*c.a+o.height*c.c,l.y=o.height*c.d+o.width*c.b,o.width=l.x,o.height=l.y}else{t._isHaveGlowFilter()&&(d=50,f=25),(o=new L).copyFrom(t.getSelfBounds()),o.x+=t.x,o.y+=t.y,o.x-=t.pivotX+4,o.y-=t.pivotY+4;var m=o.x,C=o.y;if(o.width+=d+8,o.height+=d+8,l.x=o.x*c.a+o.y*c.c,l.y=o.y*c.d+o.x*c.b,o.x=l.x,o.y=l.y,l.x=o.width*c.a+o.height*c.c,l.y=o.height*c.d+o.width*c.b,o.width=l.x,o.height=l.y,o.width<=0||o.height<=0)return;D&&ft.releaseRT(D);var E=ft.getRT(o.width,o.height),v=ft.getRT(o.width,o.height);t._getCacheStyle().filterCache=D,r.pushRT(),r.useRT(E);var A=t.x-m+f,T=t.y-C+f;_._fun.call(_,t,e,A,T),r.useRT(v);for(var N=0;N<s;N++){0!=N&&(r.useRT(E),r.drawTarget(v,0,0,o.width,o.height,R.TEMP.identity(),h,null,at.TOINT.overlay),r.useRT(v));var p=n[N];switch(p.type){case 16:case 8:p._glRender&&p._glRender.render(E,e,o.width,o.height,p);break;case 32:r.setColorFilter(p),r.drawTarget(E,0,0,o.width,o.height,R.EMPTY.identity(),Y.create(1,0)),r.setColorFilter(null)}}r.popRT()}a=a-f-t.x,i=i-f-t.y,l.setTo(a,i),c.transformPoint(l),a=l.x+o.x,i=l.y+o.y,r._drawRenderTexture(v,a,i,o.width,o.height,R.TEMP.identity(),1,$t.defuv),c.destroy()}},Float32Array.prototype.slice||(Float32Array.prototype.slice=WebGL._float32ArraySlice),Uint16Array.prototype.slice||(Uint16Array.prototype.slice=WebGL._uint16ArraySlice),Uint8Array.prototype.slice||(Uint8Array.prototype.slice=WebGL._uint8ArraySlice))},WebGL.enable=function(){return p.isConchApp?WebGL._nativeRender_enable():WebGL._webglRender_enable(),!0},WebGL.onStageResize=function(t,e){null!=WebGL.mainContext&&(WebGL.mainContext.viewport(0,0,t,e),bt.width=t,bt.height=e)},WebGL.mainContext=null,WebGL.shaderHighPrecision=!1,WebGL._isWebGL2=!1,WebGL.isNativeRender_enable=!1,WebGL}()),Mt=function(){function WebGLContext(){}r(WebGLContext,"laya.webgl.WebGLContext");var e=WebGLContext.prototype;return e.getContextAttributes=function(){return null},e.isContextLost=function(){},e.getSupportedExtensions=function(){return null},e.getExtension=function(t){return null},e.activeTexture=function(t){},e.attachShader=function(t,e){},e.bindAttribLocation=function(t,e,a){},e.bindBuffer=function(t,e){},e.bindFramebuffer=function(t,e){},e.bindRenderbuffer=function(t,e){},e.bindTexture=function(t,e){},e.useTexture=function(t){},e.blendColor=function(t,e,a,i){},e.blendEquation=function(t){},e.blendEquationSeparate=function(t,e){},e.blendFunc=function(t,e){},e.blendFuncSeparate=function(t,e,a,i){},e.bufferData=function(t,e,a){},e.bufferSubData=function(t,e,a){},e.checkFramebufferStatus=function(t){return null},e.clear=function(t){},e.clearColor=function(t,e,a,i){},e.clearDepth=function(t){},e.clearStencil=function(t){},e.colorMask=function(t,e,a,i){},e.compileShader=function(t){},e.copyTexImage2D=function(t,e,a,i,r,_,n,s){},e.copyTexSubImage2D=function(t,e,a,i,r,_,n,s){},e.createBuffer=function(){},e.createFramebuffer=function(){},e.createProgram=function(){},e.createRenderbuffer=function(){},e.createShader=function(t){},e.createTexture=function(){return null},e.cullFace=function(t){},e.deleteBuffer=function(t){},e.deleteFramebuffer=function(t){},e.deleteProgram=function(t){},e.deleteRenderbuffer=function(t){},e.deleteShader=function(t){},e.deleteTexture=function(t){},e.depthFunc=function(t){},e.depthMask=function(t){},e.depthRange=function(t,e){},e.detachShader=function(t,e){},e.disable=function(t){},e.disableVertexAttribArray=function(t){},e.drawArrays=function(t,e,a){},e.drawElements=function(t,e,a,i){},e.enable=function(t){},e.enableVertexAttribArray=function(t){},e.finish=function(){},e.flush=function(){},e.framebufferRenderbuffer=function(t,e,a,i){},e.framebufferTexture2D=function(t,e,a,i,r){},e.frontFace=function(t){return null},e.generateMipmap=function(t){return null},e.getActiveAttrib=function(t,e){return null},e.getActiveUniform=function(t,e){return null},e.getAttribLocation=function(t,e){return 0},e.getParameter=function(t){return null},e.getBufferParameter=function(t,e){return null},e.getError=function(){return null},e.getFramebufferAttachmentParameter=function(t,e,a){},e.getProgramParameter=function(t,e){return 0},e.getProgramInfoLog=function(t){return null},e.getRenderbufferParameter=function(t,e){return null},e.getShaderPrecisionFormat=function(t){return null},e.getShaderParameter=function(t,e){},e.getShaderInfoLog=function(t){return null},e.getShaderSource=function(t){return null},e.getTexParameter=function(t,e){},e.getUniform=function(t,e){},e.getUniformLocation=function(t,e){return null},e.getVertexAttrib=function(t,e){return null},e.getVertexAttribOffset=function(t,e){return null},e.hint=function(t,e){},e.isBuffer=function(t){},e.isEnabled=function(t){},e.isFramebuffer=function(t){},e.isProgram=function(t){},e.isRenderbuffer=function(t){},e.isShader=function(t){},e.isTexture=function(t){},e.lineWidth=function(t){},e.linkProgram=function(t){},e.pixelStorei=function(t,e){},e.polygonOffset=function(t,e){},e.readPixels=function(t,e,a,i,r,_,n){},e.renderbufferStorage=function(t,e,a,i){},e.sampleCoverage=function(t,e){},e.scissor=function(t,e,a,i){},e.shaderSource=function(t,e){},e.stencilFunc=function(t,e,a){},e.stencilFuncSeparate=function(t,e,a,i){},e.stencilMask=function(t){},e.stencilMaskSeparate=function(t,e){},e.stencilOp=function(t,e,a){},e.stencilOpSeparate=function(t,e,a,i){},e.texImage2D=function(t){},e.texParameterf=function(t,e,a){},e.texParameteri=function(t,e,a){},e.texSubImage2D=function(t){},e.uniform1f=function(t,e){},e.uniform1fv=function(t,e){},e.uniform1i=function(t,e){},e.uniform1iv=function(t,e){},e.uniform2f=function(t,e,a){},e.uniform2fv=function(t,e){},e.uniform2i=function(t,e,a){},e.uniform2iv=function(t,e){},e.uniform3f=function(t,e,a,i){},e.uniform3fv=function(t,e){},e.uniform3i=function(t,e,a,i){},e.uniform3iv=function(t,e){},e.uniform4f=function(t,e,a,i,r){},e.uniform4fv=function(t,e){},e.uniform4i=function(t,e,a,i,r){},e.uniform4iv=function(t,e){},e.uniformMatrix2fv=function(t,e,a){},e.uniformMatrix3fv=function(t,e,a){},e.uniformMatrix4fv=function(t,e,a){},e.useProgram=function(t){},e.validateProgram=function(t){},e.vertexAttrib1f=function(t,e){},e.vertexAttrib1fv=function(t,e){},e.vertexAttrib2f=function(t,e,a){},e.vertexAttrib2fv=function(t,e){},e.vertexAttrib3f=function(t,e,a,i){},e.vertexAttrib3fv=function(t,e){},e.vertexAttrib4f=function(t,e,a,i,r){},e.vertexAttrib4fv=function(t,e){},e.vertexAttribPointer=function(t,e,a,i,r,_){},e.viewport=function(t,e,a,i){},e.configureBackBuffer=function(t,e,a,i,r){void 0===i&&(i=!0),void 0===r&&(r=!1)},e.compressedTexImage2D=function(t){},e.createVertexArray=function(){throw"not implemented"},e.bindVertexArray=function(t){throw"not implemented"},e.deleteVertexArray=function(t){throw"not implemented"},e.isVertexArray=function(t){throw"not implemented"},WebGLContext.__init__=function(e){if(WebGLContext.__init_native(),laya.webgl.WebGLContext._checkExtensions(e),!xt._isWebGL2){t._setupVertexArrayObject&&t._setupVertexArrayObject(e);var a=(e.rawgl||e).getExtension("OES_vertex_array_object");if(a){console.log("EXT:webgl support OES_vertex_array_object");var i=e;i.createVertexArray=function(){return a.createVertexArrayOES()},i.bindVertexArray=function(t){a.bindVertexArrayOES(t)},i.deleteVertexArray=function(t){a.deleteVertexArrayOES(t)},i.isVertexArray=function(t){a.isVertexArrayOES(t)}}}},WebGLContext._getExtension=function(t,e){var a=WebGLContext._extentionVendorPrefixes;for(var i in a){var r=t.getExtension(a[i]+e);if(r)return r}return null},WebGLContext._checkExtensions=function(t){return WebGLContext._extTextureFilterAnisotropic=WebGLContext._getExtension(t,"EXT_texture_filter_anisotropic"),WebGLContext._compressedTextureS3tc=WebGLContext._getExtension(t,"WEBGL_compressed_texture_s3tc"),WebGLContext._compressedTexturePvrtc=WebGLContext._getExtension(t,"WEBGL_compressed_texture_pvrtc"),WebGLContext._compressedTextureEtc1=WebGLContext._getExtension(t,"WEBGL_compressed_texture_etc1"),null},WebGLContext.__init_native=function(){if(p.isConchApp){var t=WebGLContext;t.useProgram=t.useProgramForNative,t.activeTexture=t.activeTextureForNative,t.bindTexture=t.bindTextureForNative,t.bindVertexArray=t.bindVertexArrayForNative,t.setDepthTest=t.setDepthTestForNative,t.setDepthMask=t.setDepthMaskForNative,t.setDepthFunc=t.setDepthFuncForNative,t.setBlend=t.setBlendForNative,t.setBlendFunc=t.setBlendFuncForNative,t.setCullFace=t.setCullFaceForNative,t.setFrontFace=t.setFrontFaceForNative,t._checkExtensions(o.window.LayaGLContext.instance)}},WebGLContext.useProgram=function(t,e){return WebGLContext._useProgram!==e&&(t.useProgram(e),WebGLContext._useProgram=e,!0)},WebGLContext.setDepthTest=function(t,e){e!==WebGLContext._depthTest&&(WebGLContext._depthTest=e,e?t.enable(2929):t.disable(2929))},WebGLContext.setDepthMask=function(t,e){e!==WebGLContext._depthMask&&(WebGLContext._depthMask=e,t.depthMask(e))},WebGLContext.setDepthFunc=function(t,e){e!==WebGLContext._depthFunc&&(WebGLContext._depthFunc=e,t.depthFunc(e))},WebGLContext.setBlend=function(t,e){e!==WebGLContext._blend&&(WebGLContext._blend=e,e?t.enable(3042):t.disable(3042))},WebGLContext.setBlendFunc=function(t,e,a){(e!==WebGLContext._sFactor||a!==WebGLContext._dFactor)&&(WebGLContext._sFactor=e,WebGLContext._dFactor=a,t.blendFunc(e,a))},WebGLContext.setCullFace=function(t,e){e!==WebGLContext._cullFace&&(WebGLContext._cullFace=e,e?t.enable(2884):t.disable(2884))},WebGLContext.setFrontFace=function(t,e){e!==WebGLContext._frontFace&&(WebGLContext._frontFace=e,t.frontFace(e))},WebGLContext.activeTexture=function(t,e){WebGLContext._activedTextureID!==e&&(t.activeTexture(e),WebGLContext._activedTextureID=e)},WebGLContext.bindTexture=function(t,e,a){WebGLContext._activeTextures[WebGLContext._activedTextureID-33984]!==a&&(t.bindTexture(e,a),WebGLContext._activeTextures[WebGLContext._activedTextureID-33984]=a)},WebGLContext.bindVertexArray=function(t,e){WebGLContext._bindedVAO!==e&&(t.bindVertexArray(e),WebGLContext._bindedVAO=e)},WebGLContext.useProgramForNative=function(t,e){return t.useProgram(e),!0},WebGLContext.setDepthTestForNative=function(t,e){e?t.enable(2929):t.disable(2929)},WebGLContext.setDepthMaskForNative=function(t,e){t.depthMask(e)},WebGLContext.setDepthFuncForNative=function(t,e){t.depthFunc(e)},WebGLContext.setBlendForNative=function(t,e){e?t.enable(3042):t.disable(3042)},WebGLContext.setBlendFuncForNative=function(t,e,a){t.blendFunc(e,a)},WebGLContext.setCullFaceForNative=function(t,e){e?t.enable(2884):t.disable(2884)},WebGLContext.setFrontFaceForNative=function(t,e){t.frontFace(e)},WebGLContext.activeTextureForNative=function(t,e){t.activeTexture(e)},WebGLContext.bindTextureForNative=function(t,e,a){t.bindTexture(e,a)},WebGLContext.bindVertexArrayForNative=function(t,e){t.bindVertexArray(e)},WebGLContext.DEPTH_BUFFER_BIT=256,WebGLContext.STENCIL_BUFFER_BIT=1024,WebGLContext.COLOR_BUFFER_BIT=16384,WebGLContext.POINTS=0,WebGLContext.LINES=1,WebGLContext.LINE_LOOP=2,WebGLContext.LINE_STRIP=3,WebGLContext.TRIANGLES=4,WebGLContext.TRIANGLE_STRIP=5,WebGLContext.TRIANGLE_FAN=6,WebGLContext.ZERO=0,WebGLContext.ONE=1,WebGLContext.SRC_COLOR=768,WebGLContext.ONE_MINUS_SRC_COLOR=769,WebGLContext.SRC_ALPHA=770,WebGLContext.ONE_MINUS_SRC_ALPHA=771,WebGLContext.DST_ALPHA=772,WebGLContext.ONE_MINUS_DST_ALPHA=773,WebGLContext.DST_COLOR=774,WebGLContext.ONE_MINUS_DST_COLOR=775,WebGLContext.SRC_ALPHA_SATURATE=776,WebGLContext.FUNC_ADD=32774,WebGLContext.BLEND_EQUATION=32777,WebGLContext.BLEND_EQUATION_RGB=32777,WebGLContext.BLEND_EQUATION_ALPHA=34877,WebGLContext.FUNC_SUBTRACT=32778,WebGLContext.FUNC_REVERSE_SUBTRACT=32779,WebGLContext.BLEND_DST_RGB=32968,WebGLContext.BLEND_SRC_RGB=32969,WebGLContext.BLEND_DST_ALPHA=32970,WebGLContext.BLEND_SRC_ALPHA=32971,WebGLContext.CONSTANT_COLOR=32769,WebGLContext.ONE_MINUS_CONSTANT_COLOR=32770,WebGLContext.CONSTANT_ALPHA=32771,WebGLContext.ONE_MINUS_CONSTANT_ALPHA=32772,WebGLContext.BLEND_COLOR=32773,WebGLContext.ARRAY_BUFFER=34962,WebGLContext.ELEMENT_ARRAY_BUFFER=34963,WebGLContext.ARRAY_BUFFER_BINDING=34964,WebGLContext.ELEMENT_ARRAY_BUFFER_BINDING=34965,WebGLContext.STREAM_DRAW=35040,WebGLContext.STATIC_DRAW=35044,WebGLContext.DYNAMIC_DRAW=35048,WebGLContext.BUFFER_SIZE=34660,WebGLContext.BUFFER_USAGE=34661,WebGLContext.CURRENT_VERTEX_ATTRIB=34342,WebGLContext.FRONT=1028,WebGLContext.BACK=1029,WebGLContext.CULL_FACE=2884,WebGLContext.FRONT_AND_BACK=1032,WebGLContext.BLEND=3042,WebGLContext.DITHER=3024,WebGLContext.STENCIL_TEST=2960,WebGLContext.DEPTH_TEST=2929,WebGLContext.SCISSOR_TEST=3089,WebGLContext.POLYGON_OFFSET_FILL=32823,WebGLContext.SAMPLE_ALPHA_TO_COVERAGE=32926,WebGLContext.SAMPLE_COVERAGE=32928,WebGLContext.NO_ERROR=0,WebGLContext.INVALID_ENUM=1280,WebGLContext.INVALID_VALUE=1281,WebGLContext.INVALID_OPERATION=1282,WebGLContext.OUT_OF_MEMORY=1285,WebGLContext.CW=2304,WebGLContext.CCW=2305,WebGLContext.LINE_WIDTH=2849,WebGLContext.ALIASED_POINT_SIZE_RANGE=33901,WebGLContext.ALIASED_LINE_WIDTH_RANGE=33902,WebGLContext.CULL_FACE_MODE=2885,WebGLContext.FRONT_FACE=2886,WebGLContext.DEPTH_RANGE=2928,WebGLContext.DEPTH_WRITEMASK=2930,WebGLContext.DEPTH_CLEAR_VALUE=2931,WebGLContext.DEPTH_FUNC=2932,WebGLContext.STENCIL_CLEAR_VALUE=2961,WebGLContext.STENCIL_FUNC=2962,WebGLContext.STENCIL_FAIL=2964,WebGLContext.STENCIL_PASS_DEPTH_FAIL=2965,WebGLContext.STENCIL_PASS_DEPTH_PASS=2966,WebGLContext.STENCIL_REF=2967,WebGLContext.STENCIL_VALUE_MASK=2963,WebGLContext.STENCIL_WRITEMASK=2968,WebGLContext.STENCIL_BACK_FUNC=34816,WebGLContext.STENCIL_BACK_FAIL=34817,WebGLContext.STENCIL_BACK_PASS_DEPTH_FAIL=34818,WebGLContext.STENCIL_BACK_PASS_DEPTH_PASS=34819,WebGLContext.STENCIL_BACK_REF=36003,WebGLContext.STENCIL_BACK_VALUE_MASK=36004,WebGLContext.STENCIL_BACK_WRITEMASK=36005,WebGLContext.VIEWPORT=2978,WebGLContext.SCISSOR_BOX=3088,WebGLContext.COLOR_CLEAR_VALUE=3106,WebGLContext.COLOR_WRITEMASK=3107,WebGLContext.UNPACK_ALIGNMENT=3317,WebGLContext.PACK_ALIGNMENT=3333,WebGLContext.MAX_TEXTURE_SIZE=3379,WebGLContext.MAX_VIEWPORT_DIMS=3386,WebGLContext.SUBPIXEL_BITS=3408,WebGLContext.RED_BITS=3410,WebGLContext.GREEN_BITS=3411,WebGLContext.BLUE_BITS=3412,WebGLContext.ALPHA_BITS=3413,WebGLContext.DEPTH_BITS=3414,WebGLContext.STENCIL_BITS=3415,WebGLContext.POLYGON_OFFSET_UNITS=10752,WebGLContext.POLYGON_OFFSET_FACTOR=32824,WebGLContext.TEXTURE_BINDING_2D=32873,WebGLContext.SAMPLE_BUFFERS=32936,WebGLContext.SAMPLES=32937,WebGLContext.SAMPLE_COVERAGE_VALUE=32938,WebGLContext.SAMPLE_COVERAGE_INVERT=32939,WebGLContext.NUM_COMPRESSED_TEXTURE_FORMATS=34466,WebGLContext.COMPRESSED_TEXTURE_FORMATS=34467,WebGLContext.DONT_CARE=4352,WebGLContext.FASTEST=4353,WebGLContext.NICEST=4354,WebGLContext.GENERATE_MIPMAP_HINT=33170,WebGLContext.BYTE=5120,WebGLContext.UNSIGNED_BYTE=5121,WebGLContext.SHORT=5122,WebGLContext.UNSIGNED_SHORT=5123,WebGLContext.INT=5124,WebGLContext.UNSIGNED_INT=5125,WebGLContext.FLOAT=5126,WebGLContext.DEPTH_COMPONENT=6402,WebGLContext.ALPHA=6406,WebGLContext.RGB=6407,WebGLContext.RGBA=6408,WebGLContext.LUMINANCE=6409,WebGLContext.LUMINANCE_ALPHA=6410,WebGLContext.UNSIGNED_SHORT_4_4_4_4=32819,WebGLContext.UNSIGNED_SHORT_5_5_5_1=32820,WebGLContext.UNSIGNED_SHORT_5_6_5=33635,WebGLContext.FRAGMENT_SHADER=35632,WebGLContext.VERTEX_SHADER=35633,WebGLContext.MAX_VERTEX_ATTRIBS=34921,WebGLContext.MAX_VERTEX_UNIFORM_VECTORS=36347,WebGLContext.MAX_VARYING_VECTORS=36348,WebGLContext.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661,WebGLContext.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660,WebGLContext.MAX_TEXTURE_IMAGE_UNITS=34930,WebGLContext.MAX_FRAGMENT_UNIFORM_VECTORS=36349,WebGLContext.SHADER_TYPE=35663,WebGLContext.DELETE_STATUS=35712,WebGLContext.LINK_STATUS=35714,WebGLContext.VALIDATE_STATUS=35715,WebGLContext.ATTACHED_SHADERS=35717,WebGLContext.ACTIVE_UNIFORMS=35718,WebGLContext.ACTIVE_ATTRIBUTES=35721,WebGLContext.SHADING_LANGUAGE_VERSION=35724,WebGLContext.CURRENT_PROGRAM=35725,WebGLContext.NEVER=512,WebGLContext.LESS=513,WebGLContext.EQUAL=514,WebGLContext.LEQUAL=515,WebGLContext.GREATER=516,WebGLContext.NOTEQUAL=517,WebGLContext.GEQUAL=518,WebGLContext.ALWAYS=519,WebGLContext.KEEP=7680,WebGLContext.REPLACE=7681,WebGLContext.INCR=7682,WebGLContext.DECR=7683,WebGLContext.INVERT=5386,WebGLContext.INCR_WRAP=34055,WebGLContext.DECR_WRAP=34056,WebGLContext.VENDOR=7936,WebGLContext.RENDERER=7937,WebGLContext.VERSION=7938,WebGLContext.NEAREST=9728,WebGLContext.LINEAR=9729,WebGLContext.NEAREST_MIPMAP_NEAREST=9984,WebGLContext.LINEAR_MIPMAP_NEAREST=9985,WebGLContext.NEAREST_MIPMAP_LINEAR=9986,WebGLContext.LINEAR_MIPMAP_LINEAR=9987,WebGLContext.TEXTURE_MAG_FILTER=10240,WebGLContext.TEXTURE_MIN_FILTER=10241,WebGLContext.TEXTURE_WRAP_S=10242,WebGLContext.TEXTURE_WRAP_T=10243,WebGLContext.TEXTURE_2D=3553,WebGLContext.TEXTURE_3D=32879,WebGLContext.TEXTURE=5890,WebGLContext.TEXTURE_CUBE_MAP=34067,WebGLContext.TEXTURE_BINDING_CUBE_MAP=34068,WebGLContext.TEXTURE_CUBE_MAP_POSITIVE_X=34069,WebGLContext.TEXTURE_CUBE_MAP_NEGATIVE_X=34070,WebGLContext.TEXTURE_CUBE_MAP_POSITIVE_Y=34071,WebGLContext.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072,WebGLContext.TEXTURE_CUBE_MAP_POSITIVE_Z=34073,WebGLContext.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074,WebGLContext.MAX_CUBE_MAP_TEXTURE_SIZE=34076,WebGLContext.TEXTURE0=33984,WebGLContext.TEXTURE1=33985,WebGLContext.TEXTURE2=33986,WebGLContext.TEXTURE3=33987,WebGLContext.TEXTURE4=33988,WebGLContext.TEXTURE5=33989,WebGLContext.TEXTURE6=33990,WebGLContext.TEXTURE7=33991,WebGLContext.TEXTURE8=33992,WebGLContext.TEXTURE9=33993,WebGLContext.TEXTURE10=33994,WebGLContext.TEXTURE11=33995,WebGLContext.TEXTURE12=33996,WebGLContext.TEXTURE13=33997,WebGLContext.TEXTURE14=33998,WebGLContext.TEXTURE15=33999,WebGLContext.TEXTURE16=34e3,WebGLContext.TEXTURE17=34001,WebGLContext.TEXTURE18=34002,WebGLContext.TEXTURE19=34003,WebGLContext.TEXTURE20=34004,WebGLContext.TEXTURE21=34005,WebGLContext.TEXTURE22=34006,WebGLContext.TEXTURE23=34007,WebGLContext.TEXTURE24=34008,WebGLContext.TEXTURE25=34009,WebGLContext.TEXTURE26=34010,WebGLContext.TEXTURE27=34011,WebGLContext.TEXTURE28=34012,WebGLContext.TEXTURE29=34013,WebGLContext.TEXTURE30=34014,WebGLContext.TEXTURE31=34015,WebGLContext.ACTIVE_TEXTURE=34016,WebGLContext.REPEAT=10497,WebGLContext.CLAMP_TO_EDGE=33071,WebGLContext.MIRRORED_REPEAT=33648,WebGLContext.FLOAT_VEC2=35664,WebGLContext.FLOAT_VEC3=35665,WebGLContext.FLOAT_VEC4=35666,WebGLContext.INT_VEC2=35667,WebGLContext.INT_VEC3=35668,WebGLContext.INT_VEC4=35669,WebGLContext.BOOL=35670,WebGLContext.BOOL_VEC2=35671,WebGLContext.BOOL_VEC3=35672,WebGLContext.BOOL_VEC4=35673,WebGLContext.FLOAT_MAT2=35674,WebGLContext.FLOAT_MAT3=35675,WebGLContext.FLOAT_MAT4=35676,WebGLContext.SAMPLER_2D=35678,WebGLContext.SAMPLER_CUBE=35680,WebGLContext.VERTEX_ATTRIB_ARRAY_ENABLED=34338,WebGLContext.VERTEX_ATTRIB_ARRAY_SIZE=34339,WebGLContext.VERTEX_ATTRIB_ARRAY_STRIDE=34340,WebGLContext.VERTEX_ATTRIB_ARRAY_TYPE=34341,WebGLContext.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922,WebGLContext.VERTEX_ATTRIB_ARRAY_POINTER=34373,WebGLContext.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975,WebGLContext.COMPILE_STATUS=35713,WebGLContext.LOW_FLOAT=36336,WebGLContext.MEDIUM_FLOAT=36337,WebGLContext.HIGH_FLOAT=36338,WebGLContext.LOW_INT=36339,WebGLContext.MEDIUM_INT=36340,WebGLContext.HIGH_INT=36341,WebGLContext.FRAMEBUFFER=36160,WebGLContext.RENDERBUFFER=36161,WebGLContext.RGBA4=32854,WebGLContext.RGB5_A1=32855,WebGLContext.RGB565=36194,WebGLContext.DEPTH_COMPONENT16=33189,WebGLContext.STENCIL_INDEX=6401,WebGLContext.STENCIL_INDEX8=36168,WebGLContext.DEPTH_STENCIL=34041,WebGLContext.RENDERBUFFER_WIDTH=36162,WebGLContext.RENDERBUFFER_HEIGHT=36163,WebGLContext.RENDERBUFFER_INTERNAL_FORMAT=36164,WebGLContext.RENDERBUFFER_RED_SIZE=36176,WebGLContext.RENDERBUFFER_GREEN_SIZE=36177,WebGLContext.RENDERBUFFER_BLUE_SIZE=36178,WebGLContext.RENDERBUFFER_ALPHA_SIZE=36179,WebGLContext.RENDERBUFFER_DEPTH_SIZE=36180,WebGLContext.RENDERBUFFER_STENCIL_SIZE=36181,WebGLContext.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048,WebGLContext.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049,WebGLContext.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050,WebGLContext.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051,WebGLContext.COLOR_ATTACHMENT0=36064,WebGLContext.DEPTH_ATTACHMENT=36096,WebGLContext.STENCIL_ATTACHMENT=36128,WebGLContext.DEPTH_STENCIL_ATTACHMENT=33306,WebGLContext.NONE=0,WebGLContext.FRAMEBUFFER_COMPLETE=36053,WebGLContext.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054,WebGLContext.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055,WebGLContext.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057,WebGLContext.FRAMEBUFFER_UNSUPPORTED=36061,WebGLContext.FRAMEBUFFER_BINDING=36006,WebGLContext.RENDERBUFFER_BINDING=36007,WebGLContext.MAX_RENDERBUFFER_SIZE=34024,WebGLContext.INVALID_FRAMEBUFFER_OPERATION=1286,WebGLContext.UNPACK_FLIP_Y_WEBGL=37440,WebGLContext.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441,WebGLContext.CONTEXT_LOST_WEBGL=37442,WebGLContext.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443,WebGLContext.BROWSER_DEFAULT_WEBGL=37444,WebGLContext._extTextureFilterAnisotropic=null,WebGLContext._compressedTextureS3tc=null,WebGLContext._compressedTexturePvrtc=null,WebGLContext._compressedTextureEtc1=null,WebGLContext._glTextureIDs=[33984,33985,33986,33987,33988,33989,33990,33991],WebGLContext._useProgram=null,WebGLContext._depthTest=!0,WebGLContext._depthMask=!0,WebGLContext._blend=!1,WebGLContext._cullFace=!1,WebGLContext._activedTextureID=33984,WebGLContext._bindedVAO=null,i(WebGLContext,["_extentionVendorPrefixes",function(){return this._extentionVendorPrefixes=["","WEBKIT_","MOZ_"]},"_activeTextures",function(){return this._activeTextures=new Array(8)},"_depthFunc",function(){return this._depthFunc=513},"_sFactor",function(){return this._sFactor=1},"_dFactor",function(){return this._dFactor=0},"_frontFace",function(){return this._frontFace=2305}]),WebGLContext}(),yt=function(t){var e;function WebGLContext2D(){if(this._drawTriUseAbsMatrix=!1,this._id=++WebGLContext2D._COUNT,this._path=null,this._drawCount=1,this._maxNumEle=0,this._renderCount=0,this._isConvexCmd=!0,this._submits=null,this._curSubmit=null,this.meshlist=[],this._clipInfoID=0,this._lastMatScaleX=1,this._lastMatScaleY=1,this._lastMat_a=1,this._lastMat_b=0,this._lastMat_c=0,this._lastMat_d=1,this._nBlendType=0,this._saveMark=null,this._drawTextureUseColor=!1,this._italicDeg=0,this._lastTex=null,this._fillColor=0,this._flushCnt=0,this.mId=-1,this.mHaveKey=!1,this.mHaveLineKey=!1,WebGLContext2D.__super.call(this),this._width=99999999,this._height=99999999,this._submitKey=new Pt,this._transedPoints=new Array(8),this._temp4Points=new Array(8),this._clipRect=WebGLContext2D.MAXCLIPRECT,this._globalClipMatrix=new R(99999999,0,0,99999999,0,0),this._shader2D=new Dt,this.mOutPoint,WebGLContext2D._contextcount++,!WebGLContext2D.defTexture){var t=new Jt(2,2);t.setPixels(new Uint8Array(16)),WebGLContext2D.defTexture=new V(t)}this._lastTex=WebGLContext2D.defTexture,this.clear()}r(WebGLContext2D,"laya.webgl.canvas.WebGLContext2D",c);var s=WebGLContext2D.prototype;return s.clearBG=function(t,e,a,i){var r=xt.mainContext;r.clearColor(t,e,a,i),r.clear(16384)},s._getSubmits=function(){return this._submits},s._releaseMem=function(){if(this._submits){this._curMat.destroy(),this._curMat=null,this._shader2D.destroy(),this._shader2D=null;for(var t=0,e=this._submits._length;t<e;t++)this._submits[t].releaseRender();this._submits.length=0,this._submits._length=0,this._submits=null,this._curSubmit=null,this._path=null,this._save=null;var a;for(t=0,a=this.meshlist.length;t<a;t++){this.meshlist[t].destroy()}this.meshlist.length=0,this.sprite=null,this._targets&&this._targets.destroy(),this._targets=null}},s.destroy=function(){--WebGLContext2D._contextcount,this.sprite=null,this._releaseMem(),this._targets&&this._targets.destroy(),this._targets=null,this._mesh.destroy()},s.clear=function(){this._submits||(this._other=e.DEFAULT,this._curMat=R.create(),this._mesh=Ut.getAMesh(),this.meshlist.push(this._mesh),this._pathMesh=kt.getAMesh(),this.meshlist.push(this._pathMesh),this._triangleMesh=Xt.getAMesh(),this.meshlist.push(this._triangleMesh),this._submits=[],this._save=[nt.Create(this)],this._save.length=10,this._shader2D=new Dt),this._submitKey.clear(),this._mesh.clearVB(),this._renderCount++,this._drawCount=1,this._other=e.DEFAULT,this._other.lineWidth=this._shader2D.ALPHA=1,this._nBlendType=0,this._clipRect=WebGLContext2D.MAXCLIPRECT,this._curSubmit=Rt.RENDERBASE,Rt.RENDERBASE._ref=16777215,Rt.RENDERBASE._numEle=0,this._shader2D.fillStyle=this._shader2D.strokeStyle=it.DEFAULT;for(var t=0,a=this._submits._length;t<a;t++)this._submits[t].releaseRender();this._submits._length=0,this._curMat.identity(),this._other.clear(),this._saveMark=this._save[0],this._save._length=1},s.size=function(t,e){this._width==t&&this._height==e||(this._width=t,this._height=e,this._targets&&(this._targets.destroy(),this._targets=new $t(t,e,1,-1)),p._context==this&&(xt.mainContext.viewport(0,0,t,e),bt.width=t,bt.height=e)),0===t&&0===e&&this._releaseMem()},s.getMatScaleX=function(){return this._lastMat_a==this._curMat.a&&this._lastMat_b==this._curMat.b?this._lastMatScaleX:(this._lastMatScaleX=this._curMat.getScaleX(),this._lastMat_a=this._curMat.a,this._lastMat_b=this._curMat.b,this._lastMatScaleX)},s.getMatScaleY=function(){return this._lastMat_c==this._curMat.c&&this._lastMat_d==this._curMat.d?this._lastMatScaleY:(this._lastMatScaleY=this._curMat.getScaleY(),this._lastMat_c=this._curMat.c,this._lastMat_d=this._curMat.d,this._lastMatScaleY)},s.setFillColor=function(t){this._fillColor=t},s.getFillColor=function(){return this._fillColor},s.translate=function(t,e){0===t&&0===e||(ot.save(this),this._curMat._bTransform?(st.save(this),this._curMat.tx+=t*this._curMat.a+e*this._curMat.c,this._curMat.ty+=t*this._curMat.b+e*this._curMat.d):(this._curMat.tx=t,this._curMat.ty=e))},s.save=function(){this._save[this._save._length++]=nt.Create(this)},s.restore=function(){var t=this._save._length,e=this._nBlendType;if(!(t<1)){for(var a=t-1;a>=0;a--){var i=this._save[a];if(i.restore(this),i.isSaveMark())return void(this._save._length=a)}e!=this._nBlendType&&(this._curSubmit=Rt.RENDERBASE)}},s.fillText=function(t,e,a,i,r,_){this._fillText(t,null,e,a,i,r,null,0,null)},s._fillText=function(t,e,a,i,r,_,n,s,o,h){void 0===h&&(h=0),t?WebGLContext2D._charBook.filltext(this,t,a,i,r,_,n,s,o,h):e&&WebGLContext2D._charBook.fillWords(this,e,a,i,r,_,n,s)},s._fast_filltext=function(t,e,a,i,r,_,n,s,o){void 0===o&&(o=0),WebGLContext2D._charBook._fast_filltext(this,t,null,e,a,i,r,_,n,s,o)},s.fillWords=function(t,e,a,i,r){this._fillText(null,t,e,a,i,r,null,-1,null,0)},s.fillBorderWords=function(t,e,a,i,r,_,n){this._fillBorderText(null,t,e,a,i,r,_,n,null)},s.drawText=function(t,e,a,i,r,_){this._fillText(t,null,e,a,i,l.create(r).strColor,null,-1,_)},s.strokeWord=function(t,e,a,i,r,_,n){this._fillText(t,null,e,a,i,null,l.create(r).strColor,_||1,n)},s.fillBorderText=function(t,e,a,i,r,_,n,s){this._fillBorderText(t,null,e,a,i,l.create(r).strColor,l.create(_).strColor,n,s)},s._fillBorderText=function(t,e,a,i,r,_,n,s,o){this._fillText(t,e,a,i,r,_,n,s||1,o)},s._fillRect=function(t,e,a,i,r){var _=this._curSubmit,n=_&&2===_._key.submitType&&_._key.blendShader===this._submitKey.blendShader;this._mesh.vertNum+4>65535&&(this._mesh=Ut.getAMesh(),this.meshlist.push(this._mesh),n=!1),n&&(n=n&&this.isSameClipInfo(_)),this.transformQuad(t,e,a,i,0,this._curMat,this._transedPoints),this.clipedOff(this._transedPoints)||(this._mesh.addQuad(this._transedPoints,V.NO_UV,r,!1),n||(_=this._curSubmit=Vt.create(this,this._mesh,Y.create(1,0)),this._submits[this._submits._length++]=_,this.copyClipInfo(_,this._globalClipMatrix),_.shaderValue.textureHost=this._lastTex,_._key.copyFrom2(this._submitKey,2,this._lastTex&&this._lastTex.bitmap?this._lastTex.bitmap.id:-1),_._renderType=10016),this._curSubmit._numEle+=6,this._mesh.indexNum+=6,this._mesh.vertNum+=4)},s.fillRect=function(t,e,a,i,r){var _=r?it.create(r):this._shader2D.fillStyle,n=this.mixRGBandAlpha(_.toInt());this._fillRect(t,e,a,i,n)},s.fillTexture=function(t,e,i,r,_,n,s,o){if(t._getSource()){var h=this._curSubmit;this._mesh.vertNum+4>65535&&(this._mesh=Ut.getAMesh(),this.meshlist.push(this._mesh),!1);t.bitmap;var l=!0,u=!0;switch(n){case"repeat":break;case"repeat-x":u=!1;break;case"repeat-y":l=!1;break;case"no-repeat":l=u=!1}var c=this._temp4Points,d=0,f=0,D=0,m=0,C=0,E=0;if(s.x<0?(D=e,d=-s.x%t.width/t.width):D=e+s.x,s.y<0?(m=i,f=-s.y%t.height/t.height):m=i+s.y,C=e+r,E=i+_,!l&&(C=Math.min(C,e+s.x+t.width)),!u&&(E=Math.min(E,i+s.y+t.height)),!(C<e||E<i||D>C||m>E)){var v=(C-e-s.x)/t.width,A=(E-i-s.y)/t.height;if(this.transformQuad(D,m,C-D,E-m,0,this._curMat,this._transedPoints),c[0]=d,c[1]=f,c[2]=v,c[3]=f,c[4]=v,c[5]=A,c[6]=d,c[7]=A,!this.clipedOff(this._transedPoints)){var R=this._mixRGBandAlpha(4294967295,this._shader2D.ALPHA);this._mesh.addQuad(this._transedPoints,c,R,!0);var T=Y.create(1,0);T.defines.add(256),T.u_TexRange=t.uvrect,h=this._curSubmit=Vt.create(this,this._mesh,T),this._submits[this._submits._length++]=h,this.copyClipInfo(h,this._globalClipMatrix),h.shaderValue.textureHost=t,h._renderType=10016,this._curSubmit._numEle+=6,this._mesh.indexNum+=6,this._mesh.vertNum+=4}this.breakNextMerge()}}else this.sprite&&a.systemTimer.callLater(this,this._repaintSprite)},s.setColorFilter=function(t){z.save(this,8388608,this,!0),this._colorFiler=t,this._curSubmit=Rt.RENDERBASE},s.drawTexture=function(t,e,a,i,r){this._drawTextureM(t,e,a,i,r,null,1,null)},s.drawTextures=function(t,e,i,r){if(t._getSource())for(var _=e.length/2,n=0,s=0;s<_;s++)this._inner_drawTexture(t,t.bitmap.id,e[n++]+i,e[n++]+r,0,0,null,null,1);else this.sprite&&a.systemTimer.callLater(this,this._repaintSprite)},s._drawTextureAddSubmit=function(t,e){var a=null;a=Vt.create(this,this._mesh,Y.create(1,0)),this._submits[this._submits._length++]=a,a.shaderValue.textureHost=e,a._key.copyFrom2(this._submitKey,2,t),a._renderType=10016,this._curSubmit=a},s._drawTextureM=function(t,e,i,r,_,n,s,o){return t._getSource()?this._inner_drawTexture(t,t.bitmap.id,e,i,r,_,n,o,s):(this.sprite&&a.systemTimer.callLater(this,this._repaintSprite),!1)},s._drawRenderTexture=function(t,e,a,i,r,_,n,s){return this._inner_drawTexture(t,-1,e,a,i,r,_,s,1)},s.submitDebugger=function(){this._submits[this._submits._length++]=Tt.create([],function(){},this)},s.copyClipInfo=function(t,e){var a=t.shaderValue.clipMatDir;a[0]=e.a,a[1]=e.b,a[2]=e.c,a[3]=e.d;var i=t.shaderValue.clipMatPos;i[0]=e.tx,i[1]=e.ty,t.clipInfoID=this._clipInfoID},s.isSameClipInfo=function(t){return t.clipInfoID===this._clipInfoID},s._useNewTex2DSubmit=function(t,e){this._mesh.vertNum+e>65535&&(this._mesh=Ut.getAMesh(),this.meshlist.push(this._mesh));var a=Vt.create(this,this._mesh,Y.create(1,0));this._submits[this._submits._length++]=this._curSubmit=a,a.shaderValue.textureHost=t,this.copyClipInfo(a,this._globalClipMatrix)},s._drawTexRect=function(t,e,a,i,r){this.transformQuad(t,e,a,i,this._italicDeg,this._curMat,this._transedPoints);var _=this._transedPoints;_[0]=_[0]+.5|0,_[1]=_[1]+.5|0,_[2]=_[2]+.5|0,_[3]=_[3]+.5|0,_[4]=_[4]+.5|0,_[5]=_[5]+.5|0,_[6]=_[6]+.5|0,_[7]=_[7]+.5|0,this.clipedOff(this._transedPoints)||(this._mesh.addQuad(this._transedPoints,r,this._fillColor,!0),this._curSubmit._numEle+=6,this._mesh.indexNum+=6,this._mesh.vertNum+=4)},s._inner_drawTexture=function(t,e,a,i,r,_,n,s,o){var h=this._curSubmit._key;if(s=s||t._uv,4===h.submitType&&h.other===e){var l=WebGLContext2D._drawTexToDrawTri_Vert;return l[0]=a,l[1]=i,l[2]=a+r,l[3]=i,l[4]=a+r,l[5]=i+_,l[6]=a,l[7]=i+_,this._drawTriUseAbsMatrix=!0,this.drawTriangles(t,0,0,l,s,WebGLContext2D._drawTexToDrawTri_Index,n,o,null,"normal"),this._drawTriUseAbsMatrix=!1,!0}this._drawCount++;var u=e>=0&&2===h.submitType&&h.other===e;u&&(u=u&&this.isSameClipInfo(this._curSubmit)),this._lastTex=t;var c=this._mixRGBandAlpha(4294967295,this._shader2D.ALPHA*o);if(this._mesh.vertNum+4>65535&&(this._mesh=Ut.getAMesh(),this.meshlist.push(this._mesh),u=!1),this.transformQuad(a,i,r||t.width,_||t.height,this._italicDeg,n||this._curMat,this._transedPoints),!this.clipedOff(this._transedPoints)){if(this._mesh.addQuad(this._transedPoints,s,c,!0),!u){var d=Vt.create(this,this._mesh,Y.create(1,0));this._submits[this._submits._length++]=this._curSubmit=d,d.shaderValue.textureHost=t,d._key.other=e,this.copyClipInfo(d,this._globalClipMatrix)}return this._curSubmit._numEle+=6,this._mesh.indexNum+=6,this._mesh.vertNum+=4,!0}return!1},s.transform4Points=function(t,e,a){var i=e.tx,r=e.ty;e._bTransform?(a[0]=t[0]*e.a+t[1]*e.c+i,a[1]=t[0]*e.b+t[1]*e.d+r,a[2]=t[2]*e.a+t[3]*e.c+i,a[3]=t[2]*e.b+t[3]*e.d+r,a[4]=t[4]*e.a+t[5]*e.c+i,a[5]=t[4]*e.b+t[5]*e.d+r,a[6]=t[6]*e.a+t[7]*e.c+i,a[7]=t[6]*e.b+t[7]*e.d+r):(a[0]=t[0]+i,a[1]=t[1]+r,a[2]=t[2]+i,a[3]=t[3]+r,a[4]=t[4]+i,a[5]=t[5]+r,a[6]=t[6]+i,a[7]=t[7]+r)},s.clipedOff=function(t){return this._clipRect.width<=0||this._clipRect.height<=0},s.transformQuad=function(t,e,a,i,r,_,n){var s=0;0!=r&&(s=Math.tan(r*Math.PI/180)*i);var o=t+a,h=e+i;this._temp4Points[0]=t+s,this._temp4Points[1]=e,this._temp4Points[2]=o+s,this._temp4Points[3]=e,this._temp4Points[4]=o,this._temp4Points[5]=h,this._temp4Points[6]=t,this._temp4Points[7]=h,this.transform4Points(this._temp4Points,_,n)},s.pushRT=function(){this.addRenderObject(Tt.create(null,$t.pushRT,this))},s.popRT=function(){this.addRenderObject(Tt.create(null,$t.popRT,this)),this.breakNextMerge()},s.useRT=function(t){this.addRenderObject(Tt.create([t],function(t){if(!t)throw"error useRT";t.start(),t.clear(0,0,0,0)},this)),this.breakNextMerge()},s.RTRestore=function(t){this.addRenderObject(Tt.create([t],function(t){t.restore()},this)),this.breakNextMerge()},s.breakNextMerge=function(){this._curSubmit=Rt.RENDERBASE},s._repaintSprite=function(){this.sprite&&this.sprite.repaint()},s.drawTextureWithTransform=function(t,e,a,i,r,_,n,s,o,h){if(_){var l=this._curMat;WebGLContext2D._tmpMatrix.a=_.a,WebGLContext2D._tmpMatrix.b=_.b,WebGLContext2D._tmpMatrix.c=_.c,WebGLContext2D._tmpMatrix.d=_.d,WebGLContext2D._tmpMatrix.tx=_.tx+n,WebGLContext2D._tmpMatrix.ty=_.ty+s,WebGLContext2D._tmpMatrix._bTransform=_._bTransform,_&&l._bTransform?(R.mul(WebGLContext2D._tmpMatrix,l,WebGLContext2D._tmpMatrix),(_=WebGLContext2D._tmpMatrix)._bTransform=!0):_=WebGLContext2D._tmpMatrix,this._drawTextureM(t,e,a,i,r,_,o,null)}else this._drawTextureM(t,e+n,a+s,i,r,null,o,null)},s._flushToTarget=function(t,e){bt.worldScissorTest=!1,xt.mainContext.disable(3089);var a=bt.worldAlpha,i=bt.worldMatrix4,r=bt.worldMatrix;bt.worldShaderDefines;bt.worldMatrix=R.EMPTY,bt.restoreTempArray(),bt.worldMatrix4=bt.TEMPMAT4_ARRAY,bt.worldAlpha=1,Yt.activeShader=null,e.start(),u.showCanvasMark?e.clear(0,1,0,.3):e.clear(0,0,0,0),t._curSubmit=Rt.RENDERBASE,t.flush(),t.clear(),e.restore(),t._curSubmit=Rt.RENDERBASE,Yt.activeShader=null,bt.worldAlpha=a,bt.worldMatrix4=i,bt.worldMatrix=r},s.drawCanvas=function(t,e,a,i,r){var _,n=t.context;if(n._targets)n._submits._length>0&&(_=Tt.create([n,n._targets],this._flushToTarget,this),this._submits[this._submits._length++]=_),this._drawRenderTexture(n._targets,e,a,i,r,null,1,$t.flipyuv),this._curSubmit=Rt.RENDERBASE;else{n.touches&&n.touches.forEach(function(t){t.touch()}),_=Wt.create(n,this._shader2D.ALPHA,this._shader2D.filters),this._submits[this._submits._length++]=_,_._key.clear();var s=i/t.width,o=r/t.height,h=_._matrix;this._curMat.copyTo(h),1!=s&&1!=o&&h.scale(s,o);var l=h.tx,c=h.ty;h.tx=h.ty=0,h.transformPoint(P.TEMP.setTo(e,a)),h.translate(P.TEMP.x+l,P.TEMP.y+c),this._curSubmit=Rt.RENDERBASE}u.showCanvasMark&&(this.save(),this.lineWidth=4,this.strokeStyle=n._targets?"yellow":"green",this.strokeRect(e-1,a-1,i+2,r+2,1),this.strokeRect(e,a,i,r,1),this.restore())},s.drawTarget=function(t,e,a,i,r,_,n,s,o){void 0===o&&(o=-1),this._drawCount++;this.mixRGBandAlpha(this._drawTextureUseColor?this.fillStyle?this.fillStyle.toInt():0:4294967295);if(this._mesh.vertNum+4>65535&&(this._mesh=Ut.getAMesh(),this.meshlist.push(this._mesh)),this.transformQuad(e,a,i,r,0,_||this._curMat,this._transedPoints),!this.clipedOff(this._transedPoints)){this._mesh.addQuad(this._transedPoints,s||V.DEF_UV,4294967295,!0);var h=this._curSubmit=Nt.create(this,this._mesh,n,t);return h.blendType=-1==o?this._nBlendType:o,this.copyClipInfo(h,this._globalClipMatrix),h._numEle=6,this._mesh.indexNum+=6,this._mesh.vertNum+=4,this._maxNumEle=Math.max(this._maxNumEle,h._numEle),this._submits[this._submits._length++]=h,this._curSubmit=Rt.RENDERBASE,!0}return this._curSubmit=Rt.RENDERBASE,!1},s.drawTriangles=function(t,e,i,r,_,n,s,o,h,l){if(t._getSource()){this._drawCount++;var u=null,c=!1;h&&(u=this._colorFiler,this._colorFiler=h,this._curSubmit=Rt.RENDERBASE,c=u!=h);var d=at.TOINT[l]||0,f=t.bitmap,D=this._curSubmit._key,m=4===D.submitType&&D.other===f.id&&D.blendShader==d,C=this._mixRGBandAlpha(4294967295,this._shader2D.ALPHA*o),E=r.length/2,v=n.length;if(this._triangleMesh.vertNum+E>65535&&(this._triangleMesh=Xt.getAMesh(),this.meshlist.push(this._triangleMesh),m=!1),!m){var A=this._curSubmit=Vt.create(this,this._triangleMesh,Y.create(1,0));A.shaderValue.textureHost=t,A._renderType=10016,A._key.blendShader=d,A._blendFn=this._targets?at.targetFns[d]:at.fns[d],A._key.submitType=4,A._key.other=f.id,this.copyClipInfo(A,this._globalClipMatrix),this._submits[this._submits._length++]=A}s?(WebGLContext2D._tmpMatrix.a=s.a,WebGLContext2D._tmpMatrix.b=s.b,WebGLContext2D._tmpMatrix.c=s.c,WebGLContext2D._tmpMatrix.d=s.d,WebGLContext2D._tmpMatrix.tx=s.tx+e,WebGLContext2D._tmpMatrix.ty=s.ty+i):(WebGLContext2D._tmpMatrix.a=1,WebGLContext2D._tmpMatrix.b=0,WebGLContext2D._tmpMatrix.c=0,WebGLContext2D._tmpMatrix.d=1,WebGLContext2D._tmpMatrix.tx=e,WebGLContext2D._tmpMatrix.ty=i),this._drawTriUseAbsMatrix||R.mul(WebGLContext2D._tmpMatrix,this._curMat,WebGLContext2D._tmpMatrix),this._triangleMesh.addData(r,_,n,WebGLContext2D._tmpMatrix,C,this),this._curSubmit._numEle+=v,this._maxNumEle=Math.max(this._maxNumEle,this._curSubmit._numEle),c&&(this._colorFiler=u,this._curSubmit=Rt.RENDERBASE)}else this.sprite&&a.systemTimer.callLater(this,this._repaintSprite)},s.transform=function(t,e,a,i,r,_){st.save(this),R.mul(R.TEMP.setTo(t,e,a,i,r,_),this._curMat,this._curMat),this._curMat._checkTransform()},s._transformByMatrix=function(t,e,a){t.setTranslate(e,a),R.mul(t,this._curMat,this._curMat),t.setTranslate(0,0),this._curMat._bTransform=!0},s.setTransformByMatrix=function(t){t.copyTo(this._curMat)},s.rotate=function(t){st.save(this),this._curMat.rotateEx(t)},s.scale=function(t,e){st.save(this),this._curMat.scaleEx(t,e)},s.clipRect=function(t,e,a,i){_t.save(this),this._clipRect==WebGLContext2D.MAXCLIPRECT?this._clipRect=new L(t,e,a,i):(this._clipRect.width=a,this._clipRect.height=i,this._clipRect.x=t,this._clipRect.y=e),WebGLContext2D._clipID_Gen++,WebGLContext2D._clipID_Gen%=1e4,this._clipInfoID=WebGLContext2D._clipID_Gen;var r=this._globalClipMatrix,_=r.tx,n=r.ty,s=_+r.a,o=n+r.d;if(this._clipRect.width>=99999999?(r.a=r.d=99999999,r.b=r.c=r.tx=r.ty=0):this._curMat._bTransform?(r.tx=this._clipRect.x*this._curMat.a+this._clipRect.y*this._curMat.c+this._curMat.tx,r.ty=this._clipRect.x*this._curMat.b+this._clipRect.y*this._curMat.d+this._curMat.ty,r.a=this._clipRect.width*this._curMat.a,r.b=this._clipRect.width*this._curMat.b,r.c=this._clipRect.height*this._curMat.c,r.d=this._clipRect.height*this._curMat.d):(r.tx=this._clipRect.x+this._curMat.tx,r.ty=this._clipRect.y+this._curMat.ty,r.a=this._clipRect.width,r.b=r.c=0,r.d=this._clipRect.height),r.a>0&&r.d>0){var h=r.tx+r.a,l=r.ty+r.d;h<=_||l<=n||r.tx>=s||r.ty>=o?(r.a=-.1,r.d=-.1):(r.tx<_&&(r.a-=_-r.tx,r.tx=_),h>s&&(r.a-=h-s),r.ty<n&&(r.d-=n-r.ty,r.ty=n),l>o&&(r.d-=l-o),r.a<=0&&(r.a=-.1),r.d<=0&&(r.d=-.1))}},s.drawMesh=function(t,e,a,i,r,_,n,s,o){void 0===o&&(o=0)},s.addRenderObject=function(t){this._submits[this._submits._length++]=t},s.submitElement=function(t,e){p._context;var a=this._submits,i=a._length;e<0&&(e=a._length);for(var r=Rt.RENDERBASE;t<e;)this._renderNextSubmitIndex=t+1,a[t]!==Rt.RENDERBASE?(Rt.preRender=r,t+=(r=a[t]).renderSubmit()):t++;return i},s.flush=function(){var t=this.submitElement(0,this._submits._length);this._path&&this._path.reset(),Ct.instance&&Ct.getInstance().reset(),this._curSubmit=Rt.RENDERBASE;for(var e=0,a=this.meshlist.length;e<a;e++){var i=this.meshlist[e];i.canReuse?i.releaseMesh():i.destroy()}return this.meshlist.length=0,this._mesh=Ut.getAMesh(),this._pathMesh=kt.getAMesh(),this._triangleMesh=Xt.getAMesh(),this.meshlist.push(this._mesh,this._pathMesh,this._triangleMesh),this._flushCnt++,this._flushCnt%600==0&&p._context==this&&ht.charbookInst&&ht.charbookInst.GC(),t},s.setPathId=function(t){if(this.mId=t,-1!=this.mId){this.mHaveKey=!1;var e=k.getInstance();e.shapeDic[this.mId]&&(this.mHaveKey=!0),this.mHaveLineKey=!1,e.shapeLineDic[this.mId]&&(this.mHaveLineKey=!0)}},s.beginPath=function(t){void 0===t&&(t=!1),this._getPath().beginPath(t)},s.closePath=function(){this._path.closePath()},s.addPath=function(t,e,a,i,r){var _=0,n=this._curMat;if(this._curMat._bTransform)for(var s=0,o=t.length/2;s<o;s++){var h=t[_]+i,l=t[_+1]+r;t[_]=h*n.a+l*n.c+n.tx,t[_+1]=h*n.b+l*n.d+n.ty,_+=2}else if(0!=n.tx||0!=n.ty||i||r)for(s=0,o=t.length/2;s<o;s++){var u=t[_]+i,c=t[_+1]+r;t[_]=u+n.tx,t[_+1]=c+n.ty,_+=2}else;this._getPath().push(t,a)},s.fill=function(){var t=this._getPath(),e=this._curSubmit,a=3===e._key.submitType&&e._key.blendShader===this._submitKey.blendShader;a&&(a=a&&this.isSameClipInfo(e)),a||(this._curSubmit=this.addVGSubmit(this._pathMesh));for(var i,r=this.mixRGBandAlpha(this.fillStyle.toInt()),_=0,n=0,s=t.paths.length;n<s;n++){var o=t.paths[n],h=o.path.length/2;if(!(h<3||3==h&&!o.convex)){this._pathMesh.vertNum+h>65535&&(this._curSubmit._numEle+=_,_=0,this._pathMesh=kt.getAMesh(),this._curSubmit=this.addVGSubmit(this._pathMesh));var l=this._pathMesh.vertNum;if(o.convex){var u=h-2;i=new Array(3*u);for(var c=0,d=0;d<u;d++)i[c++]=l,i[c++]=d+1+l,i[c++]=d+2+l}else if(i=vt.earcut(o.path,null,2),l>0)for(var f=0;f<i.length;f++)i[f]+=l;this._pathMesh.addVertAndIBToMesh(this,o.path,r,i),_+=i.length}}this._curSubmit._numEle+=_},s.addVGSubmit=function(t){var e=Rt.createShape(this,t,0,Y.create(4,0));return e._key.blendShader=this._submitKey.blendShader,e._key.submitType=3,this._submits[this._submits._length++]=e,this.copyClipInfo(e,this._globalClipMatrix),e},s.stroke=function(){if(this.lineWidth>0){var t=this.mixRGBandAlpha(this.strokeStyle._color.numColor),e=this._getPath(),a=this._curSubmit,i=3===a._key.submitType&&a._key.blendShader===this._submitKey.blendShader;i&&(i=i&&this.isSameClipInfo(a)),i||(this._curSubmit=this.addVGSubmit(this._pathMesh));for(var r=0,_=0,n=e.paths.length;_<n;_++){var s=e.paths[_];if(!(s.path.length<=0)){var o=[],h=[],l=2*s.path.length;l<2||(this._pathMesh.vertNum+l>65535&&(this._curSubmit._numEle+=r,r=0,this._pathMesh=kt.getAMesh(),this.meshlist.push(this._pathMesh),this._curSubmit=this.addVGSubmit(this._pathMesh)),Et.createLine2(s.path,o,this.lineWidth,this._pathMesh.vertNum,h,s.loop),this._pathMesh.addVertAndIBToMesh(this,h,t,o),r+=o.length)}}this._curSubmit._numEle+=r}},s.moveTo=function(t,e,a){void 0===a&&(a=!0);var i=this._getPath();if(i.newPath(),i._lastOriX=t,i._lastOriY=e,a){var r=t,_=e;t=this._curMat.a*r+this._curMat.c*_+this._curMat.tx,e=this._curMat.b*r+this._curMat.d*_+this._curMat.ty}i.addPoint(t,e)},s.lineTo=function(t,e,a){void 0===a&&(a=!0);var i=this._getPath();if(!(Math.abs(t-i._lastOriX)<.001&&Math.abs(e-i._lastOriY)<.001)){if(i._lastOriX=t,i._lastOriY=e,a){var r=t,_=e;t=this._curMat.a*r+this._curMat.c*_+this._curMat.tx,e=this._curMat.b*r+this._curMat.d*_+this._curMat.ty}i.addPoint(t,e)}},s.arcTo=function(t,e,a,i,r){var _=0,n=0,s=0,o=this._path._lastOriX-t,h=this._path._lastOriY-e,l=Math.sqrt(o*o+h*h);if(!(l<=1e-6)){var u=o/l,c=h/l,d=a-t,f=i-e,D=d*d+f*f,m=Math.sqrt(D);if(!(m<=1e-6)){var C=d/m,E=f/m,v=u+C,A=c+E,R=Math.sqrt(v*v+A*A);if(!(R<=1e-6)){var T=v/R,P=A/R,N=Math.acos(T*u+P*c),L=Math.PI/2-N,p=(l=r/Math.tan(L))*u+t,b=l*c+e,S=Math.sqrt(l*l+r*r),x=t+T*S,M=e+P*S,y=0,O=0;if(u*E-c*C>=0){var g=2*L/WebGLContext2D.SEGNUM;y=Math.sin(g),O=Math.cos(g)}else g=2*-L/WebGLContext2D.SEGNUM,y=Math.sin(g),O=Math.cos(g);var B=this._path._lastOriX,w=this._path._lastOriY,I=p,F=b;(Math.abs(I-this._path._lastOriX)>.1||Math.abs(F-this._path._lastOriY)>.1)&&(n=this._curMat.a*I+this._curMat.c*F+this._curMat.tx,s=this._curMat.b*I+this._curMat.d*F+this._curMat.ty,B=I,w=F,this._path.addPoint(n,s));var G=p-x,W=b-M;for(_=0;_<WebGLContext2D.SEGNUM;_++){var V=G*O+W*y,U=-G*y+W*O;if(n=V+x,s=U+M,Math.abs(B-n)>.1||Math.abs(w-s)>.1){var X=n,k=s;n=this._curMat.a*X+this._curMat.c*k+this._curMat.tx,s=this._curMat.b*X+this._curMat.d*k+this._curMat.ty,this._path.addPoint(n,s),B=n,w=s}G=V,W=U}}}}},s.arc=function(t,e,a,i,r,_,n){void 0===_&&(_=!1),void 0===n&&(n=!0);var s,o=0,h=0,l=0,u=0,c=0,d=0,f=0,D=0;if(h=r-i,_)if(Math.abs(h)>=2*Math.PI)h=2*-Math.PI;else for(;h>0;)h-=2*Math.PI;else if(Math.abs(h)>=2*Math.PI)h=2*Math.PI;else for(;h<0;)h+=2*Math.PI;s=h/(D=a<101?Math.max(10,h*a/5):a<201?Math.max(10,h*a/20):Math.max(10,h*a/40))/2,l=Math.abs(4/3*(1-Math.cos(s))/Math.sin(s)),_&&(l=-l);var m=this._getPath();for(f=0;f<=D;f++)if(o=i+h*(f/D),u=Math.cos(o),d=e+Math.sin(o)*a,(c=t+u*a)!=this._path._lastOriX||d!=this._path._lastOriY){var C=c,E=d;c=this._curMat.a*C+this._curMat.c*E+this._curMat.tx,d=this._curMat.b*C+this._curMat.d*E+this._curMat.ty,m.addPoint(c,d)}if(u=Math.cos(r),d=e+Math.sin(r)*a,(c=t+u*a)!=this._path._lastOriX||d!=this._path._lastOriY){var v=c,A=d;c=this._curMat.a*v+this._curMat.c*A+this._curMat.tx,d=this._curMat.b*v+this._curMat.d*A+this._curMat.ty,m.addPoint(c,d)}},s.quadraticCurveTo=function(t,e,a,i){for(var r=n.I.getBezierPoints([this._path._lastOriX,this._path._lastOriY,t,e,a,i],30,2),_=0,s=r.length/2;_<s;_++)this.lineTo(r[2*_],r[2*_+1]);this.lineTo(a,i)},s.rect=function(t,e,a,i){this._other=this._other.make(),this._other.path||(this._other.path=new rt),this._other.path.rect(t,e,a,i)},s.mixRGBandAlpha=function(t){return this._mixRGBandAlpha(t,this._shader2D.ALPHA)},s._mixRGBandAlpha=function(t,e){var a=(4278190080&t)>>>24;return 0!=a?a*=e:a=255*e,16777215&t|a<<24},s.strokeRect=function(t,e,a,i,r){if(this.lineWidth>0){var _=this.mixRGBandAlpha(this.strokeStyle._color.numColor),n=this.lineWidth/2;this._fillRect(t-n,e-n,a+this.lineWidth,this.lineWidth,_),this._fillRect(t-n,e-n+i,a+this.lineWidth,this.lineWidth,_),this._fillRect(t-n,e+n,this.lineWidth,i-this.lineWidth,_),this._fillRect(t-n+a,e+n,this.lineWidth,i-this.lineWidth,_)}},s.clip=function(){},s.drawParticle=function(t,e,a){a.x=t,a.y=e,this._submits[this._submits._length++]=a},s._getPath=function(){return this._path||(this._path=new rt)},_(0,s,"globalCompositeOperation",function(){return at.NAMES[this._nBlendType]},function(t){var e=at.TOINT[t];null==e||this._nBlendType===e||(z.save(this,65536,this,!0),this._curSubmit=Rt.RENDERBASE,this._nBlendType=e)}),_(0,s,"strokeStyle",function(){return this._shader2D.strokeStyle},function(t){this._shader2D.strokeStyle.equal(t)||(z.save(this,512,this._shader2D,!1),this._shader2D.strokeStyle=it.create(t),this._submitKey.other=-this._shader2D.strokeStyle.toInt())}),_(0,s,"globalAlpha",function(){return this._shader2D.ALPHA},function(t){(t=Math.floor(1e3*t)/1e3)!=this._shader2D.ALPHA&&(z.save(this,1,this._shader2D,!1),this._shader2D.ALPHA=t)}),_(0,s,"asBitmap",null,function(t){if(t){if(this._targets||(this._targets=new $t(this._width,this._height,1,-1)),!this._width||!this._height)throw Error("asBitmap no size!")}else this._targets&&this._targets.destroy(),this._targets=null}),_(0,s,"fillStyle",function(){return this._shader2D.fillStyle},function(t){this._shader2D.fillStyle.equal(t)||(z.save(this,2,this._shader2D,!1),this._shader2D.fillStyle=it.create(t),this._submitKey.other=-this._shader2D.fillStyle.toInt())}),_(0,s,"textAlign",function(){return this._other.textAlign},function(t){this._other.textAlign===t||(this._other=this._other.make(),z.save(this,32768,this._other,!1),this._other.textAlign=t)}),_(0,s,"lineWidth",function(){return this._other.lineWidth},function(t){this._other.lineWidth===t||(this._other=this._other.make(),z.save(this,256,this._other,!1),this._other.lineWidth=t)}),_(0,s,"textBaseline",function(){return this._other.textBaseline},function(t){this._other.textBaseline===t||(this._other=this._other.make(),z.save(this,16384,this._other,!1),this._other.textBaseline=t)}),_(0,s,"font",null,function(t){this._other=this._other.make(),z.save(this,8,this._other,!1)}),_(0,s,"canvas",function(){return this._canvas}),WebGLContext2D.__init__=function(){e.DEFAULT=new e},WebGLContext2D._tempPoint=new P,WebGLContext2D._SUBMITVBSIZE=32e3,WebGLContext2D._MAXSIZE=99999999,WebGLContext2D._MAXVERTNUM=65535,WebGLContext2D.MAXCLIPRECT=new L(0,0,99999999,99999999),WebGLContext2D._COUNT=0,WebGLContext2D._tmpMatrix=new R,WebGLContext2D.SEGNUM=32,WebGLContext2D._contextcount=0,WebGLContext2D._clipID_Gen=0,WebGLContext2D.defTexture=null,i(WebGLContext2D,["_drawStyleTemp",function(){return this._drawStyleTemp=new it(null)},"_keyMap",function(){return this._keyMap=new F},"_drawTexToDrawTri_Vert",function(){return this._drawTexToDrawTri_Vert=new Float32Array(8)},"_drawTexToDrawTri_Index",function(){return this._drawTexToDrawTri_Index=new Uint16Array([0,1,2,0,2,3])},"_charBook",function(){return this._charBook=new ht}]),WebGLContext2D.__init$=function(){e=function(){function ContextParams(){this.lineWidth=1,this.path=null,this.textAlign=null,this.textBaseline=null}r(ContextParams,"");var t=ContextParams.prototype;return t.clear=function(){this.lineWidth=1,this.path&&this.path.clear(),this.textAlign=this.textBaseline=null},t.make=function(){return this===ContextParams.DEFAULT?new ContextParams:this},ContextParams.DEFAULT=null,ContextParams}()},WebGLContext2D}(),Ot=function(t){function RenderSprite3D(t,e){RenderSprite3D.__super.call(this,t,e)}r(RenderSprite3D,"laya.webgl.utils.RenderSprite3D",b);var e=RenderSprite3D.prototype;return e.onCreate=function(t){switch(t){case 4:return void(this._fun=this._blend)}},e._mask=function(t,e,a,i){var r=this._next,_=t.mask,n=e;if(_){n.save();var s=n.globalCompositeOperation,o=new L;if(o.copyFrom(_.getBounds()),o.width=Math.round(o.width),o.height=Math.round(o.height),o.x=Math.round(o.x),o.y=Math.round(o.y),o.width>0&&o.height>0){var h=o.width,l=o.height,u=ft.getRT(h,l);n.breakNextMerge(),n.pushRT(),n.addRenderObject(Tt.create([n,u,h,l],laya.webgl.utils.RenderSprite3D.tmpTarget,this)),_.render(n,-o.x,-o.y),n.breakNextMerge(),n.popRT(),n.save(),n.clipRect(a+o.x-t.getStyle().pivotX,i+o.y-t.getStyle().pivotY,h,l),r._fun.call(r,t,n,a,i),n.restore(),s=n.globalCompositeOperation,n.addRenderObject(Tt.create(["mask"],laya.webgl.utils.RenderSprite3D.setBlendMode,this));var c=Y.create(1,0),d=V.INV_UV;n.drawTarget(u,a+o.x-t.getStyle().pivotX,i+o.y-t.getStyle().pivotY,h,l,R.TEMP.identity(),c,d,6),n.addRenderObject(Tt.create([u],laya.webgl.utils.RenderSprite3D.recycleTarget,this)),n.addRenderObject(Tt.create([s],laya.webgl.utils.RenderSprite3D.setBlendMode,this))}n.restore()}else r._fun.call(r,t,e,a,i)},e._blend=function(t,e,a,i){var r=t._style,_=this._next;r.blendMode?(e.save(),e.globalCompositeOperation=r.blendMode,_._fun.call(_,t,e,a,i),e.restore()):_._fun.call(_,t,e,a,i)},RenderSprite3D.tmpTarget=function(t,e,a,i){e.start(),e.clear(0,0,0,0)},RenderSprite3D.recycleTarget=function(t){ft.releaseRT(t)},RenderSprite3D.setBlendMode=function(t){var e=xt.mainContext;at.targetFns[at.TOINT[t]](e)},i(RenderSprite3D,["tempUV",function(){return this.tempUV=new Array(8)}]),RenderSprite3D}(),gt=function(t){function SkinSV(t){this.texcoord=null,this.position=null,this.offsetX=300,this.offsetY=0,SkinSV.__super.call(this,512,0);var e=8*Lt.BYTES_PE;this.position=[2,5126,!1,e,0],this.texcoord=[2,5126,!1,e,2*Lt.BYTES_PE],this.color=[4,5126,!1,e,4*Lt.BYTES_PE]}return r(SkinSV,"laya.webgl.shader.d2.skinAnishader.SkinSV",Y),SkinSV}(),Bt=function(t){function PrimitiveSV(t){PrimitiveSV.__super.call(this,4,0),this._attribLocation=["position",0,"attribColor",1]}return r(PrimitiveSV,"laya.webgl.shader.d2.value.PrimitiveSV",Y),PrimitiveSV}(),wt=function(t){function TextureSV(t){this.u_colorMatrix=null,this.strength=0,this.blurInfo=null,this.colorMat=null,this.colorAlpha=null,void 0===t&&(t=0),TextureSV.__super.call(this,1,t),this._attribLocation=["posuv",0,"attribColor",1,"attribFlags",2]}return r(TextureSV,"laya.webgl.shader.d2.value.TextureSV",Y),TextureSV.prototype.clear=function(){this.texture=null,this.shader=null,this.defines._value=this.subID+(xt.shaderHighPrecision?1024:0)},TextureSV}(),It=function(a){function CharRender_Canvas(){this.lastScaleX=1,this.lastScaleY=1,this.needResetScale=!1,CharRender_Canvas.__super.call(this),CharRender_Canvas.canvas||(CharRender_Canvas.canvas=t.document.createElement("canvas"),CharRender_Canvas.canvas.width=512,CharRender_Canvas.canvas.height=512,CharRender_Canvas.canvas.style.left="-1000px",CharRender_Canvas.canvas.style.position="absolute",e.body.appendChild(CharRender_Canvas.canvas),CharRender_Canvas.ctx=CharRender_Canvas.canvas.getContext("2d"))}r(CharRender_Canvas,"laya.webgl.resource.CharRender_Canvas",dt);var i=CharRender_Canvas.prototype;return i.getWidth=function(t){return CharRender_Canvas.ctx?(CharRender_Canvas.ctx._lastFont!=ht._curFont&&(CharRender_Canvas.ctx.font=ht._curFont,CharRender_Canvas.ctx._lastFont=ht._curFont),CharRender_Canvas.ctx.measureText(t).width):0},i.scale=function(t,e){this.lastScaleX==t&&this.lastScaleY==e||(this.needResetScale&&(CharRender_Canvas.ctx.restore(),this.lastScaleX=this.lastScaleY=1),CharRender_Canvas.ctx.save(),this.needResetScale=!0,CharRender_Canvas.ctx.scale(t,e),this.lastScaleX=t,this.lastScaleY=e)},i.getCharBmp=function(t,e,a,i,r,_,n,s,o,h){if(ht.isWan1Wan)return this.getCharCanvas(t,e,a,i,r,_,n,s,o,h);CharRender_Canvas.ctx.font!=e&&(CharRender_Canvas.ctx.font=e,CharRender_Canvas.ctx._lastFont=e),_.width=CharRender_Canvas.ctx.measureText(t).width;var l=_.width*this.lastScaleX,u=_.height*this.lastScaleY;return l+=(n+o)*this.lastScaleX,u+=(s+h)*this.lastScaleY,CharRender_Canvas.ctx.clearRect(0,0,l+1,u+1),CharRender_Canvas.ctx.textBaseline="top",a>0&&(CharRender_Canvas.ctx.strokeStyle=r,CharRender_Canvas.ctx.lineWidth=a,CharRender_Canvas.ctx.strokeText(t,n,s)),CharRender_Canvas.ctx.fillStyle=i,CharRender_Canvas.ctx.fillText(t,n,s),ht.debug&&(CharRender_Canvas.ctx.strokeStyle="#ff0000",CharRender_Canvas.ctx.strokeRect(0,0,l,u),CharRender_Canvas.ctx.strokeStyle="#00ff00",CharRender_Canvas.ctx.strokeRect(n,s,_.width,_.height)),CharRender_Canvas.ctx.getImageData(0,0,0|l,0|u)},i.getCharCanvas=function(t,e,a,i,r,_,n,s,o,h){CharRender_Canvas.ctx.font!=e&&(CharRender_Canvas.ctx.font=e,CharRender_Canvas.ctx._lastFont=e),_.width=CharRender_Canvas.ctx.measureText(t).width;var l=_.width*this.lastScaleX,u=_.height*this.lastScaleY;return l+=(n+o)*this.lastScaleX,u+=(s+h)*this.lastScaleY,CharRender_Canvas.canvas.width=l+1,CharRender_Canvas.canvas.height=u+1,CharRender_Canvas.ctx.font=e,CharRender_Canvas.ctx.clearRect(0,0,l+1,u+1),CharRender_Canvas.ctx.save(),CharRender_Canvas.ctx.translate(n,s),ht.scaleFontWithCtx&&CharRender_Canvas.ctx.scale(this.lastScaleX,this.lastScaleY),CharRender_Canvas.ctx.textAlign="left",CharRender_Canvas.ctx.textBaseline="top",a>0?(CharRender_Canvas.ctx.strokeStyle=r,CharRender_Canvas.ctx.fillStyle=i,CharRender_Canvas.ctx.lineWidth=a,CharRender_Canvas.ctx.fillAndStrokeText(t,0,0,null,null,null)):(CharRender_Canvas.ctx.fillStyle=i,CharRender_Canvas.ctx.fillText(t,0,0)),ht.debug&&(CharRender_Canvas.ctx.strokeStyle="#ff0000",CharRender_Canvas.ctx.strokeRect(0,0,l,u),CharRender_Canvas.ctx.strokeStyle="#00ff00",CharRender_Canvas.ctx.strokeRect(0,0,_.width,_.height)),CharRender_Canvas.ctx.restore(),CharRender_Canvas.canvas},CharRender_Canvas.canvas=null,CharRender_Canvas.ctx=null,CharRender_Canvas}(),Ft=function(e){function CharRender_Native(){this.lastFont="",CharRender_Native.__super.call(this)}r(CharRender_Native,"laya.webgl.resource.CharRender_Native",dt);var a=CharRender_Native.prototype;return a.getWidth=function(e){return t.conchTextCanvas?(this.lastFont!=ht._curFont&&(t.conchTextCanvas.font=ht._curFont,this.lastFont=ht._curFont),t.conchTextCanvas.measureText(e).width):0},a.scale=function(t,e){},a.getCharBmp=function(e,a,i,r,_,n,s,o,h,u){if(!t.conchTextCanvas)return null;this.lastFont!=a&&(t.conchTextCanvas.font=ht._curFont,this.lastFont=ht._curFont);n.width=t.conchTextCanvas.measureText(e).width,n.height;var c=l.create(_).numColor,d=l.create(r).numColor;return t.conchTextCanvas.getTextBitmapData(e,d,i>2?2:i,c)},CharRender_Native}(),Gt=function(t){function ShaderDefines2D(){ShaderDefines2D.__super.call(this,ShaderDefines2D.__name2int,ShaderDefines2D.__int2name,ShaderDefines2D.__int2nameMap)}return r(ShaderDefines2D,"laya.webgl.shader.d2.ShaderDefines2D",mt),ShaderDefines2D.__init__=function(){ShaderDefines2D.reg("TEXTURE2D",1),ShaderDefines2D.reg("PRIMITIVE",4),ShaderDefines2D.reg("GLOW_FILTER",8),ShaderDefines2D.reg("BLUR_FILTER",16),ShaderDefines2D.reg("COLOR_FILTER",32),ShaderDefines2D.reg("COLOR_ADD",64),ShaderDefines2D.reg("WORLDMAT",128),ShaderDefines2D.reg("FILLTEXTURE",256),ShaderDefines2D.reg("FSHIGHPRECISION",1024)},ShaderDefines2D.reg=function(t,e){mt._reg(t,e,ShaderDefines2D.__name2int,ShaderDefines2D.__int2name)},ShaderDefines2D.toText=function(t,e,a){return mt._toText(t,e,a)},ShaderDefines2D.toInt=function(t){return mt._toInt(t,ShaderDefines2D.__name2int)},ShaderDefines2D.TEXTURE2D=1,ShaderDefines2D.PRIMITIVE=4,ShaderDefines2D.FILTERGLOW=8,ShaderDefines2D.FILTERBLUR=16,ShaderDefines2D.FILTERCOLOR=32,ShaderDefines2D.COLORADD=64,ShaderDefines2D.WORLDMAT=128,ShaderDefines2D.FILLTEXTURE=256,ShaderDefines2D.SKINMESH=512,ShaderDefines2D.SHADERDEFINE_FSHIGHPRECISION=1024,ShaderDefines2D.NOOPTMASK=312,ShaderDefines2D.__name2int={},ShaderDefines2D.__int2name=[],ShaderDefines2D.__int2nameMap=[],ShaderDefines2D}(),Wt=function(t){function SubmitCanvas(){this._matrix=new R,this._matrix4=Lt.defaultMatrix4.concat(),SubmitCanvas.__super.call(this,1e4),this.shaderValue=new Y(0,0)}r(SubmitCanvas,"laya.webgl.submit.SubmitCanvas",Rt);var e=SubmitCanvas.prototype;return e.renderSubmit=function(){if(this._ctx_src._targets)return alert("nimei"),1;var t=bt.worldAlpha,e=bt.worldMatrix4,a=bt.worldMatrix,i=bt.worldFilters,r=bt.worldShaderDefines,_=this.shaderValue,n=this._matrix,s=this._matrix4,o=R.TEMP;return R.mul(n,a,o),s[0]=o.a,s[1]=o.b,s[4]=o.c,s[5]=o.d,s[12]=o.tx,s[13]=o.ty,bt.worldMatrix=o.clone(),bt.worldMatrix4=s,bt.worldAlpha=bt.worldAlpha*_.alpha,_.filters&&_.filters.length&&(bt.worldFilters=_.filters,bt.worldShaderDefines=_.defines),this._ctx_src.flush(),bt.worldAlpha=t,bt.worldMatrix4=e,bt.worldMatrix.destroy(),bt.worldMatrix=a,bt.worldFilters=i,bt.worldShaderDefines=r,1},e.releaseRender=function(){if(--this._ref<1){var t=SubmitCanvas.POOL;this._ctx_src=null,this._mesh=null,t[t._length++]=this}},e.clone=function(t,e,a){return null},e.getRenderType=function(){return 10003},SubmitCanvas.create=function(t,e,a){var i=SubmitCanvas.POOL._length?SubmitCanvas.POOL[--SubmitCanvas.POOL._length]:new SubmitCanvas;i._ctx_src=t,i._ref=1,i._numEle=0;var r=i.shaderValue;return r.alpha=e,r.defines.setValue(0),a&&a.length&&r.setFilters(a),i},SubmitCanvas.POOL=(SubmitCanvas.POOL=[],SubmitCanvas.POOL._length=0,SubmitCanvas.POOL),SubmitCanvas}(),Vt=function(t){function SubmitTexture(t){void 0===t&&(t=1e4),SubmitTexture.__super.call(this,t)}r(SubmitTexture,"laya.webgl.submit.SubmitTexture",Rt);var e=SubmitTexture.prototype;return e.clone=function(t,e,a){var i=SubmitTexture._poolSize?SubmitTexture.POOL[--SubmitTexture._poolSize]:new SubmitTexture;return this._cloneInit(i,t,e,a),i},e.releaseRender=function(){--this._ref<1&&(SubmitTexture.POOL[SubmitTexture._poolSize++]=this,this.shaderValue.release(),this._mesh=null,this._parent&&(this._parent.releaseRender(),this._parent=null))},e.renderSubmit=function(){if(0===this._numEle)return 1;var t=this.shaderValue.textureHost;if(t){var e=t?t._getSource():null;if(!e)return 1}var a=xt.mainContext;this._mesh.useMesh(a);var i=Rt.preRender,r=Rt.preRender._key;return 0===this._key.blendShader&&this._key.submitType===r.submitType&&this._key.blendShader===r.blendShader&&Yt.activeShader&&Rt.preRender.clipInfoID==this.clipInfoID&&i.shaderValue.defines._value===this.shaderValue.defines._value&&0==(this.shaderValue.defines._value&Gt.NOOPTMASK)?Yt.activeShader.uploadTexture2D(e):(at.activeBlendFunction!==this._blendFn&&(Mt.setBlend(a,!0),this._blendFn(a),at.activeBlendFunction=this._blendFn),this.shaderValue.texture=e,this.shaderValue.upload()),a.drawElements(4,this._numEle,5123,this._startIdx),I.drawCall++,I.trianglesFaces+=this._numEle/3,1},SubmitTexture.create=function(t,e,a){var i=SubmitTexture._poolSize?SubmitTexture.POOL[--SubmitTexture._poolSize]:new SubmitTexture(10016);i._mesh=e,i._key.clear(),i._key.submitType=2,i._ref=1,i._startIdx=e.indexNum*Lt.BYTES_PIDX,i._numEle=0;var r=t._nBlendType;if(i._key.blendShader=r,i._blendFn=t._targets?at.targetFns[r]:at.fns[r],i.shaderValue=a,t._colorFiler){var _=t._colorFiler;a.defines.add(_.type),a.colorMat=_._mat,a.colorAlpha=_._alpha}return i},SubmitTexture._poolSize=0,SubmitTexture.POOL=[],SubmitTexture}(),Ut=(function(t){function MeshParticle2D(t){MeshParticle2D.__super.call(this,laya.webgl.utils.MeshParticle2D.const_stride,4*t*MeshParticle2D.const_stride,4),this.canReuse=!0,this.setAttributes(laya.webgl.utils.MeshParticle2D._fixattriInfo),this.createQuadIB(t),this._quadNum=t}r(MeshParticle2D,"laya.webgl.utils.MeshParticle2D",pt);var e=MeshParticle2D.prototype;e.setMaxParticleNum=function(t){this._vb._resizeBuffer(4*t*MeshParticle2D.const_stride,!1),this.createQuadIB(t)},e.releaseMesh=function(){this._vb.setByteLength(0),this.vertNum=0,this.indexNum=0,laya.webgl.utils.MeshParticle2D._POOL.push(this)},e.destroy=function(){this._ib.destroy(),this._vb.destroy(),this._vb.deleteBuffer()},MeshParticle2D.getAMesh=function(t){if(laya.webgl.utils.MeshParticle2D._POOL.length){var e=laya.webgl.utils.MeshParticle2D._POOL.pop();return e.setMaxParticleNum(t),e}return new MeshParticle2D(t)},MeshParticle2D.const_stride=116,MeshParticle2D._POOL=[],i(MeshParticle2D,["_fixattriInfo",function(){return this._fixattriInfo=[5126,4,0,5126,3,16,5126,3,28,5126,4,40,5126,4,56,5126,3,72,5126,2,84,5126,4,92,5126,1,108,5126,1,112]}])}(),function(t){function MeshQuadTexture(){MeshQuadTexture.__super.call(this,laya.webgl.utils.MeshQuadTexture.const_stride,4,4),this.canReuse=!0,this.setAttributes(laya.webgl.utils.MeshQuadTexture._fixattriInfo),laya.webgl.utils.MeshQuadTexture._fixib?(this._ib=laya.webgl.utils.MeshQuadTexture._fixib,this._quadNum=MeshQuadTexture._maxIB):(this.createQuadIB(MeshQuadTexture._maxIB),laya.webgl.utils.MeshQuadTexture._fixib=this._ib)}r(MeshQuadTexture,"laya.webgl.utils.MeshQuadTexture",pt);var e=MeshQuadTexture.prototype;return e.releaseMesh=function(){this._vb.setByteLength(0),this.vertNum=0,this.indexNum=0,laya.webgl.utils.MeshQuadTexture._POOL.push(this)},e.destroy=function(){this._vb.destroy(),this._vb.deleteBuffer()},e.addQuad=function(t,e,a,i){var r=this._vb,_=r._byteLength>>2;r.setByteLength(_+laya.webgl.utils.MeshQuadTexture.const_stride<<2);var n=r._floatArray32||r.getFloat32Array(),s=r._uint32Array,o=_,h=i?255:0;n[o++]=t[0],n[o++]=t[1],n[o++]=e[0],n[o++]=e[1],s[o++]=a,s[o++]=h,n[o++]=t[2],n[o++]=t[3],n[o++]=e[2],n[o++]=e[3],s[o++]=a,s[o++]=h,n[o++]=t[4],n[o++]=t[5],n[o++]=e[4],n[o++]=e[5],s[o++]=a,s[o++]=h,n[o++]=t[6],n[o++]=t[7],n[o++]=e[6],n[o++]=e[7],s[o++]=a,s[o++]=h,r._upload=!0},MeshQuadTexture.getAMesh=function(){return laya.webgl.utils.MeshQuadTexture._POOL.length?laya.webgl.utils.MeshQuadTexture._POOL.pop():new MeshQuadTexture},MeshQuadTexture.const_stride=24,MeshQuadTexture._fixib=null,MeshQuadTexture._maxIB=16384,MeshQuadTexture._POOL=[],i(MeshQuadTexture,["_fixattriInfo",function(){return this._fixattriInfo=[5126,4,0,5121,4,16,5121,4,20]}]),MeshQuadTexture}()),Xt=function(t){function MeshTexture(){MeshTexture.__super.call(this,laya.webgl.utils.MeshTexture.const_stride,4,4),this.canReuse=!0,this.setAttributes(laya.webgl.utils.MeshTexture._fixattriInfo)}r(MeshTexture,"laya.webgl.utils.MeshTexture",pt);var e=MeshTexture.prototype;return e.addData=function(t,e,a,i,r,_){for(var n=t.length/2,s=this._vb.needSize(n*MeshTexture.const_stride)>>2,o=this._vb._floatArray32||this._vb.getFloat32Array(),h=this._vb._uint32Array,l=0,u=0;u<n;u++){var c=t[l],d=t[l+1],f=c*i.a+d*i.c+i.tx,D=c*i.b+d*i.d+i.ty;o[s++]=f,o[s++]=D,o[s++]=e[l],o[s++]=e[l+1],l+=2,h[s++]=r,h[s++]=255}this._vb.setNeedUpload();var m=this.vertNum;if(m>0){var C=a.length;C>MeshTexture.tmpIdx.length&&(MeshTexture.tmpIdx=new Uint16Array(C));for(var E=0;E<C;E++)MeshTexture.tmpIdx[E]=a[E]+m;this._ib.appendU16Array(MeshTexture.tmpIdx,a.length)}else this._ib.append(a);this._ib.setNeedUpload(),this.vertNum+=n,this.indexNum+=a.length},e.releaseMesh=function(){this._vb.setByteLength(0),this._ib.setByteLength(0),this.vertNum=0,this.indexNum=0,laya.webgl.utils.MeshTexture._POOL.push(this)},e.destroy=function(){this._ib.destroy(),this._vb.destroy(),this._ib.disposeResource(),this._vb.deleteBuffer()},MeshTexture.getAMesh=function(){return laya.webgl.utils.MeshTexture._POOL.length?laya.webgl.utils.MeshTexture._POOL.pop():new MeshTexture},MeshTexture.const_stride=24,MeshTexture._POOL=[],i(MeshTexture,["_fixattriInfo",function(){return this._fixattriInfo=[5126,4,0,5121,4,16,5121,4,20]},"tmpIdx",function(){return this.tmpIdx=new Uint16Array(4)}]),MeshTexture}(),kt=function(t){function MeshVG(){MeshVG.__super.call(this,laya.webgl.utils.MeshVG.const_stride,4,4),this.canReuse=!0,this.setAttributes(laya.webgl.utils.MeshVG._fixattriInfo)}r(MeshVG,"laya.webgl.utils.MeshVG",pt);var e=MeshVG.prototype;return e.addVertAndIBToMesh=function(t,e,a,i){for(var r=this._vb.needSize(e.length/2*MeshVG.const_stride)>>2,_=this._vb._floatArray32||this._vb.getFloat32Array(),n=this._vb._uint32Array,s=0,o=e.length/2,h=0;h<o;h++)_[r++]=e[s],_[r++]=e[s+1],s+=2,n[r++]=a;this._vb.setNeedUpload(),this._ib.append(new Uint16Array(i)),this._ib.setNeedUpload(),this.vertNum+=o,this.indexNum+=i.length},e.releaseMesh=function(){this._vb.setByteLength(0),this._ib.setByteLength(0),this.vertNum=0,this.indexNum=0,laya.webgl.utils.MeshVG._POOL.push(this)},e.destroy=function(){this._ib.destroy(),this._vb.destroy(),this._ib.disposeResource(),this._vb.deleteBuffer()},MeshVG.getAMesh=function(){return laya.webgl.utils.MeshVG._POOL.length?laya.webgl.utils.MeshVG._POOL.pop():new MeshVG},MeshVG.const_stride=12,MeshVG._POOL=[],i(MeshVG,["_fixattriInfo",function(){return this._fixattriInfo=[5126,2,0,5121,4,8]}]),MeshVG}(),zt=function(t){function ConchSpriteAdpt(){this._customRenderCmd=null,this._customCmds=null,this._x=0,this._y=0,this._renderType=0,this._bRepaintCanvas=!1,this._lastContext=null,ConchSpriteAdpt.__super.call(this)}r(ConchSpriteAdpt,"laya.layagl.ConchSpriteAdpt",T);var e=ConchSpriteAdpt.prototype;return e.createData=function(){this._conchData=new ParamData(308,!1),this._datai32=this._conchData._int32Data,this._dataf32=this._conchData._float32Data,this._dataf32[4]=1,this._datai32[3]=-1,this._datai32[1]=0,this._datai32[2]=0,this._datai32[22]=4294967295,this._datai32[5]=1,this._dataf32[8]=0,this._dataf32[9]=0,this._dataf32[10]=1,this._dataf32[11]=1,this._dataf32[16]=1,this._dataf32[17]=0,this._dataf32[18]=0,this._dataf32[19]=1,this._dataf32[20]=0,this._dataf32[21]=0,this._datai32[24]=-1,this._datai32[25]=-1,this._datai32[27]=-1,this._datai32[28]=0,this._datai32[29]=0,this._datai32[30]=1e6,this._datai32[31]=1e6,this._datai32[63]=0,this._datai32[71]=1,this._datai32[72]=771,this._datai32[68]=-1},e._createTransform=function(){return et.create(new Float32Array(6))},e._setTransform=function(t){var e=this._conchData._float32Data;e[15]=0,e[16]=t.a,e[17]=t.b,e[18]=t.c,e[19]=t.d,e[20]=t.tx,e[21]=t.ty},e._setGraphics=function(t){this._datai32[23]=t._commandEncoder.getPtrID()},e._setGraphicsCallBack=function(){this._callbackFuncObj||(this._callbackFuncObj=new CallbackFuncObj),this._datai32[54]=this._callbackFuncObj.id,this._callbackFuncObj.addCallbackFunc(5,this.updateParticleFromNative.bind(this)),this._datai32[68]=5},e._setCacheAs=function(t){H.createCommandEncoder(),this._drawCanvasParamData||(this._drawCanvasParamData=new ParamData(132,!0)),this._callbackFuncObj||(this._callbackFuncObj=new CallbackFuncObj),this._canvasBeginCmd||(this._canvasBeginCmd=K.instance.createCommandEncoder(128,64,!1)),this._canvasEndCmd||(this._canvasEndCmd=K.instance.createCommandEncoder(128,64,!1)),this._datai32[54]=this._callbackFuncObj.id,this._callbackFuncObj.addCallbackFunc(1,this.canvasBeginRenderFromNative.bind(this)),this._callbackFuncObj.addCallbackFunc(2,this.canvasEndRenderFromNative.bind(this)),this._datai32[56]=1,this._datai32[57]=2,this._datai32[58]=this._canvasBeginCmd.getPtrID(),this._datai32[59]=this._canvasEndCmd.getPtrID(),this._datai32[60]=H._DRAW_CANVAS_CMD_ENCODER_.getPtrID(),this._datai32[61]=this._drawCanvasParamData.getPtrID()},e._setX=function(t){this._x=this._dataf32[6]=t,this._renderType|=2,this._setRenderType(this._renderType),this._dataf32[15]=1},e._setY=function(t){this._y=this._dataf32[7]=t,this._renderType|=2,this._setRenderType(this._renderType),this._dataf32[15]=1},e._setPivotX=function(t){this._renderType|=2,this._dataf32[8]=t,this._dataf32[15]=1},e._getPivotX=function(){return this._dataf32[8]},e._setPivotY=function(t){this._renderType|=2,this._dataf32[9]=t,this._dataf32[15]=1},e._getPivotY=function(){return this._dataf32[9]},e._setAlpha=function(t){this.getStyle().alpha=t,t=(t=t>1?1:t)<0?0:t;var e=this._datai32[22];e=16777215&e|255*t<<24,this._datai32[22]=e,1!==t?this._renderType|=1:this._renderType&=-2,this._setRenderType(this._renderType),this.parentRepaint()},e._setRenderType=function(t){this._datai32[0]=t,J.GLS[t]||J.createByRenderType(t),J.GLSE[t]||J.createByRenderTypeEnd(t)},e.parentRepaint=function(){},e._getAlpha=function(){return(this._datai32[22]>>>24)/255},e._setScaleX=function(t){this._style.scaleX=this._dataf32[10]=t,this._dataf32[15]=1},e._setScaleY=function(t){this._style.scaleY=this._dataf32[11]=t,this._dataf32[15]=1},e._setSkewX=function(t){this._style.skewX=this._dataf32[12]=t,this._dataf32[15]=1},e._setSkewY=function(t){this._style.skewY=this._dataf32[13]=t,this._dataf32[15]=1},e._setRotation=function(t){this._style.rotation=this._dataf32[14]=t,this._dataf32[15]=1},e._setBgStyleColor=function(t,e,a,i,r){var _=null,n=null;this._drawSimpleRectParamData||(this._drawSimpleRectParamData=new ParamData(104,!0)),_=this._drawSimpleRectParamData._float32Data,n=this._drawSimpleRectParamData._int32Data;var s=l.create(r).numColor;n[0]=1,n[1]=96;var o=2;_[o++]=t,_[o++]=e,_[o++]=0,_[o++]=0,n[o++]=s,_[o++]=4294967295,_[o++]=t+a,_[o++]=e,_[o++]=0,_[o++]=0,n[o++]=s,_[o++]=4294967295,_[o++]=t+a,_[o++]=e+i,_[o++]=0,_[o++]=0,n[o++]=s,_[o++]=4294967295,_[o++]=t,_[o++]=e+i,_[o++]=0,_[o++]=0,n[o++]=s,_[o++]=4294967295,this._datai32[74]=this._drawSimpleRectParamData.getPtrID(),K.syncBufferToRenderThread(this._drawSimpleRectParamData),this._datai32[73]=tt._SIMPLE_RECT_CMDENCODER_.getPtrID()},e._setBorderStyleColor=function(t,e,a,i,r,_){var n=null,s=null;this._drawRectBorderParamData||(this._drawRectBorderParamData=new ParamData(236,!0)),n=this._drawRectBorderParamData._float32Data,s=this._drawRectBorderParamData._int32Data;var o=[],h=[],u=[];o.push(t),o.push(e),o.push(t+a),o.push(e),o.push(t+a),o.push(e+i),o.push(t),o.push(e+i),o.push(t),o.push(e-_/2),Et.createLine2(o,h,_,0,u,!1);var c=o.length;n=this._drawRectBorderParamData._float32Data,s=this._drawRectBorderParamData._int32Data;var d=this._drawRectBorderParamData._int16Data,f=l.create(r).numColor;s[0]=0,s[1]=120,s[2]=0,s[3]=2*h.length,s[4]=0;for(var D=5,m=0;m<c;m++)n[D++]=u[2*m],n[D++]=u[2*m+1],s[D++]=f;D=70;for(var C=0;C<h.length;C++)d[D++]=h[C];this._datai32[76]=this._drawRectBorderParamData.getPtrID(),K.syncBufferToRenderThread(this._drawRectBorderParamData),this._datai32[75]=tt._RECT_BORDER_CMD_ENCODER_.getPtrID()},e._setTextureEx=function(t,e){var a=null,i=null;if(!this._drawSimpleImageData){this._drawSimpleImageData=new ParamData(116,!0),a=this._drawSimpleImageData._float32Data,(i=this._drawSimpleImageData._int32Data)[0]=3,i[1]=33984,i[2]=e?t.bitmap._glTexture.id:0,i[3]=1,i[4]=96;var r=t.uv;a[5]=0,a[6]=0,a[7]=r[0],a[8]=r[1],i[9]=4294967295,i[10]=4294967295,a[11]=0,a[12]=0,a[13]=r[2],a[14]=r[3],i[15]=4294967295,i[16]=4294967295,a[17]=0,a[18]=0,a[19]=r[4],a[20]=r[5],i[21]=4294967295,i[22]=4294967295,a[23]=0,a[24]=0,a[25]=r[6],a[26]=r[7],i[27]=4294967295,i[28]=4294967295}a=this._drawSimpleImageData._float32Data,(i=this._drawSimpleImageData._int32Data)[2]=e?t.bitmap._glTexture.id:0;var _=e?t.width:0,n=e?t.height:0;a[11]=a[17]=_,a[18]=a[24]=n;var s=this._drawSimpleImageData.getPtrID();this._datai32[25]=s,K.syncBufferToRenderThread(this._drawSimpleImageData),this._datai32[24]=tt._SIMPLE_TEXTURE_CMDENCODER_.getPtrID()},e._setTexture=function(t){t&&(t.getIsReady()?this._setTextureEx(t,!0):(this._setTextureEx(t,!1),t.on("ready",this,this._setTextureEx,[t,!0])))},e._setCustomRender=function(){this._callbackFuncObj||(this._callbackFuncObj=new CallbackFuncObj),this._callbackFuncObj.addCallbackFunc(0,this.customRenderFromNative.bind(this)),this._customRenderCmd=K.instance.createCommandEncoder(128,64,!0),this._datai32[54]=this._callbackFuncObj.id,this._datai32[55]=0,this._datai32[27]=this._customRenderCmd.getPtrID()},e._setScrollRect=function(t){this._dataf32[28]=0,this._dataf32[29]=0,this._dataf32[30]=t.width,this._dataf32[31]=t.height,this._dataf32[32]=-t.x,this._dataf32[33]=-t.y},e._setColorFilter=function(t){this._callbackFuncObj||(this._callbackFuncObj=new CallbackFuncObj),this._filterBeginCmd||(this._filterBeginCmd=K.instance.createCommandEncoder(128,64,!1)),this._filterEndCmd||(this._filterEndCmd=K.instance.createCommandEncoder(128,64,!0)),this._datai32[54]=this._callbackFuncObj.id,this._callbackFuncObj.addCallbackFunc(3,this.filterBeginRenderFromNative.bind(this)),this._callbackFuncObj.addCallbackFunc(4,this.filterEndRenderFromNative.bind(this)),this._datai32[65]=3,this._datai32[64]=this._filterBeginCmd.getPtrID(),this._datai32[67]=4,this._datai32[66]=this._filterEndCmd.getPtrID()},e._setMask=function(t){t.cacheAs="bitmap",this._callbackFuncObj||(this._callbackFuncObj=new CallbackFuncObj),this._maskCmd||(this._maskCmd=K.instance.createCommandEncoder(128,64,!1)),this._datai32[54]=this._callbackFuncObj.id,this._callbackFuncObj.addCallbackFunc(6,this.maskRenderFromNative.bind(this)),this._datai32[69]=6,this._datai32[70]=this._maskCmd.getPtrID()},e._adjustTransform=function(){var t=this._transform||(this._transform=this._createTransform());t._bTransform=!0,K.instance.calcMatrixFromScaleSkewRotation(this._conchData._data._ptrID,60,64,24,28,32,36,40,44,48,52,56);var e=this._conchData._float32Data;return t.a=e[16],t.b=e[17],t.c=e[18],t.d=e[19],t.tx=0,t.ty=0,t},e._setBlendMode=function(t){switch(t){case"normal":this._datai32[71]=1,this._datai32[72]=771;break;case"add":case"lighter":this._datai32[71]=1,this._datai32[72]=772;break;case"multiply":this._datai32[71]=774,this._datai32[72]=771;break;case"screen":this._datai32[71]=1,this._datai32[72]=1;break;case"overlay":this._datai32[71]=1,this._datai32[72]=769;break;case"light":this._datai32[71]=1,this._datai32[72]=1;break;case"mask":this._datai32[71]=0,this._datai32[72]=770;break;case"destination-out":this._datai32[71]=0,this._datai32[72]=0;break;default:alert("_setBlendMode Unknown type")}},e.customRenderFromNative=function(){var t=K.instance.getCurrentContext();this._customRenderCmd.beginEncoding(),this._customRenderCmd.clearEncoding(),t._commandEncoder=this._customRenderCmd,t._customCmds=this._customCmds;for(var e=0,a=this._customCmds.length;e<a;e++)this._customCmds[e].recover();this._customCmds.length=0,this.customRender(t,0,0),this._customRenderCmd.endEncoding()},e.canvasBeginRenderFromNative=function(){var t=K.instance,e=null,a=null,i=this._cacheStyle;if(i.canvas&&0==this._datai32[4])e=i.canvas,0!=this._bRepaintCanvas&&(this.setChildrenNativeVisible(!1),this._bRepaintCanvas=!1),this._datai32[63]=1;else{if(this._canvasBeginCmd.beginEncoding(),this._canvasBeginCmd.clearEncoding(),e=laya.layagl.ConchSpriteAdpt.buildCanvas(this,0,0)){this._datai32[63]=0,this._lastContext=t.getCurrentContext();var r=(a=e.context)._targets;H.setParamData(this._drawCanvasParamData,r,-16,-16,r.width,r.height),t.setCurrentContext(a),a.beginRT(),t.save(),ConchSpriteAdpt._tempFloatArrayMatrix[0]=1,ConchSpriteAdpt._tempFloatArrayMatrix[1]=0,ConchSpriteAdpt._tempFloatArrayMatrix[2]=0,ConchSpriteAdpt._tempFloatArrayMatrix[3]=1,ConchSpriteAdpt._tempFloatArrayMatrix[4]=16,ConchSpriteAdpt._tempFloatArrayMatrix[5]=16,t.setGlobalValue(tt.GLOBALVALUE_MATRIX32,8,ConchSpriteAdpt._tempFloatArrayMatrix),1!=this._bRepaintCanvas&&(this.setChildrenNativeVisible(!0),this._bRepaintCanvas=!0)}this._canvasBeginCmd.endEncoding()}},e.setChildrenNativeVisible=function(t){for(var e,a=this._children,i=a.length,r=0;r<i;++r)(e=a[r])._datai32[5]=t?1:0,e.setChildrenNativeVisible(t)},e.canvasEndRenderFromNative=function(){var t=K.instance;if(this._canvasEndCmd.beginEncoding(),this._canvasEndCmd.clearEncoding(),this._bRepaintCanvas){var e=K.instance.getCurrentContext();t.restore(),t.setCurrentContext(this._lastContext),t.commitContextToGPU(e),e.endRT(),t.blendFunc(1,771)}this._canvasEndCmd.endEncoding()},e.filterBeginRenderFromNative=function(){var t=K.instance;this._filterBeginCmd.beginEncoding(),this._filterBeginCmd.clearEncoding();var e=this._getCacheStyle().filters;e.length;if(e[0]instanceof laya.filters.ColorFilter){t.addShaderMacro(tt.SHADER_MACRO_COLOR_FILTER);var a=e[0];t.setGlobalValue(tt.GLOBALVALUE_COLORFILTER_COLOR,8,a._mat),t.setGlobalValue(tt.GLOBALVALUE_COLORFILTER_ALPHA,8,a._alpha)}else{var i=P.TEMP,r=R.create(),_=0,n=0;this._isHaveGlowFilter()&&(_=50,n=25);var s=new L;s.copyFrom(this.getSelfBounds()),s.x+=this.x,s.y+=this.y,s.x-=this.pivotX+4,s.y-=this.pivotY+4;var o=s.x,h=s.y;if(s.width+=_+8,s.height+=_+8,i.x=s.x*r.a+s.y*r.c,i.y=s.y*r.d+s.x*r.b,s.x=i.x,s.y=i.y,i.x=s.width*r.a+s.height*r.c,i.y=s.height*r.d+s.width*r.b,s.width=i.x,s.height=i.y,s.width<=0||s.height<=0)return;var l=this._getCacheStyle().filterCache;l&&ft.releaseRT(l),l=ft.getRT(s.width,s.height),this._getCacheStyle().filterCache=l,ConchSpriteAdpt.useRenderTarget(l),ConchSpriteAdpt._tempFloatArrayMatrix[0]=1,ConchSpriteAdpt._tempFloatArrayMatrix[1]=0,ConchSpriteAdpt._tempFloatArrayMatrix[2]=0,ConchSpriteAdpt._tempFloatArrayMatrix[3]=1,ConchSpriteAdpt._tempFloatArrayMatrix[4]=this.x-o+n,ConchSpriteAdpt._tempFloatArrayMatrix[5]=this.y-h+n,t.setGlobalValue(tt.GLOBALVALUE_MATRIX32,8,ConchSpriteAdpt._tempFloatArrayMatrix)}this._filterBeginCmd.endEncoding()},e.filterEndRenderFromNative=function(){this._filterEndCmd.beginEncoding(),this._filterEndCmd.clearEncoding();var t=K.instance,e=this._getCacheStyle().filters;if(e[0]instanceof laya.filters.ColorFilter);else{t.restore();var i=K.instance.getCurrentContext(),r=$t.currentActive;if($t.popRT(),e[0]instanceof a.BlurFilter){t.addShaderMacro(tt.SHADER_MACRO_BLUR_FILTER);var _=e[0];ConchSpriteAdpt._tempFloatArrayBuffer2[0]=r.width,ConchSpriteAdpt._tempFloatArrayBuffer2[1]=r.height,t.setGlobalValue(tt.GLOBALVALUE_BLURFILTER_BLURINFO,8,ConchSpriteAdpt._tempFloatArrayBuffer2),t.setGlobalValue(tt.GLOBALVALUE_BLURFILTER_STRENGTH,8,_.getStrenth_sig2_2sig2_native()),i.drawTarget(this._filterEndCmd,r,-4,-4,0,0)}else if(e[0]instanceof a.GlowFilter){var n=r.width,s=r.height,o=ft.getRT(n,s);ConchSpriteAdpt.useRenderTarget(o),t.addShaderMacro(tt.SHADER_MACRO_GLOW_FILTER);var h=e[0],l=h.getBlurInfo2Native();l[0]=n,l[1]=s,t.setGlobalValue(tt.GLOBALVALUE_GLOWFILTER_COLOR,8,h.getColorNative()),t.setGlobalValue(tt.GLOBALVALUE_GLOWFILTER_BLURINFO1,8,h.getBlurInfo1Native()),t.setGlobalValue(tt.GLOBALVALUE_GLOWFILTER_BLURINFO2,8,l),i.drawTarget(this._filterEndCmd,r,-16,-16,0,0),t.restore(),$t.popRT(),i.drawTarget(this._filterEndCmd,o,-29,-29,0,0),i.drawTarget(this._filterEndCmd,r,-29,-29,0,0)}}this._filterEndCmd.endEncoding(),K.syncBufferToRenderThread(this._filterEndCmd)},e.maskRenderFromNative=function(){this._maskCmd.beginEncoding(),this._maskCmd.clearEncoding();var t=K.instance,e=t.getCurrentContext(),a=this.mask;a&&(a._children.length>0?(t.blockStart(a._conchData),a._renderChilds(e),t.blockEnd(a._conchData)):t.block(a._conchData)),ConchSpriteAdpt._tempInt1[0]=772,t.setGlobalValue(tt.GLOBALVALUE_BLENDFUNC_SRC,8,ConchSpriteAdpt._tempInt1),ConchSpriteAdpt._tempInt1[0]=0,t.setGlobalValue(tt.GLOBALVALUE_BLENDFUNC_DEST,8,ConchSpriteAdpt._tempInt1),this._maskCmd.endEncoding()},e.updateParticleFromNative=function(){this.tempCmd.updateParticle()},ConchSpriteAdpt.createMatrix=function(t,e,a,i,r,_,n){return void 0===t&&(t=1),void 0===e&&(e=0),void 0===a&&(a=0),void 0===i&&(i=1),void 0===r&&(r=0),void 0===_&&(_=0),new et(t,e,a,i,r,_,n)},ConchSpriteAdpt.init=function(){Q.__init__(),j.__init__();var t,e,a=B.prototype,i=ConchSpriteAdpt.prototype,r=["_createTransform","_setTransform","_setGraphics","_setGraphicsCallBack","_setCacheAs","_setX","_setY","_setPivotX","_getPivotX","_setPivotY","_getPivotY","_setAlpha","_getAlpha","_setScaleX","_setScaleY","_setSkewX","_setSkewY","_setRotation","_adjustTransform","_setRenderType","_setTexture","_setTextureEx","_setCustomRender","_setScrollRect","_setColorFilter","customRenderFromNative","canvasBeginRenderFromNative","canvasEndRenderFromNative","setChildrenNativeVisible","filterBeginRenderFromNative","filterEndRenderFromNative","updateParticleFromNative","_setMask","maskRenderFromNative","_setBlendMode","_setBgStyleColor","_setBorderStyleColor"],_=0;for(t=r.length,_=0;_<t;_++)a[e=r[_]]=i[e];a.createGLBuffer=i.createData,R._createFun=ConchSpriteAdpt.createMatrix;a.render=a.renderToNative=Qt.prototype.renderToNative,a.repaint=a.repaintForNative=Qt.prototype.repaintForNative,a.parentRepaint=a.parentRepaintForNative=Qt.prototype.parentRepaintForNative,a._renderChilds=Qt.prototype._renderChilds},ConchSpriteAdpt.useRenderTarget=function(t){var e=K.instance;$t.pushRT(),t.start(),e.clearColor(0,0,0,0),e.clear(17664),e.save(),ConchSpriteAdpt._tempFloatArrayBuffer2[0]=t.width,ConchSpriteAdpt._tempFloatArrayBuffer2[1]=t.height,e.setGlobalValue(tt.GLOBALVALUE_VIEWS,8,ConchSpriteAdpt._tempFloatArrayBuffer2)},ConchSpriteAdpt.buildCanvas=function(t,e,a){var i,r,_,n,s,o,h,l=t._cacheStyle,u=l.canvas,c=l.cacheAs;return s=(h=l._calculateCacheRect(t,c,e,a)).x,o=h.y,_=(r=l.cacheRect).width*s,n=r.height*o,r.x,r.y,"bitmap"===c&&(_>2048||n>2048)?(alert("cache bitmap size larger than 2048,cache ignored"),l.releaseContext(),null):(u||(l.createContext(),u=l.canvas),i=u.context,u.context.sprite=t,u.width==_&&u.height==n||(u.size(_,n),i._targets&&(i._targets.destroy(),i._targets=null)),"bitmap"===c?u.context.asBitmap=!0:"normal"===c&&(u.context.asBitmap=!1),"normal"===c&&(i.touches=[]),u)},i(ConchSpriteAdpt,["_tempFloatArrayBuffer2",function(){return this._tempFloatArrayBuffer2=new Float32Array(2)},"_tempFloatArrayMatrix",function(){return this._tempFloatArrayMatrix=new Float32Array(6)},"_tempInt1",function(){return this._tempInt1=new Int32Array(1)}]),ConchSpriteAdpt}(),Yt=function(t){function BaseShader(){BaseShader.__super.call(this)}return r(BaseShader,"laya.webgl.shader.BaseShader",S),BaseShader.activeShader=null,BaseShader.bindShader=null,BaseShader}(),Ht=function(t){function CharPageTexture(t,e,a){this.texture=null,this._source=null,this._used=null,this._startFindPos=0,this._texW=0,this._texH=0,this._gridNum=0,this.charMaps=[],this._score=0,this._scoreTick=0,this.__destroyed=!1,this._discardTm=0,CharPageTexture.__super.call(this),this._texW=t,this._texH=e,this._gridNum=a,this.texture=new lt(this),this.setGridNum(a),this.lock=!0}r(CharPageTexture,"laya.webgl.resource.CharPageTexture",S);var e=CharPageTexture.prototype;return e.findAGrid=function(){for(var t=this._startFindPos;t<this._gridNum;t++)if(0==this._used[t])return this._startFindPos=t+1,this._used[t]=1,t;return-1},e.removeGrid=function(t){this._used[t]=0,t<this._startFindPos&&(this._startFindPos=t)},e.removeOld=function(t){for(var e=0,a=null,i=0,r=this.charMaps.length;i<r;i++)if(a=this.charMaps[i]){var _=this;a.forEach(function(a,i,r){a&&a.touchTick<t&&(console.log("remove char "+i),_.removeGrid(a.pos),r.delete(i),e++)})}return e},e.reset=function(){this._discardTm=a.stage.getFrameTm(),this._startFindPos=0,this.charMaps=[],this._score=0,this._scoreTick=0,this.__destroyed=!0},e.setGridNum=function(t){if(this._used&&this._used.length==this._gridNum)if(this._used.fill)this._used.fill(0);else for(var e=0;e<this._used.length;e++)this._used[e]=0;else this._used=new Uint8Array(t)},e.recreateResource=function(){if(!this._source){var t=p.isConchApp?K.instance.getDefaultCommandEncoder():xt.mainContext,e=this._source=t.createTexture();this.texture.bitmap._glTexture=this._source,Mt.bindTexture(t,3553,e),t.texImage2D(3553,0,6408,this._texW,this._texH,0,6408,5121,null),t.texParameteri(3553,10241,9729),t.texParameteri(3553,10240,9729),t.texParameteri(3553,10242,33071),t.texParameteri(3553,10243,33071)}},e.addChar=function(t,e,a){if(ht.isWan1Wan)this.addCharCanvas(t,e,a);else{!this._source&&this.recreateResource();var i=p.isConchApp?K.instance.getDefaultCommandEncoder():xt.mainContext;Mt.bindTexture(i,3553,this._source),!p.isConchApp&&i.pixelStorei(37441,!0);var r=t.data;t.data instanceof Uint8ClampedArray&&(r=new Uint8Array(r.buffer)),i.texSubImage2D(3553,0,e,a,t.width,t.height,6408,5121,r),!p.isConchApp&&i.pixelStorei(37441,!1)}},e.addCharCanvas=function(t,e,a){!this._source&&this.recreateResource();var i=p.isConchApp?K.instance.getDefaultCommandEncoder():xt.mainContext;Mt.bindTexture(i,3553,this._source),!p.isConchApp&&i.pixelStorei(37441,!0),i.texSubImage2D(3553,0,e,a,6408,5121,t),!p.isConchApp&&i.pixelStorei(37441,!1)},e.destroy=function(){console.log("destroy CharPageTexture"),this.__destroyed=!0;var t=p.isConchApp?K.instance.getDefaultCommandEncoder():xt.mainContext;this._source&&t.deleteTexture(this._source),this._source=null},CharPageTexture}(),Zt=function(t){function Buffer(){this._glBuffer=null,this._buffer=null,this._bufferType=0,this._bufferUsage=0,this._byteLength=0,Buffer.__super.call(this),this._glBuffer=K.instance.createBuffer()}r(Buffer,"laya.webgl.utils.Buffer",S);var e=Buffer.prototype;return e._bindForVAO=function(){},e.bind=function(){return!1},e._disposeResource=function(){this._glBuffer&&(K.instance.deleteBuffer(this._glBuffer),this._glBuffer=null),this._setGPUMemory(0)},_(0,e,"bufferUsage",function(){return this._bufferUsage}),Buffer._bindedVertexBuffer=null,Buffer._bindedIndexBuffer=null,Buffer}(),Qt=function(t){function ConchSprite(){ConchSprite.__super.call(this)}r(ConchSprite,"laya.layagl.ConchSprite",B);var e=ConchSprite.prototype;return e.parentRepaintForNative=function(t){void 0===t&&(t=2);var e=this._parent;e&&(e._conchData._int32Data[4]&t)!=t&&(e._conchData._int32Data[4]|=t,e.parentRepaintForNative(t))},e.renderToNative=function(t,e,a){var i=t.gl,r=K.getFrameCount()-1,_=this._conchData._int32Data,n=_[4];this._children.length>0?r!=_[3]||n>0&&1==(1&n)?(i.blockStart(this._conchData),this._renderChilds(t),i.blockEnd(this._conchData)):i.copyCmdBuffer(this._conchData._int32Data[1],this._conchData._int32Data[2]):i.block(this._conchData)},e._renderChilds=function(t){var e,a=this._children,i=0,r=a.length,_=this._style;if(_.viewport)for(var n=_.viewport,s=n.x,o=n.y,h=n.right,l=n.bottom,u=NaN,c=NaN;i<r;++i)(e=a[i])._visible&&(u=e._x)<h&&u+e.width>s&&(c=e._y)<l&&c+e.height>o&&e.renderToNative(t);else for(;i<r;++i)(e=a[i])._visible&&e.renderToNative(t)},e.repaintForNative=function(t){void 0===t&&(t=2),(this._conchData._int32Data[4]&t)!=t&&(this._conchData._int32Data[4]|=t,this.parentRepaintForNative(t))},ConchSprite}(),jt=function(t){function BaseTexture(t,e){BaseTexture.__super.call(this),this._wrapModeU=0,this._wrapModeV=0,this._filterMode=1,this._readyed=!1,this._width=-1,this._height=-1,this._format=t,this._mipmap=e,this._anisoLevel=1,this._glTexture=K.instance.createTexture()}r(BaseTexture,"laya.webgl.resource.BaseTexture",s);var e=BaseTexture.prototype;return e._isPot=function(t){return 0==(t&t-1)},e._getGLFormat=function(){var t=0;switch(this._format){case 0:t=6407;break;case 1:t=6408;break;case 2:t=6406;break;case 3:if(!Mt._compressedTextureS3tc)throw"BaseTexture: not support DXT1 format.";t=Mt._compressedTextureS3tc.COMPRESSED_RGB_S3TC_DXT1_EXT;break;case 4:if(!Mt._compressedTextureS3tc)throw"BaseTexture: not support DXT5 format.";t=Mt._compressedTextureS3tc.COMPRESSED_RGBA_S3TC_DXT5_EXT;break;case 5:if(!Mt._compressedTextureEtc1)throw"BaseTexture: not support ETC1RGB format.";t=Mt._compressedTextureEtc1.COMPRESSED_RGB_ETC1_WEBGL;break;case 9:if(!Mt._compressedTexturePvrtc)throw"BaseTexture: not support PVRTCRGB_2BPPV format.";t=Mt._compressedTexturePvrtc.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;break;case 10:if(!Mt._compressedTexturePvrtc)throw"BaseTexture: not support PVRTCRGBA_2BPPV format.";t=Mt._compressedTexturePvrtc.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG;break;case 11:if(!Mt._compressedTexturePvrtc)throw"BaseTexture: not support PVRTCRGB_4BPPV format.";t=Mt._compressedTexturePvrtc.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;break;case 12:if(!Mt._compressedTexturePvrtc)throw"BaseTexture: not support PVRTCRGBA_4BPPV format.";t=Mt._compressedTexturePvrtc.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;break;default:throw"BaseTexture: unknown texture format."}return t},e._setFilterMode=function(t){var e=K.instance;switch(Mt.bindTexture(e,this._glTextureType,this._glTexture),t){case 0:this._mipmap&&this._isPot(this._width)&&this._isPot(this._height)?e.texParameteri(this._glTextureType,10241,9984):e.texParameteri(this._glTextureType,10241,9728),e.texParameteri(this._glTextureType,10240,9728);break;case 1:this._mipmap&&this._isPot(this._width)&&this._isPot(this._height)?e.texParameteri(this._glTextureType,10241,9985):e.texParameteri(this._glTextureType,10241,9729),e.texParameteri(this._glTextureType,10240,9729);break;case 2:this._mipmap&&this._isPot(this._width)&&this._isPot(this._height)?e.texParameteri(this._glTextureType,10241,9987):e.texParameteri(this._glTextureType,10241,9729),e.texParameteri(this._glTextureType,10240,9729);break;default:throw new Error("BaseTexture:unknown filterMode value.")}},e._setWarpMode=function(t,e){var a=K.instance;if(Mt.bindTexture(a,this._glTextureType,this._glTexture),this._isPot(this._width)&&this._isPot(this._height))switch(e){case 0:a.texParameteri(this._glTextureType,t,10497);break;case 1:a.texParameteri(this._glTextureType,t,33071)}else a.texParameteri(this._glTextureType,t,33071)},e._setAnisotropy=function(t){t=Math.max(t,1);var e=K.instance;Mt.bindTexture(e,this._glTextureType,this._glTexture);var a=Mt._extTextureFilterAnisotropic;a&&(t=Math.min(e.getParameter(a.MAX_TEXTURE_MAX_ANISOTROPY_EXT),t),e.texParameterf(this._glTextureType,a.TEXTURE_MAX_ANISOTROPY_EXT,t))},e._disposeResource=function(){this._glTexture&&(K.instance.deleteTexture(this._glTexture),this._glTexture=null,this._setGPUMemory(0))},e._getSource=function(){return this._readyed?this._glTexture:null},_(0,e,"wrapModeU",function(){return this._wrapModeU},function(t){this._wrapModeU!==t&&(this._wrapModeU=t,-1!==this._width&&this._setWarpMode(10242,t))}),_(0,e,"mipmap",function(){return this._mipmap}),_(0,e,"format",function(){return this._format}),_(0,e,"wrapModeV",function(){return this._wrapModeV},function(t){this._wrapModeV!==t&&(this._wrapModeV=t,-1!==this._height&&this._setWarpMode(10243,t))}),_(0,e,"defaulteTexture",function(){throw"BaseTexture:must override it."}),_(0,e,"filterMode",function(){return this._filterMode},function(t){t!==this._filterMode&&(this._filterMode=t,-1!==this._width&&-1!==this._height&&this._setFilterMode(t))}),_(0,e,"anisoLevel",function(){return this._anisoLevel},function(t){t!==this._anisoLevel&&(this._anisoLevel=Math.max(1,Math.min(16,t)),-1!==this._width&&-1!==this._height&&this._setAnisotropy(t))}),BaseTexture.WARPMODE_REPEAT=0,BaseTexture.WARPMODE_CLAMP=1,BaseTexture.FILTERMODE_POINT=0,BaseTexture.FILTERMODE_BILINEAR=1,BaseTexture.FILTERMODE_TRILINEAR=2,BaseTexture.FORMAT_R8G8B8=0,BaseTexture.FORMAT_R8G8B8A8=1,BaseTexture.FORMAT_ALPHA8=2,BaseTexture.FORMAT_DXT1=3,BaseTexture.FORMAT_DXT5=4,BaseTexture.FORMAT_ETC1RGB=5,BaseTexture.FORMAT_PVRTCRGB_2BPPV=9,BaseTexture.FORMAT_PVRTCRGBA_2BPPV=10,BaseTexture.FORMAT_PVRTCRGB_4BPPV=11,BaseTexture.FORMAT_PVRTCRGBA_4BPPV=12,BaseTexture.FORMAT_DEPTH_16=0,BaseTexture.FORMAT_STENCIL_8=1,BaseTexture.FORMAT_DEPTHSTENCIL_16_8=2,BaseTexture.FORMAT_DEPTHSTENCIL_NONE=3,BaseTexture}(),Kt=function(t){function Shader(t,e,a,i,r){if(this._attribInfo=null,this.customCompile=!1,this._curActTexIndex=0,this.tag={},this._program=null,this._params=null,this._paramsMap={},Shader.__super.call(this),!t||!e)throw"Shader Error";this._attribInfo=r,p.isConchApp&&(this.customCompile=!0),this._id=++Shader._count,this._vs=t,this._ps=e,this._nameMap=i||{},null!=a&&(Shader.sharders[a]=this),this.recreateResource(),this.lock=!0}r(Shader,"laya.webgl.shader.Shader",Yt);var e=Shader.prototype;return e.recreateResource=function(){this._compile(),this._setGPUMemory(0)},e._disposeResource=function(){xt.mainContext.deleteShader(this._vshader),xt.mainContext.deleteShader(this._pshader),xt.mainContext.deleteProgram(this._program),this._vshader=this._pshader=this._program=null,this._params=null,this._paramsMap={},this._setGPUMemory(0),this._curActTexIndex=0},e._compile=function(){if(this._vs&&this._ps&&!this._params){var t;this._reCompile=!0,this._params=[],this.customCompile&&(t=St.preGetParams(this._vs,this._ps));var e=xt.mainContext;this._program=e.createProgram(),this._vshader=Shader._createShader(e,this._vs,35633),this._pshader=Shader._createShader(e,this._ps,35632),e.attachShader(this._program,this._vshader),e.attachShader(this._program,this._pshader);var a,i,r=0,_=this._attribInfo?this._attribInfo.length:0;for(r=0;r<_;r+=2)e.bindAttribLocation(this._program,this._attribInfo[r+1],this._attribInfo[r]);if(e.linkProgram(this._program),!this.customCompile&&!e.getProgramParameter(this._program,35714))throw e.getProgramInfoLog(this._program);var n=this.customCompile?t.uniforms.length:e.getProgramParameter(this._program,35718);for(r=0;r<n;r++){var s=this.customCompile?t.uniforms[r]:e.getActiveUniform(this._program,r);(a={vartype:"uniform",glfun:null,ivartype:1,location:e.getUniformLocation(this._program,s.name),name:s.name,type:s.type,isArray:!1,isSame:!1,preValue:null,indexOfParams:0}).name.indexOf("[0]")>0&&(a.name=a.name.substr(0,a.name.length-3),a.isArray=!0,a.location=e.getUniformLocation(this._program,a.name)),this._params.push(a)}for(r=0,i=this._params.length;r<i;r++)switch((a=this._params[r]).indexOfParams=r,a.index=1,a.value=[a.location,null],a.codename=a.name,a.name=this._nameMap[a.codename]?this._nameMap[a.codename]:a.codename,this._paramsMap[a.name]=a,a._this=this,a.uploadedValue=[],a.type){case 5124:a.fun=a.isArray?this._uniform1iv:this._uniform1i;break;case 5126:a.fun=a.isArray?this._uniform1fv:this._uniform1f;break;case 35664:a.fun=a.isArray?this._uniform_vec2v:this._uniform_vec2;break;case 35665:a.fun=a.isArray?this._uniform_vec3v:this._uniform_vec3;break;case 35666:a.fun=a.isArray?this._uniform_vec4v:this._uniform_vec4;break;case 35678:a.fun=this._uniform_sampler2D;break;case 35680:a.fun=this._uniform_samplerCube;break;case 35676:a.glfun=e.uniformMatrix4fv,a.fun=this._uniformMatrix4fv;break;case 35670:a.fun=this._uniform1i;break;case 35674:case 35675:default:throw new Error("compile shader err!")}}},e.getUniform=function(t){return this._paramsMap[t]},e._uniform1f=function(t,e){var a=t.uploadedValue;return a[0]!==e?(xt.mainContext.uniform1f(t.location,a[0]=e),1):0},e._uniform1fv=function(t,e){if(e.length<4){var a=t.uploadedValue;return a[0]!==e[0]||a[1]!==e[1]||a[2]!==e[2]||a[3]!==e[3]?(xt.mainContext.uniform1fv(t.location,e),a[0]=e[0],a[1]=e[1],a[2]=e[2],a[3]=e[3],1):0}return xt.mainContext.uniform1fv(t.location,e),1},e._uniform_vec2=function(t,e){var a=t.uploadedValue;return a[0]!==e[0]||a[1]!==e[1]?(xt.mainContext.uniform2f(t.location,a[0]=e[0],a[1]=e[1]),1):0},e._uniform_vec2v=function(t,e){if(e.length<2){var a=t.uploadedValue;return a[0]!==e[0]||a[1]!==e[1]||a[2]!==e[2]||a[3]!==e[3]?(xt.mainContext.uniform2fv(t.location,e),a[0]=e[0],a[1]=e[1],a[2]=e[2],a[3]=e[3],1):0}return xt.mainContext.uniform2fv(t.location,e),1},e._uniform_vec3=function(t,e){var a=t.uploadedValue;return a[0]!==e[0]||a[1]!==e[1]||a[2]!==e[2]?(xt.mainContext.uniform3f(t.location,a[0]=e[0],a[1]=e[1],a[2]=e[2]),1):0},e._uniform_vec3v=function(t,e){return xt.mainContext.uniform3fv(t.location,e),1},e._uniform_vec4=function(t,e){var a=t.uploadedValue;return a[0]!==e[0]||a[1]!==e[1]||a[2]!==e[2]||a[3]!==e[3]?(xt.mainContext.uniform4f(t.location,a[0]=e[0],a[1]=e[1],a[2]=e[2],a[3]=e[3]),1):0},e._uniform_vec4v=function(t,e){return xt.mainContext.uniform4fv(t.location,e),1},e._uniformMatrix2fv=function(t,e){return xt.mainContext.uniformMatrix2fv(t.location,!1,e),1},e._uniformMatrix3fv=function(t,e){return xt.mainContext.uniformMatrix3fv(t.location,!1,e),1},e._uniformMatrix4fv=function(t,e){return xt.mainContext.uniformMatrix4fv(t.location,!1,e),1},e._uniform1i=function(t,e){var a=t.uploadedValue;return a[0]!==e?(xt.mainContext.uniform1i(t.location,a[0]=e),1):0},e._uniform1iv=function(t,e){return xt.mainContext.uniform1iv(t.location,e),1},e._uniform_ivec2=function(t,e){var a=t.uploadedValue;return a[0]!==e[0]||a[1]!==e[1]?(xt.mainContext.uniform2i(t.location,a[0]=e[0],a[1]=e[1]),1):0},e._uniform_ivec2v=function(t,e){return xt.mainContext.uniform2iv(t.location,e),1},e._uniform_vec3i=function(t,e){var a=t.uploadedValue;return a[0]!==e[0]||a[1]!==e[1]||a[2]!==e[2]?(xt.mainContext.uniform3i(t.location,a[0]=e[0],a[1]=e[1],a[2]=e[2]),1):0},e._uniform_vec3vi=function(t,e){return xt.mainContext.uniform3iv(t.location,e),1},e._uniform_vec4i=function(t,e){var a=t.uploadedValue;return a[0]!==e[0]||a[1]!==e[1]||a[2]!==e[2]||a[3]!==e[3]?(xt.mainContext.uniform4i(t.location,a[0]=e[0],a[1]=e[1],a[2]=e[2],a[3]=e[3]),1):0},e._uniform_vec4vi=function(t,e){return xt.mainContext.uniform4iv(t.location,e),1},e._uniform_sampler2D=function(t,e){var a=xt.mainContext,i=t.uploadedValue;return null==i[0]?(i[0]=this._curActTexIndex,a.uniform1i(t.location,this._curActTexIndex),Mt.activeTexture(a,33984+this._curActTexIndex),Mt.bindTexture(a,3553,e),this._curActTexIndex++,1):(Mt.activeTexture(a,33984+i[0]),Mt.bindTexture(a,3553,e),0)},e._uniform_samplerCube=function(t,e){var a=xt.mainContext,i=t.uploadedValue;return null==i[0]?(i[0]=this._curActTexIndex,a.uniform1i(t.location,this._curActTexIndex),Mt.activeTexture(a,33984+this._curActTexIndex),Mt.bindTexture(a,34067,e),this._curActTexIndex++,1):(Mt.activeTexture(a,33984+i[0]),Mt.bindTexture(a,34067,e),0)},e._noSetValue=function(t){console.log("no....:"+t.name)},e.uploadOne=function(t,e){Mt.useProgram(xt.mainContext,this._program);var a=this._paramsMap[t];a.fun.call(this,a,e)},e.uploadTexture2D=function(t){var e=Mt;e._activeTextures[0]!==t&&(e.bindTexture(xt.mainContext,e.TEXTURE_2D,t),e._activeTextures[0]=t)},e.upload=function(t,e){Yt.activeShader=Yt.bindShader=this;var a=xt.mainContext;Mt.useProgram(a,this._program),this._reCompile?(e=this._params,this._reCompile=!1):e=e||this._params;for(var i,r,_=e.length,n=0,s=0;s<_;s++)null!==(r=t[(i=e[s]).name])&&(n+=i.fun.call(this,i,r));I.shaderCall+=n},e.uploadArray=function(t,e,a){Yt.activeShader=this,Yt.bindShader=this,Mt.useProgram(xt.mainContext,this._program);this._params;for(var i,r,_=0,n=e-2;n>=0;n-=2)(r=this._paramsMap[t[n]])&&null!=(i=t[n+1])&&(a&&a[r.name]&&a[r.name].bind(),_+=r.fun.call(this,r,i));I.shaderCall+=_},e.getParams=function(){return this._params},e.setAttributesLocation=function(t){this._attribInfo=t},Shader.getShader=function(t){return Shader.sharders[t]},Shader.create=function(t,e,a,i,r){return new Shader(t,e,a,i,r)},Shader.withCompile=function(t,e,a,i){if(a&&Shader.sharders[a])return Shader.sharders[a];var r=Shader._preCompileShader[2e-4*t];if(!r)throw new Error("withCompile shader err!"+t);return r.createShader(e,a,i,null)},Shader.withCompile2D=function(t,e,a,i,r,_){if(i&&Shader.sharders[i])return Shader.sharders[i];var n=Shader._preCompileShader[2e-4*t+e];if(!n)throw new Error("withCompile shader err!"+t+" "+e);return n.createShader(a,i,r,_)},Shader.addInclude=function(t,e){St.addInclude(t,e)},Shader.preCompile=function(t,e,a,i){var r=2e-4*t;Shader._preCompileShader[r]=new St(e,a,i)},Shader.preCompile2D=function(t,e,a,i,r){var _=2e-4*t+e;Shader._preCompileShader[_]=new St(a,i,r)},Shader._createShader=function(t,e,a){var i=t.createShader(a);return t.shaderSource(i,e),t.compileShader(i),t.getShaderParameter(i,35713)?i:(console.log(t.getShaderInfoLog(i)),null)},Shader._count=0,Shader._preCompileShader={},Shader.SHADERNAME2ID=2e-4,Shader.sharders=new Array(32),i(Shader,["nameKey",function(){return this.nameKey=new F}]),Shader}(),qt=function(t){function Buffer2D(){this._maxsize=0,this._upload=!0,this._uploadSize=0,this._bufferSize=0,this._u8Array=null,Buffer2D.__super.call(this),this.lock=!0}r(Buffer2D,"laya.webgl.utils.Buffer2D",t);var e=Buffer2D.prototype;return e.setByteLength=function(t){this._byteLength!==t&&(t<=this._bufferSize||this._resizeBuffer(2*t+256,!0),this._byteLength=t)},e.needSize=function(t){var e=this._byteLength;if(t){var a=this._byteLength+t;a<=this._bufferSize||this._resizeBuffer(a<<1,!0),this._byteLength=a}return e},e._bufferData=function(){this._maxsize=Math.max(this._maxsize,this._byteLength),I.loopCount%30==0&&(this._buffer.byteLength>this._maxsize+64&&(this._setGPUMemory(this._buffer.byteLength),this._buffer=this._buffer.slice(0,this._maxsize+64),this._bufferSize=this._buffer.byteLength,this._checkArrayUse()),this._maxsize=this._byteLength),this._uploadSize<this._buffer.byteLength&&(this._uploadSize=this._buffer.byteLength,K.instance.bufferData(this._bufferType,this._uploadSize,this._bufferUsage),this._setGPUMemory(this._uploadSize)),K.instance.bufferSubData(this._bufferType,0,this._buffer)},e._bufferSubData=function(t,e,a){if(void 0===t&&(t=0),void 0===e&&(e=0),void 0===a&&(a=0),this._maxsize=Math.max(this._maxsize,this._byteLength),I.loopCount%30==0&&(this._buffer.byteLength>this._maxsize+64&&(this._setGPUMemory(this._buffer.byteLength),this._buffer=this._buffer.slice(0,this._maxsize+64),this._bufferSize=this._buffer.byteLength,this._checkArrayUse()),this._maxsize=this._byteLength),this._uploadSize<this._buffer.byteLength&&(this._uploadSize=this._buffer.byteLength,K.instance.bufferData(this._bufferType,this._uploadSize,this._bufferUsage),this._setGPUMemory(this._uploadSize)),e||a){var i=this._buffer.slice(e,a);K.instance.bufferSubData(this._bufferType,t,i)}else K.instance.bufferSubData(this._bufferType,t,this._buffer)},e._checkArrayUse=function(){},e._bind_uploadForVAO=function(){return!!this._upload&&(this._upload=!1,this._bindForVAO(),this._bufferData(),!0)},e._bind_upload=function(){return!!this._upload&&(this._upload=!1,this.bind(),this._bufferData(),!0)},e._bind_subUpload=function(t,e,a){return void 0===t&&(t=0),void 0===e&&(e=0),void 0===a&&(a=0),!!this._upload&&(this._upload=!1,this.bind(),this._bufferSubData(t,e,a),!0)},e._resizeBuffer=function(t,e){if(t<this._buffer.byteLength)return this;if(this._setGPUMemory(t),e&&this._buffer&&this._buffer.byteLength>0){var a=new ArrayBuffer(t),i=this._u8Array&&this._u8Array.buffer==this._buffer?this._u8Array:new Uint8Array(this._buffer);this._u8Array=new Uint8Array(a),this._u8Array.set(i,0),this._buffer=a}else this._buffer=new ArrayBuffer(t);return this._checkArrayUse(),this._upload=!0,this._bufferSize=this._buffer.byteLength,this},e.append=function(t){this._upload=!0;var e,a;e=t.byteLength,t instanceof Uint8Array?(this._resizeBuffer(this._byteLength+e,!0),a=new Uint8Array(this._buffer,this._byteLength)):t instanceof Uint16Array?(this._resizeBuffer(this._byteLength+e,!0),a=new Uint16Array(this._buffer,this._byteLength)):t instanceof Float32Array&&(this._resizeBuffer(this._byteLength+e,!0),a=new Float32Array(this._buffer,this._byteLength)),a.set(t,0),this._byteLength+=e,this._checkArrayUse()},e.appendU16Array=function(t,e){this._resizeBuffer(this._byteLength+2*e,!0);for(var a=new Uint16Array(this._buffer,this._byteLength,e),i=0;i<e;i++)a[i]=t[i];this._byteLength+=2*e,this._checkArrayUse()},e.appendEx=function(t,e){this._upload=!0;var a;a=t.byteLength,this._resizeBuffer(this._byteLength+a,!0),new e(this._buffer,this._byteLength).set(t,0),this._byteLength+=a,this._checkArrayUse()},e.appendEx2=function(t,e,a,i){void 0===i&&(i=1),this._upload=!0;var r,_;r=a*i,this._resizeBuffer(this._byteLength+r,!0),_=new e(this._buffer,this._byteLength);var n=0;for(n=0;n<a;n++)_[n]=t[n];this._byteLength+=r,this._checkArrayUse()},e.getBuffer=function(){return this._buffer},e.setNeedUpload=function(){this._upload=!0},e.getNeedUpload=function(){return this._upload},e.upload=function(){var t=this._bind_upload();return K.instance.bindBuffer(this._bufferType,null),34962==this._bufferType&&(Zt._bindedVertexBuffer=null),34963==this._bufferType&&(Zt._bindedIndexBuffer=null),Yt.activeShader=null,t},e.subUpload=function(t,e,a){void 0===t&&(t=0),void 0===e&&(e=0),void 0===a&&(a=0);var i=this._bind_subUpload();return K.instance.bindBuffer(this._bufferType,null),34962==this._bufferType&&(Zt._bindedVertexBuffer=null),34963==this._bufferType&&(Zt._bindedIndexBuffer=null),Yt.activeShader=null,i},e._disposeResource=function(){t.prototype._disposeResource.call(this),this._upload=!0,this._uploadSize=0},e.clear=function(){this._byteLength=0,this._upload=!0},_(0,e,"bufferLength",function(){return this._buffer.byteLength}),_(0,e,"byteLength",null,function(t){this.setByteLength(t)}),Buffer2D.__int__=function(t){},Buffer2D.FLOAT32=4,Buffer2D.SHORT=2,Buffer2D}(Zt),$t=function(t){function RenderTexture2D(t,e,a,i){this._mgrKey=0,void 0===a&&(a=0),void 0===i&&(i=0),RenderTexture2D.__super.call(this,a,!1),this._glTextureType=3553,this._width=t,this._height=e,this._depthStencilFormat=i,this._create(t,e)}r(RenderTexture2D,"laya.webgl.resource.RenderTexture2D",jt);var e=RenderTexture2D.prototype;return e._create=function(t,e){var a=K.instance;this._frameBuffer=a.createFramebuffer(),Mt.bindTexture(a,this._glTextureType,this._glTexture);var i=this._getGLFormat();if(a.texImage2D(this._glTextureType,0,i,t,e,0,i,5121,null),this._setGPUMemory(t*e*4),a.bindFramebuffer(36160,this._frameBuffer),a.framebufferTexture2D(36160,36064,3553,this._glTexture,0),3!==this._depthStencilFormat)switch(this._depthStencilBuffer=a.createRenderbuffer(),a.bindRenderbuffer(36161,this._depthStencilBuffer),this._depthStencilFormat){case 0:a.renderbufferStorage(36161,33189,t,e),a.framebufferRenderbuffer(36160,36096,36161,this._depthStencilBuffer);break;case 1:a.renderbufferStorage(36161,36168,t,e),a.framebufferRenderbuffer(36160,36128,36161,this._depthStencilBuffer);break;case 2:a.renderbufferStorage(36161,34041,t,e),a.framebufferRenderbuffer(36160,33306,36161,this._depthStencilBuffer);break;default:console.log("RenderTexture: unkonw depth format.")}a.bindFramebuffer(36160,null),a.bindRenderbuffer(36161,null),this._setWarpMode(10242,this._wrapModeU),this._setWarpMode(10243,this._wrapModeV),this._setFilterMode(this._filterMode),this._setAnisotropy(this._anisoLevel),this._readyed=!0,this._activeResource()},e.generateMipmap=function(){this._isPot(this.width)&&this._isPot(this.height)?(this._mipmap=!0,K.instance.generateMipmap(this._glTextureType),this._setFilterMode(this._filterMode),this._setGPUMemory(this.width*this.height*4*(1+1/3))):(this._mipmap=!1,this._setGPUMemory(this.width*this.height*4))},e.start=function(){var t=K.instance;K.instance.bindFramebuffer(36160,this._frameBuffer),RenderTexture2D._currentActive=this,this._readyed=!0,t.viewport(0,0,this._width,this._height),this._lastWidth=bt.width,this._lastHeight=bt.height,bt.width=this._width,bt.height=this._height,Yt.activeShader=null},e.end=function(){K.instance.bindFramebuffer(36160,null),RenderTexture2D._currentActive=null,this._readyed=!0},e.restore=function(){var t=K.instance;this._lastRT!=RenderTexture2D._currentActive&&(K.instance.bindFramebuffer(36160,this._lastRT?this._lastRT._frameBuffer:null),RenderTexture2D._currentActive=this._lastRT),this._readyed=!0,t.viewport(0,0,this._lastWidth,this._lastHeight),bt.width=this._lastWidth,bt.height=this._lastHeight,Yt.activeShader=null},e.clear=function(t,e,a,i){void 0===t&&(t=0),void 0===e&&(e=0),void 0===a&&(a=0),void 0===i&&(i=1);var r=K.instance;r.clearColor(t,e,a,i);var _=16384;switch(this._depthStencilFormat){case 33189:_|=256;break;case 36168:_|=1024;break;case 34041:_|=256,_|=1024}r.clear(_)},e.getData=function(t,e,a,i){var r=K.instance;if(r.bindFramebuffer(36160,this._frameBuffer),!(36053===r.checkFramebufferStatus(36160)))return r.bindFramebuffer(36160,null),null;var _=new Uint8Array(this._width*this._height*4),n=this._getGLFormat();return r.readPixels(t,e,a,i,n,5121,_),r.bindFramebuffer(36160,null),_},e._disposeResource=function(){if(this._frameBuffer){var t=K.instance;t.deleteTexture(this._glTexture),t.deleteFramebuffer(this._frameBuffer),t.deleteRenderbuffer(this._depthStencilBuffer),this._glTexture=null,this._frameBuffer=null,this._depthStencilBuffer=null,this._setGPUMemory(0)}},_(0,e,"depthStencilFormat",function(){return this._depthStencilFormat}),_(0,e,"defaulteTexture",function(){return Jt.grayTexture}),_(1,RenderTexture2D,"currentActive",function(){return RenderTexture2D._currentActive},laya.webgl.resource.BaseTexture._$SET_currentActive),RenderTexture2D.pushRT=function(){RenderTexture2D.rtStack.push({rt:RenderTexture2D._currentActive,w:bt.width,h:bt.height})},RenderTexture2D.popRT=function(){var t=K.instance,e=RenderTexture2D.rtStack.pop();e&&(RenderTexture2D._currentActive!=e.rt&&(K.instance.bindFramebuffer(36160,e.rt?e.rt._frameBuffer:null),RenderTexture2D._currentActive=e.rt),t.viewport(0,0,e.w,e.h),bt.width=e.w,bt.height=e.h)},RenderTexture2D._currentActive=null,RenderTexture2D.rtStack=[],i(RenderTexture2D,["defuv",function(){return this.defuv=[0,0,1,0,1,1,0,1]},"flipyuv",function(){return this.flipyuv=[0,1,1,1,1,0,0,0]}]),RenderTexture2D}(),Jt=function(t){function Texture2D(t,e,a,i,r){void 0===t&&(t=0),void 0===e&&(e=0),void 0===a&&(a=1),void 0===i&&(i=!0),void 0===r&&(r=!1),Texture2D.__super.call(this,a,i),this._glTextureType=3553,this._width=t,this._height=e,this._canRead=r,this._setWarpMode(10242,this._wrapModeU),this._setWarpMode(10243,this._wrapModeV),u.is2DPixelArtGame&&(this._filterMode=0),this._setFilterMode(this._filterMode),this._setAnisotropy(this._anisoLevel)}r(Texture2D,"laya.webgl.resource.Texture2D",jt);var e=Texture2D.prototype;return e._calcualatesCompressedDataSize=function(t,e,a){switch(t){case 3:case 5:return(e+3>>2)*(a+3>>2)*8;case 4:return(e+3>>2)*(a+3>>2)*16;case 11:case 12:return Math.floor((Math.max(e,8)*Math.max(a,8)*4+7)/8);case 9:case 10:return Math.floor((Math.max(e,16)*Math.max(a,8)*2+7)/8);default:return 0}},e._pharseDDS=function(t){var e=new Int32Array(t,0,31);if(542327876!=e[0])throw"Invalid magic number in DDS header";if(!(4&e[20]))throw"Unsupported format, must contain a FourCC code";var a=e[21];switch(this._format){case 3:if(827611204!==a)throw"the FourCC code is not same with texture format.";break;case 4:if(894720068!==a)throw"the FourCC code is not same with texture format.";break;default:throw"unknown texture format."}var i=1;if(131072&e[2]){if(i=Math.max(1,e[7]),!this._mipmap)throw"the mipmap is not same with Texture2D."}else if(this._mipmap)throw"the mipmap is not same with Texture2D.";var r=e[4],_=e[3];if(this._width!==r||this._height!==_)throw"the width or height is not same with Texture2D.";var n=e[1]+4;this._upLoadCompressedTexImage2D(t,r,_,i,n,0)},e._pharseKTX=function(t){var e=new Uint8Array(t,0,12);if(171!=e[0]||75!=e[1]||84!=e[2]||88!=e[3]||32!=e[4]||49!=e[5]||49!=e[6]||187!=e[7]||13!=e[8]||10!=e[9]||26!=e[10]||10!=e[11])throw"Invalid fileIdentifier in KTX header";var a=new Int32Array(e.buffer,e.length,13),i=a[4],r=this._getGLFormat();switch(this._format){case 5:if(i!==r)throw"the format  is not same with texture format FORMAT_ETC1RGB.";break;default:throw"unknown texture format."}var _=a[11],n=a[6],s=a[7];if(this._width!==n||this._height!==s)throw"the width or height is not same with Texture2D.";var o=64+a[12];this._upLoadCompressedTexImage2D(t,n,s,_,o,4)},e._pharsePVR=function(t){var e=new Int32Array(t,0,13);if(55727696!=e[0])throw"Invalid magic number in PVR header";var a=e[2];switch(this._format){case 5:if(6!==a)throw"the format  is not same with texture format FORMAT_ETC1RGB.";break;case 9:if(0!==a)throw"the format  is not same with texture format FORMAT_PVRTCRGB_2BPPV.";break;case 11:if(2!==a)throw"the format  is not same with texture format FORMAT_PVRTCRGB_4BPPV.";break;case 10:if(1!==a)throw"the format  is not same with texture format FORMAT_PVRTCRGBA_2BPPV.";break;case 12:if(3!==a)throw"the format  is not same with texture format FORMAT_PVRTCRGBA_4BPPV.";break;default:throw"unknown texture format."}var i=e[11],r=e[7],_=e[6];if(this._width!==r||this._height!==_)throw"the width or height is not same with Texture2D.";var n=e[12]+52;this._upLoadCompressedTexImage2D(t,r,_,i,n,0)},e._upLoadCompressedTexImage2D=function(t,e,a,i,r,_){var n=K.instance,s=this._glTextureType;Mt.bindTexture(n,s,this._glTexture);for(var o=this._getGLFormat(),h=r,l=0;l<i;l++){h+=_;var u=this._calcualatesCompressedDataSize(this._format,e,a),c=new Uint8Array(t,h,u);n.compressedTexImage2D(s,l,o,e,a,0,c),e>>=1,a>>=1,h+=u}var d=h;this._setGPUMemory(d),this._readyed=!0,this._activeResource()},e.loadImageSource=function(t,e){void 0===e&&(e=!1);var a=t.width,i=t.height;this._width=a,this._height=i,this._setWarpMode(10242,this._wrapModeU),this._setWarpMode(10243,this._wrapModeV),this._setFilterMode(this._filterMode);var r=K.instance;Mt.bindTexture(r,this._glTextureType,this._glTexture);var _=this._getGLFormat();p.isConchApp?(t.setPremultiplyAlpha(e),r.texImage2D(this._glTextureType,0,6408,6408,5121,t)):(e&&r.pixelStorei(37441,!0),r.texImage2D(this._glTextureType,0,_,_,5121,t),e&&r.pixelStorei(37441,!1)),this._mipmap&&this._isPot(a)&&this._isPot(i)?(r.generateMipmap(this._glTextureType),this._setGPUMemory(a*i*4*(1+1/3))):this._setGPUMemory(a*i*4),this._canRead&&(p.isConchApp?this._pixels=new Uint8Array(t._nativeObj.getImageData(0,0,a,i)):(o.canvas.size(a,i),o.canvas.clear(),o.context.drawImage(t,0,0,a,i),this._pixels=new Uint8Array(o.context.getImageData(0,0,a,i).data.buffer))),this._readyed=!0,this._activeResource()},e.setPixels=function(t,e){if(void 0===e&&(e=0),!t)throw"Texture2D:pixels can't be null.";var a=this._width,i=this._height,r=K.instance,_=this._glTextureType;Mt.bindTexture(r,_,this._glTexture);var n=this._getGLFormat();r.texImage2D(_,e,n,a,i,0,n,5121,t),this._mipmap&&this._isPot(a)&&this._isPot(i)?(r.generateMipmap(_),this._setGPUMemory(a*i*4*(1+1/3))):this._setGPUMemory(a*i*4),this._canRead&&(this._pixels=t),this._readyed=!0,this._activeResource()},e.setCompressData=function(t){switch(this._format){case 3:case 4:this._pharseDDS(t);break;case 5:this._pharseKTX(t);break;case 9:case 10:case 11:case 12:this._pharsePVR(t);break;default:throw"Texture2D:unkonwn format."}},e._recoverResource=function(){},e.getPixels=function(){if(this._canRead)return this._pixels;throw new Error("Texture2D: must set texture canRead is true.")},_(0,e,"defaulteTexture",function(){return laya.webgl.resource.Texture2D.grayTexture}),Texture2D.__init__=function(){var t=new Uint8Array(3);t[0]=128,t[1]=128,t[2]=128,Texture2D.grayTexture=new Texture2D(1,1,0,!1,!1),Texture2D.grayTexture.setPixels(t),Texture2D.grayTexture.lock=!0},Texture2D._parse=function(t,e,a){var i=a?new Texture2D(a[0],a[1],a[2],a[3],a[4]):new Texture2D(0,0);switch(e&&(i.wrapModeU=e.wrapModeU,i.wrapModeV=e.wrapModeV,i.filterMode=e.filterMode,i.anisoLevel=e.anisoLevel),i._format){case 0:case 1:i.loadImageSource(t);break;case 3:case 4:case 5:case 9:case 10:case 11:case 12:i.setCompressData(t);break;default:throw"Texture2D:unkonwn format."}return i},Texture2D.load=function(t,e){a.loader.create(t,e,null,"TEXTURE2D")},Texture2D.grayTexture=null,Texture2D}(),te=function(t){function Shader2X(t,e,a,i,r){this._params2dQuick2=null,this._shaderValueWidth=0,this._shaderValueHeight=0,Shader2X.__super.call(this,t,e,a,i,r)}r(Shader2X,"laya.webgl.shader.d2.Shader2X",t);var e=Shader2X.prototype;return e._disposeResource=function(){t.prototype._disposeResource.call(this),this._params2dQuick2=null},e.upload2dQuick2=function(t){this.upload(t,this._params2dQuick2||this._make2dQuick2())},e._make2dQuick2=function(){if(!this._params2dQuick2){this._params2dQuick2=[];for(var t,e=this._params,a=0,i=e.length;a<i;a++)"size"!==(t=e[a]).name&&this._params2dQuick2.push(t)}return this._params2dQuick2},Shader2X.create=function(t,e,a,i,r){return new Shader2X(t,e,a,i,r)},Shader2X}(Kt),ee=function(t){function IndexBuffer2D(t){this._uint16Array=null,void 0===t&&(t=35044),IndexBuffer2D.__super.call(this),this._bufferUsage=t,this._bufferType=34963,this._buffer=new ArrayBuffer(8)}r(IndexBuffer2D,"laya.webgl.utils.IndexBuffer2D",qt);var e=IndexBuffer2D.prototype;return e._checkArrayUse=function(){this._uint16Array&&(this._uint16Array=new Uint16Array(this._buffer))},e.getUint16Array=function(){return this._uint16Array||(this._uint16Array=new Uint16Array(this._buffer))},e._bindForVAO=function(){K.instance.bindBuffer(34963,this._glBuffer)},e.bind=function(){return Zt._bindedIndexBuffer!==this._glBuffer&&(K.instance.bindBuffer(34963,this._glBuffer),Zt._bindedIndexBuffer=this._glBuffer,!0)},e.destory=function(){this._uint16Array=null,this._buffer=null},e.disposeResource=function(){this._disposeResource()},IndexBuffer2D.create=function(t){return void 0===t&&(t=35044),new IndexBuffer2D(t)},IndexBuffer2D}(),ae=function(t){function VertexBuffer2D(t,e){this._floatArray32=null,this._uint32Array=null,this._vertexStride=0,VertexBuffer2D.__super.call(this),this._vertexStride=t,this._bufferUsage=e,this._bufferType=34962,this._buffer=new ArrayBuffer(8),this._floatArray32=new Float32Array(this._buffer),this._uint32Array=new Uint32Array(this._buffer)}r(VertexBuffer2D,"laya.webgl.utils.VertexBuffer2D",qt);var e=VertexBuffer2D.prototype;return e.getFloat32Array=function(){return this._floatArray32},e.appendArray=function(t){var e=this._byteLength>>2;this.setByteLength(this._byteLength+4*t.length),this.getFloat32Array().set(t,e),this._upload=!0},e._checkArrayUse=function(){this._floatArray32&&(this._floatArray32=new Float32Array(this._buffer)),this._uint32Array&&(this._uint32Array=new Uint32Array(this._buffer))},e.deleteBuffer=function(){this._disposeResource()},e._bindForVAO=function(){K.instance.bindBuffer(34962,this._glBuffer)},e.bind=function(){return Zt._bindedVertexBuffer!==this._glBuffer&&(K.instance.bindBuffer(34962,this._glBuffer),Zt._bindedVertexBuffer=this._glBuffer,!0)},e.destroy=function(){laya.resource.Resource.prototype.destroy.call(this),this._byteLength=0,this._upload=!0,this._buffer=null,this._floatArray32=null},_(0,e,"vertexStride",function(){return this._vertexStride}),VertexBuffer2D.create=function(t,e){return void 0===e&&(e=35048),new VertexBuffer2D(t,e)},VertexBuffer2D}();a.__init([ht,rt,yt,St])}(window,document,Laya);