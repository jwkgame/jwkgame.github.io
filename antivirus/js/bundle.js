!function(){"use strict";var e,t,i=Laya.ClassUtils.regClass;!function(e){class t extends Laya.Scene{constructor(){super()}createChildren(){super.createChildren(),this.createView(t.uiView)}}t.uiView={type:"Scene",props:{width:640,runtime:"game/UIGame.ts",height:1136},compId:2,child:[{type:"Box",props:{y:0,x:0,name:"ui"},compId:14,child:[{type:"Sprite",props:{y:0,x:0,texture:"gameui/bg.png",name:"bg"},compId:4},{type:"Sprite",props:{y:222,x:32,texture:"gameui/board.png",name:"board"},compId:6},{type:"Button",props:{y:46,x:42,var:"btnBack",stateNum:1,skin:"gameui/back.png",scaleY:1.2,scaleX:1.2,name:"btnBack"},compId:10},{type:"Text",props:{y:836,x:77,var:"txtTips",text:"说明文字。。。。。。",name:"txtTips",fontSize:32,font:"Microsoft YaHei",bold:!1,runtime:"laya.display.Text"},compId:7},{type:"Button",props:{y:902,x:468,width:141,var:"btnTips",stateNum:1,skin:"gameui/button.png",name:"btnTips",height:43},compId:9,child:[{type:"Image",props:{y:2,x:70.5,skin:"gameui/ad.png"},compId:11},{type:"Text",props:{y:10,x:16,text:"提示",fontSize:24,font:"Microsoft YaHei",color:"#fbfbfb",bold:!0,runtime:"laya.display.Text"},compId:12}]}]},{type:"Box",props:{y:266,x:73,width:492,var:"board",height:492},compId:15}],loadList:["gameui/bg.png","gameui/board.png","gameui/back.png","gameui/button.png","gameui/ad.png"],loadList3D:[]},e.mainUI=t,i("ui.mainUI",t)}(e||(e={})),function(e){e[e.None=0]="None",e[e.C2=1]="C2",e[e.H2=2]="H2",e[e.V2=3]="V2",e[e.H3=4]="H3",e[e.V3=5]="V3"}(t||(t={}));class s{}s.GridSize=82;class a{get block(){return this._block}set block(e){e?e.grids.add(this):this._block&&this._block.grids.delete(this),this._block=e}}class o{constructor(){this.grids=new Set}}class n extends Laya.Script{constructor(){super(),this.m_dragging=!1,this.m_blockLens=[0,2,2,2,3,3]}setBlock(e){this.m_block=e}onMouseDown(e){this.m_dragging=!0,this.m_dragBeginX=e.stageX,this.m_dragBeginY=e.stageY}onMouseMove(e){if(!this.m_dragging)return;let i=e.stageX-this.m_dragBeginX,a=e.stageY-this.m_dragBeginY,o=this.owner,n=Laya.Handler.create(this,this.onMouseUp);this.m_block.type==t.C2||this.m_block.type==t.H2||this.m_block.type==t.H3?(i>s.GridSize/2&&this.canMovePos(this.m_block.x+this.m_blockLens[this.m_block.type],this.m_block.y)&&(Laya.Tween.to(this.owner,{x:o.x+s.GridSize},100,Laya.Ease.linearInOut,n),l.instance.m_grids[this.m_block.x][this.m_block.y].block=null,l.instance.m_grids[this.m_block.x+this.m_blockLens[this.m_block.type]][this.m_block.y].block=this.m_block,this.m_block.x++,this.m_dragging=!1,this.m_dragBeginX=e.stageX,this.m_dragBeginY=e.stageY),i<-s.GridSize/2&&this.canMovePos(this.m_block.x-1,this.m_block.y)&&(Laya.Tween.to(this.owner,{x:o.x-s.GridSize},100,Laya.Ease.linearInOut),l.instance.m_grids[this.m_block.x+this.m_blockLens[this.m_block.type]-1][this.m_block.y].block=null,l.instance.m_grids[this.m_block.x-1][this.m_block.y].block=this.m_block,this.m_block.x--,this.m_dragging=!1,this.m_dragBeginX=e.stageX,this.m_dragBeginY=e.stageY)):this.m_block.type!=t.V2&&this.m_block.type!=t.V3||(a>s.GridSize/2&&this.canMovePos(this.m_block.x,this.m_block.y+this.m_blockLens[this.m_block.type])&&(Laya.Tween.to(this.owner,{y:o.y+s.GridSize},100,Laya.Ease.linearInOut),l.instance.m_grids[this.m_block.x][this.m_block.y].block=null,l.instance.m_grids[this.m_block.x][this.m_block.y+this.m_blockLens[this.m_block.type]].block=this.m_block,this.m_block.y++,this.m_dragging=!1,this.m_dragBeginX=e.stageX,this.m_dragBeginY=e.stageY),a<-s.GridSize/2&&this.canMovePos(this.m_block.x,this.m_block.y-1)&&(Laya.Tween.to(this.owner,{y:o.y-s.GridSize},100,Laya.Ease.linearInOut),l.instance.m_grids[this.m_block.x][this.m_block.y+this.m_blockLens[this.m_block.type]-1].block=null,l.instance.m_grids[this.m_block.x][this.m_block.y-1].block=this.m_block,this.m_block.y--,this.m_dragging=!1,this.m_dragBeginX=e.stageX,this.m_dragBeginY=e.stageY))}onMouseUp(e){this.m_dragging=!1,l.instance.onBlockDragEnd()}canMovePos(e,t){return!!this.isValidGridPos(e,t)&&null==l.instance.m_grids[e][t].block}isValidGridPos(e,t){return e>=0&&t>=0&&e<6&&t<6}}class l extends e.mainUI{constructor(){super(),this.m_grids=[],this.m_gridSize=82,this.m_level="1",this.m_blocks=new Set,l.instance=this}initGrids(){for(let e=0;e<6;e++){this.m_grids.push([]);for(let t=0;t<6;t++){let i=new a;i.x=e,i.y=t,i.pos=new Laya.Point(e*s.GridSize,t*s.GridSize),this.m_grids[e][t]=i}}}onEnable(){this.initGrids(),this.LoadStorage(),Laya.loader.load("config/levels.json",Laya.Handler.create(this,this.onLoadConfig)),this.btnBack.on(Laya.Event.CLICK,this,this.onClickBtnBack),this.btnTips.on(Laya.Event.CLICK,this,this.onClickBtnTips)}LoadStorage(){if(!Laya.LocalStorage.support)return;let e=Laya.LocalStorage.getItem("level");e||(e="1",Laya.LocalStorage.setItem("level",e)),this.m_level=e}onLoadConfig(e){this.m_configs=e;let t=this.m_configs[this.m_level];console.log(t),this.buildBoard(t)}clearBoard(){for(var e of this.m_blocks)for(var t of e.grids)t.block=null;this.m_blocks.clear(),this.clearBlocks()}buildBoard(e){e.items.forEach(e=>{let i=new o;console.log(e),console.log(this.m_grids);let s=this.m_grids[e.x][e.y];i.x=e.x,i.y=e.y,i.type=e.type,s.block=i,this.m_blocks.add(i);let a=i.type;a==t.C2||a==t.H2?this.m_grids[s.x+1][s.y].block=i:a==t.H3?(this.m_grids[s.x+1][s.y].block=i,this.m_grids[s.x+2][s.y].block=i):a==t.V2?this.m_grids[s.x][s.y+1].block=i:a==t.V3&&(this.m_grids[s.x][s.y+1].block=i,this.m_grids[s.x][s.y+2].block=i)}),this.showBlocks()}showBlocks(){for(let e of this.m_blocks){let t=new Laya.Sprite;t.loadImage(`gameui/${e.type}.png`),t.pos(e.x*s.GridSize,e.y*s.GridSize);let i=new n;i.setBlock(e),t.addComponentIntance(i),this.board.addChild(t)}}clearBlocks(){this.board.removeChildren()}onBlockDragEnd(){this.isWin()&&this.onWin()}isWin(){let e=this.m_grids[5][2].block;return!(!e||e.type!=t.C2)}onWin(){this.onClickBtnNext()}onClickBtnBack(){}onClickBtnTips(){}onClickBtnNext(){this.clearBoard(),this.m_level=(Number(this.m_level)+1).toString();let e=this.m_configs[this.m_level];this.buildBoard(e)}}class c{constructor(){}static init(){(0,Laya.ClassUtils.regClass)("game/UIGame.ts",l)}}c.width=640,c.height=1136,c.scaleMode="fixedwidth",c.screenMode="none",c.alignV="top",c.alignH="left",c.startScene="main.scene",c.sceneRoot="",c.debug=!0,c.stat=!1,c.physicsDebug=!1,c.exportSceneToJson=!0,c.init();new class{constructor(){window.Laya3D?Laya3D.init(c.width,c.height):Laya.init(c.width,c.height,Laya.WebGL),Laya.Physics&&Laya.Physics.enable(),Laya.DebugPanel&&Laya.DebugPanel.enable(),Laya.stage.scaleMode=c.scaleMode,Laya.stage.screenMode=c.screenMode,Laya.stage.alignV=c.alignV,Laya.stage.alignH=c.alignH,Laya.URL.exportSceneToJson=c.exportSceneToJson,(c.debug||"true"==Laya.Utils.getQueryString("debug"))&&Laya.enableDebugPanel(),c.physicsDebug&&Laya.PhysicsDebugDraw&&Laya.PhysicsDebugDraw.enable(),c.stat&&Laya.Stat.show(),Laya.alertGlobalError=!0,Laya.ResourceVersion.enable("version.json",Laya.Handler.create(this,this.onVersionLoaded),Laya.ResourceVersion.FILENAME_VERSION)}onVersionLoaded(){Laya.AtlasInfoManager.enable("fileconfig.json",Laya.Handler.create(this,this.onConfigLoaded))}onConfigLoaded(){c.startScene&&Laya.Scene.open(c.startScene)}}}();